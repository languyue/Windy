(function(e){function t(t){for(var i,l,o=t[0],n=t[1],c=t[2],d=0,u=[];d<o.length;d++)l=o[d],Object.prototype.hasOwnProperty.call(s,l)&&s[l]&&u.push(s[l][0]),s[l]=0;for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);p&&p(t);while(u.length)u.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,o=1;o<a.length;o++){var n=a[o];0!==s[n]&&(i=!1)}i&&(r.splice(t--,1),e=l(l.s=a[0]))}return e}var i={},s={app:0},r=[];function l(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=i,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)l.d(a,i,function(t){return e[t]}.bind(null,i));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],n=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var p=n;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0264":function(e,t,a){"use strict";a("9c5c")},"0587":function(e,t,a){"use strict";a("b282")},"0b51":function(e,t,a){"use strict";a("47d5")},"0cfd":function(e,t,a){"use strict";a("41f8")},1255:function(e,t,a){"use strict";a("746c")},"18c5":function(e,t,a){},"19aa":function(e,t,a){"use strict";a("d89d")},"19c7":function(e,t,a){},"1b39":function(e,t,a){"use strict";a("8e4d")},"1d06":function(e,t,a){"use strict";a("e9b3")},"1e95":function(e,t,a){"use strict";a("2857")},2039:function(e,t,a){e.exports=a.p+"img/ssh.09b44442.png"},2161:function(e,t,a){},2235:function(e,t,a){},2857:function(e,t,a){},2910:function(e,t,a){"use strict";a("9224")},"2a98":function(e,t,a){},"2eef":function(e,t,a){},"30b4":function(e,t,a){},3131:function(e,t,a){},"322c":function(e,t,a){"use strict";a("7105")},"3a47":function(e,t,a){"use strict";a("6c37")},"3aa8":function(e,t,a){"use strict";a("f176")},"41db":function(e,t,a){},"41f4":function(e,t,a){"use strict";a("2eef")},"41f8":function(e,t,a){},"460d":function(e,t,a){"use strict";a("e844")},"47d5":function(e,t,a){},"4aca":function(e,t,a){"use strict";a("5699")},"4c8b":function(e,t,a){"use strict";a("fb45")},"4e7c":function(e,t,a){},5699:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);var i=a("2b0e"),s=function(){var e=this,t=e._self._c;return t("el-container",[t("el-header",{staticClass:"header"},[t("el-menu",{staticClass:"title-menu",attrs:{mode:"horizontal","default-active":e.$route.path,"background-color":"#545c64","text-color":"#fff",router:!0,"active-text-color":"#ffd04b"}},[t("el-submenu",{attrs:{index:"/"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-help"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("服务管理")])]),t("el-menu-item",{attrs:{index:"/"}},[t("i",{staticClass:"el-icon-s-opportunity"}),e._v(" 服务列表")]),t("el-menu-item",{attrs:{index:"/service/resource"}},[t("i",{staticClass:"el-icon-location"}),e._v(" api管理")])],2),t("el-submenu",{attrs:{index:"/code/change"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-share"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("流水线管理")])]),t("el-menu-item",{attrs:{index:"/code/change"}},[t("i",{staticClass:"el-icon-s-unfold"}),e._v(" 变更列表")]),t("el-menu-item",{attrs:{index:"/pipeline"}},[t("i",{staticClass:"el-icon-share"}),e._v(" 流水线")]),t("el-menu-item",{attrs:{index:"/pipe/action"}},[t("i",{staticClass:"el-icon-coin"}),e._v(" 流水线节点")])],2),t("el-submenu",{attrs:{index:"/case"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-promotion"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("用例管理")])]),t("el-menu-item",{attrs:{index:"/case"}},[t("i",{staticClass:"el-icon-cpu"}),e._v(" 测试集")]),t("el-menu-item",{attrs:{index:"/template"}},[t("i",{staticClass:"el-icon-s-platform"}),e._v(" 模版管理")]),t("el-menu-item",{attrs:{index:"/task"}},[t("i",{staticClass:"el-icon-s-order"}),e._v(" 任务管理")])],2),t("el-submenu",{attrs:{index:"/system"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-promotion"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("系统管理")])]),t("el-menu-item",{attrs:{index:"/system"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v(" 系统配置")]),t("el-menu-item",{attrs:{index:"/env"}},[t("i",{staticClass:"el-icon-place"}),e._v(" 环境管理")]),t("el-menu-item",{attrs:{index:"/monitor"}},[t("i",{staticClass:"el-icon-s-platform"}),e._v(" 监控")])],2)],1)],1),t("el-main",{staticClass:"main-bg"},[t("router-view")],1)],1)},r=[],l={data(){return{selectIndex:"/"}},methods:{togleCollapse(){this.isStartCollapse=!this.isStartCollapse}}},o=l,n=(a("322c"),a("2877")),c=Object(n["a"])(o,s,r,!1,null,null,null),p=c.exports,d=a("5c96"),u=a.n(d),h=(a("0fae"),a("8c4f")),m=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"service"},[t("el-row",[t("el-col",{attrs:{span:22}},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"small",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.service,callback:function(t){e.service=t},expression:"service"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增测试集")])],1)],1)],1)],1)],1),t("div",{staticClass:"content"},[t("el-table",{attrs:{data:e.featureData,size:"mini"}},[t("el-table-column",{attrs:{prop:"testCaseName",label:"测试集"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"最近编辑时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.startEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.startDelete(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{type:"info",plain:"",icon:"el-icon-document-copy",size:"mini"},on:{click:function(t){return e.startCopy(a.row)}}},[e._v("复制")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:"创建测试集",visible:e.showDialog,width:"70%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("el-form",{ref:"caseForm",attrs:{model:e.caseForm,rules:e.rule,size:"small","label-width":"120px"}},[t("el-form-item",{attrs:{label:"测试集名称",prop:"testCaseName"}},[t("el-input",{attrs:{placeholder:"请输入测试集名称"},model:{value:e.caseForm.testCaseName,callback:function(t){e.$set(e.caseForm,"testCaseName",t)},expression:"caseForm.testCaseName"}})],1),t("el-form-item",{attrs:{label:"测试集描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请输入测试集描述"},model:{value:e.caseForm.description,callback:function(t){e.$set(e.caseForm,"description",t)},expression:"caseForm.description"}})],1),t("el-form-item",{attrs:{label:"选择服务",prop:"serviceId"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.caseForm.serviceId,callback:function(t){e.$set(e.caseForm,"serviceId",t)},expression:"caseForm.serviceId"}},e._l(e.serviceList,(function(e){return t("el-option",{key:e.serviceId,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("caseForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"复制测试集",visible:e.showCopyDialog,width:"70%"},on:{"update:visible":function(t){e.showCopyDialog=t},close:e.cancellCopy}},[t("h3",[e._v(" 原测试集名称: "),t("span",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.copyCase.testCaseName))])]),t("div",{staticStyle:{margin:"20px 40px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:16}},[t("el-input",{attrs:{size:"small",placeholder:"请输入标签过滤用例"},model:{value:e.filterTag,callback:function(t){e.filterTag=t},expression:"filterTag"}})],1),t("el-col",{attrs:{span:8}},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confimFilter}},[e._v("确认过滤")])],1)],1)],1),t("div",{staticStyle:{margin:"20px 40px"}},e._l(e.filterTagList,(function(a,i){return t("el-tag",{key:i,attrs:{type:"success","disable-transitions":!1,closable:"",size:"small"},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a)+" ")])})),1),t("el-row",[t("el-col",{attrs:{span:10}},[t("div",[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),t("div",{staticClass:"tree-list"},[t("el-tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","default-expand-all":"","highlight-current":"","node-key":"featureId",props:{children:"children",label:"featureName"}},on:{"node-click":e.treeNodeClick}})],1)],1)]),t("el-col",{attrs:{span:14}},[t("el-descriptions",{attrs:{title:"用例描述",column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"用例名称："}},[e._v(e._s(e.featureForm.featureName))]),t("el-descriptions-item",{attrs:{label:"最近修改时间"}},[e._v(e._s(e._f("dateFormat")(e.featureForm.updateTime)))]),t("el-descriptions-item",{attrs:{label:"标签"}},e._l(e.featureForm.tags,(function(a){return t("el-tag",{key:a,staticClass:"tag-item",attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])})),1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancellCopy}},[e._v("取 消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmCopy}},[e._v("确定复制")])],1)],1)],1)},v=[],f=a("bc3a"),g=a.n(f);g.a.interceptors.response.use(e=>e,e=>(e.response.data.code?d["Message"].error(`[${e.response.data.code}] ${e.response.data.message}`):d["Message"].error("访问服务器失败"),Promise.reject(e)));let b="";var y={get(e){return new Promise((t,a)=>{g.a.get(b+e).then(e=>{200==e.status?t(e.data):a(e.data)}).catch(e=>{a(e)})})},delete(e){return new Promise((t,a)=>{g.a.delete(b+e).then(e=>{200==e.status?t(e.data):a(e.data)}).catch(e=>{a(e)})})},postFile(e,t){return new Promise((a,i)=>{g.a.post(b+e,t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{200==e.status?a(e.data):i(e.data)}).catch(e=>{i(e)})})},post(e,t){return new Promise((a,i)=>{g.a.post(b+e,t).then(e=>{200==e.status?a(e.data):i(e.data)}).catch(e=>{i(e)})})},put(e,t){return new Promise((a,i)=>{g.a.put(b+e,t).then(e=>{200==e.status?a(e.data):i(e.data)}).catch(e=>{i(e)})})}},w={getServicesPage(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/services/page?page=${e}&size=${t}&name=${a}`;y.get(r).then(e=>{i(e)}).catch(e=>{s(e)})})},getServices(){return new Promise((e,t)=>{let a="/v1/devops/services";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createService(e){return new Promise((t,a)=>{let i="/v1/devops/services";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateService(e){return new Promise((t,a)=>{let i="/v1/devops/services";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteService(e){return new Promise((t,a)=>{let i="/v1/devops/service/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getApiList(e){return new Promise((t,a)=>{let i=`/v1/devops/service/${e}/resources`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getApi(e){return new Promise((t,a)=>{let i="/v1/devops/service/resources/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteApi(e){return new Promise((t,a)=>{let i="/v1/devops/service/resources/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},batchDeleteApi(e){return new Promise((t,a)=>{let i="/v1/devops/service/resources?apis="+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},updateApi(e){return new Promise((t,a)=>{let i="/v1/devops/service/resources";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},createApi(e){return new Promise((t,a)=>{let i="/v1/devops/service/resources";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},importApi(e){return new Promise((t,a)=>{let i="/v1/devops/service/api/import";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},buildGenerate(e){return new Promise((t,a)=>{let i="/v1/devops/service/resources/generate";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},generateTemplate(e){return new Promise((t,a)=>{let i="/v1/devops/service/resource/templates";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getGenerate(e){return new Promise((t,a)=>{let i=`/v1/devops/service/${e}/generate`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getGenerateLog(e){return new Promise((t,a)=>{let i=`/v1/devops/service/${e}/generate/log`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},k={getTestCaseList(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/feature/${e}/cases?page=${t}&pageSize=${a}`;y.get(r).then(e=>{i(e)}).catch(e=>{s(e)})})},createTestCase(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTestCase(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getTestCaseDetail(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTestCase(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getTestCaseConfigs(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/case/${e}/configs`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},addConfigs(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/config";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateConfig(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/config";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteConfig(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/config/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getConfig(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/config/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getCaseFeatures(e){return new Promise((t,a)=>{let i=`/v1/devops/${e}/features`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},C={getFeatures(e){return new Promise((t,a)=>{let i=`/v1/devops/case/${e}/features?page=1&size=10`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureDetail(e){return new Promise((t,a)=>{let i="/v1/devops/feature/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},createFeature(e){return new Promise((t,a)=>{let i="/v1/devops/feature";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteFeature(e){return new Promise((t,a)=>{let i="/v1/devops/feature/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},updateFeature(e){return new Promise((t,a)=>{let i="/v1/devops/feature";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureByUser(e){return new Promise((t,a)=>{let i=`/v1/devops/user/${e}/features`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getExecutePoints(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/${e}/execute/points`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteExecutePoint(e){return new Promise((t,a)=>{let i="/v1/devops/feature/execute/point/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getServiceTemplates(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/${e}/templates`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},startFeature(e){return new Promise((t,a)=>{let i="/v1/devops/feature/start/"+e;y.post(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureHistory(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/${e}/histories`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getExecuteRecords(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/${e}/records`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getExecuteOperators(){return new Promise((e,t)=>{let a="/v1/devops/feature/execute/operators";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},deleteHistory(e){return new Promise((t,a)=>{let i="/v1/devops//feature/history/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},filterFeatureByTag(e){return new Promise((t,a)=>{let i="/v1/devops/feature/tag/filter";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureTree(e){return new Promise((t,a)=>{let i=`/v1/devops/${e}/tree/features`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},copyCaseFeature(e){return new Promise((t,a)=>{let i="/v1/devops/feature/case/copy";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},pasteFeature(e){return new Promise((t,a)=>{let i="/v1/devops/feature/paste";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},batchDeleteFeature(e){return new Promise((t,a)=>{let i="/v1/devops/delete/features";y.delete(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},batchUpdateFeatures(e){return new Promise((t,a)=>{let i="/v1/devops/batch/features";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})}},_={data(){return{service:"",serviceList:[],activeName:"1",tableData:[],showHistory:!1,direction:"rtl",featureData:[],currentPage:1,totalSize:0,showDialog:!1,caseForm:{},queryForm:{},showCopyDialog:!1,checkAll:!1,isIndeterminate:!0,copyCase:{},filterTag:"",filterTagList:[],treeData:[],allKeys:[],featureForm:{},rule:{testCaseName:[{required:!0,message:"请输入测试集名称",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}],serviceId:[{required:!0,message:"请选择关联的服务",trigger:"select"}]}}},methods:{treeNodeClick(e){C.getFeatureDetail(e.featureId).then(e=>{this.featureForm=e.data})},cancellCopy(){this.showCopyDialog=!1,this.filterTagList=[],this.filterTag="",this.copyCase={},this.checkAll=!1,this.featureForm={}},confirmCopy(){let e=this.$refs.tree.getCheckedKeys();if(!e||0==e.length)return void this.$message.warning("请选择需要复制的用例");let t={testCaseId:this.copyCase.testCaseId,featureIds:e};C.copyCaseFeature(t).then(e=>{if(e.data)return this.$message.success("复制成功！"),this.selectService(),void this.cancellCopy();this.$message.error("复制失败！")})},handleClose(e){this.filterTagList.splice(this.filterTagList.indexOf(e),1),this.refreshTag()},confimFilter(){this.filterTag&&(this.filterTagList.length>=5?this.$message.danger("过滤数超过上限"):(this.filterTagList.push(this.filterTag),this.filterTag="",this.refreshTag()))},refreshTag(){if(0==this.filterTagList)return void C.getFeatureTree(this.copyCase.testCaseId).then(e=>{this.treeData=e.data});let e={tags:this.filterTagList,testCaseId:this.copyCase.testCaseId};C.filterFeatureByTag(e).then(e=>{this.treeData=e.data})},handleCheckAllChange(e){e?(this.$refs.tree.setCheckedNodes(this.treeData),this.isIndeterminate=!1):(this.$refs.tree.setCheckedNodes([]),this.isIndeterminate=!0)},startCopy(e){this.showCopyDialog=!0,this.copyCase=e,C.getFeatureTree(e.testCaseId).then(e=>{this.treeData=e.data})},closeDialog(){this.showDialog=!1,this.caseForm={}},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;k.createTestCase(this.caseForm).then(e=>{if(this.closeDialog(),e.data)return this.$message.success("添加测试集成功"),void this.getTestCaseList(1);this.$message.error("添加测试集失败")})})},startCreate(){this.showDialog=!0},getServices(){this.serviceList=[],w.getServices().then(e=>{this.serviceList=e.data,this.service=this.serviceList[0].serviceId,this.selectService()})},selectService(){this.getTestCaseList(1)},pageChange(e){this.getTestCaseList(e)},getTestCaseList(e){k.getTestCaseList(this.service,e,10).then(t=>{this.currentPage=e,this.totalSize=t.data.total,this.featureData=t.data.data})},startEdit(e){this.$router.push({path:"/feature",query:{caseId:e.testCaseId}})},startDelete(e){this.$confirm("测试集删除后用例都会删除，确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{k.deleteTestCase(e.testCaseId).then(()=>{this.$message.success("删除测试集成功"),this.getTestCaseList(this.currentPage)})})}},created(){this.getServices()}},x=_,F=(a("d024"),Object(n["a"])(x,m,v,!1,null,"6b74114e",null)),T=F.exports,P=function(){var e=this,t=e._self._c;return t("div",[t("el-row",[t("el-col",{attrs:{span:5}},[t("div",{staticClass:"title"},[t("el-page-header",{attrs:{content:e.caseName},on:{back:e.goBack}})],1),t("div",{staticClass:"api-list"},[t("div",{staticClass:"service-panel"},[t("div",{staticClass:"op"},[t("div",[e._v("辅助工具")]),t("i",{staticClass:"item el-icon-video-play",on:{click:e.startDebug}},[e._v("调试")]),t("el-tooltip",{attrs:{effect:"dark",content:"设置全局变量",placement:"top-start"}},[t("i",{staticClass:"item el-icon-setting",on:{click:e.showGlobalEnv}},[e._v("全局变量")])])],1),t("div",{staticClass:"search"},[t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入用例名进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1)]),t("div",{staticClass:"feature-title"},[t("el-row",[t("el-col",{attrs:{span:18}},[t("span",{staticClass:"feature-introduce"},[e._v("用例列表")])]),t("el-col",{attrs:{span:6}},[t("span",[t("el-dropdown",{on:{command:e.clickCommand}},[t("el-button",{staticClass:"feature-add",attrs:{type:"text",size:"mini"}},[e._v("操作")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"newItem"}},[e._v("新增用例")]),t("el-dropdown-item",{attrs:{command:"newFolder"}},[e._v("新增目录")]),t("el-dropdown-item",{attrs:{command:"deleteItems"}},[e._v("批量删除")])],1)],1)],1)])],1)],1),t("el-tree",{ref:"tree",attrs:{draggable:"","show-checkbox":"","node-key":"featureId","default-expanded-keys":e.expendList,data:e.caseFeatures,"filter-node-method":e.filterNode},on:{"node-click":e.treeNodeClick,"node-drop":e.dragNodeEvent},scopedSlots:e._u([{key:"default",fn:function({data:a}){return t("div",{key:e.uuid,staticClass:"custom-tree-node"},[t("span",{class:{"folder-Text":2==a.featureType}},[t("i",{class:{"el-icon-tickets":1==a.featureType,"el-icon-folder-opened":2==a.featureType}}),e._v(" "+e._s(a.featureName))]),t("span",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:t=>e.clickCommand(t,a)}},[t("el-button",{attrs:{type:"text"}},[e._v("...")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[2==a.featureType?t("el-dropdown-item",{attrs:{command:"newItem"}},[t("i",{staticClass:"el-icon-tickets"}),e._v("新增用例")]):e._e(),2==a.featureType?t("el-dropdown-item",{attrs:{command:"newFolder"}},[t("i",{staticClass:"el-icon-folder-opened"}),e._v("新增目录")]):e._e(),t("el-dropdown-item",{attrs:{command:"delete"}},[t("i",{staticClass:"el-icon-delete"}),e._v("删除")]),t("el-dropdown-item",{attrs:{command:"copyFeature"}},[t("i",{staticClass:"el-icon-document-copy"}),e._v("复制")]),2==a.featureType?t("el-dropdown-item",{attrs:{command:"pasteFeature"}},[t("i",{staticClass:"el-icon-document-checked"}),e._v("粘贴")]):e._e()],1)],1)],1)])}}])})],1)]),t("el-col",{attrs:{span:19}},[this.infoForm?t("div",{staticClass:"content"},[t("el-tabs",{on:{"tab-click":e.tabChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"用例信息",name:"desc"}},[t("el-descriptions",{attrs:{title:"用例描述",column:3,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.startEditFeature}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.deleteFeature}},[e._v("删除")])],1),t("el-descriptions-item",{attrs:{label:"用例名称："}},[e._v(e._s(e.infoForm.featureName))]),t("el-descriptions-item",{attrs:{label:"用例"}},[e._v(e._s(e.infoForm.featureId))]),t("el-descriptions-item",{attrs:{label:"创建人"}},[e._v(e._s(e.infoForm.author))]),t("el-descriptions-item",{attrs:{label:"创建时间"}},[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(e._f("dateFormat")(e.infoForm.createTime)))])],1),t("el-descriptions-item",{attrs:{label:"修改时间"}},[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(e._f("dateFormat")(e.infoForm.updateTime)))])],1),t("el-descriptions-item",{attrs:{label:"标签",span:3}},e._l(e.dynamicTags,(function(a){return t("el-tag",{key:a,attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])})),1)],2),1==e.infoForm.featureType?t("div",[t("div",{staticClass:"step-title"},[e._v("测试步骤：")]),t("div",{staticClass:"step-line"},[t("el-steps",{attrs:{direction:"vertical",size:"mini",space:"40px"}},e._l(e.formStepList,(function(e,a){return t("el-step",{key:a,attrs:{title:"步骤"+(a+1),status:"process",description:e}})})),1)],1)]):e._e()],1),1==e.infoForm.featureType?t("el-tab-pane",{attrs:{label:"用例配置",name:"config"}},[t("FeatureConfig",{key:e.uuid,attrs:{feature:e.selectFeatureId,service:e.serviceId}})],1):e._e(),1==e.infoForm.featureType?t("el-tab-pane",{attrs:{label:"执行历史",name:"history"}},[t("history",{ref:"historyComp",attrs:{feature:e.infoForm.featureId}})],1):e._e()],1)],1):t("el-empty",{attrs:{description:"请在左侧选择或创建用例"}})],1)],1),t("el-dialog",{attrs:{title:e.featureTitle,visible:e.showFeatureDialog,width:"60%","destroy-on-close":!0},on:{"update:visible":function(t){e.showFeatureDialog=t},close:e.closeFeatureDialog}},[t("el-form",{ref:"featureForm",attrs:{model:e.featureForm,rules:e.featureRule,size:"small","label-width":"80px","label-position":"top"}},[t("el-form-item",{attrs:{label:"名称",prop:"featureName"}},[t("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.featureForm.featureName,callback:function(t){e.$set(e.featureForm,"featureName",t)},expression:"featureForm.featureName"}})],1),1==e.createData.type?t("el-form-item",{attrs:{label:"用例标签"}},[e._l(e.dynamicTags,(function(a,i){return t("el-tag",{key:i,attrs:{closable:"",size:"mini","disable-transitions":!1},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a)+" ")])})),e.inputVisible?t("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"mini"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm.apply(null,arguments)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):t("el-button",{staticClass:"button-new-tag",attrs:{size:"mini"},on:{click:e.showInput}},[e._v("+ 新增标签")])],2):e._e(),1==e.createData.type?t("el-form-item",{attrs:{label:"用例步骤描述"}},[t("el-steps",{attrs:{direction:"vertical",size:"mini",space:"40px"}},[e._l(e.stepList,(function(a,i){return t("el-step",{key:i,attrs:{status:"process",description:a.content}},[t("template",{slot:"title"},[t("span",{on:{mouseover:function(e){a.hover=!0},mouseleave:function(e){a.hover=!1}}},[t("span",[e._v(e._s("步骤"+(i+1)))]),a.hover?t("i",{staticClass:"el-icon-delete step-delete",on:{click:function(t){return e.removeStep(i)}}}):e._e()])])],2)})),t("div",{staticClass:"step-edit"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:6}},model:{value:e.stepContent,callback:function(t){e.stepContent=t},expression:"stepContent"}})],1),t("el-col",{attrs:{span:12}},[t("el-button",{attrs:{type:"primary"},on:{click:e.addStep}},[e._v("新增步骤")])],1)],1)],1)],2)],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFeatureForm("featureForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeFeatureDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"全局环境变量配置",visible:e.showDebugDialog,width:"90%","destroy-on-close":!0},on:{"update:visible":function(t){e.showDebugDialog=t}}},[t("div",{staticClass:"tips"},[e._v(" 全局环境变量：测试集是由多个用例组合在一起的集合，在当前集合内针对于不同的用例可能需要相同的配置信息(比如http请求的域名等信息)， 针对相同的配置信息不用在每个用例里面声明，只需要在全局设置然后在每个用例里声明引用即可。 ")]),t("div",{staticClass:"config-body"},[t("el-table",{key:e.uuid,attrs:{data:e.configData,border:"",size:"small","default-expand-all":"","row-key":"configId","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数",width:"250"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit?t("el-input",{model:{value:a.row.paramKey,callback:function(t){e.$set(a.row,"paramKey",t)},expression:"scope.row.paramKey"}}):t("span",[e._v(e._s(a.row.paramKey))])]}}])}),t("el-table-column",{attrs:{prop:"paramType",label:"参数类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit||a.$index==e.configData.length-1?e._e():t("span",[e._v(e._s(a.row.paramType))]),a.row.isEdit?t("el-select",{attrs:{placeholder:"请选择参数类型"},model:{value:a.row.paramType,callback:function(t){e.$set(a.row,"paramType",t)},expression:"scope.row.paramType"}},e._l(e.paramTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"value",label:"参数值"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit?e._e():t("span",[e._v(e._s(a.row.value))]),a.row.isEdit?t("el-input",{model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}}):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit?t("div",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleSave(a.row)}}},[e._v("保存")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.cancelEditParam(a.row)}}},[e._v("取消")])],1):t("div",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.startEditParam(a.row)}}},[e._v(e._s(a.$index==e.configData.length-1?"新增":"编辑"))]),a.$index!=e.configData.length-1?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")]):e._e()],1)]}}])})],1)],1)])],1)},I=[],D=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"debug-div"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.historyData,size:"mini",height:"500"}},[t("el-table-column",{attrs:{prop:"historyId",label:"执行ID"}}),t("el-table-column",{attrs:{fixed:"",prop:"featureName",label:"用例"}}),t("el-table-column",{attrs:{prop:"createTime",label:"执行时间",formatter:e.dateFormat}}),t("el-table-column",{attrs:{prop:"executeStatus",label:"结果"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.executeStatus?t("el-tag",{attrs:{type:"success"}},[e._v("成功")]):e._e(),3==a.row.executeStatus?t("el-tag",{attrs:{type:"danger"}},[e._v("超时")]):e._e(),4==a.row.executeStatus?t("el-tag",{attrs:{type:"primary"}},[e._v("执行中")]):e._e(),2==a.row.executeStatus?t("el-tag",{attrs:{type:"danger"}},[e._v("失败")]):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.showRecord(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteHistory(a.row)}}},[e._v("删除")])]}}])},[t("template",{slot:"header"},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-refresh"},on:{click:e.refreshRecords}},[e._v("刷新")])],1)],2)],1)],1),t("el-drawer",{attrs:{title:"历史列表",visible:e.showDrawer,"with-header":!1,"append-to-body":!0,"destroy-on-close":!0,size:"40%","modal-append-to-body":!1},on:{"update:visible":function(t){e.showDrawer=t},close:e.closeDetail}},[t("div",{staticClass:"drawer-content"},[t("div",{staticClass:"drawer-title"},[e._v("详情列表")]),t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{name:"preset"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("el-badge",{staticClass:"tab-label",attrs:{value:e.presetError,hidden:e.presetError<=0}},[t("el-button",{attrs:{type:"text"}},[e._v("预置")])],1)],1),t("PanelList",{attrs:{list:e.presetList}})],1),t("el-tab-pane",{attrs:{label:"执行",name:"execute"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("el-badge",{staticClass:"tab-label",attrs:{value:e.executeError,hidden:e.executeError<=0}},[t("el-button",{attrs:{type:"text"}},[e._v("执行")])],1)],1),t("PanelList",{attrs:{list:e.executeList}})],1),t("el-tab-pane",{attrs:{label:"清理",name:"clean"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("el-badge",{staticClass:"tab-label",attrs:{value:e.cleanError,hidden:e.cleanError<=0}},[t("el-button",{attrs:{type:"text"}},[e._v("清理")])],1)],1),t("PanelList",{attrs:{list:e.cleanList}})],1)],1)],1)])],1)},S=[],N=function(){var e=this,t=e._self._c;return t("div",e._l(e.resultList,(function(a,i){return t("div",{key:i},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"list-title",on:{click:function(t){return e.showItem(a)}}},[t("div",{staticClass:"execute-name",style:{color:a.status?"#67C23A":"#F56C6C"}},[a.show?t("i",{staticClass:"el-icon-remove icon-tag"}):t("i",{staticClass:"el-icon-circle-plus icon-tag"}),e._v(" "+e._s(a.name)+" ")]),t("div",{staticClass:"tag-list"},[t("el-tag",{attrs:{type:a.status?"success":"danger",size:"mini"}},[e._v(" "+e._s(a.status?"成功":"失败")+" ")])],1)])]),t("template",{slot:"content"},[2==a.executeType||3==a.executeType?t("div",{staticClass:"cycle-div"},e._l(a.resultList,(function(i,s){return t("div",{key:s},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"list-title",on:{click:function(t){return e.showItem(i)}}},[t("div",{staticClass:"execute-name",style:{color:i.status?"#67C23A":"#F56C6C"}},[i.show?t("i",{staticClass:"el-icon-remove icon-tag"}):t("i",{staticClass:"el-icon-circle-plus icon-tag"}),e._v(" "+e._s(i.name)+" ")]),t("div",{staticClass:"tag-list"},[t("el-tag",{attrs:{type:a.status?"success":"danger",size:"mini"}},[e._v(" "+e._s(i.status?"成功":"失败")+" ")])],1)])]),t("template",{slot:"content"},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-s-promotion"}),e._v(" Request ")])]),t("template",{slot:"content"},[t("div",{staticClass:"request-list"},[i.executeDetailVo.requestTips?t("json-viewer",{attrs:{value:i.executeDetailVo.requestTips,"expand-depth":5,copyable:""}}):e._e()],1)])],2),t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-camera-solid"}),e._v(" Response ")])]),t("template",{slot:"content"},[i.compareResult&&!i.compareResult.compareStatus&&i.compareResult.description?t("div",{staticClass:"request-list"},[e._v(" 比较错误： "),t("span",{staticStyle:{color:"#f56c6c","font-size":"16px","font-weight":"900"}},[e._v(e._s(i.compareResult.description))])]):e._e(),t("div",[t("div",{staticClass:"request-list"},[e._v(" 响应结果: "),i.executeDetailVo.responseDetailVo.responseBody?t("json-viewer",{attrs:{value:i.executeDetailVo.responseDetailVo.responseBody,"expand-depth":5,copyable:""}}):e._e()],1)])])],2),i.executeDetailVo.responseDetailVo.errorMessage?t("div",[t("div",{staticClass:"desc-div error-icon"},[t("i",{staticClass:"el-icon-warning"}),e._v(" Error ")]),t("div",{staticClass:"request-list"},[e._v(" "+e._s(i.executeDetailVo.responseDetailVo.errorMessage)+" ")])]):e._e()],1)],2)],1)})),0):t("div",e._l(a.resultList,(function(a,i){return t("div",{key:i},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-s-promotion"}),e._v(" Request ")])]),t("template",{slot:"content"},[t("div",{staticClass:"request-list"},[a.executeDetailVo.requestTips?t("json-viewer",{attrs:{value:a.executeDetailVo.requestTips,"expand-depth":5,copyable:""}}):e._e()],1)])],2),t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-camera-solid"}),e._v(" Response ")])]),t("template",{slot:"content"},[a.compareResult&&!a.compareResult.compareStatus&&a.compareResult.description?t("div",{staticClass:"request-list"},[e._v(" 比较错误： "),t("span",{staticStyle:{color:"#f56c6c","font-size":"16px","font-weight":"900"}},[e._v(e._s(a.compareResult.description))])]):e._e(),t("div",[t("div",{staticClass:"request-list"},[e._v(" 响应结果: "),a.executeDetailVo.responseDetailVo.responseBody?t("json-viewer",{attrs:{value:a.executeDetailVo.responseDetailVo.responseBody,"expand-depth":5,copyable:""}}):e._e()],1)])])],2),a.executeDetailVo.responseDetailVo.errorMessage?t("div",[t("div",{staticClass:"desc-div error-icon"},[t("i",{staticClass:"el-icon-warning"}),e._v(" Error ")]),t("div",{staticClass:"request-list"},[e._v(" "+e._s(a.executeDetailVo.responseDetailVo.errorMessage)+" ")])]):e._e()],1)})),0)])],2)],1)})),0)},L=[],E=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"main",on:{click:e.showCourse}},[t("div",{staticClass:"title"},[e._t("title")],2)]),t("transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.boxshow,expression:"boxshow"}],staticClass:"lesson"},[t("div",{staticClass:"animate__animated animate__fadeIndown"},[e._t("content")],2)])])],1)},$=[],O={data(){return{boxshow:!1}},methods:{showCourse(){this.boxshow=!this.boxshow}}},z=O,A=(a("2910"),Object(n["a"])(z,E,$,!1,null,"b4de8ad6",null)),V=A.exports,q=a("349e"),R=a.n(q),B={name:"PanelList",components:{Panel:V,JsonViewer:R.a},props:{list:Array},data(){return{resultList:[]}},watch:{list(e){this.exchangeData(e)}},methods:{showItem(e){e.show=!e.show},exchangeData(e){this.resultList=[],e.forEach(e=>{e.executeResult.forEach(e=>{e.status=e.success});let t=1==e.status;e.compareResult&&(t=e.compareResult.compareStatus);let a={name:e.executePointName,executeType:e.executeType,testStage:e.testStage,resultList:e.executeResult,compareResult:e.compareResult,show:!1,status:t};this.resultList.push(a)})}},created(){}},j=B,J=(a("d610"),Object(n["a"])(j,N,L,!1,null,"15ee196d",null)),M=J.exports,G={components:{PanelList:M},props:{feature:String},watch:{feature:function(e){this.featureId=e,this.getFeatureHistory(e)}},data(){return{historyData:[],resultList:[],featureId:"",showDrawer:!1,activeName:"preset",presetList:[],executeList:[],cleanList:[],presetError:0,executeError:0,cleanError:0}},methods:{refreshRecords(){this.getFeatureHistory(this.featureId)},filterRecord(){this.resultList.forEach(e=>{1==e.testStage&&(this.presetList.push(e),1!=e.status&&this.presetError++),2==e.testStage&&(this.executeList.push(e),1!=e.status&&this.executeError++),3==e.testStage&&(this.cleanList.push(e),1!=e.status&&this.cleanError++)})},getFeatureHistory(e){this.historyData=[],C.getFeatureHistory(e).then(e=>{e.data.forEach(e=>{this.historyData.push(e)})})},getExecuteRecords(e){this.resultList=[],C.getExecuteRecords(e).then(e=>{this.resultList=e.data,this.filterRecord()})},closeDetail(){this.resultList=[],this.presetList=[],this.executeList=[],this.cleanList=[],this.activeName="preset",this.presetError=0,this.executeError=0,this.cleanError=0},showRecord(e){this.getExecuteRecords(e.historyId),this.showDrawer=!0},deleteHistory(e){C.deleteHistory(e.historyId).then(()=>{this.getFeatureHistory(this.featureId)})},changeUser(){},dateFormat(e){var t=new Date(e.createTime),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",s=t.getDate()+" ",r=t.getHours()+":",l=t.getMinutes()+":",o=t.getSeconds();return a+i+s+r+l+o}},created(){this.featureId=this.feature}},U=G,H=(a("0cfd"),Object(n["a"])(U,D,S,!1,null,"12470df0",null)),K=H.exports,W=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"feature-content gridBackground"},[t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:18}},[t("div",{staticClass:"edit-content",on:{contextmenu:function(t){return t.preventDefault(),e.onContextmenu.apply(null,arguments)}}},[t("div",{staticClass:"menu-type"},[t("el-radio-group",{attrs:{size:"small"},on:{change:e.selectTestStep},model:{value:e.menuType,callback:function(t){e.menuType=t},expression:"menuType"}},[t("el-radio-button",{attrs:{label:"1"}},[e._v("预置")]),t("el-radio-button",{attrs:{label:"2"}},[e._v("执行")]),t("el-radio-button",{attrs:{label:"3"}},[e._v("清理")])],1)],1),t("div",[e.isShowEmpty?t("el-empty",{attrs:{description:"请在右侧拖拽组件到此处"}}):t("div",[t("draggable",e._b({staticClass:"drag-box",on:{add:e.addItem},model:{value:e.displayList,callback:function(t){e.displayList=t},expression:"displayList"}},"draggable",e.dragOptions,!1),e._l(e.displayList,(function(a,i){return t("div",{key:a.id,staticClass:"content-item"},[t("div",{key:e.uuid,staticClass:"content-item-title",on:{dblclick:function(t){return e.closeDiv(a)}}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:a.editDesc?6:13}},[t("span",{on:{dblclick:()=>{e.isEdit&&!a.editDesc&&e.exchangeEditStatus(a)}}},[e._v(e._s(a.description)+" ")]),t("i",{staticClass:"el-icon-document-copy",on:{click:function(t){return e.copyExecutePoint(a)}}})]),t("el-col",{attrs:{span:4}},[e.isEdit?t("i",{staticClass:"el-icon-delete delete-point",on:{click:function(t){return e.deleteExecutePoint(i,a.pointId)}}}):e._e(),e.isEdit&&!a.editDesc?t("i",{staticClass:"el-icon-edit-outline delete-point",on:{click:function(t){return e.exchangeEditStatus(a)}}}):e._e()]),a.editDesc&&e.isEdit?t("el-col",{attrs:{span:8}},[t("div",[t("el-input",{attrs:{placeholder:"输入功能描述",size:"mini"},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.desc,callback:function(t){e.$set(a,"desc",t)},expression:"executePoint.desc"}})],1)]):e._e(),a.editDesc?t("el-col",{attrs:{span:5}},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.exchangeEditStatus(a,!0)}}},[e._v("保存")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.exchangeEditStatus(a)}}},[e._v("取消")])],1):e._e()],1),t("i",{class:{"el-icon-arrow-down":a.isActive,"right-icon":!0,"el-icon-arrow-right":!a.isActive},on:{click:function(t){return e.closeDiv(a)}}})],1),t("collapse",[t("div",{directives:[{name:"show",rawName:"v-show",value:a.isActive,expression:"executePoint.isActive"}],staticClass:"content-item-detail"},[1==a.executeType||4==a.executeType||5==a.executeType?t("FeatureTemplate",{key:e.uuid,attrs:{data:a,isEdit:e.isEdit,type:a.writeType},on:{refreshData:e.refreshValue}}):t("FeatureTool",{key:e.uuid,attrs:{data:a,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1)])],1)})),0)],1)],1)])]),t("el-col",{attrs:{span:6}},[t("div",{staticClass:"feature-config-list"},[t("div",{staticClass:"operate"},[e.isEdit?e._e():t("el-link",{attrs:{icon:"el-icon-edit",underline:!1,type:"primary",size:"middle"},on:{click:e.clickEdit}},[e._v("编辑")]),e.isEdit?t("el-link",{attrs:{icon:"el-icon-upload",type:"success",underline:!1,size:"middle"},on:{click:e.saveConfig}},[e._v("保存")]):e._e(),e.isEdit?t("el-link",{attrs:{icon:"el-icon-circle-close",type:"info",underline:!1,size:"middle"},on:{click:e.cancelEdit}},[e._v("取消")]):e._e(),e.isEdit?e._e():t("el-link",{attrs:{icon:"el-icon-video-play",type:"success",underline:!1,size:"middle"},on:{click:e.startDebug}},[e._v("调试")])],1),t("el-collapse",{attrs:{accordion:""},model:{value:e.toolType,callback:function(t){e.toolType=t},expression:"toolType"}},[t("el-collapse-item",{attrs:{title:"基础工具",name:"1"}},[t("draggable",{attrs:{list:e.featureItemList,group:{name:"api",pull:"clone"},animation:"100"},on:{start:e.startDrag}},e._l(e.featureItemList,(function(a,i){return t("div",{key:i},[a.isTool?t("div",{staticClass:"feature-item"},[t("div",{staticClass:"template-name"},[e._v(" "+e._s(a.name)+" ")]),t("div",{staticClass:"template-desc"},[e._v(" "+e._s(a.description)+" ")])]):e._e()])})),0)],1),t("el-collapse-item",{attrs:{title:"业务模版",name:"2"}},[t("div",[t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入模版名称过滤"},model:{value:e.filterName,callback:function(t){e.filterName=t},expression:"filterName"}})],1),t("draggable",{staticClass:"template-list",attrs:{list:e.featureItemList,group:{name:"api",pull:"clone"},animation:"100"},on:{start:e.startDrag}},e._l(e.templateList,(function(a,i){return t("div",{key:i},[a.isTool?e._e():t("div",{staticClass:"feature-item"},[t("div",{staticClass:"template-name"},[e._v(" "+e._s(a.name)+" ")]),t("div",{staticClass:"template-desc"},[e._v(" "+e._s(a.description)+" ")])])])})),0)],1)],1)],1)])],1)],1)])])},Q=[],Y=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title"},[t("div",{staticClass:"select-button"},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.writeType,callback:function(t){e.writeType=t},expression:"writeType"}},[t("el-radio-button",{attrs:{label:"1"}},[e._v("用例")]),t("el-radio-button",{attrs:{label:"2"}},[e._v("校验")]),t("el-radio-button",{attrs:{label:"3"}},[e._v("变量")])],1)],1)]),t("div",{staticClass:"content"},["1"==e.writeType?t("div",e._l(e.executePoint.params,(function(a,i){return t("el-row",{key:i,staticClass:"item-line"},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"param_name"},[e._v(e._s(a.paramKey)+":")])]),t("el-col",{attrs:{span:20}},[t("FeatureEdit",{attrs:{point:e.executePoint.pointId,feature:a,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1)],1)})),1):e._e(),"2"==e.writeType?t("div",[t("FeatureCompare",{attrs:{isEdit:e.isEdit,point:e.executePoint.pointId,data:e.executePoint.compareDefine},on:{refreshCompare:e.refreshCompare}})],1):e._e(),"3"==e.writeType?t("div",[t("FeatureVariable",{attrs:{isEdit:e.isEdit,point:e.executePoint.pointId,data:e.executePoint.variableDefine},on:{refreshVariable:e.refreshVariable}})],1):e._e()])])},X=[],Z=function(){var e=this,t=e._self._c;return t("div",["Array"==e.data.type?t("div",[t("div",{staticClass:"array-plus"},[e.isEdit?t("span",{on:{click:e.addParam}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 新增")]):e._e()]),"Object"==e.data.initData.rangeType?t("div",e._l(e.data.value,(function(a,i){return t("div",{key:i,staticClass:"array-show-box"},[t("el-row",[t("el-col",{attrs:{span:22}},e._l(a.rangeList,(function(a,s){return t("el-row",{key:s,staticClass:"item-line"},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"param_name"},[e._v(e._s(a.paramKey)+":")])]),t("el-col",{attrs:{span:20}},[t("FeatureEdit",{attrs:{point:e.pointId,feature:a,isEdit:e.isEdit},on:{refreshData:function(t){return e.refreshArrayValue(t,i)}}})],1)],1)})),1),t("el-col",{attrs:{span:2}},[e.isEdit?t("div",{staticClass:"array-delete"},[t("span",{on:{click:function(t){return e.deleteArray(i)}}},[t("i",{staticClass:"el-icon-remove-outline"}),e._v(" 删除")])]):e._e()])],1)],1)})),0):t("div",e._l(e.paramList,(function(a,i){return t("div",{key:i,staticClass:"array-show-box"},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-input",{attrs:{size:"small",disabled:!e.isEdit},on:{input:function(t){return e.refreshList(i)}},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"item.content"}})],1),t("el-col",{attrs:{span:4}},[e.isEdit?t("div",{staticClass:"array-delete"},[t("span",{on:{click:function(t){return e.deleteList(i)}}},[t("i",{staticClass:"el-icon-remove-outline"}),e._v(" 删除")])]):e._e()])],1)],1)})),0)]):"Object"==e.data.type?t("div",e._l(e.paramList,(function(a,i){return t("el-row",{key:i,staticClass:"item-line"},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"param_name"},[e._v(e._s(a.paramKey)+":")])]),t("el-col",{attrs:{span:15}},[t("FeatureEdit",{attrs:{point:e.pointId,feature:a,isEdit:e.isEdit},on:{refreshData:function(t){return e.refreshObjectValue(t)}}})],1)],1)})),1):"Map"==e.data.type?t("div",e._l(e.paramList,(function(a,i){return t("el-row",{key:i},[t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入键"},on:{input:e.notifyData},model:{value:a.keyName,callback:function(t){e.$set(a,"keyName",t)},expression:"item.keyName"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:9}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入值"},on:{input:e.notifyData},model:{value:a.keyValue,callback:function(t){e.$set(a,"keyValue",t)},expression:"item.keyValue"}})],1),t("el-col",{attrs:{span:3}},[e.isEdit?t("div",{staticClass:"op-icon"},[t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.deleteValueItem(e.data.value,i)}}}),t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:e.addValueItem}})]):e._e()])],1)})),1):"Integer"==e.data.type||"Long"==e.data.type?t("div",[t("el-input-number",{attrs:{size:"small",disabled:!e.isEdit,"controls-position":"right",placeholder:e.data.description},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}})],1):"Boolean"==e.data.type?t("div",[t("el-switch",{attrs:{size:"small",disabled:!e.isEdit,"active-color":"#13ce66","inactive-color":"#909399"},on:{change:e.notifyData},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}})],1):"Float"==e.data.type||"Double"==e.data.type?t("div",[t("el-input-number",{attrs:{size:"small",precision:2,step:.1,disabled:!e.isEdit,"controls-position":"right",placeholder:e.data.description},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}})],1):t("el-input",{attrs:{size:"small",disabled:!e.isEdit,placeholder:e.data.description},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-full-screen"},on:{click:function(t){return e.diaplayString(e.data.value)}},slot:"append"})],1),t("el-dialog",{attrs:{title:"数据编辑",visible:e.showDetail,width:"60%"},on:{"update:visible":function(t){e.showDetail=t},close:e.closeEditor}},[t("monaco",{ref:"editer",attrs:{codes:e.jsonStr,readonly:!1}})],1)],1)},ee=[],te=function(){var e=this,t=e._self._c;return t("div",[t("div",{ref:"container",staticClass:"monaco-editor"})])},ae=[],ie=a("f33e"),se={props:{codes:{type:String},readonly:{type:Boolean,default:function(){return!1}}},watch:{codes:{immediate:!0,handler(e){this.content=e,this.setDataValue(e)}},content:{handler(e){this.$emit("change",e)}}},data(){return{monacoEditor:null,readOnly:!0,content:""}},methods:{getValue(){return this.monacoEditor.getValue()},initEditer(){this.$nextTick(()=>{let e=this;this.$refs.container.innerHTML="",e.monacoEditor=ie["a"].create(e.$refs.container,{value:this.content,language:"json",theme:"vs-dark",editorOptions:{selectOnLineNumbers:!0,roundedSelection:!1,readOnly:!1,cursorStyle:"line",automaticLayout:!0,glyphMargin:!0}}),e.monacoEditor.onDidChangeModelContent(()=>{e.content=e.monacoEditor.getValue()}),window.onresize=function(){e.monacoEditor.layout()}})},setDataValue(e){this.monacoEditor&&this.monacoEditor.setValue(e)}},mounted(){this.initEditer(),this.readOnly=this.readonly}},re=se,le=(a("eff7"),Object(n["a"])(re,te,ae,!1,null,"00ed5aad",null)),oe=le.exports,ne={name:"FeatureEdit",props:{feature:Object,isEdit:Boolean,point:String},components:{FeatureEdit:de,monaco:oe},watch:{feature(e){this.data=JSON.parse(JSON.stringify(e)),this.exchangeDataValue()}},data(){return{pointId:"",data:{value:[]},paramList:[],uniqId:"",jsonStr:"",showDetail:!1}},methods:{closeEditor(){this.data.value=this.$refs.editer.getValue()},deleteArray(e){this.data.value.splice(e,1),this.notifyData()},addParam(){if("Object"==this.data.initData.rangeType){let e=[];this.data.initData.range.forEach(t=>{let a=JSON.parse(JSON.stringify(t));a.value=null,e.push(a)}),this.data.value.push({rangeList:e})}else this.paramList.push({content:""});this.$forceUpdate()},deleteList(e){this.paramList.splice(e,1),this.refreshList()},refreshObjectValue(e){this.data.value[e.item.paramKey]=e.item.value,this.notifyData()},refreshList(){let e=[];this.paramList.forEach(t=>{e.push(t.content)}),this.data.value=e,this.notifyData()},refreshArrayValue(e,t){this.data.value[t][e.item.paramKey]=e.item.value,this.notifyData()},diaplayString(e){this.showDetail=!0,this.jsonStr=e},notifyData(){let e=this.data;if(console.log(e),"Map"==this.data.type){let t={};this.paramList.forEach(e=>{t[e.keyName]=e.keyValue}),e.value=t,e.paramKey=this.data.paramKey}this.$emit("refreshData",{item:e,pointId:this.pointId}),this.$forceUpdate()},matchMap(e){let t=[];if(null==e||void 0==e)return t.push({keyName:"",keyValue:""}),t;for(var a in e)t.push({keyName:a,keyValue:e[a]});return 0==t.length&&t.push({keyName:"",keyValue:""}),t},deleteValueItem(e,t){this.paramList.splice(t,1),0==this.paramList.length&&this.paramList.push({keyName:"",keyValue:""}),this.notifyData()},addValueItem(){this.paramList.push({keyName:"",keyValue:""})},exchangeDataValue(){if(this.data.value||"Boolean"!=this.data.type||(this.data.value=!1),"Map"==this.data.type&&(this.paramList=this.matchMap(this.data.value)),this.data.value&&"Array"==this.data.type&&"Object"!=this.data.initData.rangeType&&(this.paramList=[],this.data.value.forEach(e=>{this.paramList.push({content:e})})),this.data.value&&this.data.initData&&"Object"==this.data.initData.rangeType){let e=this.data.initData.range;this.data.value.forEach(t=>{e.forEach(e=>{e.value=t[e.paramKey]}),t.rangeList=JSON.parse(JSON.stringify(e))})}if(this.data.value||"Array"!=this.data.type||(this.data.value=[]),"Object"==this.data.type){this.data.value=this.data.value?this.data.value:null;let e=JSON.parse(JSON.stringify(this.data));this.paramList=[],e.initData.range.forEach(e=>{this.data.value&&(e.value=this.data.value[e.paramKey]),this.paramList.push(e)})}!this.data.value&&this.data.initData&&this.data.initData.data&&(this.data.value=this.data.initData.data)}},created(){this.pointId=this.point,this.data=this.feature,this.exchangeDataValue()}},ce=ne,pe=(a("0b51"),Object(n["a"])(ce,Z,ee,!1,null,"60e7624f",null)),de=pe.exports,ue=function(){var e=this,t=e._self._c;return t("div",{staticClass:"line"},[e._l(e.compareData,(function(a,i){return t("el-row",{key:i},[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"item"},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入响应参数"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.compareKey,callback:function(t){e.$set(a,"compareKey",t)},expression:"item.compareKey"}})],1)]),t("el-col",{attrs:{span:5}},[t("div",{staticClass:"item"},[t("el-select",{attrs:{disabled:!e.isEdit,placeholder:"选择运算符",size:"mini"},model:{value:a.operator,callback:function(t){e.$set(a,"operator",t)},expression:"item.operator"}},e._l(e.operatorList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1)]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"item"},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入期望值"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.expectValue,callback:function(t){e.$set(a,"expectValue",t)},expression:"item.expectValue"}},[t("template",{slot:"append"},[t("i",{staticClass:"el-icon-full-screen",on:{click:function(t){return e.diaplayString(a)}}})])],2)],1)]),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"delete-div"},[t("i",{staticClass:"el-icon-remove-outline delete-icon",class:{"disable-icon":!e.isEdit},on:{click:function(t){return e.deleteValueItem(e.compareData,i)}}})])])],1)})),t("div",{staticClass:"add-line",class:{"disable-select":!e.isEdit},on:{click:e.addItem}},[e._m(0)]),t("el-dialog",{attrs:{title:"数据编辑",visible:e.showDetail,width:"60%"},on:{"update:visible":function(t){e.showDetail=t},close:e.closeEditor}},[t("monaco",{ref:"editer",attrs:{codes:e.jsonStr,readonly:!1}})],1)],2)},he=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"add-button"},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])}],me={props:{data:Array,point:String,isEdit:Boolean},components:{monaco:oe},data(){return{showDetail:!1,operator:"",operatorList:[],compareData:[],disableSelect:"disable-select",pointId:"",jsonStr:"",chooseItem:null}},methods:{closeEditor(){this.chooseItem.expectValue=this.$refs.editer.getValue()},diaplayString(e){this.chooseItem=e,this.showDetail=!0,this.jsonStr=e.expectValue},deleteValueItem(e,t){e.splice(t,1),0==e.length&&e.push({keyName:"",keyValue:""}),this.notifyData()},notifyData(){this.$emit("refreshCompare",{data:this.compareData,pointId:this.pointId})},addItem(){this.compareData.push({})},getOperators(){this.operatorList=[],C.getExecuteOperators().then(e=>{e.data.forEach(e=>{this.operatorList.push({label:e,value:e})})})},isEmptyArray(e){return null==e||void 0==e||0==e.length}},created(){this.pointId=this.point,this.compareData=this.data,this.isEmptyArray(this.compareData)&&(this.compareData=[{}]),this.getOperators()}},ve=me,fe=(a("84ec"),Object(n["a"])(ve,ue,he,!1,null,"bca0ce16",null)),ge=fe.exports,be=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[e._l(e.paramList,(function(a,i){return t("div",{key:i,staticClass:"input-line"},[t("el-row",[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入参数名称"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.variableKey,callback:function(t){e.$set(a,"variableKey",t)},expression:"item.variableKey"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入值"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.variableValue,callback:function(t){e.$set(a,"variableValue",t)},expression:"item.variableValue"}})],1),t("el-col",{attrs:{span:4}},[t("el-checkbox",{staticClass:"global-box",attrs:{disabled:!e.isEdit},model:{value:a.global,callback:function(t){e.$set(a,"global",t)},expression:"item.global"}},[e._v("全局变量")])],1),e.isEdit?t("el-col",{attrs:{span:2}},[t("div",{staticClass:"delete-icon",on:{click:function(t){return e.deleteValueItem(e.paramList,i)}}},[t("i",{staticClass:"el-icon-remove-outline"})])]):e._e()],1)],1)})),t("div",{staticClass:"add-line",class:{"disable-select":!e.isEdit},on:{click:e.addItem}},[e._m(0)])],2)},ye=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"add-button"},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])}],we={props:{data:Array,isEdit:Boolean,point:String},data(){return{paramList:[],pointId:""}},methods:{addItem(){this.paramList.push({})},notifyData(){this.$emit("refreshVariable",{data:this.paramList,pointId:this.pointId})},deleteValueItem(e,t){e.splice(t,1),0==e.length&&e.push({variableKey:"",variableValue:""}),this.notifyData()}},created(){this.pointId=this.point,this.data?this.paramList=this.data:this.paramList.push({})}},ke=we,Ce=(a("1255"),Object(n["a"])(ke,be,ye,!1,null,"730a454a",null)),_e=Ce.exports,xe={props:{data:Object,isEdit:Boolean,type:String},components:{FeatureEdit:de,FeatureCompare:ge,FeatureVariable:_e},watch:{data(e){this.executePoint=e},type(e){this.writeType=e}},data(){return{executePoint:{},writeType:""}},methods:{refreshValue(e){this.executePoint.params.forEach(t=>{e.item.paramKey==t.paramKey&&(t.value=e.item.value)}),console.log("refreshValue",this.executePoint.params),this.$emit("refreshData",{data:this.executePoint})},refreshCompare(e){this.executePoint.compareDefine=e.data,this.$emit("refreshData",{data:this.executePoint})},refreshVariable(e){this.executePoint.variableDefine=e.data,this.$emit("refreshData",{data:this.executePoint})}},created(){this.executePoint=this.data,this.writeType=this.type}},Fe=xe,Te=(a("d527"),Object(n["a"])(Fe,Y,X,!1,null,"145b0a21",null)),Pe=Te.exports,Ie=function(){var e=this,t=e._self._c;return t("div",[2==e.executePoint.executeType?t("div",[t("FeatureFor",{attrs:{data:e.executePoint,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1):e._e(),3==e.executePoint.executeType?t("div",[t("FeatureIF",{attrs:{data:e.executePoint,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1):e._e()])},De=[],Se=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"for-box"},[t("div",{staticClass:"for-start"},[e._v(" 循环次数 "),t("el-input-number",{staticClass:"size-input",attrs:{disabled:!e.isEdit,size:"mini",inline:""},on:{input:e.notifyData},model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}})],1),e._v(" { "),t("div",[t("draggable",{staticClass:"for-content",attrs:{group:"api",animation:"100"},on:{add:e.addFeature},model:{value:e.forFeatures,callback:function(t){e.forFeatures=t},expression:"forFeatures"}},[t("el-collapse",{key:e.uuid,attrs:{accordion:""}},e._l(e.forFeatures,(function(a,i){return t("el-collapse-item",{key:i,attrs:{name:a.randomId}},[t("template",{slot:"title"},[t("span",[e._v(" "+e._s(a.name)+" ")]),e.isEdit?t("i",{staticClass:"el-icon-delete delete-point",on:{click:function(t){return e.deleteExecutePoint(i)}}}):e._e()]),t("div",{staticClass:"content-item"},[t("FeatureTemplate",{attrs:{data:a,isEdit:e.isEdit,type:a.writeType},on:{refreshData:e.refreshValue}})],1)],2)})),1)],1)],1),e._v(" } ")])])},Ne=[],Le=a("b76a"),Ee=a.n(Le),$e={props:{data:Object,isEdit:Boolean},components:{draggable:Ee.a,FeatureTemplate:Pe},data(){return{forData:{},size:"",str:"<",forFeatures:[],uuid:"",condition:""}},methods:{addFeature(e){this.forFeatures[e.newIndex-1].randomId=(new Date).valueOf(),this.forFeatures[e.newIndex-1].writeType="1",this.forFeatures[e.newIndex-1].sortOrder=e.newIndex,this.isEdit=!0,this.uuid=(new Date).valueOf()},notifyData(){this.refreshValue()},refreshValue(e){let t=[];this.forFeatures.forEach(a=>{e&&a.randomId==e.data.randomId&&(a=e.data);let i={compareDefine:a.compareDefine,variableDefine:a.variableDefine,executorUnit:{method:a.method,name:a.name,description:a.description,service:a.service,params:a.params},featureId:this.forData.pointId};t.push(i)});let a=JSON.parse(JSON.stringify(this.forData));a.method=this.condition,a.executePoints=JSON.parse(JSON.stringify(t)),this.$emit("refreshData",{data:a})},deleteExecutePoint(e){this.forFeatures.splice(e,1)}},created(){this.forData=this.data,this.data.method&&(this.condition=this.data.method),this.forFeatures=[],this.data.executePoints&&this.data.executePoints.forEach(e=>{e.executorUnit.randomId=(new Date).valueOf();let t=e.executorUnit;t.writeType="1",t.compareDefine=e.compareDefine,t.variableDefine=e.variableDefine,this.forFeatures.push(t)})}},Oe=$e,ze=(a("1e95"),Object(n["a"])(Oe,Se,Ne,!1,null,"45d5b4f4",null)),Ae=ze.exports,Ve=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"for-title"},[t("div",{staticClass:"for-start"},[e._v(" if( "),t("el-input",{staticClass:"condition-input",attrs:{disabled:!e.isEdit,placeholder:"请输入ongl表达式",size:"mini",inline:""},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}}),e._v(" ) ")],1),e._v(" { "),t("div",[t("draggable",{staticClass:"for-content",attrs:{group:"api",animation:"100"},on:{add:e.addPoint},model:{value:e.points,callback:function(t){e.points=t},expression:"points"}},[t("el-collapse",{key:e.uuid,attrs:{accordion:""}},e._l(e.points,(function(a,i){return t("el-collapse-item",{key:i,attrs:{name:a.randomId}},[t("template",{slot:"title"},[t("span",[e._v(" "+e._s(a.name)+" ")]),e.isEdit?t("i",{staticClass:"el-icon-delete delete-point",on:{click:function(t){return e.deleteExecutePoint(i,a.pointId)}}}):e._e()]),t("div",{staticClass:"content-item"},[t("FeatureTemplate",{attrs:{data:a,isEdit:e.isEdit,type:a.writeType},on:{refreshData:e.refreshValue}})],1)],2)})),1)],1)],1),e._v(" } ")])])},qe=[],Re={props:{data:Object,isEdit:Boolean},components:{draggable:Ee.a,FeatureTemplate:Pe},data(){return{executeData:{},size:"",points:[],uuid:"",condition:""}},methods:{addPoint(e){console.log("add item",e),console.log("posts",this.points);let t=0==e.newIndex?0:e.newIndex-1;this.points[t].randomId||(this.points[t].randomId=this.$utils.randomString(20),this.points[t].writeType="1",this.points[t].sortOrder=e.newIndex),this.isEdit=!0,this.uuid=(new Date).valueOf(),this.notifyData()},notifyData(){this.refreshValue()},refreshValue(e){let t=[];this.points.forEach(a=>{e&&a.randomId==e.data.randomId&&(a=e.data);let i={executorUnit:{method:a.method,name:a.name,description:a.description,service:a.service,params:a.params,invokeType:a.invokeType,headers:a.headers,relatedId:a.relatedId},featureId:this.executeData.pointId,randomId:a.randomId,compareDefine:a.compareDefine,variableDefine:a.variableDefine,executeType:a.executeType};t.push(i)});let a=JSON.parse(JSON.stringify(this.executeData));a.method=this.condition,a.executePoints=JSON.parse(JSON.stringify(t)),this.$emit("refreshData",{data:a})},deleteExecutePoint(e){this.$confirm("确认删除用例执行点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.points.splice(e,1)})}},created(){this.executeData=this.data,this.data.method&&(this.condition=this.data.method),this.points=[],this.data.executePoints&&this.data.executePoints.forEach(e=>{e.executorUnit.randomId=(new Date).valueOf();let t=e.executorUnit;t.writeType="1",t.compareDefine=e.compareDefine,t.variableDefine=e.variableDefine,this.points.push(t)})}},Be=Re,je=(a("0587"),Object(n["a"])(Be,Ve,qe,!1,null,"4676fcbe",null)),Je=je.exports,Me={props:{data:Object,isEdit:Boolean},components:{FeatureFor:Ae,FeatureIF:Je},watch:{data(e){this.executePoint=e}},data(){return{executePoint:{},writeType:""}},methods:{refreshValue(e){this.$emit("refreshData",e)}},created(){this.executePoint=this.data}},Ge=Me,Ue=(a("a6a6"),Object(n["a"])(Ge,Ie,De,!1,null,"43cbccb0",null)),He=Ue.exports;const Ke="0.3s height ease-in-out, 0.3s padding-top ease-in-out, 0.3s padding-bottom ease-in-out",We={"before-enter"(e){e.style.transition=Ke,e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0},enter(e){e.dataset.oldOverflow=e.style.overflow,0!==e.scrollHeight?(e.style.height=e.scrollHeight+"px",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom):(e.style.height="",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom),e.style.overflow="hidden"},"after-enter"(e){e.style.transition="",e.style.height="",e.style.overflow=e.dataset.oldOverflow},"before-leave"(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.height=e.scrollHeight+"px",e.style.overflow="hidden"},leave(e){0!==e.scrollHeight&&(e.style.transition=Ke,e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0)},"after-leave"(e){e.style.transition="",e.style.height="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom}};var Qe={name:"collapseTransition",functional:!0,render(e,{children:t}){const a={on:We};return e("transition",a,t)}},Ye={props:{service:String,feature:String},components:{draggable:Ee.a,FeatureTemplate:Pe,FeatureTool:He,collapse:Qe},watch:{feature:{handler(e){this.featureId=e},deep:!0,immediate:!0},service:{handler(e){this.serviceId=e,this.getExecutePoint()},deep:!0,immediate:!0}},computed:{dragOptions(){return{animation:100,group:"api",revertClone:!0,disabled:!this.isEdit,ghostClass:"ghost"}},isShowEmpty(){let e=!1;return 0!=this.displayList.length&&void 0!=this.displayList.length||(e=!0),this.isDrag&&(e=!1),e},templateList(){return this.featureItemList.filter(e=>!this.filterName||e.name.toLowerCase().includes(this.filterName.toLowerCase()))}},data(){return{displayList:[],allPoints:[],menuType:"2",toolType:"2",isDrag:!1,featureItemList:[],isEdit:!1,uuid:"",isActive:!1,featureId:"",filterName:"",serviceId:""}},methods:{onContextmenu(e){return this.$contextmenu({items:[{label:"粘贴执行点",disabled:!this.isEdit,onClick:()=>{this.pasteExecutePoint()}}],event:e,zIndex:3,minWidth:230}),!0},pasteExecutePoint(){let e=localStorage.getItem("copyItem"),t=JSON.parse(e);t&&t.randomId&&(t.randomId=this.$utils.randomString(20),t.writeType="1",t.testStage=parseInt(this.menuType),t.pointId=null,this.allPoints.push(t),this.displayExepoints(),localStorage.removeItem("copyItem"))},copyExecutePoint(e){localStorage.setItem("copyItem",JSON.stringify(e)),this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:`执行点<strong>[${e.description}]</strong>已复制`,type:"success"})},closeDiv(e){e.isActive=!e.isActive,this.uuid=this.$utils.randomString(20)},deleteExecutePoint(e,t){this.$confirm("确认删除用例执行点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(!t)return this.removeItem(this.displayList[e]),void this.displayExepoints();this.deletePoint(t,e)})},deletePoint(e,t){C.deleteExecutePoint(e).then(e=>{if(1==e.data)return this.removeItem(this.displayList[t]),this.displayExepoints(),void this.$message.success("删除执行点成功");this.$message.warning("删除执行点失败")})},removeItem(e){let t=-1;for(let a in this.allPoints)if(this.allPoints[a]["randomId"]===e.randomId){t=a;break}-1!=t&&this.allPoints.splice(t,1)},startDebug(){C.startFeature(this.featureId).then(e=>{e.data?this.$message.success("开始执行，请查看运行日志"):this.$message.error("执行失败")})},resetOrder(){this.bindStepPoints(),this.allPoints.sort((e,t)=>{let a=e.testStage,i=t.testStage;return a>i?1:a<i?-1:0})},saveConfig(){console.log("this.allPoints",this.allPoints),this.displayList.forEach(e=>{e.editDesc=!1});let e=0,t=[];this.resetOrder(),this.allPoints.forEach(a=>{let i={method:a.method,name:a.name,invokeType:a.invokeType,description:a.description,service:a.service,headers:a.headers,relatedId:a.relatedId};2==a.executeType||3==a.executeType?i.executePoints=a.executePoints:i.params=a.params,t.push({pointId:a.pointId,featureId:this.featureId,templateId:a.templateId,testStage:a.testStage,sortOrder:e,executorUnit:i,compareDefine:a.compareDefine,variableDefine:a.variableDefine,executeType:a.executeType,description:a.description}),e++});let a={featureId:this.featureId,testFeatures:t};C.updateFeature(a).then(()=>{this.$message.success("保存成功"),this.isEdit=!1,this.getExecutePoint()})},exchangeEditStatus(e,t){t&&(e.description=e.desc),e.editDesc=!e.editDesc,this.uuid=this.$utils.randomString(20)},cancelEdit(){this.getExecutePoint(),this.isEdit=!1},clickEdit(){this.isEdit=!this.isEdit},addItem(e){let t=JSON.parse(JSON.stringify(this.templateList)),a=t[e.oldIndex];a.isActive=!0,a.randomId=this.$utils.randomString(20),a.writeType="1",a.sortOrder=e.newIndex,a.testStage=parseInt(this.menuType),a.pointId=null,this.allPoints.push(a),this.isEdit=!0,this.displayExepoints(),this.uuid=this.$utils.randomString(20)},refreshValue(e){let t=[];e.data.executePoints&&e.data.executePoints.forEach(e=>{t.push(e.randomId)}),this.allPoints=this.allPoints.filter(e=>{let a=t.indexOf(e.randomId)<0;return a||this.deletePoint(e.pointId),a});let a=[];this.allPoints.forEach(t=>{t.randomId==e.data.randomId?a.push(e.data):a.push(t)}),this.allPoints=a,this.displayExepoints()},startDrag(){this.isDrag=!0},selectTestStep(){this.bindStepPoints(),this.displayExepoints()},bindStepPoints(){if(0==this.displayList.length)return;let e=this.displayList[0].testStage,t=this.allPoints.filter(t=>t.testStage!=e);this.allPoints=t.concat(JSON.parse(JSON.stringify(this.displayList)))},refreshArray(e){this.displayList=[];let t=0;e.forEach(e=>{this.$set(this.displayList,t,e),t++})},getExecutePoint(){C.getExecutePoints(this.featureId).then(e=>{this.allPoints=[],e.data.forEach(e=>{let t=e.executorUnit,a=t.params,i={id:e.sortOrder,pointId:e.pointId,relatedId:t.relatedId,name:t.name,method:t.method,service:t.service,description:e.description,invokeType:t.invokeType,headers:t.headers,params:a,executePoints:t.executePoints,compareDefine:e.compareDefine,variableDefine:e.variableDefine,writeType:"1",executeType:e.executeType,randomId:this.$utils.randomString(20),testStage:e.testStage,isActive:!1};this.allPoints.push(i)}),this.menuType="2",this.displayExepoints()}),C.getServiceTemplates(this.serviceId).then(e=>{let t=e.data;t.forEach(e=>{e.isTool=1!=e.templateType&&5!=e.templateType,e.executeType=e.templateType}),this.featureItemList=t})},displayExepoints(){this.displayList=[];let e=[],t=parseInt(this.menuType);this.allPoints.forEach(a=>{a.testStage==t&&e.push(a)}),this.displayList=e}},created(){this.getExecutePoint()}},Xe=Ye,Ze=(a("6204"),Object(n["a"])(Xe,W,Q,!1,null,"448321be",null)),et=Ze.exports,tt={components:{history:K,FeatureConfig:et},watch:{filterText(e){this.$refs.tree.filter(e)}},data(){return{infoForm:null,activeName:"desc",filterText:"",caseFeatures:[],showDebugDialog:!1,isConnect:!1,serviceId:"",showFeatureDialog:!1,featureForm:{},isEditFeature:!1,featureTitle:"",caseId:"",stepContent:"",stepList:[],formStepList:[],configData:[],paramTypeList:[{label:"String",value:"String"},{label:"Map",value:"Map"},{label:"List",value:"List"},{label:"Integer",value:"Integer"},{label:"Float",value:"Float"},{label:"Double",value:"Double"}],uuid:0,dynamicTags:[],inputVisible:!1,inputValue:"",createData:{},caseName:"",selectFeatureId:"",featureRule:{featureName:[{required:!0,message:"请输入名称",trigger:"blur"}]},expendList:[]}},methods:{dragNodeEvent(e){console.log("all",this.caseFeatures);let t=[];this.loadItemFromTree(this.caseFeatures,t);let a=0;t.forEach(e=>{e.sortOrder=a,a++}),console.log("drag array ",t,t.length),C.batchUpdateFeatures({featureOrders:t}).then(t=>{t?this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:`用例<strong>[${e.data.featureName}]</strong>排序成功`,type:"success"}):this.$notify({title:"失败",dangerouslyUseHTMLString:!0,message:`用例<strong>[${e.data.featureName}]</strong>排序失败`,type:"error"})})},loadItemFromTree(e,t){e.forEach(e=>{t.push(e),e.children&&this.loadItemFromTree(e.children,t)})},clickCommand(e,t){if("newItem"==e&&(this.startAddFeature(),this.createData.type=1,t&&(this.createData.parentId=t.featureId)),"newFolder"==e&&(this.startAddFeature(),this.createData.type=2,this.featureTitle="添加目录",t&&(this.createData.parentId=t.featureId)),"deleteItems"==e){let e=this.$refs.tree.getCheckedKeys();C.batchDeleteFeature({features:e}).then(()=>{this.requestCaseFeatures(this.caseId),this.uuid=this.$utils.randomString(20)})}if("delete"==e&&C.deleteFeature(t.featureId).then(()=>{this.requestCaseFeatures(this.caseId),this.uuid=this.$utils.randomString(20)}).catch(e=>{this.$message.error(e.response.data.message)}),"copyFeature"==e){let e=[];if(2==t.featureType){let a=this.$refs.tree.getCheckedKeys();if(a.length<1)return void this.$notify({title:"未选中用例",dangerouslyUseHTMLString:!0,message:"请先选择用例，才可复制",type:"error"});t.children.forEach(t=>{let i=a.indexOf(t.featureId);-1!=i&&1==t.featureType&&e.push(t.featureId)})}else e.push(t.featureId);console.log("copy",e),localStorage.setItem("copyFeature",JSON.stringify({featureIds:e,featureType:t.featureType})),this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:`执行点<strong>[${t.featureName}]</strong>已复制`,type:"success"})}if("pasteFeature"==e){let e=localStorage.getItem("copyFeature");if(null==e||""==e||void 0==e)return void this.$notify({title:"粘贴失败",dangerouslyUseHTMLString:!0,message:"粘贴用例为空，请复制之后重新尝试",type:"warning"});let a=JSON.parse(e);a.targetFeature=t.featureId,C.pasteFeature(a).then(e=>{e.data&&(this.expendList=[t.featureId],localStorage.removeItem("copyItem"),this.requestCaseFeatures(this.caseId))})}},handleClose(e){this.dynamicTags.splice(this.dynamicTags.indexOf(e),1)},showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm(){let e=this.inputValue;e&&this.dynamicTags.push(e),this.inputVisible=!1,this.inputValue=""},getTestCaseConfigs(){this.configData=[],k.getTestCaseConfigs(this.caseId).then(e=>{let t=e.data;t.push({paramType:"String"}),this.configData=t})},startEditParam(e){e.isEdit=!0,this.uuid=this.$utils.randomString(20)},cancelEditParam(e){this.uuid=this.$utils.randomString(20),e.isEdit=!1},handleSave(e){e.configId?k.updateConfig(e).then(()=>{this.$message.success("修改配置成功"),this.getTestCaseConfigs()}):(e.unionId=this.caseId,k.addConfigs([e]).then(()=>{this.$message.success("添加配置成功"),this.getTestCaseConfigs()}))},handleDelete(e){k.deleteConfig(e.configId).then(()=>{this.$message.success("删除配置成功"),this.getTestCaseConfigs()})},addStep(){this.stepList.push({content:this.stepContent,hover:!1}),this.stepContent=""},removeStep(e){this.stepList.splice(e,1)},closeFeatureDialog(){this.showFeatureDialog=!1,this.featureForm={},this.dynamicTags=[],this.createData={},this.infoForm&&C.getFeatureDetail(this.infoForm.featureId).then(e=>{this.infoForm=e.data,this.formStepList=[],this.infoForm.testStep.split("|").forEach(e=>{this.formStepList.push(e)})})},startAddFeature(){this.showFeatureDialog=!this.showFeatureDialog,this.isEditFeature=!1,this.featureForm={},this.featureTitle="添加用例",this.stepList=[]},startEditFeature(){this.showFeatureDialog=!this.showFeatureDialog,this.isEditFeature=!0,this.featureTitle="修改用例",this.featureForm=this.infoForm,this.stepList=[],this.infoForm.testStep.split("|").forEach(e=>{this.stepList.push({hover:!1,content:e})})},deleteFeature(){this.$confirm("用例删除后所有执行点数据都会删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{C.deleteFeature(this.infoForm.featureId).then(()=>{this.$message("删除用例成功"),this.requestCaseFeatures(this.caseId)})})},submitFeatureForm(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=JSON.parse(JSON.stringify(this.featureForm));t.author="古月澜",t.modify="古月澜",t.featureType=1,t.testCaseId=this.caseId,t.testFeatures=[];let a="";this.stepList.forEach(e=>{a+=e.content+"|"}),t.testStep=a.substring(0,a.length-1),t.tags=JSON.parse(JSON.stringify(this.dynamicTags)),t.featureType=this.createData.type,t.parentId=this.createData.parentId,this.isEditFeature?C.updateFeature(t).then(()=>{this.$message.success("修改成功"),this.showFeatureDialog=!this.showFeatureDialog,this.requestCaseFeatures(this.caseId)}):C.createFeature(t).then(()=>{this.$message.success("添加成功"),this.showFeatureDialog=!this.showFeatureDialog,this.requestCaseFeatures(this.caseId)})})},startDebug(){let e=this.$refs.tree.getCheckedNodes();0!=e.length?(this.tableData=[],C.startFeature(this.infoForm.featureId).then(e=>{e.data?this.$message.success("开始执行，请查看运行日志"):this.$message.error("执行失败")})):this.$message.warning("请选择服务与用例～")},tabChange(){"history"==this.activeName&&this.$refs.historyComp.getFeatureHistory(this.infoForm.featureId)},treeNodeClick(e){this.activeName="desc",this.infoForm=e,this.dynamicTags=[],this.formStepList=e.testStep.split("|"),this.selectFeatureId=e.featureId,this.expendList=[e.featureId],C.getFeatureDetail(e.featureId).then(e=>{this.dynamicTags=e.data.tags,this.uuid=this.$utils.randomString(20)})},filterNode(e,t){return!e||-1!==t.featureName.indexOf(e)},showGlobalEnv(){this.showDebugDialog=!this.showDebugDialog,this.getTestCaseConfigs()},goBack(){this.$router.go(-1)},requestCaseFeatures(e){C.getFeatureTree(e).then(e=>{this.caseFeatures=e.data})},getCaseDetail(){k.getTestCaseDetail(this.caseId).then(e=>{this.caseName=e.data.testCaseName,this.serviceId=e.data.serviceId})}},created(){this.caseId=this.$route.query.caseId,this.getCaseDetail(),this.requestCaseFeatures(this.caseId)}},at=tt,it=(a("b1b3"),a("c9a5"),Object(n["a"])(at,P,I,!1,null,"23369d06",null)),st=it.exports,rt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"mini",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.serviceId,callback:function(t){e.serviceId=t},expression:"serviceId"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",{attrs:{label:"模版名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入模版名称"},on:{input:e.inputChange},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("手动创建模版")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:function(t){e.showUploadDialog=!e.showUploadDialog}}},[e._v("上传模版文件")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:e.triggerApiDialog}},[e._v("Api生成模版")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.templateData,size:"mini"}},[t("el-table-column",{attrs:{prop:"templateId",label:"模版ID"}}),t("el-table-column",{attrs:{prop:"name",label:"模版名称"}}),t("el-table-column",{attrs:{prop:"description",label:"模版描述"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"最近修改时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{align:"left",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.refreshTemplate(a.row)}}},[e._v("刷新")]),t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1),t("el-dialog",{attrs:{visible:e.showDialog,width:"85%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("template",{slot:"title"},[e._v(" "+e._s(e.dialogTitle)+" "),t("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 用例执行点是由模版拖拽而来，模版定义了执行点运行的基本参数。"),t("br"),e._v("执行点配置好参数值之后执行测试任务 ")]),t("span",[t("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"5px",cursor:"pointer","font-size":"15px"}})])])],1),t("TemplateConfig",{attrs:{isEdit:e.isEdit,config:e.infoForm,isCreate:e.isCreate,service:e.serviceId},on:{dataChange:e.templateChange,complete:e.closeDialog}})],2),t("el-dialog",{attrs:{visible:e.showUploadDialog,title:"模版扫描","destroy-on-close":!0,width:"60%"},on:{"update:visible":function(t){e.showUploadDialog=t}}},[e.parseData.length<=0?t("div",[t("el-upload",{attrs:{drag:"",action:"#","auto-upload":!0,"http-request":e.httpRequest}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jar文件")])])],1):t("div",[t("h3",[e._v("扫描结果")]),t("el-collapse",e._l(e.parseData,(function(a,i){return t("el-collapse-item",{key:i,attrs:{name:"1"}},[t("template",{slot:"title"},[e._v(" "+e._s(a.name)+" - "+e._s(a.description)+" ")]),t("TemplateConfig",{attrs:{isEdit:e.isEdit,config:a,service:e.serviceId},on:{dataChange:function(t){return e.uploadChange(t,i)}}})],2)})),1)],1),e.parseData.length>0?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.deletePlugin}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submitTemplates}},[e._v("确定")])],1):e._e()]),t("el-dialog",{attrs:{visible:e.showAPIDialog,title:"API生成模版",width:"60%"},on:{"update:visible":function(t){e.showAPIDialog=t},close:e.closeApiGenerate}},[!e.previewData||e.previewData.length<1?t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"api-list"},[t("div",{staticClass:"api-title"},[e._v("「"+e._s(e.chooseService)+"」 接口列表")]),t("div",{staticClass:"filter"},[t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入api名称过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-tree",{ref:"apiTree",attrs:{data:e.apiTreeData,"show-checkbox":"","filter-node-method":e.filterNode,props:e.apiProps},on:{"check-change":e.selectTreeNode},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"tree-node"},[0==i.apiType?t("i",{staticClass:"el-icon-folder-opened folder-icon"}):e._e(),t("span",{staticClass:"api-name"},[e._v(e._s(a.label))])])}}],null,!1,1135173118)})],1)])],1),t("el-col",{attrs:{span:16}},[t("div",{staticClass:"api-title"},[e._v("生成配置")]),t("el-form",{attrs:{"label-width":"80px",size:"mini"},model:{value:e.generateForm,callback:function(t){e.generateForm=t},expression:"generateForm"}},[t("el-form-item",{attrs:{label:"是否覆盖"}},[t("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.generateForm.cover,callback:function(t){e.$set(e.generateForm,"cover",t)},expression:"generateForm.cover"}})],1),t("el-form-item",{attrs:{label:"调用方式"}},[t("el-radio-group",{model:{value:e.generateForm.invokeType,callback:function(t){e.$set(e.generateForm,"invokeType",t)},expression:"generateForm.invokeType"}},[t("el-radio",{attrs:{label:2}},[e._v("HTTP调用")]),t("el-radio",{attrs:{label:3}},[e._v("本地方法调用")])],1)],1),3==e.generateForm.invokeType?t("el-form-item",{attrs:{label:"关联模版"}},[t("el-select",{attrs:{placeholder:"请选择关联的模版",clearable:""},on:{change:e.selectTemplate},model:{value:e.generateForm.relatedId,callback:function(t){e.$set(e.generateForm,"relatedId",t)},expression:"generateForm.relatedId"}},e._l(e.uploadTemplates,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1)],1):e._e(),3==e.generateForm.invokeType?t("el-form-item",{attrs:{label:"类名"}},[t("span",[e._v(e._s(e.generateForm.className))])]):e._e(),3==e.generateForm.invokeType?t("el-form-item",{attrs:{label:"方法名"}},[t("span",[e._v(e._s(e.generateForm.methodName))])]):e._e(),3==e.generateForm.invokeType?t("el-alert",{attrs:{title:"请注意",type:"warning",closable:!1,description:"API生成模版参数是最终会组装成4个参数url、method、deader、body，自定义的模版请一定要提供对应的参数名称的入参，在实际执行阶段会根据参数名替换成对应的值。\n              如果在模版还需其他参数请使用默认参数配置到环境变量中去。","show-icon":""}}):e._e()],1)],1)],1)],1):t("div",[t("h3",[e._v("模版预览")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.previewData,size:"mini"}},[t("el-table-column",{attrs:{prop:"name",label:"模版名称"}}),t("el-table-column",{attrs:{prop:"description",label:"模版描述"}}),t("el-table-column",{attrs:{align:"left",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.showTemplate(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deletePreviewTemp(a.$index)}}},[e._v("删除")])]}}])})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.previewData.length<1?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.nextStep}},[e._v("下一步")]):t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.upStep}},[e._v("上一步")]),t("el-button",{attrs:{size:"mini"},on:{click:e.closeApiGenerate}},[e._v("取 消")]),e.previewData.length>0?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveTemplates}},[e._v("生成模版")]):e._e()],1)])],1)},lt=[],ot={getTemplatePage(e,t,a,i){return new Promise((s,r)=>{let l=`/v1/devops/feature/${e}/templates/page?page=${t}&size=${a}&name=${i}`;y.get(l).then(e=>{s(e)}).catch(e=>{r(e)})})},getTemplateList(){return new Promise((e,t)=>{let a="/v1/devops/feature/templates";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getTemplate(e){return new Promise((t,a)=>{let i="/v1/devops/feature/template/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getTemplateByType(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/types/${e}/templates`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},createTemplate(e){return new Promise((t,a)=>{let i="/v1/devops/feature/template";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},batchCreateTemplate(e){return new Promise((t,a)=>{let i="/v1/devops/feature/templates";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deletePlugin(e){return new Promise((t,a)=>{let i="/v1/devops/feature/plugin/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},upload(e){return new Promise((t,a)=>{let i="/v1/devops/feature/template/upload";y.postFile(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTemplate(e){return new Promise((t,a)=>{let i="/v1/devops/feature/template";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTemplate(e){return new Promise((t,a)=>{let i="/v1/devops/feature/template/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},refresh(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/${e}/refresh`;y.put(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},nt=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"infoForm",attrs:{model:e.infoForm,rules:e.infoRule,size:"small",disabled:!e.isEdit,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"模版名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入模版名称"},on:{input:e.dataChange},model:{value:e.infoForm.name,callback:function(t){e.$set(e.infoForm,"name",t)},expression:"infoForm.name"}})],1),t("el-form-item",{attrs:{label:"模版类型",prop:"invokeType"}},[t("el-radio-group",{on:{change:e.dataChange},model:{value:e.infoForm.invokeType,callback:function(t){e.$set(e.infoForm,"invokeType",t)},expression:"infoForm.invokeType"}},[t("el-radio",{attrs:{label:1}},[e._v("本地方法调用")]),t("el-radio",{attrs:{label:2}},[e._v("HTTP调用")]),t("el-radio",{attrs:{label:3}},[e._v("关联模版")])],1)],1),t("el-form-item",{attrs:{label:1==e.infoForm.invokeType?"类名":"Url",prop:"service"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.infoForm.service,callback:function(t){e.$set(e.infoForm,"service",t)},expression:"infoForm.service"}})],1),2==e.infoForm.invokeType?t("el-form-item",{attrs:{label:"请求header"}},e._l(e.headerList,(function(a,i){return t("el-row",{key:i},[t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入"},on:{input:e.dataChange},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入默认值"},on:{input:e.dataChange},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1),t("el-col",{attrs:{span:2}},[e.isEdit?t("i",{staticClass:"el-icon-remove-outline op-icon",on:{click:function(t){return e.removeHeader(i)}}}):e._e(),i==e.headerList.length-1&&e.isEdit?t("i",{staticClass:"el-icon-circle-plus-outline op-icon",on:{click:e.addHeader}}):e._e()])],1)})),1):e._e(),t("el-form-item",{attrs:{label:"方法",prop:"method"}},[1==e.infoForm.invokeType?t("el-input",{attrs:{placeholder:"请输入"},on:{input:e.dataChange},model:{value:e.infoForm.method,callback:function(t){e.$set(e.infoForm,"method",t)},expression:"infoForm.method"}}):t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.dataChange},model:{value:e.infoForm.method,callback:function(t){e.$set(e.infoForm,"method",t)},expression:"infoForm.method"}},e._l(e.httpMethods,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"参数列表"}},e._l(e.infoForm.params,(function(a,i){return t("el-row",{key:i},[t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名"},on:{input:e.dataChange},model:{value:a.paramKey,callback:function(t){e.$set(a,"paramKey",t)},expression:"item.paramKey"}})],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"请选择参数类型"},on:{change:e.dataChange},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"item.type"}},e._l(e.paramTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数描述"},on:{input:e.dataChange},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:2}},[t("el-select",{attrs:{placeholder:"参数位置"},on:{change:e.dataChange},model:{value:a.position,callback:function(t){e.$set(a,"position",t)},expression:"item.position"}},e._l(e.positionList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入默认值"},on:{input:e.dataChange},model:{value:a.initValue,callback:function(t){e.$set(a,"initValue",t)},expression:"item.initValue"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"delete-icon"},[e.isEdit?t("i",{staticClass:"el-icon-remove-outline op-icon",on:{click:function(t){return e.deleteItem(i)}}}):e._e(),i==e.infoForm.params.length-1&&e.isEdit?t("i",{staticClass:"el-icon-circle-plus-outline op-icon",on:{click:e.addItem}}):e._e()])])],1)})),1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请输入模版功能描述",type:"textarea",autosize:{minRows:2,maxRows:4}},on:{input:e.dataChange},model:{value:e.infoForm.description,callback:function(t){e.$set(e.infoForm,"description",t)},expression:"infoForm.description"}})],1),e.isEdit?t("el-form-item",[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submit("infoForm")}}},[e._v("确定")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1):e._e()],1)],1)},ct=[],pt={props:{config:Object,service:String,isEdit:Boolean,isCreate:{type:Boolean,default:!1}},watch:{service:{handler(e){this.serviceId=e},deep:!0,immediate:!0},config:{handler(e){let t=JSON.parse(JSON.stringify(e));if(t.headers&&Object.keys(t.headers).length>0){let e=[];Object.keys(t.headers).forEach(a=>{e.push({key:a,value:t.headers[a]})}),this.headerList=e}else this.headerList=[{key:"",value:""}];if(!t.params||0==t.params.length)return this.infoForm=t,void(this.infoForm.params=[{position:"Body"}]);t.params.forEach(e=>{this.isEmpty(e.initData)||(2==e.type&&(e.range=e.initData.range),e.initValue=e.initData.data)}),this.infoForm=t},deep:!0,immediate:!0}},data(){return{serviceId:"",infoForm:{},headerList:[],infoRule:{name:[{required:!0,message:"请输入模版名称",trigger:"blur"}],invokeType:[{required:!0,message:"请选择执行类型",trigger:"blur"}],service:[{required:!0,message:"此项不能为空",trigger:"blur"}],method:[{required:!0,message:"此项不能为空",trigger:"blur"}],description:[{required:!0,message:"模版描述不能为空",trigger:"blur"}]},options:[],paramTypeList:[{label:"String",value:"String"},{label:"Map",value:"Map"},{label:"Array",value:"Array"},{label:"Integer",value:"Integer"},{label:"Float",value:"Float"},{label:"Double",value:"Double"}],httpMethods:[{label:"Post",value:"Post"},{label:"Get",value:"Get"},{label:"Put",value:"Put"},{label:"Delete",value:"Delete"}],positionList:[{label:"Body",value:"Body"},{label:"Path",value:"Path"},{label:"Query",value:"Query"},{label:"Header",value:"Header"}]}},methods:{isEmpty(e){return!e||""==e||null==e},removeHeader(e){this.headerList.splice(e,1)},addHeader(){this.headerList.push({})},deleteItem(e){this.infoForm.params.splice(e,1)},addItem(){this.infoForm.params.push({position:"Body"})},dataChange(){let e=JSON.parse(JSON.stringify(this.infoForm));e.params.forEach(e=>{e.initData={data:e.initValue,range:e.range}});let t={};this.headerList.forEach(e=>{t[e.key]=e.value}),e.headers=t,this.$emit("dataChange",e)},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=JSON.parse(JSON.stringify(this.infoForm)),a=[];t.params.forEach(e=>{e.initData={data:e.initValue?e.initValue:""},2==e.type&&(e.initData.range=e.range),1==e.type&&this.isEmpty(e.value)&&(e.initData.data="{}"),e.paramKey&&a.push(e)}),t.params=a;let i={};this.headerList.length>0&&this.headerList.forEach(e=>{this.isEmpty(e.key)||this.isEmpty(e.value)||(i[e.key]=e.value)}),t.owner=this.serviceId,t.headers=i,this.isCreate?ot.createTemplate(t).then(()=>{this.$message.success({message:"添加成功",showClose:!0}),this.$emit("complete")}):ot.updateTemplate(t).then(()=>{this.$message.success({message:"修改成功",showClose:!0}),this.$emit("complete")})})},closeDialog(){this.infoForm={params:[{position:"Body"}]},this.$emit("complete")}}},dt=pt,ut=(a("4aca"),Object(n["a"])(dt,nt,ct,!1,null,"7f631b59",null)),ht=ut.exports,mt={components:{TemplateConfig:ht},data(){return{templateData:[],queryForm:{},showDialog:!1,infoForm:{params:[{position:"Body"}]},dialogTitle:"添加执行点模版",isEdit:!1,currentPage:1,totalSize:0,showUploadDialog:!1,parseData:[],pluginId:"",serviceId:"",showAPIDialog:!1,apiTreeData:[],apiProps:{children:"children",label:"apiName"},selectNodes:[],generateForm:{invokeType:2},filterText:"",chooseService:"",previewData:[],uploadTemplates:[],isCreate:!1,pluginType:5}},watch:{filterText(e){this.$refs.apiTree.filter(e)}},methods:{selectTemplate(){this.generateForm.className="",this.generateForm.methodName="",this.uploadTemplates.forEach(e=>{e.templateId==this.generateForm.relatedId&&(this.generateForm.className=e.service,this.generateForm.methodName=e.method)})},saveTemplates(){let e={templates:this.previewData};ot.batchCreateTemplate(e).then(e=>{e.data?(this.$message.success("添加模版成功"),this.closeApiGenerate()):this.$message.error("添加模版失败")})},nextStep(){this.selectNodes.length<1?this.$message.warning("请先选择生成的api"):this.genarateApi()},upStep(){this.previewData=[]},deletePreviewTemp(e){this.previewData.splice(e,1)},showTemplate(e){console.log("show log",e),this.isEdit=!1,this.infoForm=e,this.showDialog=!0},genarateApi(){w.generateTemplate({serviceId:this.serviceId,apiIds:this.selectNodes,invokeType:this.generateForm.invokeType,relatedId:this.generateForm.relatedId,cover:this.generateForm.cover}).then(e=>{e.data.length>0?this.previewData=e.data:this.$message.warning("接口已存在用例，请选择可覆盖选项")})},closeApiGenerate(){this.getTemplatePage(),this.showAPIDialog=!1,this.generateForm={invokeType:2},this.previewData=[]},expendAllNode(){let e=this.$refs["apiTree"].store._getAllNodes();for(let t=0;t<e.length;t++)this.$refs["apiTree"].store._getAllNodes()[t].expanded=!0},triggerApiDialog(){this.showAPIDialog=!this.showAPIDialog,this.serviceList.forEach(e=>{e.serviceId==this.serviceId&&(this.chooseService=e.serviceName)}),this.getServiceApi(),ot.getTemplateByType(this.pluginType).then(e=>{this.uploadTemplates=e.data})},selectTreeNode(e,t){if(console.log("xxxx",e,t),t)this.selectNodes.push(e.apiId);else{let t=this.selectNodes.indexOf(e.apiId);-1!=t&&this.selectNodes.splice(t,1)}},getServiceApi(){w.getApiList(this.serviceId).then(e=>{this.apiTreeData=this.buildTree(e.data),this.expendAllNode()})},buildTree(e,t=null){let a=[];for(let i of e)if(i.parentId===t){let t=this.buildTree(e,i.apiId);t.length>0&&(i.children=t),i.children||(i.children=[]),a.push(i)}return a},filterNode(e,t){return!e||-1!==t.apiName.indexOf(e)},selectService(){this.currentPage=1,this.getTemplatePage()},getServices(){this.serviceList=[],w.getServices().then(e=>{this.serviceList=e.data,this.serviceId=this.serviceList[0].serviceId,this.selectService()})},deletePlugin(){ot.deletePlugin(this.pluginId).then(e=>{e.data?this.$message.success("未使用插件，已清理相关数据"):this.$message.warning("未使用插件，清理数据错误")})},templateChange(e){this.infoForm=e},submitTemplates(){let e={templates:this.parseData,pluginId:this.pluginId};ot.batchCreateTemplate(e).then(e=>{e.data?(this.$message.success("添加模版成功"),this.showUploadDialog=!1,this.parseData=[],this.pluginId="",this.getTemplatePage()):this.$message.error("添加模版失败")})},uploadChange(e,t){this.parseData[t]=e},httpRequest(e){const t=new FormData;t.append("file",e.file),t.append("serviceId",this.serviceId),ot.upload(t).then(e=>{e.data?(this.$message.success("上传文件成功"),this.parseData=e.data.templateDefines,this.pluginId=e.data.pluginId):this.$message.error("上传文件失败")})},removeHeader(e){this.infoForm.headers.splice(e,1)},addHeader(){this.infoForm.headers.push({})},inputChange(){this.currentPage=1,this.getTemplatePage()},pageChange(e){this.currentPage=e,this.getTemplatePage()},getTemplatePage(){let e=this.queryForm.name;e||(e=""),ot.getTemplatePage(this.serviceId,this.currentPage,10,e).then(e=>{this.templateData=e.data.data,this.totalSize=e.data.total})},startQuery(){this.currentPage=1,this.getTemplatePage()},startCreate(){this.isEdit=!0,this.isCreate=!0,this.showDialog=!this.showDialog,this.dialogTitle="手动创建模版",this.infoForm={params:[{position:"Body"}],invokeType:1,method:"",owner:this.serviceId}},refreshTemplate(e){ot.refresh(e.templateId).then(e=>{e.data?this.$message.success("刷新成功"):this.$message.error("刷新失败")})},handleEdit(e){this.isEdit=!0,this.isCreate=!1,this.showDialog=!0,this.dialogTitle="编辑模版",this.infoForm=e},handleDelete(e){this.$confirm(`确认删除模版【${e.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ot.deleteTemplate(e.templateId).then(e=>{e.data?(this.$message.success("删除模版成功"),this.getTemplatePage()):this.$message.error("删除模版失败")})})},closeDialog(){this.showDialog=!1,this.isCreate=!1,this.infoForm={params:[{position:"Body"}]},this.getTemplatePage()}},created(){this.getServices()}},vt=mt,ft=(a("973f"),Object(n["a"])(vt,rt,lt,!1,null,"76979e17",null)),gt=ft.exports,bt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-form",{attrs:{inline:!0,model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"任务名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入任务名称"},on:{input:e.startQuery},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增任务")])],1)],1),t("el-tabs",{on:{"tab-click":e.selectTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"任务管理",name:"first"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.taskData,size:"mini"}},[t("el-table-column",{attrs:{prop:"taskId",label:"任务Id"}}),t("el-table-column",{attrs:{prop:"taskName",label:"任务名称"}}),t("el-table-column",{attrs:{prop:"description",label:"任务状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isRunning?t("i",{staticClass:"el-icon-loading loading-status"}):t("span",[e._v("--")])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-video-play",plain:""},on:{click:function(t){return e.startRun(a.row)}}},[e._v("执行")]),t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.editTask(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteTask(a.row)}}},[e._v("删除")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.taskCurrentPage,layout:"prev, pager, next",total:e.taskTotal},on:{"current-change":e.taskPageChange}})],1)],1),t("el-tab-pane",{attrs:{label:"任务记录",name:"second"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.recordData,size:"mini"}},[t("el-table-column",{attrs:{prop:"taskName",label:"任务名称"}}),t("el-table-column",{attrs:{prop:"statusName",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e._f("statusFormat")(a.row.status)}},[e._v(e._s(a.row.statusName))])]}}])}),t("el-table-column",{attrs:{prop:"userId",label:"执行人"}}),t("el-table-column",{attrs:{label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(e.dateFormat(a.row.updateTime)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[4==a.row.status?t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-video-pause",plain:""},on:{click:function(t){return e.stopRun(a.row)}}},[e._v("停止")]):e._e(),t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.showRecord(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(t){return e.deleteTaskRecord(a.row)}}},[e._v("删除")])]}}])},[t("template",{slot:"header"},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-refresh"},on:{click:function(t){return e.getTaskRecords(1)}}},[e._v("刷新")])],1)],2)],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.recordCurrentPage,layout:"prev, pager, next",total:e.recordTotal},on:{"current-change":e.recordPageChange}})],1)],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.showDialog,width:"70%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("el-form",{ref:"taskForm",attrs:{model:e.taskForm,rules:e.taskRule,size:"small","label-width":"120px"}},[t("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[t("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.taskForm.taskName,callback:function(t){e.$set(e.taskForm,"taskName",t)},expression:"taskForm.taskName"}})],1),t("el-form-item",{attrs:{label:"任务描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请输入任务描述"},model:{value:e.taskForm.description,callback:function(t){e.$set(e.taskForm,"description",t)},expression:"taskForm.description"}})],1),t("el-form-item",{attrs:{label:"选择服务",prop:"serviceId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectService},model:{value:e.taskForm.serviceId,callback:function(t){e.$set(e.taskForm,"serviceId",t)},expression:"taskForm.serviceId"}},e._l(e.services,(function(e){return t("el-option",{key:e.serviceId,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",{attrs:{label:"选择任务集",prop:"testCaseId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectTestCase},model:{value:e.taskForm.testCaseId,callback:function(t){e.$set(e.taskForm,"testCaseId",t)},expression:"taskForm.testCaseId"}},e._l(e.testCases,(function(e){return t("el-option",{key:e.testCaseId,attrs:{label:e.testCaseName,value:e.testCaseId}})})),1)],1),t("el-form-item",{attrs:{label:"任务配置"}},[t("el-button",{staticClass:"sync-btn",attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.refreshConfig}},[e._v("同步测试集配置")]),t("monaco",{ref:"editer",attrs:{codes:e.jsonStr,readonly:!1},on:{change:e.dataChange}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("taskForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)],1)},yt=[],wt={getTaskList(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/feature/tasks?page=${e}&pageSize=${t}&name=${a}`;y.get(r).then(e=>{i(e)}).catch(e=>{s(e)})})},getAllTaskList(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/${e}/tasks`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},createTask(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTask(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskDetail(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},runTask(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task/"+e;y.post(i).then(e=>{t(e)}).catch(e=>{a(e)})})},stopTask(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task/stop/"+e;y.put(i).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTask(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskRecords(e,t){return new Promise((a,i)=>{let s=`/v1/devops/feature/task/records?page=${e}&pageSize=${t}`;y.get(s).then(e=>{a(e)}).catch(e=>{i(e)})})},getTaskRecordDetail(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task/record/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTaskRecord(e){return new Promise((t,a)=>{let i="/v1/devops/feature/task/record/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskHistoryTree(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/task/records/${e}/history/tree`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskHistories(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/task/records/${e}/histories`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskRecordByTriggerId(e){return new Promise((t,a)=>{let i=`/v1/devops/feature/task/${e}/record`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},kt={components:{monaco:oe},data(){return{recordData:[],taskData:[],queryForm:{},taskForm:{},showDialog:!1,dialogTitle:"添加任务",isEdit:!1,activeName:"first",machineList:[],executeList:[],testCases:[],services:[],jsonStr:"a",taskCurrentPage:1,taskTotal:0,recordCurrentPage:1,recordTotal:0,taskRule:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],serviceId:[{required:!0,message:"请选择关联的服务",trigger:"select"}],testCaseId:[{required:!0,message:"请选择关联的测试集",trigger:"select"}]}}},methods:{refreshConfig(){this.selectTestCase(this.taskForm.testCaseId)},dataChange(e){this.jsonStr=e},selectService(e){this.testCases=[],k.getTestCaseList(e,1,100).then(e=>{this.testCases=e.data.data})},selectTestCase(e){let t={};k.getTestCaseConfigs(e).then(e=>{e.data&&(e.data.forEach(e=>{t[e.paramKey]=this.exchangeType(e.paramType,e.value)}),this.jsonStr=JSON.stringify(t,null,3))})},exchangeType(e,t){switch(e){case"String":return t;case"List":return JSON.parse(t);case"Map":return JSON.parse(t);case"Integer":return parseInt(t);case"Float":return parseFloat(t);case"Double":return parseFloat(t)}return t},startRun(e){wt.runTask(e.taskId).then(e=>{e.data?this.$message.success("执行成功,请查看执行记录"):this.$message.error("任务执行失败")}),this.getTasks(this.taskCurrentPage,this.queryForm.name)},stopRun(e){wt.stopTask(e.recordId).then(()=>{this.$message.success("执行成功,请查看执行记录")}),this.getTasks(this.taskCurrentPage,this.queryForm.name),this.getTaskRecords(this.recordCurrentPage)},startQuery(){this.getTasks(1,this.queryForm.name)},startCreate(){this.showDialog=!0,this.taskForm={},this.isEdit=!1},editTask(e){this.isEdit=!0,this.taskForm=e,this.showDialog=!0,this.selectService(e.serviceId),this.jsonStr=JSON.stringify(JSON.parse(e.taskConfig),null,3),e.machines&&(this.executeList=JSON.parse(e.machines))},deleteTask(e){wt.deleteTask(e.taskId).then(e=>{e.data?(this.$message.success("删除成功"),this.getTasks(this.taskCurrentPage,this.queryForm.name)):this.$message.error("删除失败")})},closeDialog(){this.showDialog=!1,this.taskForm={}},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;this.taskForm.machines=JSON.stringify(this.executeList),this.taskForm.taskConfig=this.jsonStr,this.isEdit?wt.updateTask(this.taskForm).then(e=>{this.closeDialog(),this.getTasks(1),1!=e.data?this.$message.warning("修改失败"):this.$message.success("修改成功")}):wt.createTask(this.taskForm).then(e=>{this.closeDialog(),this.getTasks(1),1!=e.data?this.$message.warning("添加失败"):this.$message.success("添加成功")})})},getServices(){this.services=[],w.getServices().then(e=>{this.services=e.data})},getTasks(e,t){t||(t=""),wt.getTaskList(e,10,t).then(e=>{this.taskTotal=e.data.total,this.taskCurrentPage=1,this.taskData=e.data.data})},getTaskRecords(e){wt.getTaskRecords(e,10).then(t=>{this.recordTotal=t.data.total,this.recordCurrentPage=e,this.recordData=t.data.data})},selectTab(){"first"==this.activeName&&this.getTasks(1,this.queryForm.name),"second"==this.activeName&&this.getTaskRecords(1)},taskPageChange(e){this.getTasks(e,this.queryForm.name)},recordPageChange(e){this.getTaskRecords(e)},showRecord(e){this.$router.push({path:"/record/detail",query:{recordId:e.recordId}})},deleteTaskRecord(e){wt.deleteTaskRecord(e.recordId).then(()=>{this.$message.success("删除成功"),this.getTaskRecords(this.recordCurrentPage)})},dateFormat(e){var t=new Date(e),a=t.getFullYear()+"-",i=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",s=t.getDate()+" ",r=t.getHours()+":",l=t.getMinutes()+":",o=t.getSeconds();return a+i+s+r+l+o}},created(){this.getServices(),this.getTasks(1,"")}},Ct=kt,_t=(a("c157"),Object(n["a"])(Ct,bt,yt,!1,null,"3ec1f280",null)),xt=_t.exports,Ft=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title"},[t("el-page-header",{attrs:{content:e.recordName},on:{back:e.goBack}})],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"show-config"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.showRecordConfig}},[e._v("查看配置")])],1),t("div",{staticClass:"search"},[t("span",{staticClass:"filter-txt"},[e._v("状态过滤:")]),t("el-radio-group",{staticClass:"status-box",on:{change:e.chooseStatus},model:{value:e.filterStatus,callback:function(t){e.filterStatus=t},expression:"filterStatus"}},[t("el-radio",{attrs:{label:1}},[e._v("全部")]),t("el-radio",{attrs:{label:2}},[e._v("失败")]),t("el-radio",{attrs:{label:3}},[e._v("成功")])],1),t("el-input",{attrs:{size:"mini",placeholder:"输入用例名进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-tree",{ref:"tree",attrs:{"node-key":"featureId","default-expanded-keys":e.errorList,data:e.recordData,"filter-node-method":e.filterNode,props:{children:"children",label:"featureName"}},on:{"node-click":e.treeNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("span",{},[t("span",{staticClass:"custom-tree-node",style:{color:i.status}},[e._v(e._s(a.label))])])}}])})],1),t("el-col",{attrs:{span:18}},[t("div",{staticClass:"percent-box"},[t("h3",[e._v("任务执行统计")]),t("div",{staticClass:"ui-container"},[t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-result"},[t("el-progress",{attrs:{type:"circle",percentage:e.executePercent}})],1),t("div",{staticClass:"ui-label"},[e._v("执行进度")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value"},[e._v(e._s(e.totalCount))]),t("div",{staticClass:"ui-label"},[e._v("用例总数")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-success"},[e._v(e._s(e.successCount))]),t("div",{staticClass:"ui-label"},[e._v("成功数")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-error"},[e._v(e._s(e.errorCount))]),t("div",{staticClass:"ui-label"},[e._v("失败数")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-result"},[e._v(e._s(e.resultPercent)+"%")]),t("div",{staticClass:"ui-label"},[e._v("成功率")])])])]),e.isShowEmpty?t("el-empty",{attrs:{description:"请在左侧点击详细用例查看详情"}}):t("div",{staticClass:"drawer-content"},[t("div",{staticClass:"record-title"},[e._v(" 【"+e._s(e.chooseFeature.featureName)+"】执行历史记录 ")]),t("div",{staticClass:"execute-detail"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{name:"preset"}},[t("el-badge",{staticClass:"tab-label",attrs:{slot:"label","is-dot":"",hidden:!e.presetError},slot:"label"},[e._v("预置")]),t("PanelList",{attrs:{list:e.presetList}})],1),t("el-tab-pane",{attrs:{name:"execute"}},[t("el-badge",{staticClass:"tab-label",attrs:{slot:"label","is-dot":"",hidden:!e.executeError},slot:"label"},[e._v("执行")]),t("PanelList",{attrs:{list:e.executeList}})],1),t("el-tab-pane",{attrs:{name:"clean"}},[t("el-badge",{staticClass:"tab-label",attrs:{slot:"label","is-dot":"",hidden:!e.cleanError},slot:"label"},[e._v("清理")]),t("PanelList",{attrs:{list:e.cleanList}})],1)],1)],1)])],1)],1),t("el-dialog",{attrs:{visible:e.dialogVisible,title:"任务执行配置",width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("json-viewer",{attrs:{value:e.jsonData,"expand-depth":5,copyable:"",boxed:"",sort:""}})],1)],1)},Tt=[],Pt={components:{PanelList:M,JsonViewer:R.a},data(){return{recordData:[],recordId:"",recordName:"",filterText:"",activeName:"preset",resultList:[],presetList:[],executeList:[],cleanList:[],jsonData:[],dialogVisible:!1,chooseFeature:{},isShowEmpty:!0,errorList:[],presetError:!1,executeError:!1,cleanError:!1,filterStatus:1,totalCount:0,successCount:0,errorCount:0,displayAll:!1}},watch:{filterText(e){this.displayAll=!0,this.$refs.tree.filter(e)}},computed:{resultPercent(){var e=this.successCount/this.totalCount;return Math.round(100*e)},executePercent(){if(0==this.totalCount)return 0;var e=(this.successCount+this.errorCount)/this.totalCount;return Math.round(100*e)}},methods:{chooseStatus(){this.displayAll=1!=this.filterStatus,this.$refs.tree.filter()},goBack(){this.$router.go(-1)},treeNodeClick(e){this.resultList=[],this.activeName="preset",this.chooseFeature=e,this.isShowEmpty=!1,C.getExecuteRecords(e.historyId).then(e=>{this.resultList=e.data,this.filterRecord()})},filterRecord(){this.presetList=[],this.executeList=[],this.cleanList=[],this.resultList.forEach(e=>{1==e.testStage&&(this.presetList.push(e),1!=e.status&&(this.presetError=!0)),2==e.testStage&&(this.executeList.push(e),1!=e.status&&(this.executeError=!0)),3==e.testStage&&(this.cleanList.push(e),1!=e.status&&(this.cleanError=!0))})},filterNode(e,t){return!!(3!=this.filterStatus||t.executeStatus&&1==t.executeStatus)&&(!!(2!=this.filterStatus||t.executeStatus&&2==t.executeStatus)&&(!e||-1!==t.featureName.indexOf(e)))},getTaskHistories(){wt.getTaskHistoryTree(this.recordId).then(e=>{let t=e.data;this.errorCount=0,this.successCount=0,this.displayTreeNode(t),this.recordData=t,this.errorCount+this.successCount==this.totalCount&&clearInterval(this.queryInterval)})},startInterval(){this.queryInterval=setInterval(()=>{this.getTaskHistories()},2e3)},displayTreeNode(e){e.forEach(e=>{e.executeStatus&&(e.status="#67C23A",1!=e.executeStatus?(e.status="#F56C6C",this.errorCount++,this.errorList.push(e.featureId)):this.successCount++),e.children&&e.children.length>0&&this.displayTreeNode(e.children)})},showRecordConfig(){this.dialogVisible=!0,wt.getTaskRecordDetail(this.recordId).then(e=>{this.jsonData=JSON.parse(e.data.taskConfig)})},getRecordDetail(){wt.getTaskRecordDetail(this.recordId).then(e=>{this.recordName="任务名称: "+e.data.taskName,this.getCaseFeatures(e.data.testCaseId)})},getCaseFeatures(e){k.getCaseFeatures(e).then(e=>{e.data.forEach(e=>{1==e.featureType&&this.totalCount++})})}},created(){this.recordId=this.$route.query.recordId,this.getRecordDetail(),this.getTaskHistories(),this.startInterval()}},It=Pt,Dt=(a("7e30"),Object(n["a"])(It,Ft,Tt,!1,null,"26246e46",null)),St=Dt.exports,Nt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"all"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"服务名称"}},[t("el-input",{attrs:{placeholder:"请输入服务名称",clearable:""},on:{input:e.startQuery},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增服务")])],1)],1)],1),t("div",{staticClass:"content"},[t("el-table",{attrs:{data:e.serviceData,size:"mini"}},[t("el-table-column",{attrs:{prop:"serviceName",label:"服务名称"}}),t("el-table-column",{attrs:{prop:"description",label:"服务描述"}}),t("el-table-column",{attrs:{prop:"gitUrl",label:"git地址"}}),t("el-table-column",{attrs:{prop:"priority",label:"优先级"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-rate",{attrs:{disabled:""},model:{value:a.row.priority,callback:function(t){e.$set(a.row,"priority",t)},expression:"scope.row.priority"}})]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.startEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.startDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.showServiceDialog,width:"70%"},on:{"update:visible":function(t){e.showServiceDialog=t},close:e.closeDialog}},[e.notConfigGit?t("el-alert",{attrs:{type:"warning",center:"","show-icon":"",closable:!1}},[t("template",{slot:"title"},[e._v(" 创建服务需先配置环境信息 "),t("el-link",{attrs:{type:"primary"},on:{click:e.goEnv}},[e._v("前往配置>>")])],1)],2):e._e(),t("el-form",{ref:"serviceForm",attrs:{model:e.serviceForm,disabled:!e.isEdit&&e.notConfigGit,rules:e.rules,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"服务名称",prop:"serviceName"}},[t("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.serviceForm.serviceName,callback:function(t){e.$set(e.serviceForm,"serviceName",t)},expression:"serviceForm.serviceName"}})],1),t("el-form-item",{attrs:{label:"服务描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入服务描述"},model:{value:e.serviceForm.description,callback:function(t){e.$set(e.serviceForm,"description",t)},expression:"serviceForm.description"}})],1),t("el-form-item",{attrs:{label:"服务git地址",prop:"gitUrl"}},[t("el-input",{attrs:{placeholder:"请输入服务git地址"},model:{value:e.serviceForm.gitUrl,callback:function(t){e.$set(e.serviceForm,"gitUrl",t)},expression:"serviceForm.gitUrl"}})],1),t("el-form-item",{attrs:{label:"优先级",prop:"gitUrl"}},[t("el-rate",{model:{value:e.serviceForm.priority,callback:function(t){e.$set(e.serviceForm,"priority",t)},expression:"serviceForm.priority"}})],1),t("h3",[e._v("Kubernetes配置")]),t("el-tabs",{staticClass:"k8s-config",attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"基础配置",name:"first"}},[t("el-form-item",{attrs:{label:"环境变量"}},e._l(e.envList,(function(a,i){return t("el-row",{key:i,staticClass:"param-line"},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"环境变量名称"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"env.name"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"环境变量值"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"env.value"}})],1),t("el-col",{attrs:{span:4}},[t("el-switch",{attrs:{"active-text":"系统变量"},model:{value:a.isRelated,callback:function(t){e.$set(a,"isRelated",t)},expression:"env.isRelated"}})],1),t("el-col",{staticClass:"op-box",attrs:{span:4}},[t("i",{staticClass:"el-icon-remove op-icon del",on:{click:function(t){return e.delEnv(i)}}}),i==e.envList.length-1?t("i",{staticClass:"el-icon-circle-plus op-icon add",on:{click:e.addEnv}}):e._e()])],1)})),1),t("el-form-item",{attrs:{label:"文件挂载"}},e._l(e.volumeList,(function(a,i){return t("el-row",{key:i,staticClass:"param-line"},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"主机路径"},model:{value:a.hostVolume,callback:function(t){e.$set(a,"hostVolume",t)},expression:"volume.hostVolume"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"容器路径"},model:{value:a.volume,callback:function(t){e.$set(a,"volume",t)},expression:"volume.volume"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"volume.name"}})],1),t("el-col",{staticClass:"op-box",attrs:{span:4}},[t("i",{staticClass:"el-icon-remove op-icon del",on:{click:function(t){return e.delVolume(i)}}}),t("i",{staticClass:"el-icon-circle-plus op-icon add",on:{click:e.addVolume}})])],1)})),1),t("el-form-item",{attrs:{label:"端口映射"}},e._l(e.portList,(function(a,i){return t("el-row",{key:i,staticClass:"param-line"},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"容器端口"},model:{value:a.port,callback:function(t){e.$set(a,"port",t)},expression:"port.port"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"宿主机端口"},model:{value:a.hostPort,callback:function(t){e.$set(a,"hostPort",t)},expression:"port.hostPort"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"协议类型"},model:{value:a.protocol,callback:function(t){e.$set(a,"protocol",t)},expression:"port.protocol"}},[t("el-option",{attrs:{label:"TCP",value:"TCP"}}),t("el-option",{attrs:{label:"UDP",value:"UDP"}})],1)],1),t("el-col",{staticClass:"op-box",attrs:{span:4}},[t("i",{staticClass:"el-icon-remove op-icon del",on:{click:function(t){return e.delPort(i)}}}),t("i",{staticClass:"el-icon-circle-plus op-icon add",on:{click:e.addPort}})])],1)})),1)],1),t("el-tab-pane",{attrs:{label:"高级配置",name:"second"}},[t("el-form-item",{attrs:{label:"更新策略"}},[t("el-select",{attrs:{placeholder:"选择更新策略"},model:{value:e.strategy,callback:function(t){e.strategy=t},expression:"strategy"}},[t("el-option",{attrs:{label:"暂停更新",value:"Recreate"}})],1)],1),t("el-form-item",{attrs:{label:"节点调度"}},[t("el-radio-group",{model:{value:e.selectWay,callback:function(t){e.selectWay=t},expression:"selectWay"}},[t("el-radio",{attrs:{label:"name"}},[e._v("根据【节点名称】选择节点")]),t("el-radio",{attrs:{label:"label",disabled:""}},[e._v("根据【标签选择器】选择节点")]),t("el-radio",{attrs:{label:"rule"}},[e._v("根据【节点亲和性】选择节点")])],1),t("div",[e._v(" 请选择标签: "),t("el-link",{attrs:{type:"primary"},on:{click:e.chooseNode}},[t("i",{staticClass:"el-icon-thumb"},[e._v("选择标签")])]),e.selectNode?t("span",{staticClass:"chosed-tag"},[e._v("已选择标签："),t("el-tag",{attrs:{size:"mini",closable:""},on:{close:function(t){e.selectNode=null}}},[e._v(e._s(e.selectNode))])],1):e._e()],1)],1)],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("serviceForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"选择节点",visible:e.showChooseNode},on:{"update:visible":function(t){e.showChooseNode=t}}},[t("el-select",{attrs:{placeholder:"请选择环境",size:"mini"},on:{change:e.chooseEnv},model:{value:e.selectEnv,callback:function(t){e.selectEnv=t},expression:"selectEnv"}},e._l(e.deployEnvList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-table",{attrs:{data:e.nodeList},on:{"row-click":e.clickNode}},[t("el-table-column",{attrs:{label:"节点名",prop:"nodeName"}}),t("el-table-column",{attrs:{label:"节点IP",prop:"nodeIp"}})],1)],1)],1)},Lt=[],Et={getEnvs(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/environments?page=${e}&size=${t}&name=${a}`;y.get(r).then(e=>{i(e)}).catch(e=>{s(e)})})},getAllEnvs(){return new Promise((e,t)=>{let a="/v1/devops/environments/all";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createEnv(e){return new Promise((t,a)=>{let i="/v1/devops/environments";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},checkEnv(e,t){return new Promise((a,i)=>{let s="/v1/devops/environment/check?checkType="+e;y.post(s,t).then(e=>{a(e)}).catch(e=>{i(e)})})},updateEnv(e){return new Promise((t,a)=>{let i="/v1/devops/environment";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteEnv(e){return new Promise((t,a)=>{let i="/v1/devops/environments/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getService(e){return new Promise((t,a)=>{let i="/v1/devops/environments/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getNodeList(e){return new Promise((t,a)=>{let i=`/v1/devops/environment/${e}/nodes`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},$t={updateGitConfig(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/system/config/git";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateMavenConfig(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/system/config/maven";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateRepository(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/system/config/repository";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},requestGitConfig(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/git";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},requestMavenConfig(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/maven";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getDefaultPipeline(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/pipe";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getImageRepository(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/repository";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getMonitor(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/monitor";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})}},Ot={data(){return{activeName:"first",serviceData:[],currentPage:1,totalSize:0,queryName:"",dialogTitle:"创建服务",showServiceDialog:!1,serviceForm:{},isEdit:!1,rules:{serviceName:[{required:!0,message:"请输入服务名称",trigger:"blur"}],description:[{required:!0,message:"请输入服务描述",trigger:"blur"}],gitUrl:[{required:!0,message:"请输入服务的git地址",trigger:"blur"}]},notConfigGit:!1,envList:[{}],volumeList:[{}],portList:[{}],showChooseNode:!1,nodeList:[],deployEnvList:[],selectEnv:"",selectWay:"",selectNode:"",strategy:""}},methods:{clickNode(e){this.selectNode=e.nodeName,this.showChooseNode=!1,this.nodeList=[],this.selectEnv=""},chooseEnv(e){Et.getNodeList(e).then(e=>{console.log(e),this.nodeList=e.data})},chooseNode(){this.showChooseNode=!0,this.deployEnvList=[],Et.getAllEnvs().then(e=>{console.log(e),e.data.forEach(e=>{this.deployEnvList.push({label:e.envName,value:e.envId})})})},getNodeList(){},delPort(e){0!=e&&this.portList.splice(e,1)},delEnv(e){0!=e&&this.envList.splice(e,1)},delVolume(e){0!=e&&this.volumeList.splice(e,1)},addPort(){this.portList.push({protocol:"TCP"})},addEnv(){this.envList.push({})},addVolume(){this.volumeList.push({})},startEdit(e){this.dialogTitle="修改服务",this.isEdit=!0,this.showServiceDialog=!0,this.serviceForm=JSON.parse(JSON.stringify(e));let t=e.containerParams;t&&(t.envParams&&t.envParams.length>0&&(this.envList=t.envParams),t.ports&&t.ports.length>0&&(this.portList=t.ports),t.volumes&&t.volumes.length>0&&(this.volumeList=t.volumes),this.selectWay=t.nodeStrategy.type,this.selectNode=t.nodeStrategy.value,this.strategy=t.strategy.type)},startDelete(e){this.$confirm(`确认删除服务【${e.serviceName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{w.deleteService(e.serviceId).then(e=>{if(1==e.data)return this.$message.success("删除服务成功"),this.closeDialog(),void this.getServices(1);this.$message.warning("删除服务失败")})})},startQuery(){this.getServices(1)},startCreate(){this.dialogTitle="添加服务",this.isEdit=!1,this.showServiceDialog=!0,this.serviceForm={}},closeDialog(){this.isEdit=!1,this.showServiceDialog=!1,this.serviceForm={}},pageChange(e){this.getServices(e)},getServices(e){let t=this.queryName;null!=t&&void 0!=t||(t=""),w.getServicesPage(e,10,t).then(t=>{this.totalSize=t.data.total,this.currentPage=e,this.serviceData=t.data.data})},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;let t={envParams:this.envList,ports:this.portList,volumes:this.volumeList,nodeStrategy:{type:this.selectWay,value:this.selectNode},strategy:{type:this.strategy}};this.serviceForm.containerParams=t,this.isEdit?w.updateService(this.serviceForm).then(()=>{this.$message.success("修改成功！"),this.closeDialog(),this.getServices(1)}):w.createService(this.serviceForm).then(()=>{this.$message.success("添加成功！"),this.closeDialog(),this.getServices(1)})})},getGitEnv(){$t.requestGitConfig().then(e=>{this.notConfigGit=this.$utils.isEmpty(e.data.accessToken)})},goEnv(){this.$router.push({path:"/system"})}},created(){this.getGitEnv(),this.getServices(1)}},zt=Ot,At=(a("8779"),Object(n["a"])(zt,Nt,Lt,!1,null,"7a087364",null)),Vt=At.exports,qt=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:5}},[t("div",{staticClass:"api-list"},[t("el-form",{attrs:{inline:"",size:"mini"}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"mini",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.serviceId,callback:function(t){e.serviceId=t},expression:"serviceId"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1)],1),t("div",{staticClass:"filter-text"},[t("div",{staticClass:"filter-op"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:16}},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-tickets"},on:{click:e.queryHistory}},[e._v("二方包构建记录")])],1),t("el-col",{attrs:{span:5}},[t("el-dropdown",{attrs:{szie:"mini"},on:{command:e.selectCommand}},[t("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(" 操作"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"api"}},[e._v("新增接口")]),t("el-dropdown-item",{attrs:{command:"dir"}},[e._v("新增目录")]),t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")]),t("el-dropdown-item",{attrs:{command:"generate"}},[e._v("生成Maven")]),t("el-dropdown-item",{attrs:{command:"import"}},[e._v("API导入")])],1)],1)],1)],1)],1),t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入api名称过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-tree",{ref:"tree",attrs:{data:e.apiTreeData,"show-checkbox":"",draggable:"","filter-node-method":e.filterNode,props:e.apiProps,"allow-drop":e.allowApiDrop},on:{"node-drop":e.handleApiDragEnd,"check-change":e.selectTreeNode,"node-click":e.treeNodeSelect},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"tree-node"},[0==i.apiType?t("i",{staticClass:"el-icon-folder-opened folder-icon"}):e._e(),t("span",{staticClass:"api-name"},[e._v(e._s(a.label))]),t("div",{staticClass:"tree-op-list"},[t("el-dropdown",{on:{command:function(t){return e.selectItemCommand(t,i)}}},[t("span",[e._v(" ... ")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[0==i.apiType?t("el-dropdown-item",{attrs:{command:"api"}},[e._v("新增接口")]):e._e(),0==i.apiType?t("el-dropdown-item",{attrs:{command:"dir"}},[e._v("新增目录")]):e._e(),t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}}])})],1)]),t("el-col",{attrs:{span:19}},[e.apiForm.apiId?t("div",{staticClass:"api-detail"},[t("el-tabs",{attrs:{"before-leave":e.beforeLeave},on:{"tab-click":e.selectTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"接口预览",name:"preview"}},[t("h4",{staticClass:"title-bar"},[e._v("接口属性")]),t("el-descriptions",{attrs:{column:2}},[t("el-descriptions-item",{attrs:{label:"接口名称"}},[e._v(e._s(e.apiForm.apiName))]),t("el-descriptions-item",{attrs:{label:"接口类型"}},[e._v(e._s(e.apiForm.type))]),t("el-descriptions-item",{attrs:{label:"接口定义"}},[t("el-tag",{attrs:{type:"success",size:"small"}},[e._v(e._s(e.apiForm.method))]),e._v(" "+e._s(e.apiForm.resource))],1),t("el-descriptions-item",{attrs:{label:"修改时间"}},[e._v(e._s(e._f("dateFormat")(e.apiForm.updateTime)))]),t("el-descriptions-item",{attrs:{label:"接口说明"}},[e._v(" "+e._s(e.apiForm.description)+" ")])],1),t("h4",{staticClass:"title-bar"},[e._v("请求参数")]),e.pathData.length>0?t("div",{staticClass:"display-param"},[t("h5",[e._v("Path路径参数")]),t("el-table",{attrs:{data:e.pathData,border:"",size:"mini"}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称",width:"150px"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型",width:"150px"}}),t("el-table-column",{attrs:{prop:"position",label:"参数位置",width:"150px"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}],null,!1,1370730974)}),t("el-table-column",{attrs:{prop:"description",label:"参数描述"}})],1)],1):e._e(),e.headerData.length>0?t("div",{staticClass:"display-param"},[t("h5",[e._v("Header")]),t("el-table",{attrs:{data:e.headerData,border:"",size:"mini"}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称",width:"200px"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型",width:"150px"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}],null,!1,1370730974)}),t("el-table-column",{attrs:{prop:"description",label:"参数描述"}})],1)],1):e._e(),e.bodyData.length>0?t("div",{staticClass:"display-param"},[t("h5",[e._v("请求body")]),t("el-table",{attrs:{data:e.bodyData,size:"mini",border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称",width:"200px"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型",width:"150px"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}],null,!1,1370730974)}),t("el-table-column",{attrs:{prop:"description",label:"参数描述"}})],1)],1):e._e(),t("h4",{staticClass:"title-bar"},[e._v("响应参数")]),t("div",{staticClass:"display-param"},[t("el-table",{attrs:{data:e.previewRes,border:"","row-key":"id",size:"mini","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}])}),t("el-table-column",{attrs:{prop:"type",label:"参数描述"}})],1)],1)],1),t("el-tab-pane",{attrs:{label:"接口配置",name:"edit"}},[t("el-form",{attrs:{size:"mini","label-width":"80px"},model:{value:e.apiForm,callback:function(t){e.apiForm=t},expression:"apiForm"}},[t("h4",{staticClass:"title-bar"},[e._v("接口属性")]),t("el-form-item",{attrs:{label:"接口名称"}},[t("el-input",{attrs:{placeholder:"请输入接口名称"},model:{value:e.apiForm.apiName,callback:function(t){e.$set(e.apiForm,"apiName",t)},expression:"apiForm.apiName"}})],1),t("el-form-item",{attrs:{label:"接口类型"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.apiForm.method=""}},model:{value:e.apiForm.type,callback:function(t){e.$set(e.apiForm,"type",t)},expression:"apiForm.type"}},[t("el-option",{attrs:{label:"HTTP",value:"http"}}),t("el-option",{attrs:{label:"DUBBO",value:"dubbo"}})],1)],1),t("el-form-item",{attrs:{label:"接口定义"}},[t("el-row",{attrs:{gutter:10}},["http"==e.apiForm.type?t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"请选择HTTP请求方法"},model:{value:e.apiForm.method,callback:function(t){e.$set(e.apiForm,"method",t)},expression:"apiForm.method"}},[t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1):e._e(),t("el-col",{attrs:{span:18}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"http"==e.apiForm.type?"请输入uri":"请输入dubbo的类名"},model:{value:e.apiForm.resource,callback:function(t){e.$set(e.apiForm,"resource",t)},expression:"apiForm.resource"}})],1),"dubbo"==e.apiForm.type?t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"请输入方法名"},model:{value:e.apiForm.method,callback:function(t){e.$set(e.apiForm,"method",t)},expression:"apiForm.method"}})],1):e._e()],1)],1),t("el-form-item",{attrs:{label:"接口说明"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入接口描述"},model:{value:e.apiForm.description,callback:function(t){e.$set(e.apiForm,"description",t)},expression:"apiForm.description"}})],1),t("h4",{staticClass:"title-bar"},[e._v("参数设置")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addParam}},[e._v("新增请求参数")]),t("el-tree",{staticClass:"tree-item",attrs:{data:e.paramData,props:e.defaultProps,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"custom-node"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",disabled:i.hide,placeholder:"请输入参数名称"},model:{value:i.paramKey,callback:function(t){e.$set(i,"paramKey",t)},expression:"data.paramKey"}})],1),t("el-col",{attrs:{span:3}},[t("el-select",{staticStyle:{with:"100%"},attrs:{size:"mini",disabled:i.freezed,placeholder:"请选择参数位置"},model:{value:i.position,callback:function(t){e.$set(i,"position",t)},expression:"data.position"}},[t("el-option",{attrs:{label:"Path",value:"Path"}}),t("el-option",{attrs:{label:"Query",value:"Query"}}),t("el-option",{attrs:{label:"Header",value:"Header"}}),t("el-option",{attrs:{label:"Body",value:"Body"}})],1)],1),t("el-col",{attrs:{span:3}},[t("el-select",{staticClass:"select-type",attrs:{placeholder:"请选择参数类型",size:"mini"},on:{change:function(t){return e.paramTypeChange(t,i)}},model:{value:i.type,callback:function(t){e.$set(i,"type",t)},expression:"data.type"}},[t("el-option",{attrs:{label:"String",value:"String"}}),t("el-option",{attrs:{label:"Long",value:"Long"}}),"Body"==i.position?t("el-option",{attrs:{label:"Array",value:"Array"}}):e._e(),"Body"==i.position?t("el-option",{attrs:{label:"Object",value:"Object"}}):e._e(),t("el-option",{attrs:{label:"Boolean",value:"Boolean"}}),t("el-option",{attrs:{label:"Integer",value:"Integer"}}),t("el-option",{attrs:{label:"Float",value:"Float"}}),t("el-option",{attrs:{label:"Array",value:"Array"}})],1)],1),i.hide?e._e():t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{size:"mini",disabled:i.hide,placeholder:"选择参数是否必填"},model:{value:i.required,callback:function(t){e.$set(i,"required",t)},expression:"data.required"}},[t("el-option",{attrs:{label:"必填",value:!0}}),t("el-option",{attrs:{label:"非必填",value:!1}})],1)],1),i.hide||"Object"==i.type?e._e():t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",disabled:i.hide,placeholder:"请输入参数默认值"},model:{value:i.defaultValue,callback:function(t){e.$set(i,"defaultValue",t)},expression:"data.defaultValue"}})],1),i.hide?e._e():t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",disabled:i.hide,placeholder:"请输入参数描述"},model:{value:i.description,callback:function(t){e.$set(i,"description",t)},expression:"data.description"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"op-icon"},[i.hide?e._e():t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.removeParam(a,i)}}}),"Object"==i.type?t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addSubParam(i)}}}):e._e()])]),"Object"==i.type?t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入Object类名,代码生成使用"},model:{value:i.objectName,callback:function(t){e.$set(i,"objectName",t)},expression:"data.objectName"}})],1):e._e()],1)],1)}}])}),t("h4",{staticClass:"title-bar"},[e._v("响应设置")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addResParam}},[e._v("新增响应参数")]),t("el-tree",{staticClass:"tree-item",attrs:{data:e.responseData,props:e.defaultProps,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function({node:a,data:i}){return t("div",{staticClass:"custom-node"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名称"},model:{value:i.paramKey,callback:function(t){e.$set(i,"paramKey",t)},expression:"data.paramKey"}})],1),t("el-col",{attrs:{span:3}},[t("el-select",{staticClass:"select-type",attrs:{placeholder:"请选择参数类型",size:"mini"},model:{value:i.type,callback:function(t){e.$set(i,"type",t)},expression:"data.type"}},[t("el-option",{attrs:{label:"String",value:"String"}}),t("el-option",{attrs:{label:"Long",value:"Long"}}),t("el-option",{attrs:{label:"Array",value:"Array"}}),t("el-option",{attrs:{label:"Object",value:"Object"}}),t("el-option",{attrs:{label:"Boolean",value:"Boolean"}}),t("el-option",{attrs:{label:"Integer",value:"Integer"}})],1)],1),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{size:"mini",placeholder:"选择参数是否必填"},model:{value:i.required,callback:function(t){e.$set(i,"required",t)},expression:"data.required"}},[t("el-option",{attrs:{label:"必填",value:!0}}),t("el-option",{attrs:{label:"非必填",value:!1}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数描述"},model:{value:i.description,callback:function(t){e.$set(i,"description",t)},expression:"data.description"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"op-icon",on:{click:function(t){return e.addSubParam(i)}}},[t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.removeParam(a,i)}}}),"Object"==i.type?t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addSubParam(i)}}}):e._e()])]),"Object"==i.type?t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入Object类名,代码生成使用"},model:{value:i.objectName,callback:function(t){e.$set(i,"objectName",t)},expression:"data.objectName"}})],1):e._e()],1)],1)}}])}),t("h4",{staticClass:"title-bar"},[e._v("代码生成配置")]),t("el-form-item",{attrs:{label:"文件类名","label-width":"120px"}},[t("div",[t("el-input",{attrs:{placeholder:"请输入类名"},model:{value:e.apiForm.className,callback:function(t){e.$set(e.apiForm,"className",t)},expression:"apiForm.className"}},[t("el-input",{attrs:{slot:"append",placeholder:"请输入接口方法名称"},slot:"append",model:{value:e.apiForm.classMethod,callback:function(t){e.$set(e.apiForm,"classMethod",t)},expression:"apiForm.classMethod"}})],1)],1)]),e.isHaveBody?t("el-form-item",{attrs:{label:"body请求体类名","label-width":"120px"}},[t("el-input",{attrs:{placeholder:"请输入body请求体类名"},model:{value:e.apiForm.bodyClass,callback:function(t){e.$set(e.apiForm,"bodyClass",t)},expression:"apiForm.bodyClass"}})],1):e._e(),e.responseData.length>0?t("el-form-item",{attrs:{label:"响应体类名","label-width":"120px"}},[t("el-input",{attrs:{placeholder:"请输入接口响应类名"},model:{value:e.apiForm.resultClass,callback:function(t){e.$set(e.apiForm,"resultClass",t)},expression:"apiForm.resultClass"}})],1):e._e()],1)],1)],1)],1):t("el-empty",{attrs:{description:"请在左侧选择接口"}})],1)],1)],1),"edit"==e.activeName?t("div",{staticClass:"save-btn"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-upload",size:"small"},on:{click:e.saveApi}},[e._v("保存配置")])],1):e._e(),t("el-dialog",{attrs:{title:"创建目录",visible:e.showCreateApi,width:"50%","before-close":e.cancelCreate},on:{"update:visible":function(t){e.showCreateApi=t}}},[t("el-form",{ref:"dataForm",attrs:{model:e.dataForm,"label-width":"80px",size:"mini",rules:e.apiRule}},[t("el-form-item",{attrs:{label:"名称",prop:"apiName"}},[t("el-input",{model:{value:e.dataForm.apiName,callback:function(t){e.$set(e.dataForm,"apiName",t)},expression:"dataForm.apiName"}})],1),e.createDir?e._e():t("el-form-item",{attrs:{label:"接口类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},[t("el-option",{attrs:{label:"Rest Http",value:"http"}}),t("el-option",{attrs:{label:"Dubbo",value:"dubbo"}})],1)],1),e.createDir?e._e():t("el-form-item",{attrs:{label:"接口定义",prop:"resource"}},[t("el-row",{attrs:{gutter:10}},["http"==e.dataForm.type?t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"选择请求方法"},model:{value:e.dataForm.method,callback:function(t){e.$set(e.dataForm,"method",t)},expression:"dataForm.method"}},[t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1):e._e(),t("el-col",{attrs:{span:18}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"http"==e.dataForm.type?"请输入uri":"请输入dubbo的类名"},model:{value:e.dataForm.resource,callback:function(t){e.$set(e.dataForm,"resource",t)},expression:"dataForm.resource"}})],1),"dubbo"==e.dataForm.type?t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"请输入方法名"},model:{value:e.dataForm.method,callback:function(t){e.$set(e.dataForm,"method",t)},expression:"dataForm.method"}})],1):e._e()],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelCreate}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitApi("dataForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"构建Maven二方包",visible:e.showGenerateApi,width:"60%"},on:{"update:visible":function(t){e.showGenerateApi=t},open:e.getBuildParam}},[t("el-form",{ref:"generateForm",attrs:{model:e.generateForm,"label-width":"80px",size:"mini",rules:e.generateRule}},[t("el-form-item",{attrs:{label:"包路径",prop:"packageName"}},[t("el-input",{attrs:{placeholder:"请输入二方包路径，例如:com.zj.windy"},model:{value:e.generateForm.packageName,callback:function(t){e.$set(e.generateForm,"packageName",t)},expression:"generateForm.packageName"}})],1),t("el-form-item",{attrs:{label:"GroupId",prop:"groupId"}},[t("el-input",{attrs:{placeholder:"请输入GroupId"},model:{value:e.generateForm.groupId,callback:function(t){e.$set(e.generateForm,"groupId",t)},expression:"generateForm.groupId"}})],1),t("el-form-item",{attrs:{label:"ArtifactId",prop:"artifactId"}},[t("el-input",{attrs:{placeholder:"请输入ArtifactId"},model:{value:e.generateForm.artifactId,callback:function(t){e.$set(e.generateForm,"artifactId",t)},expression:"generateForm.artifactId"}})],1),t("el-form-item",{attrs:{label:"Version",prop:"version"}},[t("el-input",{attrs:{placeholder:"请输入二方包版本号"},model:{value:e.generateForm.version,callback:function(t){e.$set(e.generateForm,"version",t)},expression:"generateForm.version"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelGenerate}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitGenerate("generateForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"二方包构建记录",visible:e.isShowLog,width:"70%","before-close":e.closeLog},on:{"update:visible":function(t){e.isShowLog=t},open:e.openLog}},[t("el-form",{attrs:{size:"mini"},model:{value:e.logForm,callback:function(t){e.logForm=t},expression:"logForm"}},[t("el-form-item",{attrs:{label:"版本"}},[t("el-select",{attrs:{placeholder:"请选择历史构建版本"},on:{change:e.selectVersion},model:{value:e.logRecordId,callback:function(t){e.logRecordId=t},expression:"logRecordId"}},e._l(e.logVersions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"节点状态"}},[t("el-tag",{attrs:{type:e._f("statusFormat")(e.logForm.status)}},[e._v(e._s(e._f("statusName")(e.logForm.status)))])],1),t("el-form-item",{attrs:{label:"执行时间"}},[e._v(e._s(e._f("dateFormat")(e.logForm.time)))])],1),t("el-divider",[t("i",{staticClass:"el-icon-receiving"})]),t("h4",[e._v("运行日志")]),t("div",{staticClass:"log-list"},[t("ul",e._l(e.logForm.messageList,(function(a,i){return t("li",{key:i},[t("span",[e._v(e._s(a))])])})),0)])],1),t("el-dialog",{attrs:{title:"三方API导入",visible:e.showImportDialog},on:{"update:visible":function(t){e.showImportDialog=t}}},[t("el-form",{attrs:{size:"mini",rules:e.importRule},model:{value:e.importForm,callback:function(t){e.importForm=t},expression:"importForm"}},[t("el-form-item",{attrs:{label:"导入类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.importForm.type,callback:function(t){e.$set(e.importForm,"type",t)},expression:"importForm.type"}},[t("el-option",{attrs:{label:"Yapi-JSON文件",value:"Yapi"}}),t("el-option",{attrs:{label:"Postman文件",value:"Postman"}})],1)],1),t("el-form-item",{attrs:{label:"文件上传"}},[t("el-upload",{attrs:{drag:"",action:"#","auto-upload":!0,"http-request":e.httpRequest}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 目前只支持Yapi导出的json文件、Postman文件导入 ")])])],1)],1)],1)],1)},Rt=[],Bt={data(){return{logInterval:null,logRecordId:"",logVersions:[],isShowLog:!1,logForm:{},generateForm:{},showGenerateApi:!1,activeName:"preview",filterText:"",apiForm:{},paramData:[],responseData:[],apiTreeData:[],defaultProps:{children:"children",label:"paramKey"},apiProps:{children:"children",label:"apiName"},pathData:[],headerData:[],bodyData:[],previewRes:[],uuid:1,serviceList:[],serviceId:"",currentApi:"",showCreateApi:!1,dataForm:{type:"http"},apiRule:{apiName:[{required:!0,message:"请输入名称",trigger:"blur"}],type:[{required:!0,message:"请选择接口类型",trigger:"blur"}],resource:[{required:!0,message:"请输入api",trigger:"blur"},{validator:this.validApi,message:"请填写方法",trigger:"blur"}]},generateRule:{packageName:[{required:!0,message:"请输入包路径",trigger:"blur"}],groupId:[{required:!0,message:"请输入groupId",trigger:"blur"}],artifactId:[{required:!0,message:"请输入artifactId",trigger:"blur"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"}]},createDir:!1,selectNodes:[],isLeaving:!1,updateApi:!1,showImportDialog:!1,importForm:{},importRule:{type:[{required:!0,message:"请选择导入文件类型",trigger:"blur"}]},loading:null}},watch:{filterText(e){this.$refs.tree.filter(e)},apiForm:{handler(e,t){t&&t.apiName&&(this.updateApi=!0)},deep:!0,immediate:!0},paramData:{handler(e,t){t&&t.length>0&&(this.updateApi=!0)},deep:!0,immediate:!0}},methods:{httpRequest(e){const t=new FormData;t.append("file",e.file),t.append("type",this.importForm.type),t.append("serviceId",this.serviceId),this.showLoading(),w.importApi(t).then(e=>{this.closeLoading(),e.data.apiList?(this.$message.success("导入api成功"),this.showImportDialog=!1,this.selectService()):this.$message.error("导入api失败")})},showLoading(){this.loading=this.$loading({lock:!0,text:"文件导入中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},closeLoading(){this.loading.close()},allowApiDrop(e,t,a){let i=t.data;return"inner"!=a||0==i.apiType},handleApiDragEnd(e,t){let a=JSON.parse(JSON.stringify(e.data));a.parentId=t.data.apiId,0!=t.data.apiType&&(a.parentId=null),a.requestParams=JSON.parse(a.requestParams),a.responseParams=JSON.parse(a.responseParams),w.updateApi(a)},beforeLeave(e,t){return!("edit"==t&&!this.isLeaving&&this.updateApi)||(this.$confirm("当前页面存在数据变更，离开后数据可能丢失，确认离开?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.isLeaving=!0,this.activeName=e,this.selectTab(),this.updateApi=!1}).catch(()=>{}),!1)},selectTreeNode(e,t){if(t)this.selectNodes.push(e.apiId);else{let t=this.selectNodes.indexOf(e.apiId);-1!=t&&this.selectNodes.splice(t,1)}},validApi(e,t,a){""==this.dataForm.method||null==this.dataForm.method?a(new Error):a()},selectItemCommand(e,t){"dir"!=e?"api"!=e?"delete"==e&&w.deleteApi(t.apiId).then(e=>{e.data?(this.$message.success("删除成功"),this.selectService()):this.$message.error("删除失败")}):this.addApi(t):this.addFolder(t)},treeNodeSelect(e){0!=e.apiType&&(this.apiForm=JSON.parse(JSON.stringify(e)),console.log("show item",this.apiForm),this.paramData=JSON.parse(e.requestParams),this.paramData||(this.paramData=[]),this.paramData.forEach(e=>{(e.objectName=e.children&&e.children[0]&&"Object"==e.children[0].objectName)&&(e.children[0].hide=!0,e.children[0].freezed=!0)}),console.log("show paramData",this.paramData),this.responseData=JSON.parse(e.responseParams),this.responseData||(this.responseData=[]),this.currentApi=e.apiId,this.updateApi=!1,this.selectTab())},addFolder(e){this.createDir=!0,this.showCreateApi=!0,this.dataForm.parentId=e.apiId,this.dataForm.apiType=0},addApi(e){this.createDir=!1,this.showCreateApi=!0,this.dataForm.parentId=e.apiId,this.dataForm.apiType=1},cancelGenerate(){this.generateForm={},this.showGenerateApi=!1},getBuildParam(){w.getGenerate(this.serviceId).then(e=>{e.data&&(this.generateForm=e.data)})},submitGenerate(e){this.$refs[e].validate(e=>{if(!e)return!1;this.generateForm.serviceId=this.serviceId,w.buildGenerate(this.generateForm).then(e=>{e.data?(this.$message.success("开始构建"),this.showGenerateApi=!1,this.isShowLog=!0,this.queryHistory()):this.$message.error("触发构建任务失败")})})},submitApi(e){this.$refs[e].validate(e=>{if(!e)return!1;this.dataForm.serviceId=this.serviceId,w.createApi(this.dataForm).then(e=>{e.data?(this.$message.success("添加成功"),this.selectService(),this.cancelCreate()):this.$message.error("添加失败")})})},selectCommand(e){"generate"!=e?"import"!=e?"delete"!=e?(this.createDir="dir"==e,this.showCreateApi=!0,this.dataForm.apiType=this.createDir?0:1):w.batchDeleteApi(this.selectNodes).then(e=>{e.data?(this.$message.success("删除成功"),this.selectService()):this.$message.error("删除失败")}):this.showImportDialog=!0:this.showGenerateApi=!0},cancelCreate(){this.showCreateApi=!1,this.dataForm={type:"http"}},saveApi(){let e=this.apiForm;e.serviceId=this.serviceId,this.recursionName(this.paramData),this.recursionName(this.responseData),e.requestParams=this.paramData,e.responseParams=this.responseData,""==this.currentApi?w.createApi(e).then(e=>{e.data?(this.$message.success("添加接口成功"),this.updateApi=!1):this.$message.error("添加接口失败")}):w.updateApi(e).then(e=>{e.data&&(this.$message.success({showClose:!0,message:"修改接口成功"}),this.updateApi=!1)})},recursionName(e){e.forEach(e=>{this.$utils.isEmpty(e.objectName)&&(e.objectName=e.type),e.children&&e.children.length>0&&this.recursionName(e.children)})},selectTab(){this.isLeaving=!1,"preview"==this.activeName&&(this.pathData=[],this.headerData=[],this.bodyData=[],this.traverseTree(this.paramData),console.log("this.paramData",this.paramData),this.paramData.forEach(e=>{"Path"!=e.position&&"Query"!=e.position||this.pathData.push(e),"Header"==e.position&&this.headerData.push(e),"Body"==e.position&&this.bodyData.push(e)}),this.previewRes=JSON.parse(JSON.stringify(this.responseData)),this.traverseTree(this.previewRes))},traverseTree(e){for(const t of e)t.id=this.$utils.randomString();for(const t of e)t.children&&t.children.length>0&&this.traverseTree(t.children)},filterNode(e,t){return!e||-1!==t.apiName.indexOf(e)},removeParam(e,t){const a=e.parent,i=a.data.children||a.data,s=i.findIndex(e=>e.id===t.id);i.splice(s,1)},paramTypeChange(e,t){"Array"==e&&(t.children=[{type:"String",paramKey:" ",position:t.position,require:!0,hide:!0,freezed:!0,children:[]}])},addParam(){this.paramData.push({id:this.$utils.randomString(),paramKey:"",children:[]}),this.uuid++},addSubParam(e){if(e.children)return e.children.push({id:this.uuid,paramKey:"",children:[],position:e.position,freezed:!0}),void this.uuid++;e.children=[{id:this.uuid,paramKey:"",children:[],position:e.position,freezed:!0}],this.uuid++},addResParam(){this.responseData.push({id:this.uuid,paramKey:"",children:[]}),this.uuid++},selectService(){w.getApiList(this.serviceId).then(e=>{this.apiTreeData=this.buildTree(e.data)})},buildTree(e,t=null){let a=[];for(let i of e)if(i.parentId===t){let t=this.buildTree(e,i.apiId);t.length>0&&(i.children=t),i.children||(i.children=[]),a.push(i)}return a},openLog(){this.logInterval=setInterval(()=>{this.queryHistory()},2e3)},queryHistory(){w.getGenerateLog(this.serviceId).then(e=>{let t=[];e.data.forEach(e=>{let a=JSON.parse(e.executeParams);a.time=e.updateTime,a.status=e.status,a.label=a.version,a.value=e.recordId,a.messageList=JSON.parse(e.result),t.push(a)}),this.logVersions=t,this.isShowLog=!0,!this.logRecordId&&this.logVersions.length>0&&(this.logRecordId=this.logVersions[0].value),this.selectVersion(this.logRecordId)})},selectVersion(e){this.logForm={},this.logVersions.forEach(t=>{t.value==e&&(this.logForm=t)})},closeLog(){this.isShowLog=!1,this.logVersions=[],this.logForm={},this.logRecordId=null,this.logInterval&&clearInterval(this.logInterval)},getServices(){this.serviceList=[],w.getServices().then(e=>{this.serviceList=e.data,this.serviceId=this.serviceList[0].serviceId,this.selectService()})}},computed:{isHaveBody:function(){let e=!1;return this.paramData.forEach(t=>{"Body"==t.position&&(e=!0)}),e}},created(){this.getServices()}},jt=Bt,Jt=(a("9ffd"),a("4c8b"),Object(n["a"])(jt,qt,Rt,!1,null,"f7315138",null)),Mt=Jt.exports,Gt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",{staticClass:"title"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"}},[t("el-form-item",{attrs:{label:"环境名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入环境名称"},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.createEnv}},[e._v("新增环境")])],1)],1)],1)]),t("div",[t("el-row",{attrs:{gutter:40}},e._l(e.envData,(function(a,i){return t("el-col",{key:i,attrs:{span:6}},[t("el-card",{staticClass:"env-card",attrs:{shadow:"always","body-style":{padding:"15px"}}},[t("div",[t("span",{staticClass:"env-name"},[e._v(e._s(a.envName)+" ")]),t("img",{staticClass:"env-img",attrs:{src:a.img,width:"40",height:"40"}})]),t("div",[t("div",{staticClass:"status-icon"},[t("el-tag",{attrs:{type:e._f("statusFormat")(a.envStatus),size:"medium"}},[e._v(e._s(e._f("deployFormat")(a.envStatus)))])],1),t("div",{staticClass:"op-line"},[t("el-button",{attrs:{icon:"el-icon-edit-outline",type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])],1)])])],1)})),1),t("div",{staticClass:"page-index"},[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:e.titleName,visible:e.showEnvDialog,width:"60%"},on:{"update:visible":function(t){e.showEnvDialog=t}}},[t("el-form",{attrs:{model:e.envForm,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"环境名称",prop:"envName"}},[t("el-input",{attrs:{placeholder:"请输入环境名称"},model:{value:e.envForm.envName,callback:function(t){e.$set(e.envForm,"envName",t)},expression:"envForm.envName"}})],1),t("el-form-item",{attrs:{label:"部署类型",prop:"envType"}},[t("el-radio-group",{on:{change:e.selectType},model:{value:e.envForm.envType,callback:function(t){e.$set(e.envForm,"envType",t)},expression:"envForm.envType"}},[t("el-radio",{attrs:{label:1}},[e._v("SSH部署")]),t("el-radio",{attrs:{label:2}},[e._v("K8S部署")])],1)],1),t("el-form-item",[t("el-form",{attrs:{"label-width":"120px",size:"mini"}},e._l(e.paramsList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.name}},[t("el-input",{attrs:{placeholder:a.desc},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)})),1)],1),t("el-form-item",{attrs:{label:"环境状态",prop:"envStatus"}},[t("el-row",[t("el-col",{attrs:{span:3}},[t("el-switch",{attrs:{disabled:e.limited},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})],1),t("el-col",{attrs:{span:6}},[t("el-button",{staticClass:"check",attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.checkStatus}},[e._v("检测")])],1)],1)],1),t("el-alert",{attrs:{title:"检测提示",description:"只有通过检测之后环境才可使用，点击检测按钮即可",type:"info",closable:!1,"show-icon":""}})],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancellDialog}},[e._v(" 取消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v(" 确定")])],1)],1)],1)},Ut=[],Ht=a("6c62"),Kt=a.n(Ht),Wt=a("2039"),Qt=a.n(Wt),Yt={data(){return{currentPage:1,totalSize:0,envData:[],queryName:"",showEnvDialog:!1,envForm:{},titleName:"创建环境",limited:!0,isEdit:!1,checked:!1,sshParams:[{key:"sshIp",value:"",name:"访问IP",desc:"请输入访问ssh的IP"},{key:"sshPort",value:"22",name:"访问端口",desc:"请输入访问ssh的端口"},{key:"user",value:"",name:"ssh用户",desc:"请输入访问ssh所使用的用户"},{key:"password",value:"",name:"ssh密码",desc:"请输入访问ssh所使用的密码"},{key:"remotePath",value:"",name:"远端路径",desc:"请输入ssh远端服务的运行路径"}],k8sParams:[{key:"apiService",value:"",name:"Api服务",desc:"请输入访问k8s的ApiService地址"},{key:"token",value:"",name:"访问token",desc:"请输入访问k8s的地址"},{key:"repository",value:"",name:"镜像仓库",desc:"请输入访问k8s镜像仓库的地址,填写后覆盖默认仓库地址"},{key:"namespace",value:"",name:"命名空间",desc:"请输入部署的Namespace"},{key:"secretName",value:"",name:"Secret名称",desc:"请输入拉取镜像的Secret名称"}],paramsList:[]}},methods:{pageChange(e){this.currentPage=e,this.getEnvs()},handleDelete(e){this.$confirm(`确认删除环境【${e.envName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{Et.deleteEnv(e.envId).then(e=>{e.data?(this.$message.success("删除环境成功"),this.getEnvs()):this.$message.error("删除环境失败")})})},handleEdit(e){this.showEnvDialog=!0,this.isEdit=!0,this.titleName="修改环境",this.paramsList=this.translate(e),this.limited=2==e.envStatus,this.envForm=JSON.parse(JSON.stringify(e)),this.checked=1==e.envStatus},translate(e){let t=[],a=JSON.parse(e.envParams);return 1==e.envType&&(this.setValue(this.sshParams,a),t=this.sshParams),2==e.envType&&(this.setValue(this.k8sParams,a),t=this.k8sParams),t},setValue(e,t){e.forEach(e=>{let a=t[e.key];a&&(e.value=a)})},submit(){let e=this.envForm,t={};this.paramsList.forEach(e=>{t[e.key]=e.value}),e.envParams=JSON.stringify(t),e.envStatus=2,this.checked&&(e.envStatus=1),this.isEdit?Et.updateEnv(e).then(e=>{e.data?(this.$message.success("修改环境成功"),this.cancellDialog(),this.getEnvs()):this.$message.error("修改环境失败")}):Et.createEnv(e).then(e=>{e.data?(this.$message.success("添加环境成功"),this.cancellDialog(),this.getEnvs()):this.$message.error("添加环境失败")})},cancellDialog(){this.showEnvDialog=!1,this.envForm={}},selectType(e){this.paramsList=[],1==e&&(this.paramsList=JSON.parse(JSON.stringify(this.sshParams))),2==e&&(this.paramsList=JSON.parse(JSON.stringify(this.k8sParams)))},getEnvs(){this.envData=[],Et.getEnvs(this.currentPage,10,this.queryName).then(e=>{e.data.data&&(e.data.data.forEach(e=>{e.configList=this.translate(e),1==e.envType&&(e.img=Qt.a),2==e.envType&&(e.img=Kt.a),this.envData.push(e)}),this.totalSize=e.data.total)})},checkStatus(){let e={};this.paramsList.forEach(t=>{e[t.key]=t.value}),Et.checkEnv(this.envForm.envType,e).then(e=>{e.data?(this.$message.success("环境校验成功"),this.limited=!1,this.checked=!0):(this.checked=!1,this.limited=!0,this.$message.error("环境校验失败"))})},startQuery(){this.getEnvs()},createEnv(){this.showEnvDialog=!0,this.envForm={envType:1},this.selectType(1),this.limited=!0,this.isEdit=!1,this.titleName="创建环境"}},created(){this.getEnvs()}},Xt=Yt,Zt=(a("f2fb"),Object(n["a"])(Xt,Gt,Ut,!1,null,"37af8ada",null)),ea=Zt.exports,ta=function(){var e=this,t=e._self._c;return t("div",[t("el-alert",{staticClass:"tips-info",attrs:{title:"消息提示",type:"info",closable:!1,description:"系统配置作用于全局，请谨慎操作","show-icon":""}}),t("div",{staticClass:"content"},[t("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.clickTab},model:{value:e.configType,callback:function(t){e.configType=t},expression:"configType"}},[t("el-tab-pane",{attrs:{label:"Git配置",name:"git"}},[t("el-form",{attrs:{model:e.systemForm,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"类型",prop:"gitType"}},[t("el-radio-group",{on:{change:e.changeGit},model:{value:e.systemForm.gitType,callback:function(t){e.$set(e.systemForm,"gitType",t)},expression:"systemForm.gitType"}},[t("el-radio",{attrs:{label:"Gitea"}},[e._v("Gitea")]),t("el-radio",{attrs:{label:"Gitlab"}},[e._v("Gitlab")])],1)],1),t("el-form-item",{attrs:{label:"地址",prop:"gitDomain"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入git访问地址"},model:{value:e.systemForm.gitDomain,callback:function(t){e.$set(e.systemForm,"gitDomain",t)},expression:"systemForm.gitDomain"}})],1),"Gitlab"!=e.systemForm.gitType?t("el-form-item",{attrs:{label:"拥有者",prop:"owner"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入git拥有者"},model:{value:e.systemForm.owner,callback:function(t){e.$set(e.systemForm,"owner",t)},expression:"systemForm.owner"}})],1):e._e(),t("el-form-item",{attrs:{label:"访问token",prop:"accessToken"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入git访问token"},model:{value:e.systemForm.accessToken,callback:function(t){e.$set(e.systemForm,"accessToken",t)},expression:"systemForm.accessToken"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitGit}},[e._v("提交")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"镜像仓库配置",name:"repo"}},[t("el-form",{attrs:{model:e.repoForm,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"仓库地址",prop:"repositoryUrl"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入镜像仓库地址"},model:{value:e.repoForm.repositoryUrl,callback:function(t){e.$set(e.repoForm,"repositoryUrl",t)},expression:"repoForm.repositoryUrl"}})],1),t("el-form-item",{attrs:{label:"用户",prop:"userName"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的用户"},model:{value:e.repoForm.userName,callback:function(t){e.$set(e.repoForm,"userName",t)},expression:"repoForm.userName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的密码"},model:{value:e.repoForm.password,callback:function(t){e.$set(e.repoForm,"password",t)},expression:"repoForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitImage}},[e._v("提交")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"Maven配置",name:"maven"}},[t("el-form",{attrs:{model:e.mavenForm,size:"mini","label-width":"120px"}},[t("h5",[e._v("Maven仓库")]),t("el-form-item",{attrs:{label:"推送远程仓库",prop:"mavenUrl"}},[t("el-input",{attrs:{type:"text",placeholder:"仓库地址"},model:{value:e.mavenForm.mavenUrl,callback:function(t){e.$set(e.mavenForm,"mavenUrl",t)},expression:"mavenForm.mavenUrl"}})],1),t("el-form-item",{attrs:{label:"用户",prop:"userName"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的用户"},model:{value:e.mavenForm.userName,callback:function(t){e.$set(e.mavenForm,"userName",t)},expression:"mavenForm.userName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的密码"},model:{value:e.mavenForm.password,callback:function(t){e.$set(e.mavenForm,"password",t)},expression:"mavenForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitMaven}},[e._v("提交")])],1)],1)],1)],1)],1)],1)},aa=[],ia={data(){return{systemForm:{},repoForm:{},mavenForm:{},configType:"git"}},methods:{changeGit(e){"Gitlab"==e&&(this.systemForm.owner="oauth2"),"Gitlab"!=e&&"oauth2"==this.systemForm.owner&&(this.systemForm.owner="")},getGitConfig(){$t.requestGitConfig().then(e=>{this.systemForm=e.data})},getRepoConfig(){$t.getImageRepository().then(e=>{this.repoForm=e.data})},getMavenConfig(){$t.requestMavenConfig().then(e=>{this.mavenForm=e.data})},submitMaven(){$t.updateMavenConfig(this.mavenForm).then(e=>{e.data?this.$message.success("修改Maven配置成功"):this.$message.error("修改Maven配置失败")})},submitGit(){$t.updateGitConfig(this.systemForm).then(e=>{e.data?this.$message.success("修改Git配置成功"):this.$message.error("修改Git配置失败")})},submitImage(){$t.updateRepository(this.repoForm).then(e=>{e.data?this.$message.success("修改镜像仓库成功"):this.$message.error("修改镜像仓库失败")})},clickTab(){"git"==this.configType&&this.getGitConfig(),"repo"==this.configType&&this.getRepoConfig(),"maven"==this.configType&&this.getMavenConfig()}},created(){this.getGitConfig()}},sa=ia,ra=(a("5bfb"),Object(n["a"])(sa,ta,aa,!1,null,"3ab6fbdb",null)),la=ra.exports,oa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-alert",{staticClass:"tips-info",attrs:{title:"消息提示",type:"info",description:"以下是对master与client的监控，相比较下master更需要关注内存使用情况，client更关心cpu与线程数","show-icon":""}}),t("div",[t("div",[t("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.refresh}},[e._v(" 刷新状态")])],1),t("el-divider",{attrs:{"content-position":"left"}},[e._v("Master节点")]),t("div",[t("el-table",{attrs:{data:e.masterData}},[t("el-table-column",{attrs:{label:"Master IP"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-monitor"}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.ip))])]}}])}),t("el-table-column",{attrs:{label:"cpu",prop:"cpu"}}),t("el-table-column",{attrs:{label:"内存",prop:"heap"}}),t("el-table-column",{attrs:{label:"线程数",prop:"threads"}}),t("el-table-column",{attrs:{label:"任务数",prop:"size"}}),t("el-table-column",{attrs:{label:"垃圾收集"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"right",width:"600",trigger:"click"}},[t("el-table",{attrs:{data:a.row.histories}},[t("el-table-column",{attrs:{width:"300",property:"collector",label:"收集器"}}),t("el-table-column",{attrs:{width:"150",property:"collectCount",label:"收集次数"}}),t("el-table-column",{attrs:{width:"150",property:"collectTime",label:"收集耗时"}})],1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"primary"},slot:"reference"},[e._v("查看垃圾回收")])],1)]}}])})],1)],1)],1),t("div",{staticClass:"client"},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("Client节点")]),t("el-table",{attrs:{data:e.clientData}},[t("el-table-column",{attrs:{label:"Client IP"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-monitor"}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.ip))])]}}])}),t("el-table-column",{attrs:{label:"cpu",prop:"cpu"}}),t("el-table-column",{attrs:{label:"内存",prop:"heap"}}),t("el-table-column",{attrs:{label:"线程数",prop:"threads"}}),t("el-table-column",{attrs:{label:"任务数",prop:"size"}}),t("el-table-column",{attrs:{label:"垃圾收集"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"right",width:"600",trigger:"click"}},[t("el-table",{attrs:{data:a.row.histories}},[t("el-table-column",{attrs:{width:"300",property:"collector",label:"收集器"}}),t("el-table-column",{attrs:{width:"150",property:"collectCount",label:"收集次数"}}),t("el-table-column",{attrs:{width:"150",property:"collectTime",label:"收集耗时"}})],1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"primary"},slot:"reference"},[e._v("查看垃圾回收")])],1)]}}])})],1)],1)],1)},na=[],ca={data(){return{clientData:[],masterData:[]}},methods:{refresh(){this.getMonitor()},getMonitor(){this.clientData=[],this.masterData=[],$t.getMonitor().then(e=>{e.data.clients.forEach(e=>{let t=e.physics;t.size=e.waitQuerySize,this.clientData.push(t)}),e.data.masters.forEach(e=>{let t=e.physics;t.size=e.taskCount,this.masterData.push(t)})})}},created(){this.getMonitor()}},pa=ca,da=(a("460d"),Object(n["a"])(pa,oa,na,!1,null,"7f3459fe",null)),ua=da.exports,ha=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title-line"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,size:"mini"}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"small","reserve-keyword":"",placeholder:"请输入搜索的服务名"},on:{change:e.selectService},model:{value:e.serviceId,callback:function(t){e.serviceId=t},expression:"serviceId"}},e._l(e.pipelines,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("div",{staticClass:"content"},[t("el-row",[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"left-content"},[t("div",{staticClass:"op-line"},[t("el-dropdown",{attrs:{placement:"bottom-end"},on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-edit"}),e._v("管理"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"new"}},[t("i",{staticClass:"el-icon-circle-plus"}),e._v("新增")])],1)],1)],1),t("div",{staticClass:"pipeline-list"},[t("el-collapse",{model:{value:e.activePipelines,callback:function(t){e.activePipelines=t},expression:"activePipelines"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-promotion title-icon"}),e._v(" 发布流水线 ")]),e._l(e.publishList,(function(a,i){return t("div",{key:i,staticClass:"pipeline-item",class:{"selected-line":a.selected}},[t("span",{on:{click:function(t){return e.selectPipeline(a)}}},[e._v(e._s(a.pipelineName))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:function(t){return e.operateLine(t,a)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}))],2),t("el-collapse-item",{attrs:{name:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-cpu title-icon"}),e._v(" 定时流水线 ")]),e._l(e.buildList,(function(a,i){return t("div",{key:i,staticClass:"pipeline-item",class:{"selected-line":a.selected}},[t("span",{on:{click:function(t){return e.selectPipeline(a)}}},[e._v(e._s(a.pipelineName))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:function(t){return e.operateLine(t,a)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}))],2),t("el-collapse-item",{attrs:{name:"3"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-custom title-icon"}),e._v(" 自定义流水线 ")]),e._l(e.customList,(function(a,i){return t("div",{key:i,staticClass:"pipeline-item",class:{"selected-line":a.selected}},[t("span",{on:{click:function(t){return e.selectPipeline(a)}}},[e._v(e._s(a.pipelineName))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:function(t){return e.operateLine(t,a)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}))],2)],1)],1)])]),e.currentPipeline.pipelineConfig&&e.currentPipeline.pipelineConfig.length<=0?t("el-empty",{attrs:{description:"请在左侧点击流水线查看详情"}},[t("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.handleCommand("new")}}},[e._v("创建流水线?")])],1):t("el-col",{attrs:{span:20}},[t("div",{staticClass:"pipe-op-div"},[e.isRunning?t("el-button",{attrs:{type:"primary",icon:"el-icon-video-pause",size:"mini"},on:{click:e.pausePipeline}},[e._v("停止")]):t("el-button",{attrs:{type:"primary",icon:"el-icon-video-play",size:"mini",disabled:1!=e.currentPipeline.executeType},on:{click:e.startPipeline}},[e._v("运行")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:e.startEdit}},[e._v("编辑")]),1!=e.currentPipeline.pipelineType?t("el-button",{attrs:{type:"primary",icon:"el-icon-setting",size:"mini"},on:{click:function(t){e.showGitConfig=!e.showGitConfig}}},[e._v("Git配置")]):e._e(),t("el-button",{attrs:{type:"info",icon:"el-icon-view",size:"mini"},on:{click:e.startView}},[e._v("查看")]),1!=e.currentPipeline.pipelineType?t("el-button",{attrs:{type:"primary",icon:"el-icon-upload",size:"mini"},on:{click:e.publish}},[e._v("推送发布")]):e._e()],1),t("div",{staticClass:"pipeline-detail"},[t("el-descriptions",{attrs:{title:"流水线历史",column:3,size:"medium"}},[t("el-descriptions-item",{attrs:{label:"git分支"}},[e._v(" "+e._s(e.history.branch))]),t("el-descriptions-item",{attrs:{label:"运行时间"}},[e._v(" "+e._s(e._f("dateFormat")(e.history.createTime))+" ")]),t("el-descriptions-item",{attrs:{label:"执行结果"}},[t("el-tag",{attrs:{type:e._f("statusFormat")(e.history.pipelineStatus)}},[e._v(e._s(e._f("statusName")(e.history.pipelineStatus)))])],1),t("el-descriptions-item",{attrs:{label:"执行方式"}},[t("el-tag",{attrs:{type:"primary"}},[e._v(e._s(e.executeWay(e.currentPipeline.executeType)))])],1)],1)],1),t("div",{staticClass:"pipeline-content"},[e.currentPipeline.pipelineConfig&&e.currentPipeline.pipelineConfig.length>0?t("vue-pipeline",{key:e.uuid,ref:"pipeline",attrs:{x:50,y:55,data:e.currentPipeline.pipelineConfig,showArrow:!0,ystep:70,xstep:120,lineStyle:"default"},on:{select:e.showNodeLog}}):e._e()],1),1==e.currentPipeline.pipelineType?t("div",[t("h4",{staticClass:"republis-info"},[e._v("待发布分支")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.publishData}},[t("el-table-column",{attrs:{prop:"branch",label:"分支"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("publisFormat")(t.row.status))+" ")]}}],null,!1,747692322)}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}],null,!1,3816663554)}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.removePublish(a.row)}}},[e._v("移除发布")])]}}],null,!1,2377153871)})],1)],1):e._e()])],1)],1),t("el-dialog",{attrs:{title:"Git配置",visible:e.showGitConfig,"destroy-on-close":!0,"before-close":e.closeGitDialog,width:"70%"},on:{"update:visible":function(t){e.showGitConfig=t}}},[t("bind",{attrs:{pipeline:e.currentPipeline.pipelineId,service:e.serviceId}})],1),t("el-dialog",{attrs:{title:"节点日志",visible:e.isShowNodeLog,"destroy-on-close":!0,width:"70%"},on:{"update:visible":function(t){e.isShowNodeLog=t},close:e.closeNodeLog}},[t("span",[e._v("节点运行状态: "),t("el-tag",{attrs:{type:e._f("statusFormat")(e.logForm.status)}},[e._v(e._s(e._f("statusName")(e.logForm.status)))])],1),t("el-divider",[t("i",{staticClass:"el-icon-receiving"})]),t("ul",e._l(e.logForm.messageList,(function(a,i){return t("li",{key:i},[t("span",[e._v(e._s(a))])])})),0),e.recordList&&e.recordList.length>0?t("div",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.openTaskDetail}},[e._v("查看任务详情")]),t("el-table",{attrs:{data:e.recordList,size:"mini",height:"400px"}},[t("el-table-column",{attrs:{prop:"featureName",label:"用例名称"}}),t("el-table-column",{attrs:{prop:"executeStatus",label:"用例状态",filters:[{text:"成功",value:1},{text:"失败",value:2},{text:"超时",value:3},{text:"运行中",value:4}],"filter-method":e.filterStatus},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e._f("statusFormat")(a.row.executeStatus)}},[e._v(e._s(e._f("statusName")(a.row.executeStatus)))])]}}],null,!1,2110693804)}),t("el-table-column",{attrs:{prop:"createTime",label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}],null,!1,3816663554)})],1)],1):e._e()],1),t("el-dialog",{attrs:{title:e.titleName,visible:e.pipelineDialog,width:"80%","destroy-on-close":!0,"before-close":e.cancelCreatePipeline},on:{"update:visible":function(t){e.pipelineDialog=t}}},[t("PipelineConfig",{attrs:{operate:e.piplienOperate,pipeline:e.pipelineId,service:e.serviceId},on:{complete:e.completeNotify}})],1),t("el-dialog",{attrs:{title:"卡点审批",visible:e.showApproval,width:"30%","before-close":e.approvalClose},on:{"update:visible":function(t){e.showApproval=t}}},[t("span",[e._v("审批是否通过?")]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:e.cancelApproval}},[e._v("不通过")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmApproval}},[e._v("通过")])],1)])],1)},ma=[],va=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("div",{staticClass:"git"},[t("el-link",{attrs:{type:"primary",underline:!1}},[e._v(e._s(e.gitUrl))])],1)]),t("div",[t("div",[t("el-select",{attrs:{filterable:"",size:"small","reserve-keyword":"",placeholder:"请输入绑定的分支"},model:{value:e.selectedBranch,callback:function(t){e.selectedBranch=t},expression:"selectedBranch"}},e._l(e.branches,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{staticClass:"search-btn",attrs:{type:"primary",size:"small",icon:"el-icon-paperclip"},on:{click:e.createBind}},[e._v("关联分支")])],1),t("div",[t("div",{staticClass:"bind-title"},[e._v("已绑定分支：")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[t("el-table-column",{attrs:{prop:"gitBranch",label:"分支名",width:"180"}}),t("el-table-column",{attrs:{prop:"createTime",label:"绑定时间",width:"180"}}),t("el-table-column",{attrs:{prop:"isChoose",label:"是否绑定"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isChoose?t("i",{staticClass:"el-icon-circle-check choose-item"}):e._e()]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{icon:"el-icon-connection",type:"text",size:"small"},on:{click:function(t){return e.bindBranch(a.row)}}},[e._v(e._s(a.row.isChoose?"解绑":"绑定"))]),t("el-button",{staticClass:"delete-icon",attrs:{icon:"el-icon-delete",type:"text",size:"small"},on:{click:function(t){return e.deleteBind(a.row)}}},[e._v("删除")])]}}])})],1)],1)])])},fa=[],ga={gitbindList(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/git/binds`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},createGitbind(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/git/bind";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},bindBranch(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/git/bind";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteCodeChange(e,t){return new Promise((a,i)=>{let s=`/v1/devops/pipeline/${e}/git/bind/${t}`;y.delete(s).then(e=>{a(e)}).catch(e=>{i(e)})})},getService(e){return new Promise((t,a)=>{let i=`/v1/devops/service/${e}/detail`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getServiceBranch(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/branches`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},ba={props:{pipeline:String,service:String},data(){return{selectedBranch:"",branches:[],loading:!1,tableData:[],pipelineId:"",serviceId:"",gitUrl:""}},methods:{deleteBind(e){ga.deleteCodeChange(this.pipelineId,e.bindId).then(e=>{1==e.data?(this.$message.success("删除成功"),this.getBindBranches()):this.$message.error("删除失败")})},bindBranch(e){e.isChoose=!e.isChoose,ga.bindBranch(e).then(()=>{let t=e.isChoose?"绑定":"解绑";this.$message({message:t+"成功",type:"success"}),this.getBindBranches()})},createBind(){if(!this.selectedBranch||""==this.selectedBranch)return void this.$message({message:"请先选择分支",type:"warning"});let e={gitBranch:this.selectedBranch,gitUrl:this.gitUrl,isChoose:!1,pipelineId:this.pipelineId};ga.createGitbind(e).then(()=>{this.$message({message:"关联成功",type:"success"}),this.getBindBranches()})},getBindBranches(){ga.gitbindList(this.pipelineId).then(e=>{this.tableData=e.data})},getService(){ga.getService(this.serviceId).then(e=>{this.gitUrl=e.data.gitUrl})},getServiceBranch(){this.branches=[],ga.getServiceBranch(this.serviceId).then(e=>{e.data.forEach(e=>{this.branches.push({label:e,value:e})})})}},created(){this.serviceId=this.service,this.pipelineId=this.pipeline,this.getBindBranches(),this.getService(),this.getServiceBranch()}},ya=ba,wa=(a("41f4"),Object(n["a"])(ya,va,fa,!1,null,"06292448",null)),ka=wa.exports,Ca=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"pipelineForm",attrs:{model:e.pipelineForm,"label-width":"120px",rules:e.pipelineRule,size:"mini",disabled:this.isView}},[t("el-form-item",{attrs:{label:"流水线名称",prop:"pipelineName"}},[t("el-input",{model:{value:e.pipelineForm.pipelineName,callback:function(t){e.$set(e.pipelineForm,"pipelineName",t)},expression:"pipelineForm.pipelineName"}})],1),t("el-form-item",{attrs:{label:"流水线类型",prop:"pipelineType"}},[t("el-radio-group",{model:{value:e.pipelineForm.pipelineType,callback:function(t){e.$set(e.pipelineForm,"pipelineType",t)},expression:"pipelineForm.pipelineType"}},[t("el-radio",{attrs:{label:1}},[e._v("发布流水线")]),t("el-radio",{attrs:{label:2}},[e._v("定时流水线")]),t("el-radio",{attrs:{label:3}},[e._v("个人流水线")])],1)],1),e.isSchdule?t("el-form-item",{attrs:{label:"每日定时",rules:[{required:!0,message:"定时执行时间点不能为空",trigger:"select"}],prop:"scheduleTime"}},[t("el-time-picker",{attrs:{"picker-options":{start:"00:00",step:"01:00",end:"24:00"},"value-format":"H",placeholder:"选择每日执行的时间点"},model:{value:e.pipelineForm.scheduleTime,callback:function(t){e.$set(e.pipelineForm,"scheduleTime",t)},expression:"pipelineForm.scheduleTime"}})],1):e._e(),t("el-form-item",{attrs:{label:"执行方式",prop:"executeType"}},[t("el-radio-group",{model:{value:e.pipelineForm.executeType,callback:function(t){e.$set(e.pipelineForm,"executeType",t)},expression:"pipelineForm.executeType"}},[t("el-radio",{attrs:{disabled:e.isSchdule,label:1}},[e._v("手动执行")]),t("el-radio",{attrs:{disabled:e.isSchdule||e.isPublish,label:2}},[e._v("Push")]),t("el-radio",{attrs:{disabled:!e.isSchdule||e.isPublish,label:3}},[e._v("定时执行")])],1)],1),this.isView?e._e():t("el-button",{attrs:{type:"primary",size:"mini",disabled:e.startMove,icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.dialogVisible=!e.dialogVisible,e.operateType=1}}},[e._v("添加节点")]),this.isView||e.startMove?e._e():t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(t){e.startMove=!e.startMove}}},[e._v("操作节点")]),!this.isView&&e.startMove?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-circle-close"},on:{click:function(t){e.startMove=!e.startMove}}},[e._v("取消操作")]):e._e(),!this.isView&&e.startMove?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-d-arrow-left"},on:{click:e.leftMove}},[e._v("前移")]):e._e(),!this.isView&&e.startMove?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-d-arrow-right"},on:{click:e.rightMove}},[e._v("后移")]):e._e(),!this.isView&&e.startMove?t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:e.removeNode}},[e._v("删除")]):e._e(),t("div",[e.editPipelines&&e.editPipelines.length>0?t("vue-pipeline",{key:e.uuid,ref:"pipeline",attrs:{x:50,y:55,data:e.editPipelines,showArrow:!0,ystep:70,xstep:120,lineStyle:"default"},on:{select:e.choosePipeItem}}):e._e()],1),t("el-form-item",[e.isView?e._e():t("div",{staticClass:"dialog-footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelCreatePipeline}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitPipeline("pipelineForm")}}},[e._v("确 定")])],1)])],1),t("el-dialog",{attrs:{title:"配置节点","append-to-body":!0,visible:e.dialogVisible,"destroy-on-close":!0,width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.closeConfigNode}},[t("el-form",{ref:"nodeForm",attrs:{model:e.nodeForm,rules:e.nodeRule,size:"mini",disabled:e.isView}},[t("el-form-item",{attrs:{label:"节点名称","label-width":e.formLabelWidth,prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.nodeForm.name,callback:function(t){e.$set(e.nodeForm,"name",t)},expression:"nodeForm.name"}})],1),t("el-form-item",{attrs:{label:"节点提示","label-width":e.formLabelWidth,prop:"hint"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.nodeForm.hint,callback:function(t){e.$set(e.nodeForm,"hint",t)},expression:"nodeForm.hint"}})],1),t("el-form-item",{attrs:{label:"节点类型","label-width":e.formLabelWidth,prop:"configId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectStep},model:{value:e.nodeForm.configId,callback:function(t){e.$set(e.nodeForm,"configId",t)},expression:"nodeForm.configId"}},e._l(e.stepOptions,(function(e){return t("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})})),1)],1)],1),t("el-row",[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"step-title"},[e._v("执行步骤")]),t("div",{staticClass:"item-list"},[t("ul",[t("draggable",{attrs:{list:e.itemList}},e._l(e.itemList,(function(a,i){return t("li",{key:i,on:{click:function(t){return e.chooseStep(a)}}},[t("div",{staticClass:"item"},[e._v(" "+e._s(a.actionName)+" ")])])})),0)],1)])]),t("el-col",{attrs:{span:16}},[t("div",[t("div",{staticClass:"step-title"},[e._v("配置步骤")]),t("el-form",{attrs:{size:"mini",disabled:e.isView,"label-width":e.formLabelWidth},model:{value:e.configForm,callback:function(t){e.configForm=t},expression:"configForm"}},[e.paramConfigs.length>0?t("el-divider",{attrs:{"content-position":"left"}},[e._v("触发参数配置")]):e._e(),e._l(e.paramConfigs,(function(a,i){return t("el-form-item",{key:100+i,attrs:{"label-width":e.formLabelWidth}},[t("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(a.description))]),"select"==a.type?t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.selectChange(t,a)}},model:{value:e.configForm[a.compareKey],callback:function(t){e.$set(e.configForm,a.compareKey,t)},expression:"configForm[item.compareKey]"}},e._l(a.list,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1):t("el-input",{on:{input:function(t){return e.datachange(a.compareKey)}},model:{value:e.configForm[a.compareKey],callback:function(t){e.$set(e.configForm,a.compareKey,t)},expression:"configForm[item.compareKey]"}})],1)})),e.calculateShow?t("el-divider",{attrs:{"content-position":"left"}},[e._v("节点配置")]):e._e(),e._l(e.stepConfigs,(function(a,i){return t("div",{key:i},[a.showCompare?t("el-form-item",{attrs:{"label-width":e.formLabelWidth}},[t("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(a.description))]),t("el-input",{on:{input:function(t){return e.datachange(a.compareKey)}},model:{value:e.configForm[a.compareKey],callback:function(t){e.$set(e.configForm,a.compareKey,t)},expression:"configForm[item.compareKey]"}})],1):e._e()],1)}))],2)],1)])],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[e.isView?e._e():t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitConfig("nodeForm")}}},[e._v("确认")])],1)],1)],1)},_a=[];const xa=120,Fa=50;var Ta={updateNode(e,t,a){let i=JSON.parse(JSON.stringify(e)),s=[],r=0;for(var l=0;l<i.length;)if(i[l].group==t.group){if(i[l].root){r=l,l++;continue}s.push(i[l]),i.splice(l,1)}else l++;let o=1;a.forEach(e=>{let a=r+o,s={group:t.group,hint:e.hint,id:a,name:e.name,next:[],root:!1,nodeId:e.nodeId,status:"success",originData:{actionId:e.originData.actionId,compareInfo:e.originData.compareResults,paramList:e.originData.paramList}};i.splice(a,0,s),o++});let n=s.length-a.length,c=[];t.next.forEach(e=>{e.index=e.index-n,c.push(e)});let p={};return a.forEach(e=>{p[e.actionId]=e.compareResults}),i.forEach(e=>{if(e.originData){let t=p[e.originData.actionId];t&&(e.originData.compareInfo=t)}}),i},addNode(e,t,a){let i=JSON.parse(JSON.stringify(e)),s=i[i.length-1],r=s.x,l=s.y;t.x=s.x,t.y=s.y,t.group=s.group,s.group=s.group+1,i.splice(i.length-1,1);let o=i.length+1;if(a&&(o+=a.length),t.next=[{index:o,weight:0}],i.push(t),console.log("last result",i),!a)return s.x+=xa,i.push(s),i;let n=[];i.forEach(e=>{let t=!1;e.next.forEach(e=>{e.index==i.length-1&&(t=!0)}),t&&n.push(e)});let c=t.group,p=1;return a.forEach(e=>{let a={id:c+p,name:e.name,hint:e.name,status:"success",group:c,originData:e.originData,next:[]};a.x=r,a.y=l+Fa,i.push(a),t.list.push(a),n.forEach(e=>{e.next.push({index:i.length-1,weight:0})})}),s.x+=xa,i.push(s),this.resetId(i),console.log("sub result",i),i},removeNode(e,t){if(!t.root)return this.removeSingleNode(e,t);let a=this.transformTreeNode(e);console.log("array",JSON.parse(JSON.stringify(a)));let i=a.findIndex(e=>e.id==t.id),s=a[i];for(let o=i+1;o<a.length;o++)a[o].next.forEach(e=>{e.index=e.index-s.nodes.length-1});let r=[];for(let o=0;o<a[i-1].id;o++)r.push(e[o]);let l=null;for(let o=i-1;o<a.length;o++){if(o==i)continue;let e=a[o];if(o==i-1){let t=a[i+1];e.next=[],e.next.push({index:t.id-s.nodes.length-1,width:0}),t.nodes.forEach(t=>{e.next.push({index:t.id-s.nodes.length-1,width:0})})}e.root&&(l=r.length,e.group=l),e.id=r.length,r.push(e),e.nodes&&e.nodes.length>0&&e.nodes.forEach(e=>{e.id=r.length,e.group=l,r.push(e)})}return console.log("delete result",r),r},removeSingleNode(e,t){let a=this.transformTreeNode(e),i=t.group,s=[];s.push({index:a[i].id,width:0});let r=1;a[i].nodes.forEach(e=>{e.id!=t.id&&s.push({index:a[i].id+r,width:0})}),e[a[i-1].id].next=s,e.forEach(e=>{(e.id>t.id||e.group==t.group)&&e.root&&e.next&&e.next.forEach(e=>{e.index=e.index-1})});let l=e.findIndex(e=>e.id==t.id);return e.splice(l,1),console.log("remove single result",e),this.resetId(e),e},moveLeft(e,t){if(t=this.getRootOfNode(e,t),t.id<=2)return void console.log("已到根结点无法前移");this.changeGroup(e,t,!0);let a=this.transformTreeNode(e),i=a.findIndex(e=>e.id==t.id),s=a[i-1],r=a[i-2],l=JSON.parse(JSON.stringify(a[i])),o=JSON.parse(JSON.stringify(s)),n=JSON.parse(JSON.stringify(r));l.id=o.id;let c=[],p=l.id+l.nodes.length+1;for(let m=0;m<=o.nodes.length;m++)c.push({index:p+m,width:0});o.id=l.id+l.nodes.length+1;let d=l.next,u=n.id+n.nodes.length+1,h=[];for(let m=0;m<=l.nodes.length;m++)h.push({index:u+m,width:0});l.next=c,e[l.id]=l;for(let m=0;m<l.nodes.length;m++)e[l.id+m+1]=l.nodes[m];o.next=d,e[o.id]=o;for(let m=0;m<o.nodes.length;m++)e[o.id+m+1]=o.nodes[m];e[n.id].next=h,this.resetId(e),console.log("exchange after",JSON.parse(JSON.stringify(e)))},moveRight(e,t){t=this.getRootOfNode(e,t),this.changeGroup(e,t,!1);let a=this.transformTreeNode(e),i=a.findIndex(e=>e.id==t.id);if(i>=a.length-2)return void console.log("已到根结点无法后移");let s=a[i],r=a[i-1],l=a[i+1],o=[];l.id=s.id;for(let u=0;u<=l.nodes.length;u++)o.push({index:l.id+u,width:0});let n=[],c=l.id+l.nodes.length+1;for(let u=0;u<=s.nodes.length;u++)n.push({index:c+u,width:0});let p=l.next;e[r.id].next=o,l.next=n,l.group=l.id,e[l.id]=l;for(let u=0;u<l.nodes.length;u++)l.nodes[u].group=l.id,e[l.id+u+1]=l.nodes[u];s.id=l.id+l.nodes.length+1,s.next=p,s.group=s.id,e[s.id]=s;for(let u=0;u<s.nodes.length;u++)s.nodes[u].group=s.id,e[s.id+u+1]=s.nodes[u];e[e.length-1].group=e[e.length-1].id;let d=0;e.forEach(e=>{e.id=d,d++})},exchangeData(e,t){let a={};t.forEach(e=>{a[e.group]||(a[e.group]=[]),a[e.group].push(e)});let i={pipelineId:e.pipelineId,pipelineName:e.pipelineName,pipelineType:e.pipelineType,executeType:e.executeType,stageList:[]},s=null;return Object.values(a).forEach(e=>{let t={},a=[];e.forEach(e=>{if(e.root)t.stageName=e.name,t.type=e.group,t.stageId=e.stageId,t.configId=e.configId,s=e.stageId;else{console.log("sub item",e);let t=e.originData.compareResults;t||(t=e.originData.compareInfo);let i={actionId:e.originData.actionId,compareInfo:t,paramList:e.originData.paramList};a.push({nodeName:e.name,configDetail:JSON.stringify(i),type:e.group,nodeId:e.nodeId,stageId:s})}}),t.nodes=a,i.stageList.push(t)}),console.log("转换结果",i),i},displayData(e){let t=[],a={next:[]},i=0,s=0;return e.forEach(e=>{let r={id:i,name:e.stageName,hint:e.stageName,status:"success",group:s,root:!0,stageId:e.stageId,configId:e.configId,list:e.nodes,next:[]};t.push(r),a.next.push({index:i,weight:0}),i++,e.nodes&&e.nodes.forEach(e=>{t.push({id:i,name:e.nodeName,hint:e.nodeName,status:"success",group:s,nodeId:e.nodeId,originData:JSON.parse(e.configDetail),next:[]}),a.next.push({index:i,weight:0}),i++}),a=r,s++}),t[0].status="start",t[t.length-1].status="end",console.log("filnal",t),t},getRootOfNode(e,t){if(t.root)return t;let a=t;return e.forEach(e=>{e.group==t.group&&e.root&&(a=e)}),a},changeGroup(e,t,a){let i=t.group;if(e.forEach(e=>{i==e.group&&(e.group="temp")}),a){let t=i-1;e.forEach(e=>{t==e.group&&(e.group=t+1),"temp"==e.group&&(e.group=i-1)})}else{let t=i+1;e.forEach(e=>{t==e.group&&(e.group=t-1),"temp"==e.group&&(e.group=i+1)})}},transformTreeNode(e){let t=[],a={},i=[];return e.forEach(e=>{e.root?(a.nodes=JSON.parse(JSON.stringify(i)),a=e,t.push(e),i=[]):i.push(e)}),t[t.length-1].nodes=[],t},resetId(e){let t=0;e.forEach(e=>{e.id=t,t++})}},Pa={createNode(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/nodes";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateNode(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/node";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getNode(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/node/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getNodeActions(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/executors`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getNodePage(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/pipeline/nodes?page=${e}&size=${t}&name=${a}`;y.get(r).then(e=>{i(e)}).catch(e=>{s(e)})})},getAllNodes(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/nodes/all";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},deleteNode(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/node/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},Ia={pipelineList(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/list`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},queryPipeline(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/detail/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},savePipeline(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updatePipeline(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/pipeline/${e}/${t}`;y.put(r,a).then(e=>{i(e)}).catch(e=>{s(e)})})},deletePipeline(e,t){return new Promise((a,i)=>{let s=`/v1/devops/pipeline/${e}/${t}`;y.delete(s).then(e=>{a(e)}).catch(e=>{i(e)})})},defaultConfig(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/pipe";y.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},startPipeline(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/"+e;y.post(i).then(e=>{t(e)}).catch(e=>{a(e)})})},pausePipeline(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/pause`;y.put(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},Da={components:{draggable:Ee.a},props:{operate:{type:Number,default:1},pipeline:{type:String,default:""},service:{type:String},enableView:{type:Boolean,default:!1}},watch:{pipeline:{handler(e){this.pipelineId=e},deep:!0,immediate:!0},service:{handler(e){this.serviceId=e},deep:!0,immediate:!0},operate:{handler(e){1==e&&(this.isView=!1,this.isEditPipeline=!0,this.getPipeline()),2==e&&(this.isView=!0,this.isEditPipeline=!1,this.getPipeline()),3==e&&(this.isView=!1,this.pipelineForm={},this.pipelineId="",this.serviceId="",this.getDefaultPipe(),this.isEditPipeline=!1)},deep:!0,immediate:!0}},computed:{calculateShow(){if(!this.stepConfigs||0==this.stepConfigs.length)return!1;let e=!1;return this.stepConfigs.forEach(t=>{t.showCompare&&(e=!0)}),e},isSchdule(){return 2==this.pipelineForm.pipelineType},isPublish(){return 1==this.pipelineForm.pipelineType}},data(){return{isEditPipeline:!1,pipelineForm:{},isView:!1,dialogVisible:!1,operateType:1,startMove:!1,editPipelines:[],formLabelWidth:"120px",nodeForm:{},stepOptions:[],itemList:[],configForm:{},paramConfigs:[],stepConfigs:[],labelWidth:"150px",rootList:[],uuid:"",serviceId:"",pipelineId:"",chosedConfigItem:[],pipelineRule:{pipelineName:[{required:!0,message:"请输入流水线名称",trigger:"blur"}],pipelineType:[{required:!0,message:"请选择流水线类型",trigger:"change"}],executeType:[{required:!0,message:"请选择执行方式",trigger:"change"}]},nodeRule:{name:[{required:!0,message:"请输入节点名称",trigger:"blur"}],configId:[{required:!0,message:"请选择节点类型",trigger:"select"}]}}},methods:{leftMove(){this.nodeForm.name?(Ta.moveLeft(this.editPipelines,this.nodeForm),this.uuid++,this.nodeForm={}):this.$message.warning("请先点击选择一个移动的节点")},rightMove(){this.nodeForm.name?(Ta.moveRight(this.editPipelines,this.nodeForm),this.nodeForm={},this.uuid++):this.$message.warning("请先点击选择一个移动的节点")},removeNode(){let e=Ta.removeNode(this.editPipelines,this.nodeForm);this.editPipelines=e,this.uuid++},selectChange(e,t){this.chosedConfigItem.paramList.forEach(a=>{a.name==t.compareKey&&(a.value=e)}),this.$forceUpdate()},datachange(e){this.chosedConfigItem.compareResults.forEach(t=>{t.compareKey==e&&(t.value=this.configForm[e])}),this.chosedConfigItem.paramList.forEach(t=>{t.name==e&&(t.value=this.configForm[e])}),this.$forceUpdate()},selectStep(e){this.itemList=[],Pa.getNodeActions(e).then(e=>{let t={};this.nodeForm.list&&this.nodeForm.list.forEach(e=>{if(e.configDetail){let a=JSON.parse(e.configDetail);t[a.actionId]=a}}),e.data.forEach(e=>{let a=t[e.actionId];void 0!=a&&null!=a&&(e.compareResults=a.compareInfo,e.paramList.forEach(e=>{let t=a.paramList[e.name];t&&(e.value=t)}),this.nodeForm.list.forEach(t=>{let a=JSON.parse(t.configDetail);e.actionId==a.actionId&&(e.nodeId=t.nodeId)})),this.itemList.push(e)})}),this.paramConfigs=[],this.stepConfigs=[]},cancelCreatePipeline(){this.rootList=[],this.pipelineDialog=!1,this.isView=!1,this.pipelineForm={},this.editPipelines=[],this.configForm={},this.$emit("complete")},closeConfigNode(){this.nodeForm={},this.configForm={},this.itemList=[]},submitConfig(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=JSON.parse(JSON.stringify(this.editPipelines)),a=[];if(this.itemList.forEach(e=>{let t={};e.paramList.forEach(e=>{t[e.name]=e.value});let i={actionId:e.actionId,compareResults:e.compareResults,paramList:t};e.originData=i,a.push({name:e.actionName,hint:e.actionName,status:"success",nodeId:e.nodeId,originData:JSON.parse(JSON.stringify(i)),next:[]})}),1==this.operateType){let e=JSON.parse(JSON.stringify(t)),i=e.length,s={name:this.nodeForm.name,hint:this.nodeForm.hint,status:"success",configId:this.nodeForm.configId,list:[],id:i,group:i,root:!0};this.editPipelines=Ta.addNode(t,s,a),this.uuid++}else this.editPipelines=Ta.updateNode(t,this.nodeForm,a);this.resetNode()})},submitPipeline(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=Ta.exchangeData(this.pipelineForm,this.editPipelines);if(2==t.pipelineType){let e=`0 0 ${this.pipelineForm.scheduleTime} * * ?`;t.pipelineConfig=JSON.stringify({schedule:e})}this.isEditPipeline&&Ia.updatePipeline(this.serviceId,this.pipelineId,t).then(()=>{this.$message({message:"修改流水线成功",type:"success"}),this.cancelCreatePipeline()}),this.isEditPipeline||(t.serviceId=this.serviceId,Ia.savePipeline(t).then(()=>{this.$message({message:"创建流水线成功",type:"success"}),this.cancelCreatePipeline()}))})},choosePipeItem(e){let t=e;this.nodeForm=t,e.disable||this.startMove||(this.editPipelines.forEach(a=>{a.group==e.group&&a.root&&(this.nodeForm=a,t=a)}),this.dialogVisible=!0,this.operateType=2,this.itemList=t.list,this.selectStep(t.configId))},chooseStep(e){this.stepConfigs=JSON.parse(JSON.stringify(e.compareResults)),this.stepConfigs.forEach(e=>{this.configForm[e.compareKey]=e.value}),this.paramConfigs=[],e.paramList.forEach(e=>{this.configForm[e.name]=e.value,this.paramConfigs.push({compareKey:e.name,description:e.description,value:e.value,type:e.type})}),"TEST"==e.executeType&&this.getFeatureTasks(),"DEPLOY"==e.executeType&&this.getAllEnvs(),this.chosedConfigItem=e,this.$forceUpdate()},getFeatureTasks(){wt.getAllTaskList(this.serviceId).then(e=>{let t=[];e.data.forEach(e=>{t.push({label:e.taskName,value:e.taskId})}),this.paramConfigs.forEach(e=>{"taskId"==e.compareKey&&(e.list=t)}),this.$forceUpdate()})},getAllEnvs(){Et.getAllEnvs().then(e=>{let t=[];e.data.forEach(e=>{t.push({label:e.envName,value:e.envId})}),this.paramConfigs.forEach(e=>{"envId"==e.compareKey&&(e.list=t)}),this.$forceUpdate()})},resetNode(){this.dialogVisible=!1,this.configForm={},this.itemList=[],this.nodeForm={}},getConfigNodes(){Pa.getAllNodes().then(e=>{this.stepOptions=e.data})},getDefaultPipe(){Ia.defaultConfig().then(e=>{let t=JSON.parse(e.data.configDetail);t.forEach(e=>{e.id&&e.rootId==e.id&&this.rootList.push(e)}),this.editPipelines=JSON.parse(JSON.stringify(t))})},getPipeline(){this.pipelineForm={},Ia.queryPipeline(this.pipelineId).then(e=>{this.editPipelines=Ta.displayData(e.data.stageList),this.pipelineForm=e.data;let t=JSON.parse(e.data.pipelineConfig);if(t){let e=t.schedule.split(" ")[2],a=new Date(2023,7,20,e);this.$set(this.pipelineForm,"scheduleTime",a)}this.uuid++})}},created(){this.getConfigNodes(),this.serviceId=this.service,this.pipelineId=this.pipeline}},Sa=Da,Na=(a("3aa8"),Object(n["a"])(Sa,Ca,_a,!1,null,"066f1ba8",null)),La=Na.exports,Ea={getPublishes(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/publishes`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},createPublish(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/publish";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updatePublish(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/publish";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deletePublish(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/publish/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},$a={latestPipelineHistory(e,t){return new Promise((a,i)=>{let s=`/v1/devops/pipeline/${e}/${t}/latest/history`;y.get(s).then(e=>{a(e)}).catch(e=>{i(e)})})},getPipelienStatus(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/status`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},approval(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/pipeline/node/approval?historyId=${e}&nodeId=${t}&type=${a}`;y.put(r).then(e=>{i(e)}).catch(e=>{s(e)})})}},Oa={createAction(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/actions";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateAction(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/action";y.put(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getAction(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/action/"+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},getActionPage(e,t,a){return new Promise((i,s)=>{let r=`/v1/devops/pipeline/actions?page=${e}&size=${t}&name=${a}`;y.get(r).then(e=>{i(e)}).catch(e=>{s(e)})})},deleteAction(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/action/"+e;y.delete(i).then(e=>{t(e)}).catch(e=>{a(e)})})}},za={components:{bind:ka,PipelineConfig:La},data(){return{nodes:[],startIndex:1,formLabelWidth:"80px",loading:!1,activePipelines:["1","2","3"],pipelines:[],currentPipeline:{pipelineConfig:[]},pipelineId:"",history:{},publishList:[],buildList:[],customList:[],isRunning:!1,pipelineDialog:!1,piplienOperate:0,prenodeId:[],serviceId:"",titleName:"新增流水线",showGitConfig:!1,uuid:1,isShowNodeLog:!1,logForm:{},publishData:[],approvalNode:{},showApproval:!1,bindGit:!1,recordList:[],taskRecordId:""}},methods:{closeNodeLog(){this.recordList=[],this.taskRecordId=""},filterStatus(e,t){return t.executeStatus===e},executeWay(e){let t="-";switch(e){case 1:t="手动执行";break;case 2:t="代码提交";break;case 3:t="定时执行";break}return t},approvalClose(){this.approvalNode={},this.showApproval=!1},cancelApproval(){this.approvalPipeline(2)},confirmApproval(){this.approvalPipeline(1)},approvalPipeline(e){$a.approval(this.history.historyId,this.approvalNode.nodeId,e).then(e=>{e.data?this.$message.success("审批通过"):this.$message.error("审批失败，请重试"),this.approvalClose()})},getServicePublishes(){this.publishData=[],Ea.getPublishes(this.serviceId).then(e=>{this.publishData=e.data})},publish(){let e={pipelineId:this.currentPipeline.pipelineId,serviceId:this.serviceId};Ea.createPublish(e).then(e=>{e.data?this.$message.success("推送发布成功，请去发布流水线查看"):this.$message.error("推送发布失败")})},removePublish(e){Ea.deletePublish(e.publishId).then(e=>{e.data?(this.$message.success("删除成功"),this.getServicePublishes()):this.$message.error("删除失败")})},completeNotify(){this.pipelineDialog=!1,this.getPipelineList(),1==this.piplienOperate&&Ia.queryPipeline(this.currentPipeline.pipelineId).then(e=>{let t=Ta.displayData(e.data.stageList);this.currentPipeline.pipelineConfig=t,this.currentPipeline.pipelineName=e.data.pipelineName,this.currentPipeline.pipelineType=e.data.pipelineType,this.currentPipeline.pipelineId=e.data.pipelineId,this.uuid++})},exchangeStatusMessage(e){let t="无";if(void 0==e||null==e)return t;switch(e){case 4:t="运行中";break;case 1:t="运行成功";break;case 2:t="运行失败";break;case 3:t="运行超时";break;default:t="运行失败";break}return t},exchangeExecuteStatus(e){let t="info";if(void 0==e||null==e)return t;switch(e){case 4:t="primary";break;case 1:t="success";break;case 2:t="danger";break;case 3:t="warning";break;default:t="danger";break}return t},operateLine(e,t){"delete"==e&&this.deletePipeline(t)},selectService(){this.getPipelineList(),this.currentPipeline={pipelineConfig:[]}},showNodeLog(e){e.originData&&e.originData.actionId&&Oa.getAction(e.originData.actionId).then(t=>{if("APPROVAL"==t.data.executeType&&this.isRunning){if(!this.history.historyId)return;return this.approvalNode=e,void(this.showApproval=!0)}if(!this.history||!this.history.historyId)return this.logForm.status=1,this.logForm.messageList=["未执行"],void(this.isShowNodeLog=!0);console.log("ddd",t);let a=t.data.executeType;$a.getPipelienStatus(this.history.historyId).then(t=>{t.data.nodeStatusList.forEach(t=>{t.nodeId==e.nodeId&&(this.logForm.nodeId=e.nodeId,this.logForm.status=t.status,this.logForm.messageList=t.message,this.isShowNodeLog=!0,"TEST"==a&&this.getTaskHistories(t.recordId))})})})},getTaskHistories(e){wt.getTaskRecordByTriggerId(e).then(e=>{this.taskRecordId=e.data.recordId,wt.getTaskHistories(this.taskRecordId).then(e=>{this.recordList=e.data})})},openTaskDetail(){let e=window.location.href.split("//"),t=e[1].split("/")[0];console.log(`${e[0]}//${t}/record/detail?recordId=${this.taskRecordId}`),window.open(`${e[0]}//${t}/record/detail?recordId=${this.taskRecordId}`,"_blank")},getPrenode(e,t){let a={};return e.forEach(e=>{e.next&&e.next.length>0&&e.next.forEach(i=>{i.index==t&&(a=e)})}),a},preNodeAddline(e,t,a,i){e.forEach(e=>{e.id==t&&a.forEach(t=>{e.next.push({index:t,weight:0,groupId:i})})})},remoteMethod(){w.getServices().then(e=>{this.pipelines=[],e.data.forEach(e=>{this.pipelines.push({label:e.serviceName,value:e.serviceId})})})},pausePipeline(){this.isRunning&&Ia.pausePipeline(this.history.historyId).then(e=>{this.isRunning=!1,e.data?this.$message.success("停止流水线成功"):this.$message.error("停止流水线失败")})},startPipeline(){if(!this.currentPipeline.pipelineConfig.length)return void this.$message.warning("请先选择流水线");let e=1==this.currentPipeline.pipelineType&&this.publishData.length<1;if(e)this.$message.warning("待发布列表为空，请先推送分支到发布流水线");else if(e||this.bindGit)Ia.startPipeline(this.currentPipeline.pipelineId).then(e=>{""!=e.data&&null!=e.data?(this.$message.success("开始运行流水线"),this.getLatestHistory(this.currentPipeline.pipelineId),this.isRunning=!0,this.currentPipeline.pipelineConfig.forEach(e=>{e.status="success"}),this.uuid++):this.$message.error("运行流水线失败")});else{let e=this.$message.warning({dangerouslyUseHTMLString:!0,message:'当前流水线未绑定分支，请先绑定 <span style="cursor: pointer;color:#409EFF" @click="showGitConfig = !showGitConfig">去绑定>></span>'}),t=this;e.$el.querySelector("span").onclick=()=>{t.showGitConfig=!t.showGitConfig}}},exchangeStatus(e){switch(e){case 1:return"success";case 2:return"failure";case 3:return"unstable";case 4:return"running";case 5:return"unstable";case 6:return"paused"}},startEdit(){this.currentPipeline.pipelineConfig.length?(this.piplienOperate=1,this.pipelineDialog=!0):this.$message.warning("请先选择流水线")},startView(){this.currentPipeline.pipelineConfig.length?(this.piplienOperate=2,this.titleName="查看流水线",this.pipelineDialog=!0):this.$message.warning("请先选择流水线")},selectPipeline(e){this.publishList.forEach(e=>{e.selected=!1}),this.buildList.forEach(e=>{e.selected=!1}),this.customList.forEach(e=>{e.selected=!1}),e.selected=!0,Ia.queryPipeline(e.pipelineId).then(t=>{let a=Ta.displayData(t.data.stageList);this.currentPipeline.pipelineConfig=a,this.currentPipeline.pipelineName=t.data.pipelineName,this.currentPipeline.pipelineType=t.data.pipelineType,this.currentPipeline.executeType=t.data.executeType,this.currentPipeline.pipelineId=e.pipelineId,this.pipelineId=e.pipelineId,this.uuid++,this.checkBindBranch(),1==this.currentPipeline.pipelineType&&this.getServicePublishes()}),$a.latestPipelineHistory(this.serviceId,e.pipelineId).then(e=>{e.data?(this.history=e.data,$a.getPipelienStatus(this.history.historyId).then(e=>{let t={};e.data.nodeStatusList.forEach(e=>{t[e.nodeId]=this.exchangeStatus(e.status)}),this.currentPipeline.pipelineConfig.forEach(e=>{let a=t[e.nodeId];e.status=a||"success"}),this.uuid++})):this.history={}})},getLatestHistory(e){$a.latestPipelineHistory(this.serviceId,e).then(e=>{e.data?this.history=e.data:this.history={}})},handleCommand(e){"new"==e&&(this.piplienOperate=3,this.titleName="创建流水线",this.pipelineDialog=!0)},deletePipeline(e){this.$confirm(`确认删除流水线【${e.pipelineName}】？`).then(()=>{Ia.deletePipeline(this.serviceId,e.pipelineId).then(()=>{this.getPipelineList()})})},getPipelineList(){Ia.pipelineList(this.serviceId).then(e=>{this.publishList=[],this.buildList=[],this.customList=[],e.data.forEach(e=>{e.selected=!1,e.pipelineConfig=JSON.parse(e.pipelineConfig),1==e.pipelineType&&this.publishList.push(e),2==e.pipelineType&&this.buildList.push(e),3==e.pipelineType&&this.customList.push(e)})})},getConfigNodes(){Pa.getAllNodes().then(e=>{this.stepOptions=e.data})},getDefaultService(){w.getServices().then(e=>{this.pipelines=[],e.data.forEach(e=>{this.pipelines.push({label:e.serviceName,value:e.serviceId})}),this.serviceId=this.pipelines[0].value,this.getPipelineList()})},loopQueryStatus(){setInterval(()=>{this.history.historyId&&$a.getPipelienStatus(this.history.historyId).then(e=>{let t={};if(e.data.nodeStatusList.forEach(e=>{t[e.nodeId]=this.exchangeStatus(e.status),e.nodeId==this.logForm.nodeId&&(this.logForm={nodeId:this.logForm.nodeId,status:e.status,messageList:e.message})}),this.currentPipeline.pipelineConfig.forEach(e=>{let a=t[e.nodeId];a&&(e.status=a)}),4!=e.data.pipelineStatus)return this.isRunning=!1,void this.getLatestHistory(this.currentPipeline.pipelineId);this.isRunning=!0})},3e3)},cancelCreatePipeline(){this.pipelineDialog=!1},closeGitDialog(){this.checkBindBranch(),this.showGitConfig=!1},checkBindBranch(){this.bindGit=!1,ga.gitbindList(this.currentPipeline.pipelineId).then(e=>{e.data.forEach(e=>{e.isChoose&&(this.bindGit=!0)})})}},created(){this.getConfigNodes(),this.getDefaultService(),this.loopQueryStatus()}},Aa=za,Va=(a("f2dc"),Object(n["a"])(Aa,ha,ma,!1,null,"b76be62c",null)),qa=Va.exports,Ra=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{staticClass:"content",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"节点列表",name:"node"}},[t("div",{staticClass:"query-div"},[t("el-form",{attrs:{inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"节点名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入节点名称"},model:{value:e.queryNodeName,callback:function(t){e.queryNodeName=t},expression:"queryNodeName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQueryNode}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.createNode}},[e._v("新增节点")])],1)],1)],1),t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.nodeList,stripe:""}},[t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},on:{click:function(t){return e.editNode(a.row)}},slot:"reference"},[e._v("编辑")]),t("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},on:{click:function(t){return e.removeNode(a.row)}},slot:"reference"},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.currentNodePage,total:e.nodeTotalSize},on:{"current-change":e.changeNodePage}})],1)]),t("el-tab-pane",{attrs:{label:"执行点",name:"execute"}},[t("div",{staticClass:"query-div"},[t("el-form",{attrs:{inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"执行点名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入执行点名称"},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.createTemplet}},[e._v("新增执行点")])],1)],1)],1),t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.actionList,stripe:""}},[t("el-table-column",{attrs:{prop:"actionName",label:"执行点名称"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},on:{click:function(t){return e.editAction(a.row)}},slot:"reference"},[e._v("编辑")]),"HTTP"==a.row.executeType?t("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},on:{click:function(t){return e.removeAction(a.row)}},slot:"reference"},[e._v("删除")]):e._e()]}}])})],1),t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.currentPage,total:e.totalSize},on:{"current-change":e.changePage}})],1)])],1),t("el-dialog",{attrs:{title:e.nodeTitle,visible:e.showCreateNode,width:"80%","before-close":e.closeNodeDialog},on:{"update:visible":function(t){e.showCreateNode=t}}},[t("el-form",{ref:"nodeForm",attrs:{model:e.nodeForm,rules:e.nodeRule,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"节点名称",prop:"nodeName"}},[t("el-input",{attrs:{placeholder:"请输入节点名称"},model:{value:e.nodeForm.nodeName,callback:function(t){e.$set(e.nodeForm,"nodeName",t)},expression:"nodeForm.nodeName"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入执行点描述"},model:{value:e.nodeForm.description,callback:function(t){e.$set(e.nodeForm,"description",t)},expression:"nodeForm.description"}})],1),t("el-form-item",{attrs:{label:"关联执行点",prop:"executors"}},[t("el-select",{attrs:{multiple:"",clearable:"",placeholder:"请选择"},model:{value:e.nodeForm.executors,callback:function(t){e.$set(e.nodeForm,"executors",t)},expression:"nodeForm.executors"}},e._l(e.executeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeNodeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addNode("nodeForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:e.title,visible:e.showCreateExecuter,"before-close":e.closeDialog,width:"80%"},on:{"update:visible":function(t){e.showCreateExecuter=t}}},[t("el-form",{ref:"actionForm",attrs:{model:e.actionForm,rules:e.actionRule,size:"small","label-width":"150px"}},[t("el-form-item",{attrs:{label:"执行点名称",prop:"actionName"}},[t("el-input",{attrs:{placeholder:"请输入执行点名称"},model:{value:e.actionForm.actionName,callback:function(t){e.$set(e.actionForm,"actionName",t)},expression:"actionForm.actionName"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入执行点描述"},model:{value:e.actionForm.description,callback:function(t){e.$set(e.actionForm,"description",t)},expression:"actionForm.description"}})],1),t("el-form-item",{attrs:{label:"执行类型",prop:"executeType"}},[t("el-radio-group",{on:{change:e.chooseExecuteType},model:{value:e.executeType,callback:function(t){e.executeType=t},expression:"executeType"}},[t("el-radio",{attrs:{label:"HTTP",disabled:e.isEditAction}},[e._v("默认")]),t("el-radio",{attrs:{label:"BUILD",disabled:""}},[e._v("构建")]),t("el-radio",{attrs:{label:"WAIT",disabled:""}},[e._v("等待")]),t("el-radio",{attrs:{label:"DEPLOY",disabled:""}},[e._v("部署")]),t("el-radio",{attrs:{label:"TEST",disabled:""}},[e._v("用例测试")]),t("el-radio",{attrs:{label:"APPROVAL",disabled:""}},[e._v("人工卡点")]),t("el-radio",{attrs:{label:"MERGE",disabled:""}},[e._v("合并master")])],1)],1),"HTTP"==e.executeType?t("HttpAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"APPROVAL"==e.executeType?t("ApprovalAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"BUILD"==e.executeType?t("BuildAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"DEPLOY"==e.executeType?t("DeployAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"TEST"==e.executeType?t("FeatureAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"WAIT"==e.executeType?t("WaitAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"MERGE"==e.executeType?t("MergeAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addAction("actionForm")}}},[e._v("确 定")])],1)],1)],1)},Ba=[],ja=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),t("el-form-item",{attrs:{label:"动作触发地址"}},[t("el-input",{attrs:{placeholder:"请输入执行点名称"},on:{input:e.notifyParam},model:{value:e.dataForm.actionUrl,callback:function(t){e.$set(e.dataForm,"actionUrl",t)},expression:"dataForm.actionUrl"}})],1),t("el-form-item",{attrs:{label:"参数列表"}},[e._l(e.paramList,(function(a,i){return t("el-row",{key:i,staticClass:"config-line"},[t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"输入参数名"},on:{input:e.notifyParam},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"item.name"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"输入参数描述"},on:{input:e.notifyParam},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)],1)})),t("div",{staticClass:"add-btn",on:{click:e.addNewItem}},[e._v("新增参数")])],2),t("el-divider",{attrs:{"content-position":"left"}},[e._v("状态查询配置")]),t("el-form-item",{attrs:{label:"状态查询地址"}},[t("el-input",{attrs:{placeholder:"请输入状态查询地址"},on:{input:e.notifyParam},model:{value:e.dataForm.queryUrl,callback:function(t){e.$set(e.dataForm,"queryUrl",t)},expression:"dataForm.queryUrl"}})],1),t("el-form-item",{attrs:{label:"结果条件列表"}},[e._l(e.compareList,(function(a,i){return t("el-row",{key:i,staticClass:"config-line"},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"比较Key"},on:{input:e.notifyParam},model:{value:a.compareKey,callback:function(t){e.$set(a,"compareKey",t)},expression:"item.compareKey"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"描述"},on:{input:e.notifyParam},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"选择数据类型"},on:{change:e.notifyParam},model:{value:a.valueType,callback:function(t){e.$set(a,"valueType",t)},expression:"item.valueType"}},e._l(e.typeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"选择运算服符"},on:{change:e.notifyParam},model:{value:a.operator,callback:function(t){e.$set(a,"operator",t)},expression:"item.operator"}},e._l(e.operators,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"设置期望值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)],1)})),t("div",{staticClass:"add-btn",on:{click:e.addNewCondition}},[e._v("新增条件")])],2)],1)},Ja=[],Ma={props:{form:Object},watch:{form:{handler(e){this.dataForm=e,e.paramList&&e.paramList.length>0&&(this.paramList=e.paramList),e.compareResults&&e.compareResults.length>0&&(this.compareList=e.compareResults),this.notifyParam()},deep:!0,immediate:!0}},data(){return{dataForm:{},paramList:[{}],compareList:[{showCompare:!0}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList,actionUrl:this.dataForm.actionUrl,queryUrl:this.dataForm.queryUrl})},addNewItem(){this.paramList.push({})},addNewCondition(){this.compareList.push({showCompare:!0})}},created(){this.dataForm=this.form,this.notifyParam()}},Ga=Ma,Ua=(a("3a47"),Object(n["a"])(Ga,ja,Ja,!1,null,"452d4042",null)),Ha=Ua.exports,Ka=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("秒")])])],1)}))],2)},Wa=[],Qa={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"maxWait",description:"审批最大等待时长(秒)",value:604800}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:[]})},presetValue(e,t,a){let i={};e.forEach(e=>{i[e[a]]=e.value}),t.forEach(e=>{let t=i[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},Ya=Qa,Xa=(a("f6cd"),Object(n["a"])(Ya,Ka,Wa,!1,null,"948e7356",null)),Za=Xa.exports,ei=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("默认在根目录下")])])],1)}))],2)},ti=[],ai={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),e.compareResults&&e.compareResults.length>0&&this.presetValue(e.compareResults,this.compareList,"compareKey"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"pomPath",description:"构建pom相对路径",value:"pom.xml"}],compareList:[{compareKey:"status",description:"构建状态",valueType:"Integer",operator:"=",value:"1",showCompare:!1}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList,actionUrl:this.dataForm.actionUrl,queryUrl:this.dataForm.queryUrl})},presetValue(e,t,a){let i={};e.forEach(e=>{i[e[a]]=e.value}),t.forEach(e=>{let t=i[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},ii=ai,si=(a("1b39"),Object(n["a"])(ii,ei,ti,!1,null,"fcb24c76",null)),ri=si.exports,li=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"在流水线选择部署的环境",disabled:""},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)}))],2)},oi=[],ni={props:{form:Object},watch:{form:{handler(e){this.dataForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),e.compareResults&&e.compareResults.length>0&&this.presetValue(e.compareResults,this.compareList,"compareKey"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{dataForm:{},paramList:[{name:"envId",description:"环境Id",value:"",type:"select"}],compareList:[{compareKey:"status",description:"部署状态",value:"",valueType:"Integer",operator:"=",showCompare:!1}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}],deployModes:[{label:"Jar部署",value:"JAR"},{label:"镜像部署",value:"MIRROR"}]}},methods:{presetValue(e,t,a){let i={};e.forEach(e=>{i[e[a]]=e.value}),t.forEach(e=>{let t=i[e[a]];t&&(e.value=t)})},notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList,actionUrl:this.dataForm.actionUrl,queryUrl:this.dataForm.queryUrl})}},created(){this.dataForm=this.form,this.notifyParam()}},ci=ni,pi=(a("1d06"),Object(n["a"])(ci,li,oi,!1,null,"12231a5b",null)),di=pi.exports,ui=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"编辑流水线时选择",disabled:""},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)})),t("el-divider",{attrs:{"content-position":"left"}},[e._v("状态查询配置")]),e._l(e.compareList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-input-number",{attrs:{min:50,max:100,label:"请输入默认值"},on:{change:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)}))],2)},hi=[],mi={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),e.compareResults&&e.compareResults.length>0&&this.presetValue(e.compareResults,this.compareList,"compareKey"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"taskId",description:"选择任务",value:"",type:"select"}],compareList:[{compareKey:"percent",description:"执行成功率",operator:">=",valueType:"Integer",value:"90",showCompare:!0}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList})},presetValue(e,t,a){let i={};e.forEach(e=>{i[e[a]]=e.value}),t.forEach(e=>{let t=i[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},vi=mi,fi=(a("dfd2"),Object(n["a"])(vi,ui,hi,!1,null,"70ffc2d0",null)),gi=fi.exports,bi=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("秒")])])],1)}))],2)},yi=[],wi={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"waitTime",description:"节点等待时长",value:10}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:[]})},presetValue(e,t,a){let i={};e.forEach(e=>{i[e[a]]=e.value}),t.forEach(e=>{let t=i[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},ki=wi,Ci=(a("91ee"),Object(n["a"])(ki,bi,yi,!1,null,"094fb5f3",null)),_i=Ci.exports,xi=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,i){return t("el-form-item",{key:i,attrs:{label:a.description}},[t("el-radio-group",{on:{change:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("el-radio",{attrs:{label:"1"}},[e._v("是")]),t("el-radio",{attrs:{label:"false"}},[e._v("否")])],1)],1)}))],2)},Fi=[],Ti={props:{form:Object},watch:{form:{handler(e){e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{paramList:[{name:"deleteBranch",description:"是否删除分支",value:2}]}},methods:{presetValue(e,t,a){let i={};e.forEach(e=>{i[e[a]]=e.value}),t.forEach(e=>{let t=i[e[a]];t&&(e.value=t)})},notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:[]})}},created(){this.notifyParam()}},Pi=Ti,Ii=(a("19aa"),Object(n["a"])(Pi,xi,Fi,!1,null,"054f31f1",null)),Di=Ii.exports,Si={components:{HttpAct:Ha,ApprovalAct:Za,BuildAct:ri,DeployAct:di,FeatureAct:gi,WaitAct:_i,MergeAct:Di},data(){return{queryName:"",actionList:[],showCreateExecuter:!1,actionForm:{},currentPage:1,totalSize:0,title:"创建执行点",isEditAction:!1,activeTab:"node",nodeList:[],showCreateNode:!1,nodeTitle:"创建节点",executeList:[],nodeForm:{},selectActions:[],currentNodePage:1,nodeTotalSize:0,queryNodeName:"",isEditNode:!1,executeType:"HTTP",configList:[],compareList:[],nodeRule:{nodeName:[{required:!0,message:"请输入节点名称",trigger:"blur"}],executors:[{required:!0,message:"请选择执行点",trigger:"change"}]},actionRule:{actionName:[{required:!0,message:"请输入执行点名称",trigger:"blur"}],executeType:[{required:!0,message:"请选择执行类型",trigger:"blur"}]}}},methods:{chooseExecuteType(){this.configList=[],this.compareList=[]},addNewCondition(){this.compareList.push({})},startQueryNode(){this.getNodes()},editNode(e){this.isEditNode=!0,this.nodeTitle="编辑节点",this.showCreateNode=!0,this.nodeForm=e,this.nodeForm.executors=[],this.getAllActions(),Pa.getNodeActions(e.nodeId).then(e=>{e.data.forEach(e=>{this.nodeForm.executors.push(e.actionId)})})},notifyParam(e){this.configList=e.paramList,this.compareList=e.compareList},closeNodeDialog(){this.isEditNode=!1,this.showCreateNode=!1,this.nodeForm={executors:[]},this.selectActions=[]},removeNode(e){this.$confirm(`确认删除节点【${e.nodeName}】？`).then(()=>{Pa.deleteNode(e.nodeId).then(e=>{e.data?(this.$message.success("删除节点成功"),this.getNodes()):this.$message.error("删除节点失败")})})},changeNodePage(){this.getNodes()},createNode(){this.nodeTitle="创建节点",this.showCreateNode=!0,this.nodeForm={executors:[]},this.getAllActions()},addNode(e){this.$refs[e].validate(e=>{if(!e)return!1;this.isEditNode?Pa.updateNode(this.nodeForm).then(e=>{e.data?(this.$message.success("修改节点成功"),this.getNodes(),this.closeNodeDialog()):this.$message.error("修改节点失败")}):Pa.createNode(this.nodeForm).then(e=>{e.data?(this.$message.success("添加节点成功"),this.getNodes(),this.closeNodeDialog()):this.$message.error("添加节点失败")})})},getNodes(){Pa.getNodePage(this.currentNodePage,10,this.queryNodeName).then(e=>{this.nodeTotalSize=e.total,this.nodeList=e.data})},startQuery(){this.currentPage=1,this.getActions()},changePage(){this.getActions()},createTemplet(){this.showCreateExecuter=!0,this.title="创建执行点",this.actionForm.executeType="HTTP"},editAction(e){this.isEditAction=!0,this.title="编辑执行点",this.showCreateExecuter=!0,this.actionForm=e,this.executeType=e.executeType},removeAction(e){this.$confirm(`确认删除执行点【${e.actionName}】？`).then(()=>{Oa.deleteAction(e.actionId).then(e=>{e.data?(this.$message.success("删除执行点成功"),this.getActions()):this.$message.error("删除执行点失败")})})},closeDialog(){this.showCreateExecuter=!1,this.configList=[],this.compareList=[],this.actionForm={},this.isEditAction=!1,this.executeType="HTTP"},addAction(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=this.actionForm;t.paramList=[],this.configList.forEach(e=>{"TEST"==this.executeType&&(e.type="select"),e.description&&e.name&&t.paramList.push(e)}),t.compareResults=[],this.compareList.forEach(e=>{e.value&&e.compareKey&&t.compareResults.push(e)}),t.executeType=this.executeType,this.isEditAction?Oa.updateAction(t).then(e=>{e.data?(this.$message.success("修改执行点成功"),this.closeDialog(),this.getActions()):this.$message.error("修改执行点失败")}):Oa.createAction(t).then(e=>{e.data?(this.$message.success("创建执行点成功"),this.closeDialog(),this.getActions()):this.$message.error("创建执行点失败")})})},addNewItem(){this.configList.push({})},getActions(){Oa.getActionPage(this.currentPage,10,this.queryName).then(e=>{this.totalSize=e.total,this.actionList=e.data})},getAllActions(){Oa.getActionPage(1,100,"").then(e=>{this.executeList=[],e.data.forEach(e=>{this.executeList.push({label:e.actionName,value:e.actionId})})})}},created(){this.getActions(),this.getNodes()}},Ni=Si,Li=(a("0264"),Object(n["a"])(Ni,Ra,Ba,!1,null,"152ea596",null)),Ei=Li.exports,$i=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title-line"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,size:"mini"}},[t("el-form-item",{attrs:{label:"服务列表"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-select",{attrs:{size:"small",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.service,callback:function(t){e.service=t},expression:"service"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1)],1)],1),t("div",{staticClass:"change-content"},[t("div",{staticClass:"change-title"},[t("div",{staticClass:"change-desc"},[e._v("代码变更列表")]),t("div",{staticClass:"add-btn"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:e.addChangeCode}},[e._v("添加变更")])],1)]),t("div",{staticClass:"change-list"},[t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.changeList,stripe:""}},[t("el-table-column",{attrs:{prop:"changeName",label:"变更"}}),t("el-table-column",{attrs:{prop:"changeBranch",label:"分支"}}),t("el-table-column",{attrs:{prop:"changeDesc",label:"描述"}}),t("el-table-column",{attrs:{prop:"relationId",label:"需求/缺陷Id"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},on:{click:function(t){return e.removeChange(a.row)}},slot:"reference"},[e._v("删除")])]}}])})],1)],1)])]),t("el-dialog",{attrs:{title:"创建变更",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"changeForm",attrs:{model:e.changeForm,rules:e.rule,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"变更描述",prop:"changeName"}},[t("el-input",{attrs:{placeholder:"请输入变更详细说明",autocomplete:"off"},model:{value:e.changeForm.changeName,callback:function(t){e.$set(e.changeForm,"changeName",t)},expression:"changeForm.changeName"}})],1),t("el-form-item",{attrs:{label:"详细说明",prop:"changeDesc"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入详细说明",autosize:{minRows:2,maxRows:4}},model:{value:e.changeForm.changeDesc,callback:function(t){e.$set(e.changeForm,"changeDesc",t)},expression:"changeForm.changeDesc"}})],1),t("el-form-item",{attrs:{label:"选择分支",prop:"branchType"}},[t("el-radio-group",{on:{change:e.selectBranchType},model:{value:e.changeForm.branchType,callback:function(t){e.$set(e.changeForm,"branchType",t)},expression:"changeForm.branchType"}},[t("el-radio",{attrs:{label:"default"}},[e._v("默认")]),t("el-radio",{attrs:{label:"custom"}},[e._v("自定义")])],1)],1),t("el-form-item",{attrs:{label:"变更分支",prop:"changeBranch"}},[t("el-input",{attrs:{disabled:e.editBranch,placeholder:"请输入分支名",autocomplete:"off"},model:{value:e.changeForm.changeBranch,callback:function(t){e.$set(e.changeForm,"changeBranch",t)},expression:"changeForm.changeBranch"}})],1),t("el-form-item",{attrs:{label:"关联需求/bug",prop:"relationId"}},[t("el-input",{attrs:{placeholder:"请输入关联的需求或bugId",autocomplete:"off"},model:{value:e.changeForm.relationId,callback:function(t){e.$set(e.changeForm,"relationId",t)},expression:"changeForm.relationId"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.confirmChange("changeForm")}}},[e._v("确 定")])],1)],1)],1)},Oi=[],zi={codeChangeList(e){return new Promise((t,a)=>{let i=`/v1/devops/pipeline/${e}/changes`;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},relationList(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/relations?name="+e;y.get(i).then(e=>{t(e)}).catch(e=>{a(e)})})},saveCodeChange(e){return new Promise((t,a)=>{let i="/v1/devops/pipeline/change";y.post(i,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteCodeChange(e,t){return new Promise((a,i)=>{let s=`/v1/devops/pipeline/${e}/change/${t}`;y.delete(s).then(e=>{a(e)}).catch(e=>{i(e)})})}},Ai={data(){return{service:"",serviceList:[],changeList:[],changeForm:{branchType:"custom"},dialogFormVisible:!1,loading:!1,editBranch:!1,rule:{changeName:[{required:!0,message:"请输入变更描述",trigger:"blur"}],changeBranch:[{required:!0,message:"请输入分支名称",trigger:"blur"}]}}},methods:{getServices(){this.serviceList=[],w.getServices().then(e=>{this.serviceList=e.data,this.service=this.serviceList[0].serviceId,this.getCodeChangeList()})},addChangeCode(){this.dialogFormVisible=!0},selectService(){this.getCodeChangeList()},selectBranchType(e){if("default"==e){let e="develop_";var t=new Date,a=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();e+=s+i+a+"_"+this.$utils.randomString(6),this.editBranch=!0,this.changeForm.changeBranch=e}else this.changeForm.changeBranch="",this.editBranch=!1},removeChange(e){this.$confirm("确认删除？").then(()=>{zi.deleteCodeChange(this.service,e.changeId).then(()=>{this.$message({message:"删除变更成功",type:"success"}),this.getCodeChangeList()})})},closeDialog(){this.dialogFormVisible=!1,this.changeForm={}},confirmChange(e){this.$refs[e].validate(e=>{if(!e)return!1;this.changeForm.serviceId=this.service,zi.saveCodeChange(this.changeForm).then(()=>{this.$message({message:"创建变更成功",type:"success"}),this.changeForm={branchType:"custom"},this.dialogFormVisible=!1,this.getCodeChangeList()})})},getCodeChangeList(){zi.codeChangeList(this.service).then(e=>{this.changeList=e.data})}},created(){this.getServices()}},Vi=Ai,qi=(a("e5bf"),Object(n["a"])(Vi,$i,Oi,!1,null,"005f80ac",null)),Ri=qi.exports;i["default"].use(h["a"]);const Bi=[{path:"/case",name:"TestCase",component:T},{path:"/feature",name:"Feature",component:st},{path:"/template",name:"Template",component:gt},{path:"/task",name:"Task",component:xt},{path:"/record/detail",name:"RecordDetail",component:St},{path:"/",name:"Service",component:Vt},{path:"/pipeline",name:"Pipeline",component:qa},{path:"/code/change",name:"CodeChange",component:Ri},{path:"/pipe/action",name:"PipeAction",component:Ei},{path:"/env",name:"Environment",component:ea},{path:"/service/resource",name:"ServiceApi",component:Mt},{path:"/system",name:"System",component:la},{path:"/monitor",name:"Monitor",component:ua}],ji=new h["a"]({mode:"history",base:"/",routes:Bi});var Ji=ji,Mi={randomString(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=t.length,i="";for(let s=0;s<e;s++)i+=t.charAt(Math.floor(Math.random()*a));return i},isEmpty(e){return null==e||void 0==e||""==e}},Gi=a("9a30");i["default"].filter("dateFormat",(function(e){if(!e)return"";var t=new Date(e),a=String(t.getDate()).padStart(2,"0"),i=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();let r=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return s+"-"+i+"-"+a+" "+r+":"+l+":"+o})),i["default"].filter("statusFormat",(function(e){if(!e)return"";switch(e){case 1:return"success";case 2:return"danger";case 3:return"info";case 4:return"primary";case 5:return"wrning";case 6:return"info"}return"info"})),i["default"].filter("publisFormat",(function(e){if(!e)return"-";switch(e){case 1:return"待发布";case 2:return"发布中"}return"-"})),i["default"].filter("deployType",(function(e){if(!e)return"-";switch(e){case 1:return"ssh部署";case 2:return"K8S部署";case 3:return"Docker部署"}return"-"})),i["default"].filter("deployFormat",(function(e){if(!e)return"-";switch(e){case 1:return"可用";case 2:return"不可用"}return"-"})),i["default"].filter("statusName",(function(e){if(!e)return"";switch(e){case 1:return"处理成功";case 2:return"处理失败";case 3:return"处理超时";case 4:return"运行中";case 5:return"跳过失败";case 6:return"停止运行"}return"info"}));var Ui=a("e5d9");i["default"].use(Ui["a"]),i["default"].prototype.$utils=Mi,i["default"].use(u.a),i["default"].use(Gi["a"]),i["default"].config.productionTip=!1,new i["default"]({router:Ji,render:e=>e(p)}).$mount("#app")},"59c0":function(e,t,a){},"5bfb":function(e,t,a){"use strict";a("7f2f")},6204:function(e,t,a){"use strict";a("18c5")},"6c37":function(e,t,a){},"6c62":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFwAAABcCAMAAADUMSJqAAAAclBMVEX///8lZuQWYOP8/f8gZOQcYuTk6vsybOUuauUqaOQQXuORqu8/c+ZhiOm+zPVTf+jL1vfy9f0AWeOFoe2ds/CkuPHF0fbt8fyxwvNLeufU3fjg5vrZ4fn3+f7p7fsAW+NzleupvPJ7muxrj+oAVOIASuHJijtZAAAGsElEQVRo3uVZaZOrKhANCgqK+xK3RGPm/v+/eBVQETCJM3OrXtXjU+LSNt19Th/gcvlfjJvj3P6R6bsfuW6U3/+B6WsGIXZdjECW/LJpZ0zBZHoeGKaj84umm2cKXGmA9Nn8kuk4gMRVBoFB/HPLdhlYmmlmHgWl/TPTYeQZTTPzVhT+wHxFj00z8x6tvun1A1vYfTOmRx7nvb/mELofDQTz67my9gHEpigbk4uI/3nht5lrMu2SqG0jk3WM3Mz5EIwQHORvQk5zcA/CD2DbDik4DO/EWc7hTZAO7Rswpse1h3F3uXQvapOkL2Db1OhlWVvl5VJaLwsf1Z3ZdvgaMZPxCTEP9KbwvdLYC9C7iob55eK/rX5kqvrs/Wv+J09B39AfozdYxwBOpRjDN7Gb0KDzgQNfU1RaD/n8nD/Q1Hr1AUz0gi+9V+SXlVvbt5NwdFVOk/568auQE+IimfiCUmvJ1yqSaxJRTF4FfQs5ibp7sXqG6tLMyJULthq9ttL7gVaIdCvncPr/sAQl+Yd0nYziGfZCuM2EqsUYb/fQY75QzDkgeOvydsxiGTfb18J5fthj3SjfwopUaVBAKd0sEJUHYb0E+/6o05TFMkvTqFouOy6AzO9LKNEdKhTjgVRdGI7zxBo/EE46GZhYBxbCQzJ1ByHqkiCfqdB5yoWsBt1WUEbkxptj1jssdo0nA7oP6YEHUGhaIUSVxPtsCW0SiHR4bP7V8u+5PGAPnlL0ZE+NlYbPVDzQrn2Jg2MFG3RFUcSpRkLhzvioARoMwq/8S/jlsSJohHH8tQQm0FoXyHbGDcSyorKlHK8em0vXC2ytDHLXuzneobnXGoNUTreMJ5G1yBYx3MjY0jm+l/kiRBq/MqJaOm44RRhj5qszBQFSwU02u5RobQbJlOGrYQOcfNKFg+4BgpS5c3WhNYhU2hnkpEfMr+sQ4rXCXHoga1imXyydvQwWDNyeFodnp0ZVhpGtFROHAUvc4fotoVOsavZTi0u/paTpjX2wmb8J3AOZ6RC8TjHTMLjBKFfTDcMtE5gYhVTDCxDmxoKAW7ENWkJme7bIBIYGHRUKfwjDWqd6Toa1jqkm3GwW07WyBGDKohA11i0kgFlOEqK2VLqkykmNCLuuLfuLm4x7hDgHXMKFE1yPpUTDaLoAuNIgRNk3ew6nXsDRYXMnjMltn6RcwaR3UVe69DOzFi+wNp2XEpG/9DUW2DW9ducHaFKX3EWquk7GI60lPP9Dn5W0TXGrySwNJAFzD4f6DzeuBVboLsegn5ixUqnwDAAAMwVJ8c0Y80V36VqLILOe6J6DWX7fdGEvpLQsXAmAqP+qT296JPVXbyFZpArdJYUcBX5RNYrpWxcWobK0zsNGiZndhVUeICnoitYCisq7dnEx0ClKaC8uy352kj6nTyj7RlLfYLor3v73vMxubcfdioCF+B7Ojv0X7BNkIc6K97jj0203CmSkUaC9VHL8yPJ4rqVbuwzfFIK6W55XZ+30TI72qnCUSAeMfpDOdCfSgaQFC6PPXMx+ueGtrIpBGviy8GJFu2uvBAgmBLakgBZY+n3Pv9IKouKa1RbbX4TIBYlmR8wrSyEmuSvkydGGVoJ8MjOAd7PCbGGOuR2ZVzgsp9cZ8stCZACrVoqZwKasVq7UuFqPLkam5x/mOG9dMpXsjfeeTXzPfMSW64drzEUvhsa1lqi+FhMRIt6YRGMvEAH89dho21th5xsXz5gD5ErTRO6TXGVOGo3fTlzT+tWS4BiYIkOWVsWnsBjBXHYsnlHTq/C50/6mpAJZs2yA2q1KIrNbezIl2Jjxu2TFQ4AAgDxQb2QYQOMaWhEjoTHshK4LM9sp82wYsrx0Vipoa2OhQW3lmputo/x42/ABjAixcv3Rp3lnoc+PbOepcZ9jl8x11EY/YHFkvDCDpzYfG1hHWEqCLJYaTzKtUKfSL42BhAe61URhMzcllEBEozGvwrAqsogiCOY2a0KHd7g/pycVg2ZZ1040MPUEC/IszmTbAHxApsYxqGFkpEwNiWO6SXMGjq+2tZWkMt3kGHnNc2a2xgroXm53X/c0hKrDqmBVtJew2H2z1x3vksraGDWWM4vL/rvW2yOYahcEGjvZwWYmHNt414P6D44YRrg7NkCHW4LA2s1SlajmUQP3G0P0zLeiEuPzton7oXjt0GnrGHYfnw95Z417J86LfOucbcs/I+aDU0kFwbkDYetUwE8eHrf9iYCfPnuNIcQfjMlt+I2TUSerMVGGHhG3zr534p04H4zfPu3+b4y/2/KnF87ecHwAAAAASUVORK5CYII="},7105:function(e,t,a){},"746c":function(e,t,a){},"7e30":function(e,t,a){"use strict";a("2161")},"7f2f":function(e,t,a){},"83fc":function(e,t,a){},"84ec":function(e,t,a){"use strict";a("59c0")},8779:function(e,t,a){"use strict";a("b74f")},"8e4d":function(e,t,a){},"91ee":function(e,t,a){"use strict";a("30b4")},9224:function(e,t,a){},"973f":function(e,t,a){"use strict";a("c6e0")},"9b4e":function(e,t,a){},"9c5c":function(e,t,a){},"9ffd":function(e,t,a){"use strict";a("19c7")},a106:function(e,t,a){},a473:function(e,t,a){},a6a6:function(e,t,a){"use strict";a("aa79")},aa79:function(e,t,a){},b1b3:function(e,t,a){"use strict";a("a106")},b282:function(e,t,a){},b74f:function(e,t,a){},bba7:function(e,t,a){},c157:function(e,t,a){"use strict";a("4e7c")},c6e0:function(e,t,a){},c9a5:function(e,t,a){"use strict";a("41db")},d024:function(e,t,a){"use strict";a("2a98")},d527:function(e,t,a){"use strict";a("ed62")},d610:function(e,t,a){"use strict";a("fb34")},d89d:function(e,t,a){},dfd2:function(e,t,a){"use strict";a("9b4e")},e5bf:function(e,t,a){"use strict";a("83fc")},e844:function(e,t,a){},e9b3:function(e,t,a){},ed62:function(e,t,a){},eff7:function(e,t,a){"use strict";a("3131")},f176:function(e,t,a){},f2dc:function(e,t,a){"use strict";a("bba7")},f2fb:function(e,t,a){"use strict";a("2235")},f6cd:function(e,t,a){"use strict";a("a473")},fb34:function(e,t,a){},fb45:function(e,t,a){}});
//# sourceMappingURL=app.6a4cce35.js.map