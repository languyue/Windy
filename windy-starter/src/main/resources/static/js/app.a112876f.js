(function(e){function t(t){for(var s,l,o=t[0],n=t[1],c=t[2],u=0,p=[];u<o.length;u++)l=o[u],Object.prototype.hasOwnProperty.call(i,l)&&i[l]&&p.push(i[l][0]),i[l]=0;for(s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s]);d&&d(t);while(p.length)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],s=!0,o=1;o<a.length;o++){var n=a[o];0!==i[n]&&(s=!1)}s&&(r.splice(t--,1),e=l(l.s=a[0]))}return e}var s={},i={app:0},r=[];function l(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=s,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)l.d(a,s,function(t){return e[t]}.bind(null,s));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],n=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var d=n;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"02f3":function(e,t,a){},"04d2":function(e,t,a){"use strict";a("482f")},"05b5":function(e,t,a){"use strict";a("8c29")},"062f":function(e,t,a){},"066e":function(e,t,a){"use strict";a("d7a9")},"0934":function(e,t,a){},1356:function(e,t,a){"use strict";a("46bf")},"183d":function(e,t,a){},"18f1":function(e,t,a){"use strict";a("df7a")},"18f6":function(e,t,a){"use strict";a("9090")},1913:function(e,t,a){},"1aee":function(e,t,a){"use strict";a("2d6f")},"1b58":function(e,t,a){},"1d24":function(e,t,a){},"1e02":function(e,t,a){"use strict";a("2120")},2039:function(e,t,a){e.exports=a.p+"img/ssh.09b44442.png"},2120:function(e,t,a){},"220e":function(e,t,a){"use strict";a("273e")},"236c":function(e,t,a){},"25c3":function(e,t,a){},"273e":function(e,t,a){},"2a9b":function(e,t,a){},"2b2d":function(e,t,a){"use strict";a("5456")},"2cf8":function(e,t,a){"use strict";a("062f")},"2d6f":function(e,t,a){},"2f93":function(e,t,a){"use strict";a("79ea")},"37bc":function(e,t,a){},"38ce":function(e,t,a){},"38d3":function(e,t,a){"use strict";a("f762")},"38f1":function(e,t,a){"use strict";a("4c4b")},"3dfd":function(e,t,a){},"3dfdc":function(e,t,a){"use strict";var s=a("8bce"),i=a("42d8"),r=a("2877"),l=Object(r["a"])(i["default"],s["a"],s["b"],!1,null,null,null);t["default"]=l.exports},"400f":function(e,t,a){},"42d8":function(e,t,a){"use strict";var s=a("8533"),i=a.n(s);t["default"]=i.a},"44f2":function(e,t,a){"use strict";a("183d")},"46bf":function(e,t,a){},"482f":function(e,t,a){},"4c4b":function(e,t,a){},"52d0":function(e,t,a){},5431:function(e,t,a){"use strict";a("3dfd")},5456:function(e,t,a){},"54cf":function(e,t,a){"use strict";a("236c")},5606:function(e,t,a){"use strict";a("aaa0")},"56d7":function(e,t,a){"use strict";a.r(t);var s=a("2b0e"),i=a("3dfdc"),r=a("5c96"),l=a.n(r),o=(a("0fae"),a("8c4f")),n=function(){var e=this,t=e._self._c;return t("el-container",[t("el-header",{staticClass:"header"},[t("el-menu",{staticClass:"title-menu",attrs:{mode:"horizontal","default-active":e.$route.path,"background-color":"#545c64","text-color":"#fff",router:!0,"active-text-color":"#ffd04b"}},[t("el-submenu",{attrs:{index:"/workbench"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-marketing"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("工作台")])]),t("el-menu-item",{attrs:{index:"/workbench"}},[t("i",{staticClass:"el-icon-s-platform"}),e._v(" 个人工作台")]),t("el-menu-item",{attrs:{index:"/space"}},[t("i",{staticClass:"el-icon-s-shop"}),e._v(" 空间")])],2),t("el-submenu",{attrs:{index:"/"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-help"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("服务管理")])]),t("el-menu-item",{attrs:{index:"/"}},[t("i",{staticClass:"el-icon-s-opportunity"}),e._v(" 服务列表")]),t("el-menu-item",{attrs:{index:"/service/resource"}},[t("i",{staticClass:"el-icon-location"}),e._v(" api管理")])],2),t("el-submenu",{attrs:{index:"/code/change"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-share"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("流水线管理")])]),t("el-menu-item",{attrs:{index:"/code/change"}},[t("i",{staticClass:"el-icon-s-unfold"}),e._v(" 变更列表")]),t("el-menu-item",{attrs:{index:"/pipeline"}},[t("i",{staticClass:"el-icon-share"}),e._v(" 流水线")]),t("el-menu-item",{attrs:{index:"/pipe/action"}},[t("i",{staticClass:"el-icon-coin"}),e._v(" 流水线节点")])],2),t("el-submenu",{attrs:{index:"/case"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-promotion"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("用例管理")])]),t("el-menu-item",{attrs:{index:"/case"}},[t("i",{staticClass:"el-icon-cpu"}),e._v(" 功能测试")]),t("el-menu-item",{attrs:{index:"/e2e"}},[t("i",{staticClass:"el-icon-cpu"}),e._v(" e2e测试")]),t("el-menu-item",{attrs:{index:"/template"}},[t("i",{staticClass:"el-icon-s-platform"}),e._v(" 模版管理")]),t("el-menu-item",{attrs:{index:"/task"}},[t("i",{staticClass:"el-icon-s-order"}),e._v(" 任务管理")])],2),t("el-submenu",{attrs:{index:"/system"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-promotion"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("系统管理")])]),t("el-menu-item",{attrs:{index:"/system"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v(" 系统配置")]),t("el-menu-item",{attrs:{index:"/rbac"}},[t("i",{staticClass:"el-icon-s-tools"}),e._v(" RBAC管理")]),t("el-menu-item",{attrs:{index:"/env"}},[t("i",{staticClass:"el-icon-place"}),e._v(" 环境管理")]),t("el-menu-item",{attrs:{index:"/monitor"}},[t("i",{staticClass:"el-icon-s-platform"}),e._v(" 监控")])],2)],1),t("div",{staticClass:"user-icon"},[t("el-dropdown",{attrs:{szie:"mini"},on:{command:e.handleClick}},[t("span",{staticClass:"user-div"},[t("i",{staticClass:"el-icon-user-solid"}),t("span",[e._v(e._s(e.user.nickName?e.user.nickName:e.user.userName))])]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"profile"}},[e._v("个人信息")]),t("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出登录")])],1)],1)],1)],1),t("el-main",{staticClass:"main-bg"},[t("router-view")],1)],1)},c=[],d=a("bc3a"),u=a.n(d),p=a("852e"),m=a.n(p);u.a.interceptors.request.use(e=>{let t=m.a.get("token");return t&&(e.headers["Authorization"]="Bearer "+t),e},e=>{Promise.reject(e)}),u.a.interceptors.response.use(e=>e,e=>("Auth.000001"==e.response.data.code&&(m.a.remove("token"),pl.push({path:"/login"})),e.response.data.code?r["Message"].error(`[${e.response.data.code}] ${e.response.data.message}`):r["Message"].error("访问服务器失败"),Promise.reject(e)));let h="";var g={get(e){return new Promise((t,a)=>{u.a.get(h+e).then(e=>{200==e.status?t(e.data):a(e.data)}).catch(e=>{a(e)})})},delete(e){return new Promise((t,a)=>{u.a.delete(h+e).then(e=>{200==e.status?t(e.data):a(e.data)}).catch(e=>{a(e)})})},postFile(e,t){return new Promise((a,s)=>{u.a.post(h+e,t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>{200==e.status?a(e.data):s(e.data)}).catch(e=>{s(e)})})},post(e,t){return new Promise((a,s)=>{u.a.post(h+e,t).then(e=>{200==e.status?a(e.data):s(e.data)}).catch(e=>{s(e)})})},put(e,t){return new Promise((a,s)=>{u.a.put(h+e,t).then(e=>{200==e.status?a(e.data):s(e.data)}).catch(e=>{s(e)})})}},v={login(e){return new Promise((t,a)=>{let s="/v1/devops/user/login";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},logout(){return new Promise((e,t)=>{let a="/v1/devops/user/logout";g.put(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getUserDetail(){return new Promise((e,t)=>{let a="/v1/devops/user/detail";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createUser(e){return new Promise((t,a)=>{let s="/v1/devops/users";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},queryUserByName(e){return new Promise((t,a)=>{let s="/v1/devops/user?name="+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},updateUser(e){return new Promise((t,a)=>{let s="/v1/devops/users/"+e.userId;g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getUser(e){return new Promise((t,a)=>{let s="/v1/devops/users/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteUser(e){return new Promise((t,a)=>{let s="/v1/devops/users/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},f={data(){return{user:{}}},methods:{handleClick(e){console.log("command",e),"logout"==e&&v.logout().then(e=>{console.log("logout",e),m.a.remove("token"),this.$router.push({path:"/login"})}),"profile"==e&&this.$router.push({path:"/user"})}},mounted(){v.getUserDetail().then(e=>{this.user=e.data})}},b=f,y=(a("2f93"),a("2877")),w=Object(y["a"])(b,n,c,!1,null,null,null),k=w.exports,C=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"service"},[t("el-row",[t("el-col",{attrs:{span:22}},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"small",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.service,callback:function(t){e.service=t},expression:"service"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增测试集")])],1)],1)],1)],1)],1),t("div",{staticClass:"content"},[t("el-table",{attrs:{data:e.featureData,size:"mini"}},[t("el-table-column",{attrs:{prop:"testCaseName",label:"测试集"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"最近编辑时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.startEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.startDelete(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{type:"info",plain:"",icon:"el-icon-document-copy",size:"mini"},on:{click:function(t){return e.startCopy(a.row)}}},[e._v("复制")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:"创建测试集",visible:e.showDialog,width:"70%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("el-form",{ref:"caseForm",attrs:{model:e.caseForm,rules:e.rule,size:"small","label-width":"120px"}},[t("el-form-item",{attrs:{label:"测试集名称",prop:"testCaseName"}},[t("el-input",{attrs:{placeholder:"请输入测试集名称"},model:{value:e.caseForm.testCaseName,callback:function(t){e.$set(e.caseForm,"testCaseName",t)},expression:"caseForm.testCaseName"}})],1),t("el-form-item",{attrs:{label:"测试集描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请输入测试集描述"},model:{value:e.caseForm.description,callback:function(t){e.$set(e.caseForm,"description",t)},expression:"caseForm.description"}})],1),t("el-form-item",{attrs:{label:"选择服务",prop:"serviceId"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.caseForm.serviceId,callback:function(t){e.$set(e.caseForm,"serviceId",t)},expression:"caseForm.serviceId"}},e._l(e.serviceList,(function(e){return t("el-option",{key:e.serviceId,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("caseForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"复制测试集",visible:e.showCopyDialog,width:"70%"},on:{"update:visible":function(t){e.showCopyDialog=t},close:e.cancellCopy}},[t("h3",[e._v(" 原测试集名称: "),t("span",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.copyCase.testCaseName))])]),t("div",{staticStyle:{margin:"20px 40px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:16}},[t("el-input",{attrs:{size:"small",placeholder:"请输入标签过滤用例"},model:{value:e.filterTag,callback:function(t){e.filterTag=t},expression:"filterTag"}})],1),t("el-col",{attrs:{span:8}},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confimFilter}},[e._v("确认过滤")])],1)],1)],1),t("div",{staticStyle:{margin:"20px 40px"}},e._l(e.filterTagList,(function(a,s){return t("el-tag",{key:s,attrs:{type:"success","disable-transitions":!1,closable:"",size:"small"},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a)+" ")])})),1),t("el-row",[t("el-col",{attrs:{span:10}},[t("div",[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),t("div",{staticClass:"tree-list"},[t("el-tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","default-expand-all":"","highlight-current":"","node-key":"featureId",props:{children:"children",label:"featureName"}},on:{"node-click":e.treeNodeClick}})],1)],1)]),t("el-col",{attrs:{span:14}},[t("el-descriptions",{attrs:{title:"用例描述",column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"用例名称："}},[e._v(e._s(e.featureForm.featureName))]),t("el-descriptions-item",{attrs:{label:"最近修改时间"}},[e._v(e._s(e._f("dateFormat")(e.featureForm.updateTime)))]),t("el-descriptions-item",{attrs:{label:"标签"}},e._l(e.featureForm.tags,(function(a){return t("el-tag",{key:a,staticClass:"tag-item",attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])})),1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancellCopy}},[e._v("取 消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmCopy}},[e._v("确定复制")])],1)],1)],1)},_=[],F={getServicesPage(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/services/page?page=${e}&size=${t}&name=${a}`;g.get(r).then(e=>{s(e)}).catch(e=>{i(e)})})},getServiceMembers(e){return new Promise((t,a)=>{let s=`/v1/devops/services/${e}/members`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},removeMember(e,t){return new Promise((a,s)=>{let i=`/v1/devops/services/${e}/members/${t}`;g.delete(i).then(e=>{a(e)}).catch(e=>{s(e)})})},addServiceMembers(e){return new Promise((t,a)=>{let s=`/v1/devops/services/${e.serviceId}/members`;g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getServices(){return new Promise((e,t)=>{let a="/v1/devops/services";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createService(e){return new Promise((t,a)=>{let s="/v1/devops/services";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateService(e){return new Promise((t,a)=>{let s="/v1/devops/services";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteService(e){return new Promise((t,a)=>{let s="/v1/devops/service/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getApiList(e){return new Promise((t,a)=>{let s=`/v1/devops/service/${e}/resources`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getApi(e){return new Promise((t,a)=>{let s="/v1/devops/service/resources/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteApi(e){return new Promise((t,a)=>{let s="/v1/devops/service/resources/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},batchDeleteApi(e){return new Promise((t,a)=>{let s="/v1/devops/service/resources?apis="+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},updateApi(e){return new Promise((t,a)=>{let s="/v1/devops/service/resources";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},createApi(e){return new Promise((t,a)=>{let s="/v1/devops/service/resources";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},importApi(e){return new Promise((t,a)=>{let s="/v1/devops/service/api/import";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},buildGenerate(e){return new Promise((t,a)=>{let s="/v1/devops/service/resources/generate";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},generateTemplate(e){return new Promise((t,a)=>{let s="/v1/devops/service/resource/templates";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getGenerate(e){return new Promise((t,a)=>{let s=`/v1/devops/service/${e}/generate`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getGenerateLog(e){return new Promise((t,a)=>{let s=`/v1/devops/service/${e}/generate/log`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},x={getTestCaseList(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/feature/${e}/cases?page=${t}&pageSize=${a}`;g.get(r).then(e=>{s(e)}).catch(e=>{i(e)})})},getE2EPage(e,t){return new Promise((a,s)=>{let i=`/v1/devops/feature/e2e/page?page=${e}&pageSize=${t}`;g.get(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getE2EList(){return new Promise((e,t)=>{let a="/v1/devops/feature/e2e/cases";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createTestCase(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTestCase(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getTestCaseDetail(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTestCase(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTestCaseConfigs(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/case/${e}/configs`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},addConfigs(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/config";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateConfig(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/config";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteConfig(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/config/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getConfig(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/config/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getCaseFeatures(e){return new Promise((t,a)=>{let s=`/v1/devops/${e}/features`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},I={getFeatures(e){return new Promise((t,a)=>{let s=`/v1/devops/case/${e}/features?page=1&size=10`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureDetail(e){return new Promise((t,a)=>{let s="/v1/devops/feature/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createFeature(e){return new Promise((t,a)=>{let s="/v1/devops/feature";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteFeature(e){return new Promise((t,a)=>{let s="/v1/devops/feature/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},updateFeature(e){return new Promise((t,a)=>{let s="/v1/devops/feature";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureByUser(e){return new Promise((t,a)=>{let s=`/v1/devops/user/${e}/features`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getExecutePoints(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/${e}/execute/points`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteExecutePoint(e){return new Promise((t,a)=>{let s="/v1/devops/feature/execute/point/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getAllTemplates(){return new Promise((e,t)=>{let a="/v1/devops/feature/templates";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getServiceTemplates(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/${e}/templates`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},startFeature(e){return new Promise((t,a)=>{let s="/v1/devops/feature/start/"+e;g.post(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureHistory(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/${e}/histories`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getExecuteRecords(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/${e}/records`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getExecuteOperators(){return new Promise((e,t)=>{let a="/v1/devops/feature/execute/operators";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},deleteHistory(e){return new Promise((t,a)=>{let s="/v1/devops//feature/history/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},filterFeatureByTag(e){return new Promise((t,a)=>{let s="/v1/devops/feature/tag/filter";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getFeatureTree(e){return new Promise((t,a)=>{let s=`/v1/devops/${e}/tree/features`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},copyCaseFeature(e){return new Promise((t,a)=>{let s="/v1/devops/feature/case/copy";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},pasteFeature(e){return new Promise((t,a)=>{let s="/v1/devops/feature/paste";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},batchDeleteFeature(e){return new Promise((t,a)=>{let s="/v1/devops/delete/features";g.delete(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},batchUpdateFeatures(e){return new Promise((t,a)=>{let s="/v1/devops/batch/features";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})}},D={data(){return{service:"",serviceList:[],activeName:"1",tableData:[],showHistory:!1,direction:"rtl",featureData:[],currentPage:1,totalSize:0,showDialog:!1,caseForm:{},queryForm:{},showCopyDialog:!1,checkAll:!1,isIndeterminate:!0,copyCase:{},filterTag:"",filterTagList:[],treeData:[],allKeys:[],featureForm:{},rule:{testCaseName:[{required:!0,message:"请输入测试集名称",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}],serviceId:[{required:!0,message:"请选择关联的服务",trigger:"select"}]}}},methods:{treeNodeClick(e){I.getFeatureDetail(e.featureId).then(e=>{this.featureForm=e.data})},cancellCopy(){this.showCopyDialog=!1,this.filterTagList=[],this.filterTag="",this.copyCase={},this.checkAll=!1,this.featureForm={}},confirmCopy(){let e=this.$refs.tree.getCheckedKeys();if(!e||0==e.length)return void this.$message.warning("请选择需要复制的用例");let t={testCaseId:this.copyCase.testCaseId,featureIds:e};I.copyCaseFeature(t).then(e=>{if(e.data)return this.$message.success("复制成功！"),this.selectService(),void this.cancellCopy();this.$message.error("复制失败！")})},handleClose(e){this.filterTagList.splice(this.filterTagList.indexOf(e),1),this.refreshTag()},confimFilter(){this.filterTag&&(this.filterTagList.length>=5?this.$message.danger("过滤数超过上限"):(this.filterTagList.push(this.filterTag),this.filterTag="",this.refreshTag()))},refreshTag(){if(0==this.filterTagList)return void I.getFeatureTree(this.copyCase.testCaseId).then(e=>{this.treeData=e.data});let e={tags:this.filterTagList,testCaseId:this.copyCase.testCaseId};I.filterFeatureByTag(e).then(e=>{this.treeData=e.data})},handleCheckAllChange(e){e?(this.$refs.tree.setCheckedNodes(this.treeData),this.isIndeterminate=!1):(this.$refs.tree.setCheckedNodes([]),this.isIndeterminate=!0)},startCopy(e){this.showCopyDialog=!0,this.copyCase=e,I.getFeatureTree(e.testCaseId).then(e=>{this.treeData=e.data})},closeDialog(){this.showDialog=!1,this.caseForm={}},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;x.createTestCase(this.caseForm).then(e=>{if(this.closeDialog(),e.data)return this.$message.success("添加测试集成功"),void this.getTestCaseList(1);this.$message.error("添加测试集失败")})})},startCreate(){this.showDialog=!0},getServices(){this.serviceList=[],F.getServices().then(e=>{this.serviceList=e.data,this.service=this.serviceList[0].serviceId,this.selectService()})},selectService(){this.getTestCaseList(1)},pageChange(e){this.getTestCaseList(e)},getTestCaseList(e){x.getTestCaseList(this.service,e,10).then(t=>{this.currentPage=e,this.totalSize=t.data.total,this.featureData=t.data.data})},startEdit(e){this.$router.push({path:"/feature",query:{caseId:e.testCaseId}})},startDelete(e){this.$confirm("测试集删除后用例都会删除，确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{x.deleteTestCase(e.testCaseId).then(()=>{this.$message.success("删除测试集成功"),this.getTestCaseList(this.currentPage)})})}},created(){this.getServices()}},T=D,P=(a("c181"),Object(y["a"])(T,C,_,!1,null,"6b74114e",null)),S=P.exports,L=function(){var e=this,t=e._self._c;return t("div",[t("h2",{staticClass:"title"},[e._v("e2e测试")]),t("div",{staticClass:"service"},[t("el-row",[t("el-col",{attrs:{span:22}},[t("el-form",{attrs:{inline:!0,size:"mini"}},[t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增e2e测试")])],1)],1)],1)],1)],1),t("div",{staticClass:"content"},[t("el-table",{attrs:{data:e.featureData,size:"mini"}},[t("el-table-column",{attrs:{prop:"testCaseName",label:"e2e用例"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("testview",{attrs:{text:e.row.testCaseName,len:40}})]}}])}),t("el-table-column",{attrs:{prop:"description",label:"描述"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("testview",{attrs:{text:e.row.description,len:40}})]}}])}),t("el-table-column",{attrs:{prop:"updateTime",label:"最近编辑时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.startEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.startDelete(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{type:"info",plain:"",icon:"el-icon-document-copy",size:"mini"},on:{click:function(t){return e.startCopy(a.row)}}},[e._v("复制")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:"创建e2e测试",visible:e.showDialog,width:"60%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("el-form",{ref:"caseForm",attrs:{model:e.caseForm,rules:e.rule,size:"small","label-width":"120px"}},[t("el-form-item",{attrs:{label:"测试名称",prop:"testCaseName"}},[t("el-input",{attrs:{placeholder:"请输入e2e测试名称"},model:{value:e.caseForm.testCaseName,callback:function(t){e.$set(e.caseForm,"testCaseName",t)},expression:"caseForm.testCaseName"}})],1),t("el-form-item",{attrs:{label:"测试描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"请输入测试描述"},model:{value:e.caseForm.description,callback:function(t){e.$set(e.caseForm,"description",t)},expression:"caseForm.description"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("caseForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"复制测试集",visible:e.showCopyDialog,width:"70%"},on:{"update:visible":function(t){e.showCopyDialog=t},close:e.cancellCopy}},[t("h3",[e._v(" 原测试集名称: "),t("span",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.copyCase.testCaseName))])]),t("div",{staticStyle:{margin:"20px 40px"}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:16}},[t("el-input",{attrs:{size:"small",placeholder:"请输入标签过滤用例"},model:{value:e.filterTag,callback:function(t){e.filterTag=t},expression:"filterTag"}})],1),t("el-col",{attrs:{span:8}},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confimFilter}},[e._v("确认过滤")])],1)],1)],1),t("div",{staticStyle:{margin:"20px 40px"}},e._l(e.filterTagList,(function(a,s){return t("el-tag",{key:s,attrs:{type:"success","disable-transitions":!1,closable:"",size:"small"},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a)+" ")])})),1),t("el-row",[t("el-col",{attrs:{span:10}},[t("div",[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),t("div",{staticClass:"tree-list"},[t("el-tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","default-expand-all":"","highlight-current":"","node-key":"featureId",props:{children:"children",label:"featureName"}},on:{"node-click":e.treeNodeClick}})],1)],1)]),t("el-col",{attrs:{span:14}},[t("el-descriptions",{attrs:{title:"用例描述",column:2,size:"small"}},[t("el-descriptions-item",{attrs:{label:"用例名称："}},[e._v(e._s(e.featureForm.featureName))]),t("el-descriptions-item",{attrs:{label:"最近修改时间"}},[e._v(e._s(e._f("dateFormat")(e.featureForm.updateTime)))]),t("el-descriptions-item",{attrs:{label:"标签"}},e._l(e.featureForm.tags,(function(a){return t("el-tag",{key:a,staticClass:"tag-item",attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])})),1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancellCopy}},[e._v("取 消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmCopy}},[e._v("确定复制")])],1)],1)],1)},N=[],$=function(){var e=this,t=e._self._c;return t("span",[e.showText.length<=e.len?t("span",[e._v(e._s(e.showText))]):t("span",[e.showpop?t("el-tooltip",{attrs:{effect:"dark",content:e.fullText,placement:"top-start"}},[t("span",[e._v(e._s(e.showText))])]):t("span",[e._v(e._s(e.showText))])],1)])},E=[],z={props:{text:{type:String},len:{type:Number,default:20},showpop:{type:Boolean,default:!0}},watch:{text:{handler(e){e&&(this.fullText=e,e.length>this.len?this.showText=e.substring(0,this.len)+"...":this.showText=e)},deep:!0,immediate:!0}},data(){return{showText:"",fullText:""}}},R=z,O=Object(y["a"])(R,$,E,!1,null,null,null),A=O.exports,q={components:{testview:A},data(){return{TemplatectiveName:"1",tableData:[],showHistory:!1,direction:"rtl",featureData:[],currentPage:1,totalSize:0,showDialog:!1,caseForm:{},queryForm:{},showCopyDialog:!1,checkAll:!1,isIndeterminate:!0,copyCase:{},filterTag:"",filterTagList:[],treeData:[],allKeys:[],featureForm:{},rule:{testCaseName:[{required:!0,message:"请输入e2e测试名称",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}]}}},methods:{treeNodeClick(e){I.getFeatureDetail(e.featureId).then(e=>{this.featureForm=e.data})},cancellCopy(){this.showCopyDialog=!1,this.filterTagList=[],this.filterTag="",this.copyCase={},this.checkAll=!1,this.featureForm={}},confirmCopy(){let e=this.$refs.tree.getCheckedKeys();if(!e||0==e.length)return void this.$message.warning("请选择需要复制的用例");let t={testCaseId:this.copyCase.testCaseId,featureIds:e};I.copyCaseFeature(t).then(e=>{if(e.data)return this.$message.success("复制成功！"),this.getTestCaseList(this.currentPage),void this.cancellCopy();this.$message.error("复制失败！")})},handleClose(e){this.filterTagList.splice(this.filterTagList.indexOf(e),1),this.refreshTag()},confimFilter(){this.filterTag&&(this.filterTagList.length>=5?this.$message.danger("过滤数超过上限"):(this.filterTagList.push(this.filterTag),this.filterTag="",this.refreshTag()))},refreshTag(){if(0==this.filterTagList)return void I.getFeatureTree(this.copyCase.testCaseId).then(e=>{this.treeData=e.data});let e={tags:this.filterTagList,testCaseId:this.copyCase.testCaseId};I.filterFeatureByTag(e).then(e=>{this.treeData=e.data})},handleCheckAllChange(e){e?(this.$refs.tree.setCheckedNodes(this.treeData),this.isIndeterminate=!1):(this.$refs.tree.setCheckedNodes([]),this.isIndeterminate=!0)},startCopy(e){this.showCopyDialog=!0,this.copyCase=e,I.getFeatureTree(e.testCaseId).then(e=>{this.treeData=e.data})},closeDialog(){this.showDialog=!1,this.caseForm={}},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;this.caseForm.caseType=2,x.createTestCase(this.caseForm).then(e=>{if(this.closeDialog(),e.data)return this.$message.success("添加测试集成功"),void this.getTestCaseList(1);this.$message.error("添加测试集失败")})})},startCreate(){this.showDialog=!0},pageChange(e){this.getTestCaseList(e)},getTestCaseList(e){x.getE2EPage(e,10).then(t=>{this.currentPage=e,this.totalSize=t.data.total,this.featureData=t.data.data})},startEdit(e){this.$router.push({path:"/feature",query:{caseId:e.testCaseId}})},startDelete(e){this.$confirm("测试集删除后用例都会删除，确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{x.deleteTestCase(e.testCaseId).then(()=>{this.$message.success("删除测试集成功"),this.getTestCaseList(this.currentPage)})})}},created(){this.getTestCaseList(1)}},B=q,V=(a("b92d"),Object(y["a"])(B,L,N,!1,null,"38b760b5",null)),U=V.exports,G=function(){var e=this,t=e._self._c;return t("div",[t("el-row",[t("el-col",{attrs:{span:5}},[t("div",{staticClass:"title"},[t("el-page-header",{on:{back:e.goBack}},[t("span",{attrs:{slot:"content"},slot:"content"},[t("i",{staticClass:"el-icon-edit-outline edit-name-icon",on:{click:e.startEditCase}}),t("testview",{attrs:{text:e.caseName,len:20}})],1)])],1),t("div",{staticClass:"api-list"},[t("div",{staticClass:"service-panel"},[t("div",{staticClass:"op"},[t("div",[e._v("辅助工具")]),t("i",{staticClass:"item el-icon-video-play",on:{click:e.startDebug}},[e._v("调试")]),t("el-tooltip",{attrs:{effect:"dark",content:"设置全局变量",placement:"top-start"}},[t("i",{staticClass:"item el-icon-setting",on:{click:e.showGlobalEnv}},[e._v("全局变量")])])],1),t("div",{staticClass:"search"},[t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入用例名进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1)]),t("div",{staticClass:"feature-title"},[t("el-row",[t("el-col",{attrs:{span:18}},[t("span",{staticClass:"feature-introduce"},[e._v("用例列表")])]),t("el-col",{attrs:{span:6}},[t("span",[t("el-dropdown",{on:{command:e.clickCommand}},[t("el-button",{staticClass:"feature-add",attrs:{type:"text",size:"mini"}},[e._v("操作")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"newItem"}},[e._v("新增用例")]),t("el-dropdown-item",{attrs:{command:"newFolder"}},[e._v("新增目录")]),t("el-dropdown-item",{attrs:{command:"deleteItems"}},[e._v("批量删除")])],1)],1)],1)])],1)],1),t("el-tree",{ref:"tree",attrs:{draggable:"","show-checkbox":"","node-key":"featureId","default-expanded-keys":e.expendList,data:e.caseFeatures,"filter-node-method":e.filterNode},on:{"node-click":e.treeNodeClick,"node-drop":e.dragNodeEvent},scopedSlots:e._u([{key:"default",fn:function({data:a}){return t("div",{key:e.uuid,staticClass:"custom-tree-node"},[t("span",{class:{"folder-Text":2==a.featureType}},[t("i",{class:{"el-icon-tickets":1==a.featureType,"el-icon-folder-opened":2==a.featureType}}),e._v(" "+e._s(a.featureName))]),t("span",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:t=>e.clickCommand(t,a)}},[t("el-button",{attrs:{type:"text"}},[e._v("...")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[2==a.featureType?t("el-dropdown-item",{attrs:{command:"newItem"}},[t("i",{staticClass:"el-icon-tickets"}),e._v("新增用例")]):e._e(),2==a.featureType?t("el-dropdown-item",{attrs:{command:"newFolder"}},[t("i",{staticClass:"el-icon-folder-opened"}),e._v("新增目录")]):e._e(),t("el-dropdown-item",{attrs:{command:"delete"}},[t("i",{staticClass:"el-icon-delete"}),e._v("删除")]),t("el-dropdown-item",{attrs:{command:"copyFeature"}},[t("i",{staticClass:"el-icon-document-copy"}),e._v("复制")]),2==a.featureType?t("el-dropdown-item",{attrs:{command:"pasteFeature"}},[t("i",{staticClass:"el-icon-document-checked"}),e._v("粘贴")]):e._e()],1)],1)],1)])}}])})],1)]),t("el-col",{attrs:{span:19}},[this.infoForm?t("div",{staticClass:"content"},[t("el-tabs",{on:{"tab-click":e.tabChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"用例信息",name:"desc"}},[t("el-descriptions",{attrs:{title:"用例描述",column:3,size:"small"}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.startEditFeature}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:e.deleteFeature}},[e._v("删除")])],1),t("el-descriptions-item",{attrs:{label:"用例名称："}},[e._v(e._s(e.infoForm.featureName))]),t("el-descriptions-item",{attrs:{label:"用例"}},[e._v(e._s(e.infoForm.featureId))]),t("el-descriptions-item",{attrs:{label:"创建人"}},[e._v(e._s(e.infoForm.author))]),t("el-descriptions-item",{attrs:{label:"创建时间"}},[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(e._f("dateFormat")(e.infoForm.createTime)))])],1),t("el-descriptions-item",{attrs:{label:"修改时间"}},[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(e._f("dateFormat")(e.infoForm.updateTime)))])],1),t("el-descriptions-item",{attrs:{label:"标签",span:3}},e._l(e.dynamicTags,(function(a){return t("el-tag",{key:a,attrs:{size:"mini"}},[e._v(" "+e._s(a)+" ")])})),1)],2),1==e.infoForm.featureType?t("div",[t("div",{staticClass:"step-title"},[e._v("测试步骤：")]),t("div",{staticClass:"step-line"},[t("el-steps",{attrs:{direction:"vertical",size:"mini",space:"40px"}},e._l(e.formStepList,(function(e,a){return t("el-step",{key:a,attrs:{title:"步骤"+(a+1),status:"process",description:e}})})),1)],1)]):e._e()],1),1==e.infoForm.featureType?t("el-tab-pane",{attrs:{label:"用例配置",name:"config"}},[t("FeatureConfig",{key:e.uuid,attrs:{feature:e.selectFeatureId,service:e.serviceId,case:e.caseId}})],1):e._e(),1==e.infoForm.featureType?t("el-tab-pane",{attrs:{label:"执行历史",name:"history"}},[t("history",{ref:"historyComp",attrs:{feature:e.infoForm.featureId}})],1):e._e()],1)],1):t("el-empty",{attrs:{description:"请在左侧选择或创建用例"}})],1)],1),t("el-dialog",{attrs:{title:e.featureTitle,visible:e.showFeatureDialog,width:"60%","destroy-on-close":!0},on:{"update:visible":function(t){e.showFeatureDialog=t},close:e.closeFeatureDialog}},[t("el-form",{ref:"featureForm",attrs:{model:e.featureForm,rules:e.featureRule,size:"small","label-width":"80px","label-position":"top"}},[t("el-form-item",{attrs:{label:"名称",prop:"featureName"}},[t("el-input",{attrs:{placeholder:"请输入名称"},model:{value:e.featureForm.featureName,callback:function(t){e.$set(e.featureForm,"featureName",t)},expression:"featureForm.featureName"}})],1),t("el-form-item",{attrs:{label:"用例标签"}},[e._l(e.dynamicTags,(function(a,s){return t("el-tag",{key:s,attrs:{closable:"",size:"mini","disable-transitions":!1},on:{close:function(t){return e.handleClose(a)}}},[e._v(" "+e._s(a)+" ")])})),e.inputVisible?t("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"mini"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm.apply(null,arguments)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):t("el-button",{staticClass:"button-new-tag",attrs:{size:"mini"},on:{click:e.showInput}},[e._v("+ 新增标签")])],2),1==e.createData.type?t("el-form-item",{attrs:{label:"用例步骤描述"}},[t("el-steps",{attrs:{direction:"vertical",size:"mini",space:"40px"}},[e._l(e.stepList,(function(a,s){return t("el-step",{key:s,attrs:{status:"process",description:a.content}},[t("template",{slot:"title"},[t("span",{on:{mouseover:function(e){a.hover=!0},mouseleave:function(e){a.hover=!1}}},[t("span",[e._v(e._s("步骤"+(s+1)))]),a.hover?t("i",{staticClass:"el-icon-delete step-delete",on:{click:function(t){return e.removeStep(s)}}}):e._e()])])],2)})),t("div",{staticClass:"step-edit"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:6}},model:{value:e.stepContent,callback:function(t){e.stepContent=t},expression:"stepContent"}})],1),t("el-col",{attrs:{span:12}},[t("el-button",{attrs:{type:"primary"},on:{click:e.addStep}},[e._v("新增步骤")])],1)],1)],1)],2)],1):e._e(),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFeatureForm("featureForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeFeatureDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"全局环境变量配置",visible:e.showDebugDialog,width:"90%","destroy-on-close":!0},on:{"update:visible":function(t){e.showDebugDialog=t}}},[t("div",{staticClass:"tips"},[e._v(" 全局环境变量：测试集是由多个用例组合在一起的集合，在当前集合内针对于不同的用例可能需要相同的配置信息(比如http请求的域名等信息)， 针对相同的配置信息不用在每个用例里面声明，只需要在全局设置然后在每个用例里声明引用即可。 ")]),t("div",{staticClass:"config-body"},[t("el-table",{key:e.uuid,attrs:{data:e.configData,border:"",size:"small","default-expand-all":"","row-key":"configId","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数",width:"250"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit?t("el-input",{model:{value:a.row.paramKey,callback:function(t){e.$set(a.row,"paramKey",t)},expression:"scope.row.paramKey"}}):t("span",[e._v(e._s(a.row.paramKey))])]}}])}),t("el-table-column",{attrs:{prop:"paramType",label:"参数类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit||a.$index==e.configData.length-1?e._e():t("span",[e._v(e._s(a.row.paramType))]),a.row.isEdit?t("el-select",{attrs:{placeholder:"请选择参数类型"},model:{value:a.row.paramType,callback:function(t){e.$set(a.row,"paramType",t)},expression:"scope.row.paramType"}},e._l(e.paramTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e()]}}])}),t("el-table-column",{attrs:{prop:"value",label:"参数值"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit?e._e():t("span",[e._v(e._s(a.row.value))]),a.row.isEdit?t("el-input",{model:{value:a.row.value,callback:function(t){e.$set(a.row,"value",t)},expression:"scope.row.value"}}):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isEdit?t("div",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleSave(a.row)}}},[e._v("保存")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(t){return e.cancelEditParam(a.row)}}},[e._v("取消")])],1):t("div",[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.startEditParam(a.row)}}},[e._v(e._s(a.$index==e.configData.length-1?"新增":"编辑"))]),a.$index!=e.configData.length-1?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")]):e._e()],1)]}}])})],1)],1)]),t("el-dialog",{attrs:{title:"编辑测试集",visible:e.showCaseDialog,width:"60%"},on:{"update:visible":function(t){e.showCaseDialog=t}}},[t("el-form",{ref:"caseForm",attrs:{model:e.caseDetail,size:"mini",rules:e.caseRule,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"测试集名称",prop:"testCaseName"}},[t("el-input",{attrs:{placeholder:"请输入测试集名称"},model:{value:e.caseDetail.testCaseName,callback:function(t){e.$set(e.caseDetail,"testCaseName",t)},expression:"caseDetail.testCaseName"}})],1),t("el-form-item",{attrs:{label:"测试集描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"请输入测试描述"},model:{value:e.caseDetail.description,callback:function(t){e.$set(e.caseDetail,"description",t)},expression:"caseDetail.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showCaseDialog=!e.showCaseDialog}}},[e._v("取 消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitCase("caseForm")}}},[e._v("确 定")])],1)],1)],1)},j=[],M=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"debug-div"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.historyData,size:"mini",height:"500"}},[t("el-table-column",{attrs:{prop:"featureName",label:"用例"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("textview",{attrs:{text:e.row.featureName,len:15}})]}}])}),t("el-table-column",{attrs:{prop:"historyId",label:"执行ID"}}),t("el-table-column",{attrs:{prop:"createTime",label:"执行时间",formatter:e.dateFormat}}),t("el-table-column",{attrs:{prop:"executeStatus",label:"结果",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.executeStatus?t("el-tag",{attrs:{type:"success"}},[e._v("成功")]):e._e(),3==a.row.executeStatus?t("el-tag",{attrs:{type:"danger"}},[e._v("超时")]):e._e(),4==a.row.executeStatus?t("el-tag",{attrs:{type:"primary"}},[e._v("执行中")]):e._e(),2==a.row.executeStatus?t("el-tag",{attrs:{type:"danger"}},[e._v("失败")]):e._e()]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.showRecord(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.deleteHistory(a.row)}}},[e._v("删除")])]}}])},[t("template",{slot:"header"},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-refresh"},on:{click:e.refreshRecords}},[e._v("刷新")]),t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-video-play"},on:{click:e.startDebug}},[e._v("调试")])],1)],2)],1)],1),t("el-drawer",{attrs:{title:"历史列表",visible:e.showDrawer,"with-header":!1,"append-to-body":!0,"destroy-on-close":!0,size:"40%","modal-append-to-body":!1},on:{"update:visible":function(t){e.showDrawer=t},close:e.closeDetail}},[t("div",{staticClass:"drawer-content"},[t("div",{staticClass:"drawer-title"},[e._v("详情列表")]),t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{name:"preset"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("el-badge",{staticClass:"tab-label",attrs:{value:e.presetError,hidden:e.presetError<=0}},[t("el-button",{attrs:{type:"text"}},[e._v("预置")])],1)],1),t("PanelList",{attrs:{list:e.presetList}})],1),t("el-tab-pane",{attrs:{label:"执行",name:"execute"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("el-badge",{staticClass:"tab-label",attrs:{value:e.executeError,hidden:e.executeError<=0}},[t("el-button",{attrs:{type:"text"}},[e._v("执行")])],1)],1),t("PanelList",{attrs:{list:e.executeList}})],1),t("el-tab-pane",{attrs:{label:"清理",name:"clean"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("el-badge",{staticClass:"tab-label",attrs:{value:e.cleanError,hidden:e.cleanError<=0}},[t("el-button",{attrs:{type:"text"}},[e._v("清理")])],1)],1),t("PanelList",{attrs:{list:e.cleanList}})],1)],1)],1)])],1)},J=[],H=function(){var e=this,t=e._self._c;return t("div",e._l(e.resultList,(function(a,s){return t("div",{key:s},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"list-title",on:{click:function(t){return e.showItem(a)}}},[t("div",{staticClass:"execute-name",style:{color:a.status?"#67C23A":"#F56C6C"}},[a.show?t("i",{staticClass:"el-icon-remove icon-tag"}):t("i",{staticClass:"el-icon-circle-plus icon-tag"}),e._v(" "+e._s(a.name)+" ")]),t("div",{staticClass:"tag-list"},[t("el-tag",{attrs:{type:a.status?"success":"danger",size:"mini"}},[e._v(" "+e._s(a.status?"成功":"失败")+" ")])],1)])]),t("template",{slot:"content"},[2==a.executeType?t("div",{staticClass:"cycle-div"},e._l(a.resultList,(function(s,i){return t("div",{key:i},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"list-title",on:{click:function(t){return e.showItem(s)}}},[t("div",{staticClass:"execute-name",style:{color:s.status?"#67C23A":"#F56C6C"}},[s.show?t("i",{staticClass:"el-icon-remove icon-tag"}):t("i",{staticClass:"el-icon-circle-plus icon-tag"}),e._v(" "+e._s(s.name)+" ")]),t("div",{staticClass:"tag-list"},[t("el-tag",{attrs:{type:a.status?"success":"danger",size:"mini"}},[e._v(" "+e._s(s.status?"成功":"失败")+" ")])],1)])]),t("template",{slot:"content"},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-s-promotion"}),e._v(" Request ")])]),t("template",{slot:"content"},[t("div",{staticClass:"request-list"},[s.executeDetailVo.requestTips?t("json-viewer",{attrs:{value:s.executeDetailVo.requestTips,"expand-depth":5,copyable:""}}):e._e()],1)])],2),t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-camera-solid"}),e._v(" Response ")])]),t("template",{slot:"content"},[s.compareResult&&!s.compareResult.compareStatus&&s.compareResult.description?t("div",{staticClass:"request-list"},[e._v(" 比较错误： "),t("span",{staticStyle:{color:"#f56c6c","font-size":"16px","font-weight":"900"}},[e._v(e._s(s.compareResult.description))])]):e._e(),t("div",[t("div",{staticClass:"request-list"},[e._v(" 响应结果: "),s.executeDetailVo.responseDetailVo.responseBody?t("json-viewer",{attrs:{value:s.executeDetailVo.responseDetailVo.responseBody,"expand-depth":5,copyable:""}}):e._e()],1)])])],2),s.executeDetailVo.responseDetailVo.errorMessage?t("div",[t("div",{staticClass:"desc-div error-icon"},[t("i",{staticClass:"el-icon-warning"}),e._v(" Error ")]),t("div",{staticClass:"request-list"},[e._v(" "+e._s(s.executeDetailVo.responseDetailVo.errorMessage)+" ")])]):e._e()],1)],2)],1)})),0):t("div",e._l(a.resultList,(function(a,s){return t("div",{key:s},[t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-s-promotion"}),e._v(" Request ")])]),t("template",{slot:"content"},[t("div",{staticClass:"request-list"},[a.executeDetailVo.requestTips?t("json-viewer",{attrs:{value:a.executeDetailVo.requestTips,"expand-depth":5,copyable:""}}):e._e()],1)])],2),t("Panel",[t("template",{slot:"title"},[t("div",{staticClass:"desc-div"},[t("i",{staticClass:"el-icon-camera-solid"}),e._v(" Response ")])]),t("template",{slot:"content"},[a.compareResult&&!a.compareResult.compareStatus&&a.compareResult.description?t("div",{staticClass:"request-list"},[e._v(" 比较错误： "),t("span",{staticStyle:{color:"#f56c6c","font-size":"16px","font-weight":"900"}},[e._v(e._s(a.compareResult.description))])]):e._e(),t("div",[t("div",{staticClass:"request-list"},[e._v(" 响应结果: "),a.executeDetailVo.responseDetailVo.responseBody?t("json-viewer",{attrs:{value:a.executeDetailVo.responseDetailVo.responseBody,"expand-depth":5,copyable:""}}):e._e()],1)])])],2),a.executeDetailVo.responseDetailVo.errorMessage?t("div",[t("div",{staticClass:"desc-div error-icon"},[t("i",{staticClass:"el-icon-warning"}),e._v(" Error ")]),t("div",{staticClass:"request-list"},[e._v(" "+e._s(a.executeDetailVo.responseDetailVo.errorMessage)+" ")])]):e._e()],1)})),0)])],2)],1)})),0)},K=[],W=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"main",on:{click:e.showCourse}},[t("div",{staticClass:"title"},[e._t("title")],2)]),t("transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.boxshow,expression:"boxshow"}],staticClass:"lesson"},[t("div",{staticClass:"animate__animated animate__fadeIndown"},[e._t("content")],2)])])],1)},Q=[],Y={data(){return{boxshow:!1}},methods:{showCourse(){this.boxshow=!this.boxshow}}},X=Y,Z=(a("04d2"),Object(y["a"])(X,W,Q,!1,null,"b4de8ad6",null)),ee=Z.exports,te=a("349e"),ae=a.n(te),se={name:"PanelList",components:{Panel:ee,JsonViewer:ae.a},props:{list:Array},data(){return{resultList:[]}},watch:{list(e){this.exchangeData(e)}},methods:{showItem(e){e.show=!e.show},exchangeData(e){this.resultList=[],e.forEach(e=>{e.executeResult.forEach(e=>{e.status=e.success});let t=1==e.status;e.compareResult&&(t=e.compareResult.compareStatus);let a={name:e.executePointName,executeType:e.executeType,testStage:e.testStage,resultList:e.executeResult,compareResult:e.compareResult,show:!1,status:t};this.resultList.push(a)})}},created(){}},ie=se,re=(a("8901"),Object(y["a"])(ie,H,K,!1,null,"2b7eb808",null)),le=re.exports,oe={components:{PanelList:le,textview:A},props:{feature:String},watch:{feature:function(e){this.featureId=e,this.getFeatureHistory(e)}},data(){return{historyData:[],resultList:[],featureId:"",showDrawer:!1,activeName:"preset",presetList:[],executeList:[],cleanList:[],presetError:0,executeError:0,cleanError:0}},methods:{startDebug(){I.startFeature(this.featureId).then(e=>{e.data?(this.$message.success("开始执行，请查看运行日志"),this.refreshRecords()):this.$message.error("执行失败")})},refreshRecords(){this.getFeatureHistory(this.featureId)},filterRecord(){this.resultList.forEach(e=>{1==e.testStage&&(this.presetList.push(e),1!=e.status&&this.presetError++),2==e.testStage&&(this.executeList.push(e),1!=e.status&&this.executeError++),3==e.testStage&&(this.cleanList.push(e),1!=e.status&&this.cleanError++)})},getFeatureHistory(e){this.historyData=[],I.getFeatureHistory(e).then(e=>{e.data.forEach(e=>{this.historyData.push(e)})})},getExecuteRecords(e){this.resultList=[],I.getExecuteRecords(e).then(e=>{this.resultList=e.data,this.filterRecord()})},closeDetail(){this.resultList=[],this.presetList=[],this.executeList=[],this.cleanList=[],this.activeName="preset",this.presetError=0,this.executeError=0,this.cleanError=0},showRecord(e){this.getExecuteRecords(e.historyId),this.showDrawer=!0},deleteHistory(e){I.deleteHistory(e.historyId).then(()=>{this.getFeatureHistory(this.featureId)})},changeUser(){},dateFormat(e){var t=new Date(e.createTime),a=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",i=t.getDate()+" ",r=t.getHours()+":",l=t.getMinutes()+":",o=t.getSeconds();return a+s+i+r+l+o}},created(){this.featureId=this.feature}},ne=oe,ce=(a("5431"),Object(y["a"])(ne,M,J,!1,null,"29d3b14a",null)),de=ce.exports,ue=function(){var e=this,t=e._self._c;return t("div",[t("div",{ref:"parent",staticClass:"feature-content gridBackground"},[t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:18}},[t("div",{staticClass:"edit-content",on:{contextmenu:function(t){return t.preventDefault(),e.onContextmenu.apply(null,arguments)}}},[t("div",{staticClass:"menu-type"},[t("el-radio-group",{attrs:{size:"small"},on:{change:e.selectTestStep},model:{value:e.menuType,callback:function(t){e.menuType=t},expression:"menuType"}},[t("el-radio-button",{attrs:{label:"1"}},[e._v("预置")]),t("el-radio-button",{attrs:{label:"2"}},[e._v("执行")]),t("el-radio-button",{attrs:{label:"3"}},[e._v("清理")])],1)],1),t("div",[e.isShowEmpty?t("el-empty",{attrs:{description:"请在右侧拖拽组件到此处"}}):t("div",[t("draggable",e._b({ref:"child",staticClass:"drag-box",on:{end:e.dragEnd,add:e.addItem},model:{value:e.displayList,callback:function(t){e.displayList=t},expression:"displayList"}},"draggable",e.dragOptions,!1),e._l(e.displayList,(function(a,s){return t("div",{key:a.id,staticClass:"content-item"},[t("div",{key:e.uuid,staticClass:"content-item-title",on:{dblclick:function(t){return e.closeDiv(a)}}},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:a.editDesc?6:13}},[t("span",{on:{dblclick:()=>{e.isEdit&&!a.editDesc&&e.exchangeEditStatus(a)}}},[e._v(e._s(a.description)+" ")]),t("i",{staticClass:"el-icon-document-copy",on:{click:function(t){return e.copyExecutePoint(a)}}})]),t("el-col",{attrs:{span:4}},[e.isEdit?t("i",{staticClass:"el-icon-delete delete-point",on:{click:function(t){return e.deleteExecutePoint(s,a.pointId)}}}):e._e(),e.isEdit&&!a.editDesc?t("i",{staticClass:"el-icon-edit-outline delete-point",on:{click:function(t){return e.exchangeEditStatus(a)}}}):e._e()]),a.editDesc&&e.isEdit?t("el-col",{attrs:{span:8}},[t("div",[t("el-input",{attrs:{placeholder:"输入功能描述",size:"mini"},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.desc,callback:function(t){e.$set(a,"desc",t)},expression:"executePoint.desc"}})],1)]):e._e(),a.editDesc?t("el-col",{attrs:{span:5}},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.exchangeEditStatus(a,!0)}}},[e._v("保存")]),t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.exchangeEditStatus(a)}}},[e._v("取消")])],1):e._e()],1),t("i",{class:{"el-icon-arrow-down":a.isActive,"right-icon":!0,"el-icon-arrow-right":!a.isActive},on:{click:function(t){return e.closeDiv(a)}}})],1),t("collapse",[t("div",{directives:[{name:"show",rawName:"v-show",value:a.isActive,expression:"executePoint.isActive"}],staticClass:"content-item-detail"},[1==a.executeType||4==a.executeType?t("FeatureTemplate",{key:e.uuid,attrs:{case:e.caseId,data:a,isEdit:e.isEdit,type:a.writeType},on:{refreshData:e.refreshValue}}):t("FeatureTool",{key:e.uuid,attrs:{data:a,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1)])],1)})),0)],1)],1)])]),t("el-col",{attrs:{span:6}},[t("div",{staticClass:"feature-config-list"},[t("div",{staticClass:"operate"},[e.isEdit?e._e():t("el-link",{attrs:{icon:"el-icon-edit",underline:!1,type:"primary",size:"middle"},on:{click:e.clickEdit}},[e._v("编辑")]),e.isEdit?t("el-link",{attrs:{icon:"el-icon-upload",type:"success",underline:!1,size:"middle"},on:{click:e.saveConfig}},[e._v("保存")]):e._e(),e.isEdit?t("el-link",{attrs:{icon:"el-icon-circle-close",type:"info",underline:!1,size:"middle"},on:{click:e.cancelEdit}},[e._v("取消")]):e._e(),e.isEdit?e._e():t("el-link",{attrs:{icon:"el-icon-video-play",type:"success",underline:!1,size:"middle"},on:{click:e.startDebug}},[e._v("调试")])],1),t("el-collapse",{attrs:{accordion:""},model:{value:e.toolType,callback:function(t){e.toolType=t},expression:"toolType"}},[t("el-collapse-item",{attrs:{title:"基础工具",name:"1"}},[t("draggable",{staticClass:"tool-list",attrs:{list:e.featureItemList,group:{name:"api",pull:"clone"},animation:"100"},on:{start:function(t){return e.startDrag(t,{list:e.featureItemList})}}},e._l(e.featureItemList,(function(a,s){return t("div",{key:s},[a.isTool?t("div",{staticClass:"feature-item"},[t("div",{staticClass:"template-name"},[e._v(" "+e._s(a.name)+" ")]),t("div",{staticClass:"template-desc"},[e._v(" "+e._s(a.description)+" ")])]):e._e()])})),0)],1),t("el-collapse-item",{attrs:{title:"业务模版",name:"2"}},[t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:20}},[t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入模版名称过滤"},model:{value:e.filterName,callback:function(t){e.filterName=t},expression:"filterName"}})],1),t("el-col",{attrs:{span:4}},[t("i",{staticClass:"el-icon-refresh refresh-icon",on:{click:e.getCaseInfo}})])],1)],1),e._l(e.templateGroup,(function(a,s){return t("div",{key:s},[t("div",{staticClass:"service-title",on:{click:function(t){return e.closeTemplates(a)}}},[e._v(" "+e._s(a.name)+" "),t("i",{class:{"el-icon-arrow-down":a.isActive,"right-icon":!0,"el-icon-arrow-right":!a.isActive},on:{click:function(t){return e.closeTemplates(a)}}})]),t("collapse",[t("div",{directives:[{name:"show",rawName:"v-show",value:a.showList,expression:"item.showList"}]},[t("draggable",{staticClass:"template-list",attrs:{list:a.list,group:{name:"api",pull:"clone"},animation:"100"},on:{start:function(t){return e.startDrag(t,a)}}},e._l(a.list,(function(a,s){return t("div",{key:s},[a.isTool?e._e():t("div",{staticClass:"feature-item"},[t("div",{staticClass:"template-name"},[e._v(" "+e._s(a.name)+" ")]),t("div",{staticClass:"template-desc"},[e._v(" "+e._s(a.description)+" ")])])])})),0)],1)])],1)}))],2)],1)],1)])],1)],1)])])},pe=[],me=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title"},[t("div",{staticClass:"select-button"},[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.writeType,callback:function(t){e.writeType=t},expression:"writeType"}},[t("el-radio-button",{attrs:{label:"1"}},[e._v("用例")]),t("el-radio-button",{attrs:{label:"2"}},[e._v("校验")]),t("el-radio-button",{attrs:{label:"3"}},[e._v("变量")])],1)],1)]),t("div",{staticClass:"content"},["1"==e.writeType?t("div",e._l(e.executePoint.params,(function(a,s){return t("el-row",{key:s,staticClass:"item-line"},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"param_name"},[e._v(e._s(a.paramKey)+":")])]),t("el-col",{attrs:{span:20}},[t("FeatureEdit",{attrs:{point:e.executePoint.pointId,feature:a,case:e.caseId,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1)],1)})),1):e._e(),"2"==e.writeType?t("div",[t("FeatureCompare",{attrs:{isEdit:e.isEdit,point:e.executePoint.pointId,data:e.executePoint.compareDefine},on:{refreshCompare:e.refreshCompare}})],1):e._e(),"3"==e.writeType?t("div",[t("FeatureVariable",{attrs:{isEdit:e.isEdit,point:e.executePoint.pointId,data:e.executePoint.variableDefine},on:{refreshVariable:e.refreshVariable}})],1):e._e()])])},he=[],ge=function(){var e=this,t=e._self._c;return t("div",["Array"==e.data.type?t("div",[t("div",{staticClass:"array-plus"},[e.isEdit?t("span",{on:{click:e.addParam}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 新增")]):e._e()]),"Object"==e.data.initData.rangeType?t("div",e._l(e.data.value,(function(a,s){return t("div",{key:s,staticClass:"array-show-box"},[t("el-row",[t("el-col",{attrs:{span:22}},e._l(a.rangeList,(function(a,i){return t("el-row",{key:i,staticClass:"item-line"},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"param_name"},[e._v(e._s(a.paramKey)+":")])]),t("el-col",{attrs:{span:20}},[t("FeatureEdit",{attrs:{point:e.pointId,feature:a,isEdit:e.isEdit},on:{refreshData:function(t){return e.refreshArrayValue(t,s)}}})],1)],1)})),1),t("el-col",{attrs:{span:2}},[e.isEdit?t("div",{staticClass:"array-delete"},[t("span",{on:{click:function(t){return e.deleteArray(s)}}},[t("i",{staticClass:"el-icon-remove-outline"}),e._v(" 删除")])]):e._e()])],1)],1)})),0):t("div",e._l(e.paramList,(function(a,s){return t("div",{key:s,staticClass:"array-show-box"},[t("el-row",[t("el-col",{attrs:{span:20}},[t("el-input",{attrs:{size:"small",disabled:!e.isEdit},on:{input:function(t){return e.refreshList(s)}},model:{value:a.content,callback:function(t){e.$set(a,"content",t)},expression:"item.content"}})],1),t("el-col",{attrs:{span:4}},[e.isEdit?t("div",{staticClass:"array-delete"},[t("span",{on:{click:function(t){return e.deleteList(s)}}},[t("i",{staticClass:"el-icon-remove-outline"}),e._v(" 删除")])]):e._e()])],1)],1)})),0)]):"Object"==e.data.type?t("div",e._l(e.paramList,(function(a,s){return t("el-row",{key:s,staticClass:"item-line"},[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"param_name"},[e._v(e._s(a.paramKey)+":")])]),t("el-col",{attrs:{span:15}},[t("FeatureEdit",{attrs:{point:e.pointId,feature:a,isEdit:e.isEdit},on:{refreshData:function(t){return e.refreshObjectValue(t)}}})],1)],1)})),1):"Map"==e.data.type?t("div",e._l(e.paramList,(function(a,s){return t("el-row",{key:s},[t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入键"},on:{input:e.notifyData},model:{value:a.keyName,callback:function(t){e.$set(a,"keyName",t)},expression:"item.keyName"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:9}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入值"},on:{input:e.notifyData},model:{value:a.keyValue,callback:function(t){e.$set(a,"keyValue",t)},expression:"item.keyValue"}})],1),t("el-col",{attrs:{span:3}},[e.isEdit?t("div",{staticClass:"op-icon"},[t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.deleteValueItem(e.data.value,s)}}}),t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:e.addValueItem}})]):e._e()])],1)})),1):"Integer"==e.data.type||"Long"==e.data.type?t("div",[e.backshow?t("el-autocomplete",{staticStyle:{width:"400px"},attrs:{size:"small",disabled:!e.isEdit,"fetch-suggestions":e.querySearch,placeholder:e.data.description},on:{input:e.notifyData,select:e.handleSelect},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-full-screen"},on:{click:function(t){return e.diaplayString(e.data.value)}},slot:"append"})],1):t("el-input-number",{attrs:{size:"small",disabled:!e.isEdit,"controls-position":"right",placeholder:e.data.description},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}}),t("el-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{disabled:!e.isEdit},model:{value:e.backshow,callback:function(t){e.backshow=t},expression:"backshow"}},[e._v("使用变量")])],1):"Boolean"==e.data.type?t("div",[e.backshow?t("el-autocomplete",{staticStyle:{width:"400px"},attrs:{size:"small",disabled:!e.isEdit,"fetch-suggestions":e.querySearch,placeholder:e.data.description},on:{input:e.notifyData,select:e.handleSelect},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-full-screen"},on:{click:function(t){return e.diaplayString(e.data.value)}},slot:"append"})],1):e._e(),t("el-switch",{attrs:{size:"small",disabled:!e.isEdit,"active-color":"#13ce66","inactive-color":"#909399"},on:{change:e.notifyData},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}}),t("el-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{disabled:!e.isEdit},model:{value:e.backshow,callback:function(t){e.backshow=t},expression:"backshow"}},[e._v("使用变量")])],1):"Float"==e.data.type||"Double"==e.data.type?t("div",[e.backshow?t("el-autocomplete",{staticStyle:{width:"400px"},attrs:{size:"small",disabled:!e.isEdit,"fetch-suggestions":e.querySearch,placeholder:e.data.description},on:{input:e.notifyData,select:e.handleSelect},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-full-screen"},on:{click:function(t){return e.diaplayString(e.data.value)}},slot:"append"})],1):e._e(),t("el-input-number",{attrs:{size:"small",precision:2,step:.1,disabled:!e.isEdit,"controls-position":"right",placeholder:e.data.description},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}}),t("el-checkbox",{staticStyle:{"margin-left":"10px"},attrs:{disabled:!e.isEdit},model:{value:e.backshow,callback:function(t){e.backshow=t},expression:"backshow"}},[e._v("使用变量")])],1):t("el-autocomplete",{attrs:{size:"small",disabled:!e.isEdit,"fetch-suggestions":e.querySearch,placeholder:e.data.description},on:{input:e.notifyData,select:e.handleSelect},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.data.value,callback:function(t){e.$set(e.data,"value",t)},expression:"data.value"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-full-screen"},on:{click:function(t){return e.diaplayString(e.data.value)}},slot:"append"})],1),t("el-dialog",{attrs:{title:"数据编辑",visible:e.showDetail,width:"60%"},on:{"update:visible":function(t){e.showDetail=t},close:e.closeEditor}},[t("monaco",{ref:"editer",attrs:{codes:e.jsonStr,readonly:!1}})],1)],1)},ve=[],fe=function(){var e=this,t=e._self._c;return t("div",[t("codemirror",{attrs:{options:e.options},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)},be=[],ye=a("8f94"),we=(a("a7be"),a("7b0e"),a("f9d4"),{components:{codemirror:ye["codemirror"]},props:{codes:{type:String},language:{type:String,default:"application/json"},readonly:{type:Boolean,default:function(){return!1}}},watch:{codes:{immediate:!0,handler(e){e&&(this.content=e)}},content:{handler(e){this.$emit("change",e)}},readonly:{handler(e){this.options.readOnly=e}}},data(){return{monacoEditor:null,readOnly:!0,content:"",hoverProvider:null,options:{line:!0,theme:"lesser-dark",tabSize:4,indentUnit:2,firstLineNumber:1,readOnly:this.readonly,autorefresh:!0,smartIndent:!0,lineNumbers:!0,styleActiveLine:!0,viewportMargin:1/0,showCursorWhenSelecting:!0,mode:this.language}}},methods:{},mounted(){}}),ke=we,Ce=(a("1356"),Object(y["a"])(ke,fe,be,!1,null,"b9c6fe40",null)),_e=Ce.exports,Fe={name:"FeatureEdit",props:{feature:Object,isEdit:Boolean,point:String,case:String},components:{FeatureEdit:De,monaco:_e},watch:{feature(e){this.data=JSON.parse(JSON.stringify(e)),this.exchangeDataValue()}},data(){return{pointId:"",data:{value:[]},paramList:[],uniqId:"",jsonStr:"",showDetail:!1,backshow:!1,contextList:[],originString:""}},methods:{isValidPlaceholder(e){if(!e.startsWith("${"))return!1;const t=e.slice(2);if(!t.includes("}"))return!0;const a=t.split("}")[0];return 0===a.trim().length},querySearch(e,t){if(console.log(e),this.originString=e,e&&this.isValidPlaceholder(e)){let i=e.replace("${","");console.log("clear test ",i);var a=this.contextList,s=i?a.filter(this.createFilter(i)):a;t(s)}else t([])},createFilter(e){return t=>0===t.value.toLowerCase().indexOf(e.toLowerCase())},handleSelect(e){this.data.value="${"+e.value+"}"},closeEditor(){this.data.value=this.$refs.editer.getValue()},deleteArray(e){this.data.value.splice(e,1),this.notifyData()},addParam(){if("Object"==this.data.initData.rangeType){let e=[];this.data.initData.range.forEach(t=>{let a=JSON.parse(JSON.stringify(t));a.value=null,e.push(a)}),this.data.value.push({rangeList:e})}else this.paramList.push({content:""});this.$forceUpdate()},deleteList(e){this.paramList.splice(e,1),this.refreshList()},refreshObjectValue(e){this.data.value[e.item.paramKey]=e.item.value,this.notifyData()},refreshList(){let e=[];this.paramList.forEach(t=>{e.push(t.content)}),this.data.value=e,this.notifyData()},refreshArrayValue(e,t){this.data.value[t][e.item.paramKey]=e.item.value,this.notifyData()},diaplayString(e){this.showDetail=!0,this.jsonStr=e},notifyData(){let e=this.data;if("Map"==this.data.type){let t={};this.paramList.forEach(e=>{t[e.keyName]=e.keyValue}),e.value=t,e.paramKey=this.data.paramKey}this.$emit("refreshData",{item:e,pointId:this.pointId}),this.$forceUpdate()},matchMap(e){let t=[];if(null==e||void 0==e)return t.push({keyName:"",keyValue:""}),t;for(var a in e)t.push({keyName:a,keyValue:e[a]});return 0==t.length&&t.push({keyName:"",keyValue:""}),t},deleteValueItem(e,t){this.paramList.splice(t,1),0==this.paramList.length&&this.paramList.push({keyName:"",keyValue:""}),this.notifyData()},addValueItem(){this.paramList.push({keyName:"",keyValue:""})},exchangeDataValue(){if(this.data.value||"Boolean"!=this.data.type||(this.data.value=!1),"Map"==this.data.type&&(this.paramList=this.matchMap(this.data.value)),this.data.value&&"Array"==this.data.type&&"Object"!=this.data.initData.rangeType&&(this.paramList=[],this.data.value.forEach(e=>{this.paramList.push({content:e})})),this.data.value&&this.data.initData&&"Object"==this.data.initData.rangeType){let e=this.data.initData.range;this.data.value.forEach(t=>{e.forEach(e=>{e.value=t[e.paramKey]}),t.rangeList=JSON.parse(JSON.stringify(e))})}if(this.data.value||"Array"!=this.data.type||(this.data.value=[]),"Object"==this.data.type){this.data.value=this.data.value?this.data.value:null;let e=JSON.parse(JSON.stringify(this.data));this.paramList=[],e.initData.range.forEach(e=>{this.data.value&&(e.value=this.data.value[e.paramKey]),this.paramList.push(e)})}!this.data.value&&this.data.initData&&this.data.initData.data&&(this.data.value=this.data.initData.data),"String"!=this.data.type&&"Map"!=this.data.type&&"Array"!=this.data.type&&this.data&&this.data.value&&-1!=(this.data.value+"").indexOf("$")&&(this.backshow=!0)}},created(){let e=this.$store.state.caseContext[this.case];e&&e.forEach(e=>{this.contextList.push({value:e})}),this.pointId=this.point,this.data=this.feature,this.exchangeDataValue()}},xe=Fe,Ie=(a("f55a"),Object(y["a"])(xe,ge,ve,!1,null,"e207d8b2",null)),De=Ie.exports,Te=function(){var e=this,t=e._self._c;return t("div",{staticClass:"line"},[e._l(e.compareData,(function(a,s){return t("el-row",{key:s},[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"item"},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入响应参数"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.compareKey,callback:function(t){e.$set(a,"compareKey",t)},expression:"item.compareKey"}})],1)]),t("el-col",{attrs:{span:5}},[t("div",{staticClass:"item"},[t("el-select",{attrs:{disabled:!e.isEdit,placeholder:"选择运算符",size:"mini"},model:{value:a.operator,callback:function(t){e.$set(a,"operator",t)},expression:"item.operator"}},e._l(e.operatorList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1)]),t("el-col",{attrs:{span:12}},[t("div",{staticClass:"item"},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入期望值"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.expectValue,callback:function(t){e.$set(a,"expectValue",t)},expression:"item.expectValue"}},[t("template",{slot:"append"},[t("i",{staticClass:"el-icon-full-screen",on:{click:function(t){return e.diaplayString(a)}}})])],2)],1)]),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"delete-div"},[t("i",{staticClass:"el-icon-remove-outline delete-icon",class:{"disable-icon":!e.isEdit},on:{click:function(t){return e.deleteValueItem(e.compareData,s)}}})])])],1)})),t("div",{staticClass:"add-line",class:{"disable-select":!e.isEdit},on:{click:e.addItem}},[e._m(0)]),t("el-dialog",{attrs:{title:"数据编辑",visible:e.showDetail,width:"60%"},on:{"update:visible":function(t){e.showDetail=t},close:e.closeEditor}},[t("monaco",{ref:"editer",attrs:{codes:e.jsonStr,readonly:!1}})],1)],2)},Pe=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"add-button"},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])}],Se={props:{data:Array,point:String,isEdit:Boolean},components:{monaco:_e},data(){return{showDetail:!1,operator:"",operatorList:[],compareData:[],disableSelect:"disable-select",pointId:"",jsonStr:"",chooseItem:null}},methods:{closeEditor(){this.chooseItem.expectValue=this.$refs.editer.getValue()},diaplayString(e){this.chooseItem=e,this.showDetail=!0,this.jsonStr=e.expectValue},deleteValueItem(e,t){e.splice(t,1),0==e.length&&e.push({keyName:"",keyValue:""}),this.notifyData()},notifyData(){this.$emit("refreshCompare",{data:this.compareData,pointId:this.pointId})},addItem(){this.compareData.push({})},getOperators(){this.operatorList=[],I.getExecuteOperators().then(e=>{e.data.forEach(e=>{this.operatorList.push({label:e,value:e})})})},isEmptyArray(e){return null==e||void 0==e||0==e.length}},created(){this.pointId=this.point,this.compareData=this.data,this.isEmptyArray(this.compareData)&&(this.compareData=[{}]),this.getOperators()}},Le=Se,Ne=(a("05b5"),Object(y["a"])(Le,Te,Pe,!1,null,"bca0ce16",null)),$e=Ne.exports,Ee=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[e._l(e.paramList,(function(a,s){return t("div",{key:s,staticClass:"input-line"},[t("el-row",[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入参数名称"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.variableKey,callback:function(t){e.$set(a,"variableKey",t)},expression:"item.variableKey"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{size:"mini",disabled:!e.isEdit,placeholder:"请输入值"},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:a.variableValue,callback:function(t){e.$set(a,"variableValue",t)},expression:"item.variableValue"}})],1),t("el-col",{attrs:{span:4}},[t("el-checkbox",{staticClass:"global-box",attrs:{disabled:!e.isEdit},model:{value:a.global,callback:function(t){e.$set(a,"global",t)},expression:"item.global"}},[e._v("全局变量")])],1),e.isEdit?t("el-col",{attrs:{span:2}},[t("div",{staticClass:"delete-icon",on:{click:function(t){return e.deleteValueItem(e.paramList,s)}}},[t("i",{staticClass:"el-icon-remove-outline"})])]):e._e()],1)],1)})),t("div",{staticClass:"add-line",class:{"disable-select":!e.isEdit},on:{click:e.addItem}},[e._m(0)])],2)},ze=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"add-button"},[t("i",{staticClass:"el-icon-plus"}),e._v(" 新增")])}],Re={props:{data:Array,isEdit:Boolean,point:String},data(){return{paramList:[],pointId:""}},methods:{addItem(){this.paramList.push({})},notifyData(){this.$emit("refreshVariable",{data:this.paramList,pointId:this.pointId})},deleteValueItem(e,t){e.splice(t,1),0==e.length&&e.push({variableKey:"",variableValue:""}),this.notifyData()}},created(){this.pointId=this.point,this.data?this.paramList=this.data:this.paramList.push({})}},Oe=Re,Ae=(a("44f2"),Object(y["a"])(Oe,Ee,ze,!1,null,"730a454a",null)),qe=Ae.exports,Be={props:{data:Object,isEdit:Boolean,type:String,case:String},components:{FeatureEdit:De,FeatureCompare:$e,FeatureVariable:qe},watch:{data(e){this.executePoint=e},type(e){this.writeType=e}},data(){return{executePoint:{},writeType:"",caseId:""}},methods:{refreshValue(e){this.executePoint.params.forEach(t=>{e.item.paramKey==t.paramKey&&(t.value=e.item.value)}),this.$emit("refreshData",{data:this.executePoint})},refreshCompare(e){this.executePoint.compareDefine=e.data,this.$emit("refreshData",{data:this.executePoint})},refreshVariable(e){this.executePoint.variableDefine=e.data,this.$emit("refreshData",{data:this.executePoint})}},created(){this.caseId=this.case,this.executePoint=this.data,this.writeType=this.type}},Ve=Be,Ue=(a("a77f"),Object(y["a"])(Ve,me,he,!1,null,"72cb5cd4",null)),Ge=Ue.exports,je=function(){var e=this,t=e._self._c;return t("div",[2==e.executePoint.executeType?t("div",[t("FeatureFor",{attrs:{data:e.executePoint,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1):e._e(),3==e.executePoint.executeType?t("div",[t("FeatureIF",{attrs:{data:e.executePoint,isEdit:e.isEdit},on:{refreshData:e.refreshValue}})],1):e._e(),6==e.executePoint.executeType?t("div",[t("monaco",{attrs:{codes:e.executePoint.service,language:"javascript",readonly:!e.isEdit},on:{change:e.dataChange}})],1):e._e()])},Me=[],Je=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"for-box"},[t("div",{staticClass:"for-start"},[e._v(" 循环次数 "),t("el-input-number",{staticClass:"size-input",attrs:{disabled:!e.isEdit,size:"mini",inline:""},on:{input:e.notifyData},model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}})],1),e._v(" { "),t("div",[t("draggable",{staticClass:"for-content",attrs:{group:"api",animation:"100"},on:{add:e.addFeature},model:{value:e.forFeatures,callback:function(t){e.forFeatures=t},expression:"forFeatures"}},[t("el-collapse",{key:e.uuid,attrs:{accordion:""}},e._l(e.forFeatures,(function(a,s){return t("el-collapse-item",{key:s,attrs:{name:a.randomId}},[t("template",{slot:"title"},[t("span",[e._v(" "+e._s(a.name)+" ")]),e.isEdit?t("i",{staticClass:"el-icon-delete delete-point",on:{click:function(t){return e.deleteExecutePoint(s)}}}):e._e()]),t("div",{staticClass:"content-item"},[t("FeatureTemplate",{attrs:{data:a,isEdit:e.isEdit,type:a.writeType},on:{refreshData:e.refreshValue}})],1)],2)})),1)],1)],1),e._v(" } ")])])},He=[],Ke=a("b76a"),We=a.n(Ke),Qe={props:{data:Object,isEdit:Boolean},components:{draggable:We.a,FeatureTemplate:Ge},data(){return{forData:{},size:"",str:"<",forFeatures:[],uuid:"",condition:""}},methods:{addFeature(e){this.forFeatures[e.newIndex-1].randomId=(new Date).valueOf(),this.forFeatures[e.newIndex-1].writeType="1",this.forFeatures[e.newIndex-1].sortOrder=e.newIndex,this.isEdit=!0,this.uuid=(new Date).valueOf()},notifyData(){this.refreshValue()},refreshValue(e){let t=[];this.forFeatures.forEach(a=>{e&&a.randomId==e.data.randomId&&(a=e.data);let s={compareDefine:a.compareDefine,variableDefine:a.variableDefine,executorUnit:{method:a.method,name:a.name,description:a.description,service:a.service,params:a.params},featureId:this.forData.pointId};t.push(s)});let a=JSON.parse(JSON.stringify(this.forData));a.method=this.condition,a.executePoints=JSON.parse(JSON.stringify(t)),this.$emit("refreshData",{data:a})},deleteExecutePoint(e){this.forFeatures.splice(e,1)}},created(){this.forData=this.data,this.data.method&&(this.condition=this.data.method),this.forFeatures=[],this.data.executePoints&&this.data.executePoints.forEach(e=>{e.executorUnit.randomId=(new Date).valueOf();let t=e.executorUnit;t.writeType="1",t.compareDefine=e.compareDefine,t.variableDefine=e.variableDefine,this.forFeatures.push(t)})}},Ye=Qe,Xe=(a("8bd4"),Object(y["a"])(Ye,Je,He,!1,null,"45d5b4f4",null)),Ze=Xe.exports,et=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"for-title"},[t("div",{staticClass:"for-start"},[e._v(" if( "),t("el-input",{staticClass:"condition-input",attrs:{disabled:!e.isEdit,placeholder:"请输入ongl表达式",size:"mini",inline:""},on:{input:e.notifyData},nativeOn:{pointerdown:function(e){e.stopPropagation()}},model:{value:e.condition,callback:function(t){e.condition=t},expression:"condition"}}),e._v(" ) ")],1),e._v(" { "),t("div",[t("draggable",{staticClass:"for-content",attrs:{group:"api",animation:"100"},on:{add:e.addPoint},model:{value:e.points,callback:function(t){e.points=t},expression:"points"}},[t("el-collapse",{key:e.uuid,attrs:{accordion:""}},e._l(e.points,(function(a,s){return t("el-collapse-item",{key:s,attrs:{name:a.randomId}},[t("template",{slot:"title"},[t("span",[e._v(" "+e._s(a.name)+" ")]),e.isEdit?t("i",{staticClass:"el-icon-delete delete-point",on:{click:function(t){return e.deleteExecutePoint(s,a.pointId)}}}):e._e()]),t("div",{staticClass:"content-item"},[t("FeatureTemplate",{attrs:{data:a,isEdit:e.isEdit,type:a.writeType},on:{refreshData:e.refreshValue}})],1)],2)})),1)],1)],1),e._v(" } ")])])},tt=[],at={props:{data:Object,isEdit:Boolean},components:{draggable:We.a,FeatureTemplate:Ge},data(){return{executeData:{},size:"",points:[],uuid:"",condition:""}},methods:{addPoint(e){let t=0==e.newIndex?0:e.newIndex-1;this.points[t].randomId||(this.points[t].randomId=this.$utils.randomString(20),this.points[t].writeType="1",this.points[t].sortOrder=e.newIndex),this.isEdit=!0,this.uuid=(new Date).valueOf(),this.notifyData()},notifyData(){this.refreshValue()},refreshValue(e){let t=[];this.points.forEach(a=>{e&&a.randomId==e.data.randomId&&(a=e.data);let s={executorUnit:{method:a.method,name:a.name,description:a.description,service:a.service,params:a.params,invokeType:a.invokeType,headers:a.headers,relatedId:a.relatedId},featureId:this.executeData.pointId,randomId:a.randomId,compareDefine:a.compareDefine,variableDefine:a.variableDefine,executeType:a.executeType};t.push(s)});let a=JSON.parse(JSON.stringify(this.executeData));a.method=this.condition,a.executePoints=JSON.parse(JSON.stringify(t)),this.$emit("refreshData",{data:a})},deleteExecutePoint(e){this.$confirm("确认删除用例执行点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.points.splice(e,1)})}},created(){this.executeData=this.data,this.data.method&&(this.condition=this.data.method),this.points=[],this.data.executePoints&&this.data.executePoints.forEach(e=>{e.executorUnit.randomId=(new Date).valueOf();let t=e.executorUnit;t.writeType="1",t.compareDefine=e.compareDefine,t.variableDefine=e.variableDefine,this.points.push(t)})}},st=at,it=(a("cbd4"),Object(y["a"])(st,et,tt,!1,null,"0ca36ca2",null)),rt=it.exports,lt={props:{data:Object,isEdit:Boolean},components:{FeatureFor:Ze,FeatureIF:rt,monaco:_e},watch:{data(e){this.executePoint=e}},data(){return{executePoint:{},writeType:""}},methods:{dataChange(e){this.executePoint.service=e,this.$emit("refreshData",{data:this.executePoint})},refreshValue(e){this.$emit("refreshData",e)}},created(){this.executePoint=this.data,console.log(this.executePoint)}},ot=lt,nt=(a("d5d1"),Object(y["a"])(ot,je,Me,!1,null,"031ae73a",null)),ct=nt.exports;const dt="0.3s height ease-in-out, 0.3s padding-top ease-in-out, 0.3s padding-bottom ease-in-out",ut={"before-enter"(e){e.style.transition=dt,e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0},enter(e){e.dataset.oldOverflow=e.style.overflow,0!==e.scrollHeight?(e.style.height=e.scrollHeight+"px",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom):(e.style.height="",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom),e.style.overflow="hidden"},"after-enter"(e){e.style.transition="",e.style.height="",e.style.overflow=e.dataset.oldOverflow},"before-leave"(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.height=e.scrollHeight+"px",e.style.overflow="hidden"},leave(e){0!==e.scrollHeight&&(e.style.transition=dt,e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0)},"after-leave"(e){e.style.transition="",e.style.height="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom}};var pt={name:"collapseTransition",functional:!0,render(e,{children:t}){const a={on:ut};return e("transition",a,t)}},mt={props:{service:String,feature:String,case:String},components:{draggable:We.a,FeatureTemplate:Ge,FeatureTool:ct,collapse:pt},watch:{feature:{handler(e){this.featureId=e},deep:!0,immediate:!0},service:{handler(e){this.serviceId=e,this.getExecutePoint()},deep:!0,immediate:!0},case:{handler(e){this.caseId=e,this.getCaseInfo()},deep:!0,immediate:!0}},computed:{dragOptions(){return{animation:100,group:"api",revertClone:!0,disabled:!this.isEdit,ghostClass:"ghost"}},isShowEmpty(){let e=!1;return 0!=this.displayList.length&&void 0!=this.displayList.length||(e=!0),this.isDrag&&(e=!1),e},templateGroup(){return this.serviceGroup.filter(e=>{if(!this.filterName)return!0;let t=e.list.filter(e=>e.name.toLowerCase().includes(this.filterName.toLowerCase()));return e.list=t,t.length>0})},templateList(){return this.featureItemList.filter(e=>!this.filterName||e.name.toLowerCase().includes(this.filterName.toLowerCase()))}},data(){return{displayList:[],allPoints:[],menuType:"2",toolType:"2",isDrag:!1,dragGroupList:[],featureItemList:[],isEdit:!1,uuid:"",isActive:!1,featureId:"",filterName:"",serviceId:"",caseId:"",caseInfo:{},serviceList:[],testActive:!1,testShow:!1,serviceGroup:[]}},methods:{closeTemplates(e){e.isActive=!e.isActive,e.showList=!e.showList},onContextmenu(e){return this.$contextmenu({items:[{label:"粘贴执行点",disabled:!this.isEdit,onClick:()=>{this.pasteExecutePoint()}}],event:e,zIndex:3,minWidth:230}),!0},pasteExecutePoint(){let e=localStorage.getItem("copyItem"),t=JSON.parse(e);t&&t.randomId&&(t.randomId=this.$utils.randomString(20),t.writeType="1",t.testStage=parseInt(this.menuType),t.pointId=null,this.allPoints.push(t),this.displayExepoints(),localStorage.removeItem("copyItem"))},copyExecutePoint(e){localStorage.setItem("copyItem",JSON.stringify(e)),this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:`执行点<strong>[${e.description}]</strong>已复制`,type:"success"})},closeDiv(e){e.isActive=!e.isActive,this.uuid=this.$utils.randomString(20)},deleteExecutePoint(e,t){this.$confirm("确认删除用例执行点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(!t)return this.removeItem(this.displayList[e]),void this.displayExepoints();this.deletePoint(t,e)})},deletePoint(e,t){I.deleteExecutePoint(e).then(e=>{if(1==e.data)return this.removeItem(this.displayList[t]),this.displayExepoints(),void this.$message.success("删除执行点成功");this.$message.warning("删除执行点失败")})},removeItem(e){let t=-1;for(let a in this.allPoints)if(this.allPoints[a]["randomId"]===e.randomId){t=a;break}-1!=t&&this.allPoints.splice(t,1)},startDebug(){I.startFeature(this.featureId).then(e=>{e.data?this.$message.success("开始执行，请查看运行日志"):this.$message.error("执行失败")})},resetOrder(){this.bindStepPoints(),this.allPoints.sort((e,t)=>{let a=e.testStage,s=t.testStage;return a>s?1:a<s?-1:0})},saveConfig(){this.displayList.forEach(e=>{e.editDesc=!1});let e=0,t=[];this.resetOrder(),this.allPoints.forEach(a=>{let s={method:a.method,name:a.name,invokeType:a.invokeType,description:a.description,service:a.service,headers:a.headers,relatedId:a.relatedId};2==a.executeType||3==a.executeType?s.executePoints=a.executePoints:s.params=a.params,t.push({pointId:a.pointId,featureId:this.featureId,templateId:a.templateId,testStage:a.testStage,sortOrder:e,executorUnit:s,compareDefine:a.compareDefine,variableDefine:a.variableDefine,executeType:a.executeType,description:a.description}),e++});let a={featureId:this.featureId,testFeatures:t};I.updateFeature(a).then(()=>{this.$message.success("保存成功"),this.isEdit=!1,this.getExecutePoint()})},exchangeEditStatus(e,t){t&&(e.description=e.desc),e.editDesc=!e.editDesc,this.uuid=this.$utils.randomString(20)},cancelEdit(){this.getExecutePoint(),this.isEdit=!1},clickEdit(){this.isEdit=!this.isEdit},dragEnd(){let e=JSON.parse(JSON.stringify(this.allPoints)),t={};e.forEach(e=>{let a=e.testStage+"";t[a]||(t[a]=[]),t[a].push(e)}),t[this.menuType]=this.displayList;let a=[];Object.values(t).forEach(e=>{a=a.concat(e)}),this.allPoints=a},addItem(e){let t=JSON.parse(JSON.stringify(this.dragGroupList[e.oldIndex]));t.isActive=!0,t.randomId=this.$utils.randomString(20),t.writeType="1",t.sortOrder=e.newIndex,t.testStage=parseInt(this.menuType),t.pointId=null,this.allPoints.push(t),this.isEdit=!0,this.displayExepoints(),this.uuid=this.$utils.randomString(20)},refreshValue(e){let t=[];e.data.executePoints&&e.data.executePoints.forEach(e=>{t.push(e.randomId)}),this.allPoints=this.allPoints.filter(e=>{let a=t.indexOf(e.randomId)<0;return a||this.deletePoint(e.pointId),a});let a=[];this.allPoints.forEach(t=>{t.randomId==e.data.randomId?a.push(e.data):a.push(t)}),this.allPoints=a,this.displayExepoints()},startDrag(e,t){this.dragGroupList=t.list,this.isDrag=!0},selectTestStep(){this.bindStepPoints(),this.displayExepoints()},bindStepPoints(){if(0==this.displayList.length)return;let e=this.displayList[0].testStage,t=this.allPoints.filter(t=>t.testStage!=e);this.allPoints=t.concat(JSON.parse(JSON.stringify(this.displayList)))},refreshArray(e){this.displayList=[];let t=0;e.forEach(e=>{this.$set(this.displayList,t,e),t++})},getExecutePoint(){I.getExecutePoints(this.featureId).then(e=>{this.allPoints=[],e.data.forEach(e=>{let t=e.executorUnit,a=t.params,s={id:e.sortOrder,pointId:e.pointId,relatedId:t.relatedId,name:t.name,method:t.method,service:t.service,description:e.description,invokeType:t.invokeType,headers:t.headers,params:a,executePoints:t.executePoints,compareDefine:e.compareDefine,variableDefine:e.variableDefine,writeType:"1",executeType:e.executeType,randomId:this.$utils.randomString(20),testStage:e.testStage,isActive:!1};this.allPoints.push(s)}),this.menuType="2",this.displayExepoints()}),this.getTemplates()},getCaseInfo(){x.getTestCaseDetail(this.caseId).then(e=>{this.caseInfo=e.data,this.getTemplates()})},getTemplates(){this.caseInfo?2!=this.caseInfo.caseType?I.getServiceTemplates(this.serviceId).then(e=>{let t=e.data;t.forEach(e=>{e.isTool=1!=e.templateType&&5!=e.templateType,e.executeType=e.templateType,e.service=e.service?e.service:""}),this.featureItemList=t;const a={};this.serviceList.forEach(e=>a[e.serviceId]=e);let s=a[this.serviceId];s&&(this.serviceGroup=[{name:s.serviceName,isActive:!1,showList:!1,list:t}])}):I.getAllTemplates().then(e=>{let t=e.data;t.forEach(e=>{e.isTool=1!=e.templateType&&5!=e.templateType,e.executeType=e.templateType,e.service=e.service?e.service:""}),this.exchangeGroup(t),this.featureItemList=t}):this.getCaseInfo()},exchangeGroup(e){let t={};e.forEach(e=>{let a=t[e.owner];a||(a=[]),a.push(e),t[e.owner]=a});const a={};this.serviceList.forEach(e=>a[e.serviceId]=e);let s=[];for(let i in t)if(i&&""!=i){let e=a[i];e&&s.push({name:e.serviceName,isActive:!1,showList:!1,list:t[i]})}this.serviceGroup=s},getServices(){F.getServices().then(e=>{this.serviceList=e.data})},displayExepoints(){this.displayList=[];let e=[],t=parseInt(this.menuType);this.allPoints.forEach(a=>{a.testStage==t&&e.push(a)}),this.displayList=e}},created(){this.getServices(),this.getExecutePoint(),this.caseId=this.$route.query.caseId,this.getCaseInfo()}},ht=mt,gt=(a("54cf"),a("2cf8"),Object(y["a"])(ht,ue,pe,!1,null,"6e2a9e0c",null)),vt=gt.exports,ft={components:{history:de,FeatureConfig:vt,testview:A},watch:{filterText(e){this.$refs.tree.filter(e)}},data(){return{showCaseDialog:!1,caseDetail:{},infoForm:null,activeName:"desc",filterText:"",caseFeatures:[],showDebugDialog:!1,isConnect:!1,serviceId:"",showFeatureDialog:!1,featureForm:{},isEditFeature:!1,featureTitle:"",caseId:"",stepContent:"",stepList:[],formStepList:[],configData:[],paramTypeList:[{label:"String",value:"String"},{label:"Map",value:"Map"},{label:"List",value:"List"},{label:"Integer",value:"Integer"},{label:"Float",value:"Float"},{label:"Double",value:"Double"}],uuid:0,dynamicTags:[],inputVisible:!1,inputValue:"",createData:{},caseName:"",selectFeatureId:"",featureRule:{featureName:[{required:!0,message:"请输入名称",trigger:"blur"}]},expendList:[],caseRule:{testCaseName:[{required:!0,message:"请输入测试集名称",trigger:"blur"}],description:[{required:!0,message:"请输入详细描述",trigger:"blur"}]}}},methods:{submitCase(e){this.$refs[e].validate(e=>{if(!e)return!1;x.updateTestCase(this.caseDetail).then(e=>{if(e.data)return this.$message.success("修改测试集成功"),this.getCaseDetail(),void(this.showCaseDialog=!1);this.$message.error("修改测试集失败")})})},startEditCase(){this.showCaseDialog=!0},dragNodeEvent(e){console.log("all",this.caseFeatures);let t=[];this.loadItemFromTree(this.caseFeatures,t);let a=0;t.forEach(e=>{e.sortOrder=a,a++}),console.log("drag array ",t,t.length),I.batchUpdateFeatures({featureOrders:t}).then(t=>{t?this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:`用例<strong>[${e.data.featureName}]</strong>排序成功`,type:"success"}):this.$notify({title:"失败",dangerouslyUseHTMLString:!0,message:`用例<strong>[${e.data.featureName}]</strong>排序失败`,type:"error"})})},loadItemFromTree(e,t){e.forEach(e=>{t.push(e),e.children&&this.loadItemFromTree(e.children,t)})},clickCommand(e,t){if("newItem"==e&&(this.startAddFeature(),this.createData.type=1,t&&(this.createData.parentId=t.featureId)),"newFolder"==e&&(this.startAddFeature(),this.createData.type=2,this.featureTitle="添加目录",t&&(this.createData.parentId=t.featureId)),"deleteItems"==e){let e=this.$refs.tree.getCheckedKeys();I.batchDeleteFeature({features:e}).then(()=>{this.requestCaseFeatures(this.caseId),this.uuid=this.$utils.randomString(20)})}if("delete"==e&&I.deleteFeature(t.featureId).then(()=>{this.requestCaseFeatures(this.caseId),this.uuid=this.$utils.randomString(20)}).catch(e=>{this.$message.error(e.response.data.message)}),"copyFeature"==e){let e=[];if(2==t.featureType){let a=this.$refs.tree.getCheckedKeys();if(a.length<1)return void this.$notify({title:"未选中用例",dangerouslyUseHTMLString:!0,message:"请先选择用例，才可复制",type:"error"});t.children.forEach(t=>{let s=a.indexOf(t.featureId);-1!=s&&1==t.featureType&&e.push(t.featureId)})}else e.push(t.featureId);console.log("copy",e),localStorage.setItem("copyFeature",JSON.stringify({featureIds:e,featureType:t.featureType})),this.$notify({title:"成功",dangerouslyUseHTMLString:!0,message:`执行点<strong>[${t.featureName}]</strong>已复制`,type:"success"})}if("pasteFeature"==e){let e=localStorage.getItem("copyFeature");if(null==e||""==e||void 0==e)return void this.$notify({title:"粘贴失败",dangerouslyUseHTMLString:!0,message:"粘贴用例为空，请复制之后重新尝试",type:"warning"});let a=JSON.parse(e);a.targetFeature=t.featureId,I.pasteFeature(a).then(e=>{e.data&&(this.expendList=[t.featureId],localStorage.removeItem("copyItem"),this.requestCaseFeatures(this.caseId))})}},handleClose(e){this.dynamicTags.splice(this.dynamicTags.indexOf(e),1)},showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm(){let e=this.inputValue;e&&this.dynamicTags.push(e),this.inputVisible=!1,this.inputValue=""},getTestCaseConfigs(){this.configData=[],x.getTestCaseConfigs(this.caseId).then(e=>{let t=e.data;t.push({paramType:"String"}),this.configData=t;let a=[];t.forEach(e=>{e&&e.paramKey&&a.push(e.paramKey)}),this.$store.commit("UPDATE_CASE_CONTEXT",{key:this.caseId,value:a})})},startEditParam(e){e.isEdit=!0,this.uuid=this.$utils.randomString(20)},cancelEditParam(e){this.uuid=this.$utils.randomString(20),e.isEdit=!1},handleSave(e){e.configId?x.updateConfig(e).then(()=>{this.$message.success("修改配置成功"),this.getTestCaseConfigs()}):(e.unionId=this.caseId,x.addConfigs([e]).then(()=>{this.$message.success("添加配置成功"),this.getTestCaseConfigs()}))},handleDelete(e){x.deleteConfig(e.configId).then(()=>{this.$message.success("删除配置成功"),this.getTestCaseConfigs()})},addStep(){this.stepList.push({content:this.stepContent,hover:!1}),this.stepContent=""},removeStep(e){this.stepList.splice(e,1)},closeFeatureDialog(){this.showFeatureDialog=!1,this.featureForm={},this.dynamicTags=[],this.createData={},this.infoForm&&I.getFeatureDetail(this.infoForm.featureId).then(e=>{this.infoForm=e.data,this.formStepList=[],this.infoForm.testStep.split("|").forEach(e=>{this.formStepList.push(e)})})},startAddFeature(){this.showFeatureDialog=!this.showFeatureDialog,this.isEditFeature=!1,this.featureForm={},this.featureTitle="添加用例",this.stepList=[]},startEditFeature(){this.showFeatureDialog=!this.showFeatureDialog,this.isEditFeature=!0,this.featureTitle="修改用例",this.featureForm=this.infoForm,this.stepList=[],this.infoForm.testStep.split("|").forEach(e=>{this.stepList.push({hover:!1,content:e})})},deleteFeature(){this.$confirm("用例删除后所有执行点数据都会删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{I.deleteFeature(this.infoForm.featureId).then(()=>{this.$message("删除用例成功"),this.requestCaseFeatures(this.caseId)})})},submitFeatureForm(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=JSON.parse(JSON.stringify(this.featureForm));t.author="古月澜",t.modify="古月澜",t.featureType=1,t.testCaseId=this.caseId,t.testFeatures=[];let a="";this.stepList.forEach(e=>{a+=e.content+"|"}),t.testStep=a.substring(0,a.length-1),t.tags=JSON.parse(JSON.stringify(this.dynamicTags)),t.featureType=this.createData.type,t.parentId=this.createData.parentId,this.isEditFeature?I.updateFeature(t).then(()=>{this.$message.success("修改成功"),this.showFeatureDialog=!this.showFeatureDialog,this.requestCaseFeatures(this.caseId)}):I.createFeature(t).then(()=>{this.$message.success("添加成功"),this.showFeatureDialog=!this.showFeatureDialog,this.requestCaseFeatures(this.caseId)})})},startDebug(){let e=this.$refs.tree.getCheckedNodes();0!=e.length?(this.tableData=[],I.startFeature(this.infoForm.featureId).then(e=>{e.data?this.$message.success("开始执行，请查看运行日志"):this.$message.error("执行失败")})):this.$message.warning("请选择服务与用例～")},tabChange(){"history"==this.activeName&&this.$refs.historyComp.getFeatureHistory(this.infoForm.featureId)},treeNodeClick(e){this.activeName="desc",this.infoForm=e,this.dynamicTags=[],this.formStepList=e.testStep.split("|"),this.selectFeatureId=e.featureId,this.expendList=[e.featureId],I.getFeatureDetail(e.featureId).then(e=>{this.dynamicTags=e.data.tags,this.uuid=this.$utils.randomString(20)})},filterNode(e,t){return!e||-1!==t.featureName.indexOf(e)},showGlobalEnv(){this.showDebugDialog=!this.showDebugDialog,this.getTestCaseConfigs()},goBack(){this.$router.go(-1)},requestCaseFeatures(e){I.getFeatureTree(e).then(e=>{this.caseFeatures=e.data})},getCaseDetail(){x.getTestCaseDetail(this.caseId).then(e=>{this.caseName=e.data.testCaseName,this.serviceId=e.data.serviceId,this.caseDetail=e.data})}},created(){this.caseId=this.$route.query.caseId,this.getTestCaseConfigs(),this.getCaseDetail(),this.requestCaseFeatures(this.caseId)}},bt=ft,yt=(a("bd78"),a("1e02"),Object(y["a"])(bt,G,j,!1,null,"213450c7",null)),wt=yt.exports,kt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"mini",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.serviceId,callback:function(t){e.serviceId=t},expression:"serviceId"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1),t("el-form-item",{attrs:{label:"模版名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入模版名称"},on:{input:e.inputChange},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("手动创建模版")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:function(t){e.showUploadDialog=!e.showUploadDialog}}},[e._v("上传模版文件")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:e.triggerApiDialog}},[e._v("Api生成模版")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.templateData,size:"mini"}},[t("el-table-column",{attrs:{prop:"templateId",label:"模版ID"}}),t("el-table-column",{attrs:{prop:"name",label:"模版名称"}}),t("el-table-column",{attrs:{prop:"description",label:"模版描述"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"最近修改时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{align:"left",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.refreshTemplate(a.row)}}},[e._v("刷新")]),t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1),t("el-dialog",{attrs:{visible:e.showDialog,width:"85%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("template",{slot:"title"},[e._v(" "+e._s(e.dialogTitle)+" "),t("el-tooltip",{attrs:{effect:"dark",placement:"right-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 用例执行点是由模版拖拽而来，模版定义了执行点运行的基本参数。"),t("br"),e._v("执行点配置好参数值之后执行测试任务 ")]),t("span",[t("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"5px",cursor:"pointer","font-size":"15px"}})])])],1),t("TemplateConfig",{attrs:{isEdit:e.isEdit,config:e.infoForm,isCreate:e.isCreate,service:e.serviceId},on:{dataChange:e.templateChange,complete:e.closeDialog}})],2),t("el-dialog",{attrs:{visible:e.showUploadDialog,title:"模版扫描","destroy-on-close":!0,width:"60%"},on:{"update:visible":function(t){e.showUploadDialog=t}}},[e.parseData.length<=0?t("div",[t("el-upload",{attrs:{drag:"",action:"#","auto-upload":!0,"http-request":e.httpRequest}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jar文件")])])],1):t("div",[t("h3",[e._v("扫描结果")]),t("el-collapse",e._l(e.parseData,(function(a,s){return t("el-collapse-item",{key:s,attrs:{name:"1"}},[t("template",{slot:"title"},[e._v(" "+e._s(a.name)+" - "+e._s(a.description)+" ")]),t("TemplateConfig",{attrs:{isEdit:e.isEdit,config:a,service:e.serviceId},on:{dataChange:function(t){return e.uploadChange(t,s)}}})],2)})),1)],1),e.parseData.length>0?t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.deletePlugin}},[e._v("取消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submitTemplates}},[e._v("确定")])],1):e._e()]),t("el-dialog",{attrs:{visible:e.showAPIDialog,title:"API生成模版",width:"60%","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.showAPIDialog=t},close:e.closeApiGenerate}},[!e.previewData||e.previewData.length<1?t("div",[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-scrollbar",{staticStyle:{height:"100%"}},[t("div",{staticClass:"api-list"},[t("div",{staticClass:"api-title"},[e._v("「"+e._s(e.chooseService)+"」 接口列表")]),t("div",{staticClass:"filter"},[t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入api名称过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-tree",{ref:"apiTree",attrs:{data:e.apiTreeData,"show-checkbox":"","node-key":"apiId","check-on-click-node":!0,"filter-node-method":e.filterNode,props:e.apiProps},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("div",{staticClass:"tree-node"},[0==s.apiType?t("i",{staticClass:"el-icon-folder-opened folder-icon"}):e._e(),t("span",{staticClass:"api-name"},[e._v(e._s(a.label))])])}}],null,!1,1135173118)})],1)])],1),t("el-col",{attrs:{span:16}},[t("div",{staticClass:"api-title"},[e._v("生成配置")]),t("el-form",{attrs:{"label-width":"80px",size:"mini"},model:{value:e.generateForm,callback:function(t){e.generateForm=t},expression:"generateForm"}},[t("el-form-item",{attrs:{label:"是否覆盖"}},[t("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.generateForm.cover,callback:function(t){e.$set(e.generateForm,"cover",t)},expression:"generateForm.cover"}})],1),t("el-form-item",{attrs:{label:"调用方式"}},[t("el-radio-group",{model:{value:e.generateForm.invokeType,callback:function(t){e.$set(e.generateForm,"invokeType",t)},expression:"generateForm.invokeType"}},[t("el-radio",{attrs:{label:2}},[e._v("HTTP调用")]),t("el-radio",{attrs:{label:3}},[e._v("本地方法调用")])],1)],1),3==e.generateForm.invokeType?t("el-form-item",{attrs:{label:"关联模版"}},[t("el-select",{attrs:{placeholder:"请选择关联的模版",clearable:""},on:{change:e.selectTemplate},model:{value:e.generateForm.relatedId,callback:function(t){e.$set(e.generateForm,"relatedId",t)},expression:"generateForm.relatedId"}},e._l(e.uploadTemplates,(function(e){return t("el-option",{key:e.templateId,attrs:{label:e.name,value:e.templateId}})})),1)],1):e._e(),3==e.generateForm.invokeType?t("el-form-item",{attrs:{label:"类名"}},[t("span",[e._v(e._s(e.generateForm.className))])]):e._e(),3==e.generateForm.invokeType?t("el-form-item",{attrs:{label:"方法名"}},[t("span",[e._v(e._s(e.generateForm.methodName))])]):e._e(),3==e.generateForm.invokeType?t("el-alert",{attrs:{title:"请注意",type:"warning",closable:!1,description:"API生成模版参数是最终会组装成4个参数url、method、deader、body，自定义的模版请一定要提供对应的参数名称的入参，在实际执行阶段会根据参数名替换成对应的值。\n              如果在模版还需其他参数请使用默认参数配置到环境变量中去。","show-icon":""}}):e._e()],1)],1)],1)],1):t("div",[t("h3",[e._v("模版预览")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.showBatchOperate}},[e._v("批量操作")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.previewData,size:"mini"}},[t("el-table-column",{attrs:{prop:"name",label:"模版名称"}}),t("el-table-column",{attrs:{prop:"description",label:"模版描述"}}),t("el-table-column",{attrs:{align:"left",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.showTemplate(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deletePreviewTemp(a.$index)}}},[e._v("删除")])]}}])})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.previewData.length<1?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.nextStep}},[e._v("下一步")]):t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.upStep}},[e._v("上一步")]),t("el-button",{attrs:{size:"mini"},on:{click:e.closeApiGenerate}},[e._v("取 消")]),e.previewData.length>0?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveTemplates}},[e._v("生成模版")]):e._e()],1)]),t("el-dialog",{attrs:{visible:e.showBatchDialog,title:"模版批量操作",width:"60%","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.showBatchDialog=t}}},[t("div",{staticClass:"alert-info"},[t("el-alert",{attrs:{title:"批量操作所有模版",type:"info",description:"通过批量操作功能给所有的模版添加指定信息，比如可以给模版添加固定的Header信息，避免生成模版后手动操作提高效率。"}})],1),e._l(e.variableList,(function(a,s){return t("el-row",{key:s,staticClass:"param-line"},[t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名"},model:{value:a.paramKey,callback:function(t){e.$set(a,"paramKey",t)},expression:"item.paramKey"}})],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:2}},[t("el-select",{attrs:{size:"mini",placeholder:"参数位置"},model:{value:a.position,callback:function(t){e.$set(a,"position",t)},expression:"item.position"}},e._l(e.positionList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数描述"},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入默认值"},model:{value:a.initValue,callback:function(t){e.$set(a,"initValue",t)},expression:"item.initValue"}})],1),"Header"!=a.position?t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]):e._e(),"Header"!=a.position?t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{size:"mini",placeholder:"请选择参数类型"},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"item.type"}},e._l(e.paramTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"delete-icon"},[t("i",{staticClass:"el-icon-remove-outline op-icon",on:{click:function(t){return e.deleteItem(s)}}}),s==e.variableList.length-1?t("i",{staticClass:"el-icon-circle-plus-outline op-icon",on:{click:e.addItem}}):e._e()])])],1)})),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:function(t){e.showBatchDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.batchOperate}},[e._v("确 定")])],1)],2)],1)},Ct=[],_t={getTemplatePage(e,t,a,s){return new Promise((i,r)=>{let l=`/v1/devops/feature/${e}/templates/page?page=${t}&size=${a}&name=${s}`;g.get(l).then(e=>{i(e)}).catch(e=>{r(e)})})},getTemplateList(){return new Promise((e,t)=>{let a="/v1/devops/feature/templates";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getTemplate(e){return new Promise((t,a)=>{let s="/v1/devops/feature/template/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTemplateByType(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/types/${e}/templates`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createTemplate(e){return new Promise((t,a)=>{let s="/v1/devops/feature/template";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},batchCreateTemplate(e){return new Promise((t,a)=>{let s="/v1/devops/feature/templates";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deletePlugin(e){return new Promise((t,a)=>{let s="/v1/devops/feature/plugin/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},upload(e){return new Promise((t,a)=>{let s="/v1/devops/feature/template/upload";g.postFile(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTemplate(e){return new Promise((t,a)=>{let s="/v1/devops/feature/template";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTemplate(e){return new Promise((t,a)=>{let s="/v1/devops/feature/template/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},refresh(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/${e}/refresh`;g.put(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Ft=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"infoForm",attrs:{model:e.infoForm,rules:e.infoRule,size:"small",disabled:!e.isEdit,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"模版名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入模版名称"},on:{input:e.dataChange},model:{value:e.infoForm.name,callback:function(t){e.$set(e.infoForm,"name",t)},expression:"infoForm.name"}})],1),t("el-form-item",{attrs:{label:"模版类型",prop:"invokeType"}},[t("el-radio-group",{on:{change:e.dataChange},model:{value:e.infoForm.invokeType,callback:function(t){e.$set(e.infoForm,"invokeType",t)},expression:"infoForm.invokeType"}},[t("el-radio",{attrs:{label:1}},[e._v("本地方法调用")]),t("el-radio",{attrs:{label:2}},[e._v("HTTP调用")]),t("el-radio",{attrs:{label:3}},[e._v("关联模版")])],1)],1),t("el-form-item",{attrs:{label:1==e.infoForm.invokeType?"类名":"Url",prop:"service"}},[t("el-input",{attrs:{placeholder:"请输入"},model:{value:e.infoForm.service,callback:function(t){e.$set(e.infoForm,"service",t)},expression:"infoForm.service"}})],1),2==e.infoForm.invokeType?t("el-form-item",{attrs:{label:"请求header"}},e._l(e.headerList,(function(a,s){return t("el-row",{key:s},[t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入"},on:{input:e.dataChange},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:10}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入默认值"},on:{input:e.dataChange},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1),t("el-col",{attrs:{span:2}},[e.isEdit?t("i",{staticClass:"el-icon-remove-outline op-icon",on:{click:function(t){return e.removeHeader(s)}}}):e._e(),s==e.headerList.length-1&&e.isEdit?t("i",{staticClass:"el-icon-circle-plus-outline op-icon",on:{click:e.addHeader}}):e._e()])],1)})),1):e._e(),t("el-form-item",{attrs:{label:"方法",prop:"method"}},[1==e.infoForm.invokeType?t("el-input",{attrs:{placeholder:"请输入"},on:{input:e.dataChange},model:{value:e.infoForm.method,callback:function(t){e.$set(e.infoForm,"method",t)},expression:"infoForm.method"}}):t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.dataChange},model:{value:e.infoForm.method,callback:function(t){e.$set(e.infoForm,"method",t)},expression:"infoForm.method"}},e._l(e.httpMethods,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"参数列表"}},e._l(e.infoForm.params,(function(a,s){return t("el-row",{key:s},[t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名"},on:{input:e.dataChange},model:{value:a.paramKey,callback:function(t){e.$set(a,"paramKey",t)},expression:"item.paramKey"}})],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{placeholder:"请选择参数类型"},on:{change:e.dataChange},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"item.type"}},e._l(e.paramTypeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数描述"},on:{input:e.dataChange},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:2}},[t("el-select",{attrs:{placeholder:"参数位置"},on:{change:e.dataChange},model:{value:a.position,callback:function(t){e.$set(a,"position",t)},expression:"item.position"}},e._l(e.positionList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:1}},[t("div",{staticClass:"header-line"},[e._v("-")])]),t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入默认值"},on:{input:e.dataChange},model:{value:a.initValue,callback:function(t){e.$set(a,"initValue",t)},expression:"item.initValue"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"delete-icon"},[e.isEdit?t("i",{staticClass:"el-icon-remove-outline op-icon",on:{click:function(t){return e.deleteItem(s)}}}):e._e(),s==e.infoForm.params.length-1&&e.isEdit?t("i",{staticClass:"el-icon-circle-plus-outline op-icon",on:{click:e.addItem}}):e._e()])])],1)})),1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请输入模版功能描述",type:"textarea",autosize:{minRows:2,maxRows:4}},on:{input:e.dataChange},model:{value:e.infoForm.description,callback:function(t){e.$set(e.infoForm,"description",t)},expression:"infoForm.description"}})],1),e.isEdit?t("el-form-item",[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submit("infoForm")}}},[e._v("确定")]),t("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1):e._e()],1)],1)},xt=[],It={props:{config:Object,service:String,isEdit:Boolean,isCreate:{type:Boolean,default:!1}},watch:{service:{handler(e){this.serviceId=e},deep:!0,immediate:!0},config:{handler(e){let t=JSON.parse(JSON.stringify(e));if(t.headers&&Object.keys(t.headers).length>0){let e=[];Object.keys(t.headers).forEach(a=>{e.push({key:a,value:t.headers[a]})}),this.headerList=e}else this.headerList=[{key:"",value:""}];if(!t.params||0==t.params.length)return this.infoForm=t,void(this.infoForm.params=[{position:"Body"}]);t.params.forEach(e=>{this.isEmpty(e.initData)||(2==e.type&&(e.range=e.initData.range),e.initValue=e.initData.data)}),this.infoForm=t},deep:!0,immediate:!0}},data(){return{serviceId:"",infoForm:{},headerList:[],infoRule:{name:[{required:!0,message:"请输入模版名称",trigger:"blur"}],invokeType:[{required:!0,message:"请选择执行类型",trigger:"blur"}],service:[{required:!0,message:"此项不能为空",trigger:"blur"}],method:[{required:!0,message:"此项不能为空",trigger:"blur"}],description:[{required:!0,message:"模版描述不能为空",trigger:"blur"}]},options:[],paramTypeList:[{label:"String",value:"String"},{label:"Map",value:"Map"},{label:"Array",value:"Array"},{label:"Integer",value:"Integer"},{label:"Float",value:"Float"},{label:"Double",value:"Double"}],httpMethods:[{label:"Post",value:"Post"},{label:"Get",value:"Get"},{label:"Put",value:"Put"},{label:"Delete",value:"Delete"}],positionList:[{label:"Body",value:"Body"},{label:"Path",value:"Path"},{label:"Query",value:"Query"},{label:"Header",value:"Header"}]}},methods:{isEmpty(e){return!e||""==e||null==e},removeHeader(e){this.headerList.splice(e,1)},addHeader(){this.headerList.push({})},deleteItem(e){this.infoForm.params.splice(e,1)},addItem(){this.infoForm.params.push({position:"Body"})},dataChange(){let e=JSON.parse(JSON.stringify(this.infoForm));e.params.forEach(e=>{e.initData={data:e.initValue,range:e.range}});let t={};this.headerList.forEach(e=>{e.key||(e.key=""),e.value||(e.value=""),t[e.key]=e.value}),e.headers=t,this.$emit("dataChange",e)},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=JSON.parse(JSON.stringify(this.infoForm)),a=[];t.params.forEach(e=>{e.initData={data:e.initValue?e.initValue:""},2==e.type&&(e.initData.range=e.range),1==e.type&&this.isEmpty(e.value)&&(e.initData.data="{}"),e.paramKey&&a.push(e)}),t.params=a;let s={};this.headerList.length>0&&this.headerList.forEach(e=>{this.isEmpty(e.key)||this.isEmpty(e.value)||(s[e.key]=e.value)}),t.owner=this.serviceId,t.headers=s,this.isCreate?_t.createTemplate(t).then(()=>{this.$message.success({message:"添加成功",showClose:!0}),this.$emit("complete")}):_t.updateTemplate(t).then(()=>{this.$message.success({message:"修改成功",showClose:!0}),this.$emit("complete")})})},closeDialog(){this.infoForm={params:[{position:"Body"}]},this.$emit("complete")}}},Dt=It,Tt=(a("d7d14"),Object(y["a"])(Dt,Ft,xt,!1,null,"4fd846ce",null)),Pt=Tt.exports,St={components:{TemplateConfig:Pt},data(){return{templateData:[],queryForm:{},showDialog:!1,infoForm:{params:[{position:"Body"}]},dialogTitle:"添加执行点模版",isEdit:!1,currentPage:1,totalSize:0,showUploadDialog:!1,parseData:[],pluginId:"",serviceId:"",showAPIDialog:!1,apiTreeData:[],apiProps:{children:"children",label:"apiName"},generateForm:{invokeType:2},filterText:"",chooseService:"",previewData:[],uploadTemplates:[],isCreate:!1,pluginType:5,showBatchDialog:!1,variableList:[],paramTypeList:[{label:"String",value:"String"},{label:"Map",value:"Map"},{label:"Array",value:"Array"},{label:"Integer",value:"Integer"},{label:"Float",value:"Float"},{label:"Double",value:"Double"}],positionList:[{label:"Body",value:"Body"},{label:"Path",value:"Path"},{label:"Query",value:"Query"},{label:"Header",value:"Header"}]}},watch:{filterText(e){this.$refs.apiTree.filter(e)}},methods:{batchOperate(){let e=this.variableList.filter(e=>"Header"==e.position),t=this.variableList.filter(e=>"Header"!=e.position);const a={};e.forEach(e=>{a[e.paramKey]=e.initValue}),this.previewData.forEach(e=>{e.headers=e.headers?Object.assign({},e.headers,a):a,t.forEach(t=>{let a={paramKey:t.paramKey,type:t.type,description:t.description,position:t.position,initValue:{data:t.initValue}};e.params||(e.params=[]),e.params.push(a)})}),this.showBatchDialog=!1},deleteItem(e){this.variableList.splice(e,1)},addItem(){this.variableList.push({position:"Header"})},showBatchOperate(){this.showBatchDialog=!0,this.variableList=[{position:"Header"}]},selectTemplate(){this.generateForm.className="",this.generateForm.methodName="",this.uploadTemplates.forEach(e=>{e.templateId==this.generateForm.relatedId&&(this.generateForm.className=e.service,this.generateForm.methodName=e.method)})},saveTemplates(){let e={templates:this.previewData};_t.batchCreateTemplate(e).then(e=>{e.data?(this.$message.success("添加模版成功"),this.closeApiGenerate()):this.$message.error("添加模版失败")})},nextStep(){this.$refs.apiTree.getCheckedKeys().length<1?this.$message.warning("请先选择生成的api"):this.genarateApi()},upStep(){this.previewData=[]},deletePreviewTemp(e){this.previewData.splice(e,1)},showTemplate(e){console.log("show log",e),this.isEdit=!1,this.infoForm=e,this.showDialog=!0},genarateApi(){console.log(),F.generateTemplate({serviceId:this.serviceId,apiIds:this.$refs.apiTree.getCheckedKeys(),invokeType:this.generateForm.invokeType,relatedId:this.generateForm.relatedId,cover:this.generateForm.cover}).then(e=>{e.data.length>0?this.previewData=e.data:this.$message.warning("接口已存在用例，请选择可覆盖选项")})},closeApiGenerate(){this.getTemplatePage(),this.showAPIDialog=!1,this.generateForm={invokeType:2},this.previewData=[]},expendAllNode(){let e=this.$refs["apiTree"].store._getAllNodes();for(let t=0;t<e.length;t++)this.$refs["apiTree"].store._getAllNodes()[t].expanded=!0},triggerApiDialog(){this.showAPIDialog=!this.showAPIDialog,this.serviceList.forEach(e=>{e.serviceId==this.serviceId&&(this.chooseService=e.serviceName)}),this.getServiceApi(),_t.getTemplateByType(this.pluginType).then(e=>{this.uploadTemplates=e.data})},getServiceApi(){F.getApiList(this.serviceId).then(e=>{this.apiTreeData=this.buildTree(e.data),this.expendAllNode()})},buildTree(e,t=null){let a=[];for(let s of e)if(s.parentId===t){let t=this.buildTree(e,s.apiId);t.length>0&&(s.children=t),s.children||(s.children=[]),a.push(s)}return a},filterNode(e,t){return!e||-1!==t.apiName.indexOf(e)},selectService(){this.currentPage=1,this.getTemplatePage()},getServices(){this.serviceList=[],F.getServices().then(e=>{this.serviceList=e.data,this.serviceId=this.serviceList[0].serviceId,this.selectService()})},deletePlugin(){_t.deletePlugin(this.pluginId).then(e=>{e.data?this.$message.success("未使用插件，已清理相关数据"):this.$message.warning("未使用插件，清理数据错误")})},templateChange(e){this.infoForm=JSON.parse(JSON.stringify(e)),this.$forceUpdate()},submitTemplates(){let e={templates:this.parseData,pluginId:this.pluginId};_t.batchCreateTemplate(e).then(e=>{e.data?(this.$message.success("添加模版成功"),this.showUploadDialog=!1,this.parseData=[],this.pluginId="",this.getTemplatePage()):this.$message.error("添加模版失败")})},uploadChange(e,t){this.parseData[t]=e},httpRequest(e){const t=new FormData;t.append("file",e.file),t.append("serviceId",this.serviceId),_t.upload(t).then(e=>{e.data?(this.$message.success("上传文件成功"),this.parseData=e.data.templateDefines,this.pluginId=e.data.pluginId):this.$message.error("上传文件失败")})},removeHeader(e){this.infoForm.headers.splice(e,1)},addHeader(){this.infoForm.headers.push({})},inputChange(){this.currentPage=1,this.getTemplatePage()},pageChange(e){this.currentPage=e,this.getTemplatePage()},getTemplatePage(){let e=this.queryForm.name;e||(e=""),_t.getTemplatePage(this.serviceId,this.currentPage,10,e).then(e=>{this.templateData=e.data.data,this.totalSize=e.data.total})},startQuery(){this.currentPage=1,this.getTemplatePage()},startCreate(){this.isEdit=!0,this.isCreate=!0,this.showDialog=!this.showDialog,this.dialogTitle="手动创建模版",this.infoForm={params:[{position:"Body"}],invokeType:1,method:"",owner:this.serviceId}},refreshTemplate(e){_t.refresh(e.templateId).then(e=>{e.data?this.$message.success("刷新成功"):this.$message.error("刷新失败")})},handleEdit(e){this.isEdit=!0,this.isCreate=!1,this.showDialog=!0,this.dialogTitle="编辑模版",this.infoForm=e},handleDelete(e){this.$confirm(`确认删除模版【${e.name}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{_t.deleteTemplate(e.templateId).then(e=>{e.data?(this.$message.success("删除模版成功"),this.getTemplatePage()):this.$message.error("删除模版失败")})})},closeDialog(){this.showDialog=!1,this.isCreate=!1,this.infoForm={params:[{position:"Body"}]},this.getTemplatePage()}},created(){this.getServices()}},Lt=St,Nt=(a("5e2d"),Object(y["a"])(Lt,kt,Ct,!1,null,"f8649dea",null)),$t=Nt.exports,Et=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",{staticClass:"video-background"},[t("video",{attrs:{autoplay:"autoplay",loop:"loop",muted:"muted"},domProps:{muted:!0}},[t("source",{attrs:{src:a("b3ef"),type:"video/mp4"}})]),t("div",{staticClass:"login-div"},[t("div",{staticClass:"title"},[e._v("Windy")]),t("el-form",{staticClass:"form-div",attrs:{size:"small",model:e.loginForm,"label-width":"40px"}},[t("el-form-item",{staticClass:"form-line",attrs:{label:"用户",prop:"userName",size:"mini"}},[t("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.loginForm.userName,callback:function(t){e.$set(e.loginForm,"userName",t)},expression:"loginForm.userName"}})],1),t("el-form-item",{staticClass:"form-line",attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{"show-password":"",placeholder:"请输入密码"},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1)],1),t("div",{staticClass:"login-btn",on:{click:e.login}},[e._v("登录")]),t("div",{staticClass:"bottom-line"},[e._v("-便捷一站式Devops平台-")])],1)])])},zt=[],Rt={data(){return{loginForm:{}}},methods:{login(){v.login(this.loginForm).then(e=>{e.data.token&&(m.a.set("token",e.data.token,{expires:e.data.expireTime,path:"/login"}),this.$router.push({path:"/"}))})}}},Ot=Rt,At=(a("c942"),Object(y["a"])(Ot,Et,zt,!1,null,"6d29c4b0",null)),qt=At.exports,Bt=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title"},[t("el-page-header",{attrs:{content:"用户详情"},on:{back:e.goBack}})],1),t("el-tabs",{staticStyle:{height:"300px"},attrs:{"tab-position":"left"}},[t("el-tab-pane",{attrs:{label:"用户信息"}},[t("div",{staticClass:"logo-text"},[e._v(" "+e._s(e.logoName)+" ")]),t("el-form",{staticClass:"form-div",attrs:{size:"mini","label-position":"80px"},model:{value:e.userForm,callback:function(t){e.userForm=t},expression:"userForm"}},[t("el-form-item",{attrs:{label:"用户名称"}},[e._v(e._s(e.userForm.userName))]),t("el-form-item",{attrs:{label:"用户昵称"}},[e.isEdit?t("el-input",{staticClass:"edit-name",attrs:{placeholder:"请输入用户昵称"},on:{blur:e.updateNickName},model:{value:e.userForm.nickName,callback:function(t){e.$set(e.userForm,"nickName",t)},expression:"userForm.nickName"}}):t("span",[e._v(e._s(e.userForm.nickName)+" "),t("i",{staticClass:"el-icon-edit edit-icon",on:{click:e.startEdit}})])],1),t("el-form-item",{attrs:{label:"所属组织"}},[e._v("暂无")]),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-refresh"}},[e._v("重置密码")])],1)],1)],1)],1)],1)},Vt=[],Ut={data(){return{userForm:{},isEdit:!1,oldName:""}},computed:{logoName(){return this.userForm&&this.userForm.userName?this.userForm.userName.substring(0,1):""}},methods:{startEdit(){this.isEdit=!0,this.oldName=this.userForm.nickName},updateNickName(){this.oldName!=this.userForm.nickName?v.updateUser(this.userForm).then(e=>{e.data&&(this.$message.success("修改成功成功"),this.isEdit=!1)}):this.isEdit=!1},goBack(){this.$router.go(-1)},getUserInfo(){v.getUserDetail().then(e=>{console.log(e),this.userForm=e.data})}},created(){this.getUserInfo()}},Gt=Ut,jt=(a("5a9e"),Object(y["a"])(Gt,Bt,Vt,!1,null,"84dd1ca2",null)),Mt=jt.exports,Jt=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{staticStyle:{height:"600px",margin:"20px"},attrs:{"tab-position":"left"}},[t("el-tab-pane",{attrs:{label:"组织管理"}},[t("group")],1),t("el-tab-pane",{attrs:{label:"角色管理"}},[t("role")],1),t("el-tab-pane",{attrs:{label:"资源管理"}},[t("resource")],1)],1)],1)},Ht=[],Kt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("h3",[e._v("组织列表")]),t("div",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.trggerShow}},[e._v("新增组织")])],1),t("div",{staticClass:"group-div"},[t("el-tree",{attrs:{data:e.treeList},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("div",{staticStyle:{width:"100%"}},[t("span",[t("i",{staticClass:"el-icon-office-building"}),e._v(" "+e._s(a.label))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{attrs:{size:"mini"},on:{command:function(t){return e.handleCommand(t,s)}}},[t("span",[e._v("...")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")]),t("el-dropdown-item",{attrs:{command:"edit"}},[e._v("编辑")])],1)],1)],1)])}}])})],1)]),t("el-col",{attrs:{span:17}},[e.chooseGroup?t("div",[t("h3",[t("i",{staticClass:"el-icon-office-building"}),e._v(":"+e._s(e.chooseGroup.label))]),t("el-tabs",{staticStyle:{height:"600px"},attrs:{type:"card"},on:{"tab-click":e.clickTab},model:{value:e.chooseName,callback:function(t){e.chooseName=t},expression:"chooseName"}},[t("el-tab-pane",{attrs:{label:"用户管理",name:"user"}},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clickUser}},[e._v("新增用户")]),t("el-table",{attrs:{data:e.userTable,size:"mini",height:"300px"}},[t("el-table-column",{attrs:{prop:"userId",label:"用户Id"}}),t("el-table-column",{attrs:{prop:"userName",label:"用户名称"}}),t("el-table-column",{attrs:{prop:"gmtCreated",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.editUser(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.deleteUser(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.bindRole(a.row)}}},[e._v("绑定角色")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.groupUserPage,"page-sizes":[10,20,50],"page-size":e.groupUserSize,layout:"total, sizes, prev, pager, next, jumper",total:e.groupUserTotal},on:{"size-change":e.handleUserSizeChange,"current-change":e.handleUserPageChange}})],1),t("el-tab-pane",{attrs:{label:"角色管理",name:"role"}},[t("div",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.groupBind}},[e._v("绑定角色")])],1),t("div",[t("el-table",{attrs:{data:e.groupRoles,size:"mini",height:"300px"}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("h4",[e._v("功能列表:")]),t("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(a.row.resources,(function(e,a){return t("el-checkbox",{key:a,attrs:{label:e.name,checked:!0,disabled:""}})})),1)]}}])}),t("el-table-column",{attrs:{prop:"roleId",label:"角色ID"}}),t("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])})],1),t("el-pagination",{attrs:{"current-page":e.groupUserPage,"page-sizes":[10,20,50],"page-size":e.groupUserSize,layout:"total, sizes, prev, pager, next, jumper",total:e.groupUserTotal},on:{"size-change":e.handleUserSizeChange,"current-change":e.handleUserPageChange}})],1)])],1)],1):t("el-empty",{attrs:{description:"请在左侧选择组织"}})],1)],1),t("el-dialog",{attrs:{visible:e.showDialog,title:"创建组织"},on:{"update:visible":function(t){e.showDialog=t}}},[t("el-form",{attrs:{"label-width":"80px",size:"mini"},model:{value:e.groupForm,callback:function(t){e.groupForm=t},expression:"groupForm"}},[t("el-form-item",{attrs:{label:"组织名称"}},[t("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.groupForm.groupName,callback:function(t){e.$set(e.groupForm,"groupName",t)},expression:"groupForm.groupName"}})],1),t("el-form-item",{attrs:{label:"组织描述"}},[t("el-input",{attrs:{type:"testarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入组织描述"},model:{value:e.groupForm.description,callback:function(t){e.$set(e.groupForm,"description",t)},expression:"groupForm.description"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitGroup}},[e._v("确认")]),t("el-button",{attrs:{type:"info"}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{visible:e.showUserDialog,title:e.userTitle},on:{"update:visible":function(t){e.showUserDialog=t}}},[t("el-form",{attrs:{"label-width":"80px",size:"mini"},model:{value:e.userForm,callback:function(t){e.userForm=t},expression:"userForm"}},[t("el-form-item",{attrs:{label:"用户名称"}},[t("el-input",{attrs:{placeholder:"请输入用户名称"},model:{value:e.userForm.userName,callback:function(t){e.$set(e.userForm,"userName",t)},expression:"userForm.userName"}})],1),t("el-form-item",{attrs:{label:"密码"}},[t("el-input",{attrs:{placeholder:"请输入用户密码"},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1),t("el-form-item",{attrs:{label:"用户昵称"}},[t("el-input",{attrs:{placeholder:"请输入用户昵称"},model:{value:e.userForm.nickName,callback:function(t){e.$set(e.userForm,"nickName",t)},expression:"userForm.nickName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitUser}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.cancelUser}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"绑定角色",visible:e.showBindDialog,width:"60%"},on:{"update:visible":function(t){e.showBindDialog=t},close:e.cancelBind}},[t("el-form",{attrs:{size:"mini","label-width":"120px"},model:{value:e.bindForm,callback:function(t){e.bindForm=t},expression:"bindForm"}},[t("el-form-item",{attrs:{label:2==e.bindForm.userType?"组织ID":"用户ID"}},[t("el-input",{attrs:{placeholder:"请输入",disabled:""},model:{value:e.bindForm.relationId,callback:function(t){e.$set(e.bindForm,"relationId",t)},expression:"bindForm.relationId"}})],1),t("el-form-item",{attrs:{label:2==e.bindForm.userType?"组织名称":"用户名称"}},[t("el-input",{attrs:{placeholder:"请输入",disabled:""},model:{value:e.bindForm.name,callback:function(t){e.$set(e.bindForm,"name",t)},expression:"bindForm.name"}})],1),t("el-form-item",{attrs:{label:"用户类型"}},[t("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.bindForm.userType,callback:function(t){e.$set(e.bindForm,"userType",t)},expression:"bindForm.userType"}},[t("el-option",{attrs:{label:"用户",value:1}}),t("el-option",{attrs:{label:"组织",value:2}})],1)],1),t("el-form-item",{attrs:{label:"关联角色"}},[t("el-select",{attrs:{multiple:"",clearable:"",placeholder:"请选择角色"},model:{value:e.roleIds,callback:function(t){e.roleIds=t},expression:"roleIds"}},e._l(e.roleList,(function(e){return t("el-option",{key:e.roleId,attrs:{label:e.roleName,value:e.roleId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitBind}},[e._v("确定")]),t("el-button",{attrs:{type:"info"},on:{click:e.cancelBind}},[e._v("取消")])],1)],1)],1)],1)},Wt=[],Qt={getGroups(){return new Promise((e,t)=>{let a="/v1/devops/groups";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createGroup(e){return new Promise((t,a)=>{let s="/v1/devops/groups";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateGroup(e,t){return new Promise((a,s)=>{let i="/v1/devops/groups/"+e;g.put(i,t).then(e=>{a(e)}).catch(e=>{s(e)})})},deleteGroup(e){return new Promise((t,a)=>{let s="/v1/devops/groups/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getGroup(e){return new Promise((t,a)=>{let s="/v1/devops/groups/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getGroupUsers(e){return new Promise((t,a)=>{let s=`/v1/devops/groups/${e}/users`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Yt={getRoles(){return new Promise((e,t)=>{let a="/v1/devops/roles";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getAllRoles(){return new Promise((e,t)=>{let a="/v1/devops/role/all";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createRole(e){return new Promise((t,a)=>{let s="/v1/devops/roles";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},bindRole(e){return new Promise((t,a)=>{let s="/v1/devops/role/bind";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateRole(e){return new Promise((t,a)=>{let s="/v1/devops/roles/"+e.roleId;g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteRole(e){return new Promise((t,a)=>{let s="/v1/devops/roles/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getRole(e){return new Promise((t,a)=>{let s="/v1/devops/roles/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getGropRoles(e){return new Promise((t,a)=>{let s=`/v1/devops/groups/${e}/roles`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Xt={data(){return{treeList:[],title:"",showDialog:!1,groupForm:{},userTable:[],showUserDialog:!1,userForm:{},chooseGroup:null,showBindDialog:!1,bindForm:{},checkList:[],resourceList:[],roleList:[],chooseName:"user",groupRoles:[],edistUser:!1,userTitle:"创建用户",editGroup:!1,groupUserPage:1,groupUserSize:10,groupUserTotal:0,roleIds:[]}},methods:{handleUserSizeChange(e){this.groupUserSize=e,this.getGroupUsers()},handleUserPageChange(e){this.groupUserPage=e,this.getGroupUsers()},handleCommand(e,t){console.log(e,t),"delete"==e&&Qt.deleteGroup(t.id).then(e=>{e&&(this.$message.success("删除组织成功!"),this.getGroups())}),"edit"==e&&(this.showDialog=!0,this.editGroup=!0,this.groupForm=t.group)},groupBind(){this.bindForm={relationId:this.chooseGroup.id,name:this.chooseGroup.label,userType:2},this.getAllRoles(),this.showBindDialog=!0,this.getUserOrGroupRoles(this.chooseGroup.id)},getAllRoles(){Yt.getAllRoles().then(e=>{this.roleList=e.data})},submitBind(){this.bindForm.roleIds=this.roleIds,Yt.bindRole(this.bindForm).then(e=>{e&&(this.$message.success("绑定角色成功！"),this.getUserOrGroupRoles(this.chooseGroup.id,2),this.cancelBind())})},cancelBind(){this.showBindDialog=!1,this.bindForm={},this.roleList=[]},editUser(e){this.showUserDialog=!0,this.userForm=e,this.edistUser=!0,this.userTitle="编辑用户"},bindRole(e){this.getAllRoles(),this.showBindDialog=!0,this.getUserOrGroupRoles(e.userId,1),this.bindForm={userId:e.userId,relationId:e.userId,name:e.userName,userType:1}},clickUser(){this.showUserDialog=!0,this.userForm={},this.edistUser=!1,this.userTitle="创建用户"},handleNodeClick(e){this.chooseGroup=e,this.getGroupUsers(),this.getUserOrGroupRoles(this.chooseGroup.id)},trggerShow(){this.showDialog=!0},submitUser(){let e=this.userForm;e.groupId=this.chooseGroup.id,this.edistUser?v.updateUser(this.userForm).then(e=>{e&&(this.$message.success("修改用户成功"),this.showUserDialog=!1,this.getGroupUsers())}):v.createUser(this.userForm).then(e=>{e&&(this.$message.success("添加用户成功"),this.showUserDialog=!1,this.getGroupUsers())})},deleteUser(e){v.deleteUser(e.userId).then(e=>{e&&(this.$message.success("删除用户成功"),this.getGroupUsers())})},cancelUser(){this.showUserDialog=!1,this.userForm={}},submitGroup(){this.editGroup?Qt.updateGroup(this.groupForm.groupId,this.groupForm).then(e=>{e.data?(this.$message.success("修改组织成功"),this.showDialog=!1,this.getGroups()):this.$message.error("修改组织失败")}):Qt.createGroup(this.groupForm).then(e=>{e?(this.$message.success("添加组织成功"),this.showDialog=!1,this.getGroups()):this.$message.error("添加组织失败")})},cancelGroup(){this.editGroup=!1,this.showDialog=!1,this.groupForm={}},getGroups(){Qt.getGroups().then(e=>{this.treeList=[],e.data.forEach(e=>{this.treeList.push({label:e.groupName,id:e.groupId,group:e})})})},clickTab(e){"user"==e.name&&this.getGroupUsers(),"role"==e.name&&this.getUserOrGroupRoles(this.chooseGroup.id,2)},getUserOrGroupRoles(e){Yt.getGropRoles(e).then(e=>{this.groupRoles=e.data.data,this.roleIds=[],e.data.data&&e.data.data.forEach(e=>{this.roleIds.push(e.roleId)})})},getGroupUsers(){Qt.getGroupUsers(this.chooseGroup.id,this.groupUserPage,this.groupUserSize).then(e=>{this.userTable=e.data.data,this.groupUserTotal=e.data.total})}},created(){this.getGroups()}},Zt=Xt,ea=(a("afd5"),Object(y["a"])(Zt,Kt,Wt,!1,null,"0d8d7839",null)),ta=ea.exports,aa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addRole}},[e._v("新增角色")]),t("el-table",{attrs:{data:e.roleTable,size:"mini",height:"300px"}},[t("el-table-column",{attrs:{prop:"roleId",label:"用户Id"}}),t("el-table-column",{attrs:{prop:"roleName",label:"用户名称"}}),t("el-table-column",{attrs:{prop:"description",label:"用户名称"}}),t("el-table-column",{attrs:{prop:"gmtCreated",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.editRole(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteRole(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.showBind(a.row)}}},[e._v("绑定资源")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.rolePage,"page-sizes":[10,20,50],"page-size":e.roleSize,layout:"total, sizes, prev, pager, next, jumper",total:e.roleTotal},on:{"size-change":e.handleRoleSizeChange,"current-change":e.handleRolePageChange}}),t("el-dialog",{attrs:{title:e.title,visible:e.showRoleDialog,width:"30%","before-close":e.closeRoleDialog},on:{"update:visible":function(t){e.showRoleDialog=t}}},[t("el-form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.roleRule,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"角色名称"}},[t("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1),t("el-form-item",{attrs:{label:"角色描述"}},[t("el-input",{attrs:{type:"testarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入角色描述"},model:{value:e.roleForm.description,callback:function(t){e.$set(e.roleForm,"description",t)},expression:"roleForm.description"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitRole("roleForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:e.title,visible:e.showBindResource,width:"30%","before-close":e.closeResourceDialog},on:{"update:visible":function(t){e.showBindResource=t}}},[t("el-form",{attrs:{model:e.resourceForm,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"角色ID"}},[t("el-input",{model:{value:e.resourceForm.relationId,callback:function(t){e.$set(e.resourceForm,"relationId",t)},expression:"resourceForm.relationId"}})],1),t("el-form-item",{attrs:{label:"角色名称"}},[t("el-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.resourceForm.roleName,callback:function(t){e.$set(e.resourceForm,"roleName",t)},expression:"resourceForm.roleName"}})],1),t("el-form-item",{attrs:{label:"角色描述"}},[t("el-input",{attrs:{type:"testarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入角色描述"},model:{value:e.resourceForm.description,callback:function(t){e.$set(e.resourceForm,"description",t)},expression:"resourceForm.description"}})],1),t("el-form-item",{attrs:{label:"关联资源"}},[t("el-select",{attrs:{multiple:"",clearable:"",placeholder:"请选择资源"},model:{value:e.resourceIds,callback:function(t){e.resourceIds=t},expression:"resourceIds"}},e._l(e.resourceList,(function(e){return t("el-option",{key:e.resourceId,attrs:{label:e.resourceName,value:e.resourceId}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitBind}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeResourceDialog}},[e._v("取消")])],1)],1)],1)],1)},sa=[],ia={getResources(){return new Promise((e,t)=>{let a="/v1/devops/resources";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getAllResources(){return new Promise((e,t)=>{let a="/v1/devops/resource/all";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getRoleResources(e){return new Promise((t,a)=>{let s=`/v1/devops/roles/${e}/resources`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},bindResource(e){return new Promise((t,a)=>{let s="/v1/devops/resource/bind";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},createResource(e){return new Promise((t,a)=>{let s="/v1/devops/resources";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateResource(e){return new Promise((t,a)=>{let s="/v1/devops/resources/"+e.resourceId;g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteResource(e){return new Promise((t,a)=>{let s="/v1/devops/resources/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getResource(e){return new Promise((t,a)=>{let s="/v1/devops/resources/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getGropResources(e){return new Promise((t,a)=>{let s=`/v1/devops/groups/${e}/resources`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},ra={data(){return{roleTable:[],rolePage:1,roleSize:10,roleTotal:0,title:"创建角色",showRoleDialog:!1,showBindResource:!1,roleForm:{},isEdit:!1,resourceIds:[],resourceList:[],resourceForm:{},roleRule:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,message:"角色名称最少2个字符",trigger:"blur"}]}}},methods:{submitBind(){this.resourceForm.resourceIds=this.resourceIds,ia.bindResource(this.resourceForm).then(e=>{e.data?(this.$message.success("资源绑定成功"),this.closeResourceDialog()):this.$message.error("资源绑定失败")})},showBind(e){this.resourceForm=e,this.resourceForm.relationId=e.roleId,this.showBindResource=!0,this.getAllResource(),ia.getRoleResources(e.roleId).then(e=>{e.data&&(this.resourceIds=[],e.data.forEach(e=>{this.resourceIds.push(e.resourceId)}))})},closeResourceDialog(){this.resourceForm={},this.showBindResource=!1},getAllResource(){ia.getAllResources().then(e=>{this.resourceList=e.data})},closeRoleDialog(){this.showRoleDialog=!1,this.roleForm={},this.isEdit=!1},addRole(){this.showRoleDialog=!0,this.roleForm={}},submitRole(e){this.$refs[e].validate(e=>{if(!e)return!1;this.isEdit?Yt.updateRole(this.roleForm).then(e=>{e.data?(this.$message.success("修改角色成功"),this.getRoleList(),this.closeRoleDialog()):this.$message.error("修改角色失败")}):Yt.createRole(this.roleForm).then(e=>{e.data?(this.$message.success("创建角色成功"),this.getRoleList(),this.closeRoleDialog()):this.$message.error("创建角色失败")})})},editRole(e){this.showRoleDialog=!0,this.roleForm=e,this.isEdit=!0},deleteRole(e){Yt.deleteRole(e.roleId).then(e=>{e.data?(this.$message.success("删除角色成功"),this.getRoleList()):this.$message.error("删除角色失败")})},handleRoleSizeChange(e){this.roleSize=e,this.getRoleList()},handleRolePageChange(e){this.rolePage=e,this.getRoleList()},getRoleList(){Yt.getRoles(this.rolePage,this.roleSize).then(e=>{console.log("xxxx",e),this.roleTable=e.data.data,this.roleTotal=e.data.total})}},created(){this.getRoleList()}},la=ra,oa=(a("a5c6"),Object(y["a"])(la,aa,sa,!1,null,"15dada86",null)),na=oa.exports,ca=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addResource}},[e._v("新增资源")]),t("el-table",{attrs:{data:e.resourceTable,size:"mini",height:"300px"}},[t("el-table-column",{attrs:{prop:"resourceId",label:"资源ID"}}),t("el-table-column",{attrs:{prop:"resourceName",label:"资源名称名称"}}),t("el-table-column",{attrs:{prop:"content",label:"资源内容"}}),t("el-table-column",{attrs:{prop:"operate",label:"操作类型"}}),t("el-table-column",{attrs:{prop:"description",label:"资源描述"}}),t("el-table-column",{attrs:{prop:"gmtCreated",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.editResource(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){return e.deleteResource(a.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{"current-page":e.resourcePage,"page-sizes":[10,20,50],"page-size":e.resourceSize,layout:"total, sizes, prev, pager, next, jumper",total:e.resourceTotal},on:{"size-change":e.handleResourceSizeChange,"current-change":e.handleResourcePageChange}}),t("el-dialog",{attrs:{title:e.title,visible:e.showResourceDialog,width:"40%","before-close":e.closeResourceDialog},on:{"update:visible":function(t){e.showResourceDialog=t}}},[t("el-form",{ref:"resourceForm",attrs:{model:e.resourceForm,rules:e.resourceRule,"label-width":"120px",size:"mini"}},[t("el-form-item",{attrs:{label:"资源名称"}},[t("el-input",{attrs:{placeholder:"请输入资源名称"},model:{value:e.resourceForm.resourceName,callback:function(t){e.$set(e.resourceForm,"resourceName",t)},expression:"resourceForm.resourceName"}})],1),t("el-form-item",{attrs:{label:"资源描述"}},[t("el-input",{attrs:{type:"testarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入资源描述"},model:{value:e.resourceForm.description,callback:function(t){e.$set(e.resourceForm,"description",t)},expression:"resourceForm.description"}})],1),t("el-form-item",{attrs:{label:"资源操作类型"}},[t("el-select",{attrs:{placeholder:"请选择资源操作类型"},model:{value:e.resourceForm.operate,callback:function(t){e.$set(e.resourceForm,"operate",t)},expression:"resourceForm.operate"}},[t("el-option",{attrs:{label:"查询",value:"GET"}}),t("el-option",{attrs:{label:"创建",value:"POST"}}),t("el-option",{attrs:{label:"更新",value:"PUT"}}),t("el-option",{attrs:{label:"删除",value:"DELETE"}}),t("el-option",{attrs:{label:"任意",value:"*"}})],1)],1),t("el-form-item",{attrs:{label:"资源内容"}},[t("el-input",{attrs:{placeholder:"请输入资源名称"},model:{value:e.resourceForm.content,callback:function(t){e.$set(e.resourceForm,"content",t)},expression:"resourceForm.content"}})],1),t("el-form-item",{attrs:{label:"排序"}},[t("el-input-number",{attrs:{placeholder:"请输入资源名称"},model:{value:e.resourceForm.sortOrder,callback:function(t){e.$set(e.resourceForm,"sortOrder",t)},expression:"resourceForm.sortOrder"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitResource("resourceForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"}},[e._v("取消")])],1)],1)],1)],1)},da=[],ua={data(){return{resourceTable:[],resourcePage:1,resourceSize:10,resourceTotal:0,title:"创建资源",showResourceDialog:!1,resourceForm:{},isEdit:!1,resourceRule:{resourceName:[{required:!0,message:"请输入资源名称",trigger:"blur"},{min:2,message:"资源名称最少2个字符",trigger:"blur"}]}}},methods:{closeResourceDialog(){this.showResourceDialog=!1,this.resourceForm={},this.isEdit=!1},addResource(){this.showResourceDialog=!0,this.resourceForm={}},submitResource(e){this.$refs[e].validate(e=>{if(!e)return!1;this.isEdit?ia.updateResource(this.resourceForm).then(e=>{e.data?(this.$message.success("修改资源成功"),this.getResourceList(),this.closeResourceDialog()):this.$message.error("修改资源失败")}):ia.createResource(this.resourceForm).then(e=>{e.data?(this.$message.success("创建资源成功"),this.getResourceList(),this.closeResourceDialog()):this.$message.error("创建资源失败")})})},editResource(e){this.showResourceDialog=!0,this.resourceForm=e,this.isEdit=!0},deleteResource(e){ia.deleteResource(e.resourceId).then(e=>{e.data?(this.$message.success("删除资源成功"),this.getResourceList()):this.$message.error("删除资源失败")})},handleResourceSizeChange(e){this.resourceSize=e,this.getResourceList()},handleResourcePageChange(e){this.resourcePage=e,this.getResourceList()},getResourceList(){ia.getResources(this.resourcePage,this.resourceSize).then(e=>{console.log("xxxx",e),this.resourceTable=e.data.data,this.resourceTotal=e.data.total})}},created(){this.getResourceList()}},pa=ua,ma=(a("b49e"),Object(y["a"])(pa,ca,da,!1,null,"4576d8aa",null)),ha=ma.exports,ga={components:{group:ta,resource:ha,role:na},data(){return{}}},va=ga,fa=Object(y["a"])(va,Jt,Ht,!1,null,null,null),ba=fa.exports,ya=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-form",{attrs:{inline:!0,model:e.queryForm,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"任务名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入任务名称"},on:{input:e.startQuery},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增任务")])],1)],1),t("el-tabs",{on:{"tab-click":e.selectTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"任务管理",name:"first"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.taskData,size:"mini"}},[t("el-table-column",{attrs:{prop:"taskId",label:"任务Id"}}),t("el-table-column",{attrs:{prop:"taskName",label:"任务名称"}}),t("el-table-column",{attrs:{prop:"description",label:"任务状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isRunning?t("i",{staticClass:"el-icon-loading loading-status"}):t("span",[e._v("--")])]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-video-play",plain:""},on:{click:function(t){return e.startRun(a.row)}}},[e._v("执行")]),t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.editTask(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteTask(a.row)}}},[e._v("删除")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.taskCurrentPage,layout:"prev, pager, next",total:e.taskTotal},on:{"current-change":e.taskPageChange}})],1)],1),t("el-tab-pane",{attrs:{label:"任务记录",name:"second"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.recordData,size:"mini"}},[t("el-table-column",{attrs:{prop:"taskName",label:"任务名称"}}),t("el-table-column",{attrs:{prop:"statusName",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e._f("statusFormat")(a.row.status)}},[e._v(e._s(a.row.statusName))])]}}])}),t("el-table-column",{attrs:{prop:"userId",label:"执行人"}}),t("el-table-column",{attrs:{label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",[e._v(" "+e._s(e.dateFormat(a.row.updateTime)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[4==a.row.status?t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-video-pause",plain:""},on:{click:function(t){return e.stopRun(a.row)}}},[e._v("停止")]):e._e(),t("el-button",{attrs:{size:"mini",plain:""},on:{click:function(t){return e.showRecord(a.row)}}},[e._v("查看")]),t("el-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(t){return e.deleteTaskRecord(a.row)}}},[e._v("删除")])]}}])},[t("template",{slot:"header"},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-refresh"},on:{click:function(t){return e.getTaskRecords(1)}}},[e._v("刷新")])],1)],2)],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.recordCurrentPage,layout:"prev, pager, next",total:e.recordTotal},on:{"current-change":e.recordPageChange}})],1)],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.showDialog,width:"70%"},on:{"update:visible":function(t){e.showDialog=t},close:e.closeDialog}},[t("el-form",{ref:"taskForm",attrs:{model:e.taskForm,rules:e.taskRule,size:"small","label-width":"120px"}},[t("el-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[t("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.taskForm.taskName,callback:function(t){e.$set(e.taskForm,"taskName",t)},expression:"taskForm.taskName"}})],1),t("el-form-item",{attrs:{label:"任务描述",prop:"description"}},[t("el-input",{attrs:{placeholder:"请输入任务描述"},model:{value:e.taskForm.description,callback:function(t){e.$set(e.taskForm,"description",t)},expression:"taskForm.description"}})],1),t("el-form-item",{attrs:{label:"测试集类型"}},[t("el-radio-group",{on:{change:e.chooseType},model:{value:e.caseType,callback:function(t){e.caseType=t},expression:"caseType"}},[t("el-radio",{attrs:{label:1}},[e._v("功能测试集")]),t("el-radio",{attrs:{label:2}},[e._v("e2e测试集")])],1)],1),1==e.caseType?t("el-form-item",{attrs:{label:"选择服务",prop:"serviceId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectService},model:{value:e.taskForm.serviceId,callback:function(t){e.$set(e.taskForm,"serviceId",t)},expression:"taskForm.serviceId"}},e._l(e.services,(function(e){return t("el-option",{key:e.serviceId,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"选择任务集",prop:"testCaseId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectTestCase},model:{value:e.taskForm.testCaseId,callback:function(t){e.$set(e.taskForm,"testCaseId",t)},expression:"taskForm.testCaseId"}},e._l(e.testCases,(function(e){return t("el-option",{key:e.testCaseId,attrs:{label:e.testCaseName,value:e.testCaseId}})})),1)],1),t("el-form-item",{attrs:{label:"任务配置"}},[t("el-button",{staticClass:"sync-btn",attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.refreshConfig}},[e._v("同步测试集配置")]),t("monaco",{ref:"editer",attrs:{codes:e.jsonStr,readonly:!1},on:{change:e.dataChange}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("taskForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1)],1)},wa=[],ka={getTaskList(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/feature/tasks?page=${e}&pageSize=${t}&name=${a}`;g.get(r).then(e=>{s(e)}).catch(e=>{i(e)})})},getAllTaskList(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/${e}/tasks`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createTask(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTask(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskDetail(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},runTask(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task/"+e;g.post(s).then(e=>{t(e)}).catch(e=>{a(e)})})},stopTask(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task/stop/"+e;g.put(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTask(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskRecords(e,t){return new Promise((a,s)=>{let i=`/v1/devops/feature/task/records?page=${e}&pageSize=${t}`;g.get(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getTaskRecordDetail(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task/record/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTaskRecord(e){return new Promise((t,a)=>{let s="/v1/devops/feature/task/record/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskHistoryTree(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/task/records/${e}/history/tree`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskHistories(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/task/records/${e}/histories`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskRecordByTriggerId(e){return new Promise((t,a)=>{let s=`/v1/devops/feature/task/${e}/record`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Ca={components:{monaco:_e},data(){return{recordData:[],taskData:[],queryForm:{},taskForm:{},showDialog:!1,dialogTitle:"添加任务",isEdit:!1,activeName:"first",machineList:[],executeList:[],testCases:[],services:[],jsonStr:"",taskCurrentPage:1,taskTotal:0,recordCurrentPage:1,recordTotal:0,caseType:1,taskRule:{taskName:[{required:!0,message:"请输入任务名称",trigger:"blur"}],serviceId:[{required:!0,message:"请选择关联的服务",trigger:"select"}],testCaseId:[{required:!0,message:"请选择关联的测试集",trigger:"select"}]}}},methods:{chooseType(e){2==e&&(this.testCases=[],x.getE2EList().then(e=>{this.testCases=e.data}))},refreshConfig(){this.selectTestCase(this.taskForm.testCaseId)},dataChange(e){this.jsonStr=e},selectService(e){this.testCases=[],x.getTestCaseList(e,1,100).then(e=>{this.testCases=e.data.data})},selectTestCase(e){let t={};x.getTestCaseConfigs(e).then(e=>{e.data&&(e.data.forEach(e=>{t[e.paramKey]=this.exchangeType(e.paramType,e.value)}),this.jsonStr=JSON.stringify(t,null,3))})},exchangeType(e,t){switch(e){case"String":return t;case"List":return JSON.parse(t);case"Map":return JSON.parse(t);case"Integer":return parseInt(t);case"Float":return parseFloat(t);case"Double":return parseFloat(t)}return t},startRun(e){ka.runTask(e.taskId).then(e=>{e.data?this.$message.success("执行成功,请查看执行记录"):this.$message.error("任务执行失败")}),this.getTasks(this.taskCurrentPage,this.queryForm.name)},stopRun(e){ka.stopTask(e.recordId).then(()=>{this.$message.success("执行成功,请查看执行记录")}),this.getTasks(this.taskCurrentPage,this.queryForm.name),this.getTaskRecords(this.recordCurrentPage)},startQuery(){this.getTasks(1,this.queryForm.name)},startCreate(){this.showDialog=!0,this.taskForm={},this.isEdit=!1},editTask(e){this.isEdit=!0,this.taskForm=e,this.showDialog=!0,this.selectService(e.serviceId),this.jsonStr=JSON.stringify(JSON.parse(e.taskConfig),null,3),e.machines&&(this.executeList=JSON.parse(e.machines))},deleteTask(e){this.$confirm(`确认删除任务【${e.taskName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ka.deleteTask(e.taskId).then(e=>{e.data?(this.$message.success("删除成功"),this.getTasks(this.taskCurrentPage,this.queryForm.name)):this.$message.error("删除失败")})})},closeDialog(){this.showDialog=!1,this.taskForm={}},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;this.taskForm.machines=JSON.stringify(this.executeList),this.taskForm.taskConfig=this.jsonStr,this.isEdit?ka.updateTask(this.taskForm).then(e=>{this.closeDialog(),this.getTasks(1),1!=e.data?this.$message.warning("修改失败"):this.$message.success("修改成功")}):ka.createTask(this.taskForm).then(e=>{this.closeDialog(),this.getTasks(1),1!=e.data?this.$message.warning("添加失败"):this.$message.success("添加成功")})})},getServices(){this.services=[],F.getServices().then(e=>{this.services=e.data})},getTasks(e,t){t||(t=""),ka.getTaskList(e,10,t).then(e=>{this.taskTotal=e.data.total,this.taskCurrentPage=1,this.taskData=e.data.data})},getTaskRecords(e){ka.getTaskRecords(e,10).then(t=>{this.recordTotal=t.data.total,this.recordCurrentPage=e,this.recordData=t.data.data})},selectTab(){"first"==this.activeName&&this.getTasks(1,this.queryForm.name),"second"==this.activeName&&this.getTaskRecords(1)},taskPageChange(e){this.getTasks(e,this.queryForm.name)},recordPageChange(e){this.getTaskRecords(e)},showRecord(e){this.$router.push({path:"/record/detail",query:{recordId:e.recordId}})},deleteTaskRecord(e){ka.deleteTaskRecord(e.recordId).then(()=>{this.$message.success("删除成功"),this.getTaskRecords(this.recordCurrentPage)})},dateFormat(e){var t=new Date(e),a=t.getFullYear()+"-",s=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",i=t.getDate()+" ",r=t.getHours()+":",l=t.getMinutes()+":",o=t.getSeconds();return a+s+i+r+l+o}},created(){this.getServices(),this.getTasks(1,"")}},_a=Ca,Fa=(a("6888"),Object(y["a"])(_a,ya,wa,!1,null,"156ab5f5",null)),xa=Fa.exports,Ia=function(){var e=this,t=e._self._c;return t("div",{staticClass:"root-content"},[t("el-container",[t("el-aside",{staticClass:"left-content",style:{width:e.detailWidth+"px",height:e.asideHeight+"px"}},[t("div",{staticClass:"space-box"},[t("el-popover",{attrs:{placement:"right",width:"800",trigger:"click"},model:{value:e.showPop,callback:function(t){e.showPop=t},expression:"showPop"}},[t("spaceList",{on:{switchSpace:e.selecteSpace}}),e.isCollapse?t("div",{staticClass:"collapse-space",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(e.simpleSpaceName)+" ")]):t("div",{staticClass:"title-space",attrs:{slot:"reference"},slot:"reference"},[t("textview",{attrs:{text:e.spaceName,len:10}}),t("i",{staticClass:"el-icon-caret-bottom"})],1)],1)],1),t("div",{staticClass:"collapse-icon"},[t("i",{class:{"el-icon-arrow-left":!e.isCollapse,"el-icon-arrow-right":e.isCollapse,"left-icon":!0},on:{click:e.hideMenu}})]),t("el-menu",{attrs:{"default-active":"1","background-color":"#122037","text-color":"#fff","active-text-color":"#ffd04b",collapse:e.isCollapse},on:{select:e.selectMenu}},[t("el-menu-item",{attrs:{index:"1"}},[t("i",{staticClass:"el-icon-s-shop"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("需求")])]),t("el-menu-item",{attrs:{index:"2"}},[t("i",{staticClass:"el-icon-aim"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("缺陷")])]),t("el-menu-item",{attrs:{index:"3"}},[t("i",{staticClass:"el-icon-add-location"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("迭代")])])],1)],1),t("el-main",{ref:"mainContent",staticClass:"right-content"},[t("el-scrollbar",[1==e.showIndex?t("demand"):2==e.showIndex?t("bug"):t("iteration",{attrs:{id:e.spaceId}})],1)],1)],1)],1)},Da=[],Ta=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",{staticStyle:{width:"100%"}},[t("el-form",{attrs:{inline:!0,size:"mini"},model:{value:e.queryForm,callback:function(t){e.queryForm=t},expression:"queryForm"}},[t("el-form-item",{attrs:{label:"缺陷名称"}},[t("el-input",{attrs:{placeholder:"输入缺陷名称查询",clearable:""},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择缺陷状态"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.statusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.statusName,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.queryBugs}},[e._v("查询")])],1)],1),t("div",{staticClass:"bug-div"},[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"mini"},on:{click:e.createBug}},[e._v("新建缺陷")])],1)],1),t("div",{staticClass:"table-list"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"500"}},[t("el-table-column",{attrs:{prop:"bugName",label:"缺陷名称"}}),t("el-table-column",{attrs:{prop:"acceptor",label:"负责人"}}),t("el-table-column",{attrs:{prop:"status",label:"缺陷状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.exchangeStatusName(t.row.status))+" ")]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"提出时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"tag",label:"缺陷标签"}}),t("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.viewBug(a.row)}}},[e._v("查看")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":10,layout:"sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1),t("el-dialog",{attrs:{title:e.bugTitle,visible:e.showBugDialog,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.showBugDialog=t}}},[t("div",[t("bugDetail",{attrs:{edit:e.isEdit,bug:e.bugId},on:{cancel:e.closeBug}})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeBug}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitBug("bugForm")}}},[e._v("确 定")])],1)])],1)},Pa=[],Sa={getUserbugs(e,t){return new Promise((a,s)=>{let i=`/v1/devops/user/bugs?page=${e}&size=${t}`;g.get(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getBugList(e,t,a,s,i,r){return new Promise((l,o)=>{let n=`/v1/devops/bugs?page=${e}&size=${t}&name=${a}&status=${s}&spaceId=${i}&iterationId=${r}`;g.get(n).then(e=>{l(e)}).catch(e=>{o(e)})})},getIterationBugs(e){return new Promise((t,a)=>{let s=`/v1/devops/iterations/${e}/bugs`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getBugDetail(e){return new Promise((t,a)=>{let s="/v1/devops/bugs/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getBugStatuses(){return new Promise((e,t)=>{let a="/v1/devops/bug/statuses";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createBug(e){return new Promise((t,a)=>{let s="/v1/devops/bugs";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateBug(e){return new Promise((t,a)=>{let s="/v1/devops/bug";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})}},La=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"bugForm",attrs:{model:e.bugForm,size:"mini","label-width":"120px",rules:e.bugRule}},[t("el-form-item",{attrs:{label:"缺陷标题",prop:"bugName"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入缺陷标题"},model:{value:e.bugForm.bugName,callback:function(t){e.$set(e.bugForm,"bugName",t)},expression:"bugForm.bugName"}})],1),t("el-form-item",{attrs:{label:"负责人"}},[t("userSearch",{attrs:{user:e.bugForm.acceptorName},on:{chooseUser:e.selectUser}})],1),e.edit?t("el-form-item",{attrs:{label:"缺陷状态"}},[t("el-select",{attrs:{placeholder:"请选择缺陷状态"},model:{value:e.bugForm.status,callback:function(t){e.$set(e.bugForm,"status",t)},expression:"bugForm.status"}},e._l(e.statusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.statusName,value:e.value}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"缺陷级别",prop:"level"}},[t("el-select",{attrs:{placeholder:"请选择缺陷优先级"},model:{value:e.bugForm.level,callback:function(t){e.$set(e.bugForm,"level",t)},expression:"bugForm.level"}},[t("el-option",{attrs:{label:"P1",value:1}}),t("el-option",{attrs:{label:"P2",value:2}}),t("el-option",{attrs:{label:"P3",value:3}})],1)],1),t("el-form-item",{attrs:{label:"缺陷环境",prop:"environment"}},[t("el-input",{attrs:{placeholder:"请输入缺陷环境"},model:{value:e.bugForm.environment,callback:function(t){e.$set(e.bugForm,"environment",t)},expression:"bugForm.environment"}})],1),t("el-form-item",{attrs:{label:"bug现象",prop:"scene"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:12,maxRows:30},placeholder:"请输入详细描述缺陷信息"},model:{value:e.bugForm.scene,callback:function(t){e.$set(e.bugForm,"scene",t)},expression:"bugForm.scene"}})],1),t("el-form-item",{attrs:{label:"关联需求",prop:"demandId"}},[t("el-input",{attrs:{placeholder:"请输入关联的需求ID"},model:{value:e.bugForm.demandId,callback:function(t){e.$set(e.bugForm,"demandId",t)},expression:"bugForm.demandId"}})],1),t("el-form-item",{attrs:{label:"复现步骤",prop:"replayStep"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入缺陷的浮现步骤"},model:{value:e.bugForm.bugContent,callback:function(t){e.$set(e.bugForm,"bugContent",t)},expression:"bugForm.bugContent"}})],1),t("el-form-item",{attrs:{label:"预期结果",prop:"expectResult"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:4},placeholder:"请输入预期结果"},model:{value:e.bugForm.expectResult,callback:function(t){e.$set(e.bugForm,"expectResult",t)},expression:"bugForm.expectResult"}})],1),t("el-form-item",{attrs:{label:"实际结果",prop:"realResult"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:4},placeholder:"请输入实际结果"},model:{value:e.bugForm.realResult,callback:function(t){e.$set(e.bugForm,"realResult",t)},expression:"bugForm.realResult"}})],1),t("el-form-item",{attrs:{label:"标签"}},[t("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择标签"},model:{value:e.bugForm.tags,callback:function(t){e.$set(e.bugForm,"tags",t)},expression:"bugForm.tags"}},e._l(e.tagList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.text,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{size:"mini"},on:{click:e.closeBug}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitBug("bugForm")}}},[e._v("确 定")])],1)],1)],1)},Na=[],$a=function(){var e=this,t=e._self._c;return t("div",[t("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入用户名称搜索"},on:{select:e.handleSelect},model:{value:e.selectedUser,callback:function(t){e.selectedUser=t},expression:"selectedUser"}})],1)},Ea=[],za={props:{user:String},watch:{user:{immediate:!0,handler(e){console.log("接受到数据",e),this.selectedUser=e}}},data(){return{selectedUser:null}},methods:{querySearchAsync(e,t){v.queryUserByName(e).then(e=>{let a=[];e.data.forEach(e=>{e.value=e.userName,a.push(e)}),t(a)})},handleSelect(e){console.log(this.selectedUser),this.$emit("chooseUser",e)}},created(){this.selectedUser=this.user}},Ra=za,Oa=Object(y["a"])(Ra,$a,Ea,!1,null,null,null),Aa=Oa.exports,qa={components:{userSearch:Aa},props:{edit:Boolean,bug:String,iteration:{type:String,default:""}},watch:{edit:{handler(e){this.isEdit=e},deep:!0,immediate:!0},bug:{handler(e){this.bugId=e,this.bugForm={},this.getBug()},deep:!0,immediate:!0},iteration:{handler(e){this.iterationId=e},deep:!0,immediate:!0}},data(){return{spaceId:"",iterationId:"",bugForm:{},statusList:[],isEdit:!1,bugId:"",tagList:[{text:"个人缺陷",value:"个人缺陷"},{text:"数据分析",value:"数据分析"},{text:"客户定制",value:"客户定制"}],bugRule:{bugName:[{required:!0,message:"请输入缺陷名称",trigger:"blur"},{min:10,message:"缺陷名称最少10个字符",trigger:"blur"}],level:[{required:!0,message:"请选择缺陷优先级",trigger:"change"}]}}},methods:{selectUser(e){this.bugForm.acceptor=e.userId},getBug(){this.edit&&Sa.getBugDetail(this.bug).then(e=>{this.bugForm=e.data,this.$refs.bugForm&&this.$refs.bugForm.resetFields()})},getstatusList(){Sa.getBugStatuses().then(e=>{this.statusList=e.data})},closeBug(){this.bugForm={},this.$emit("cancel")},submitBug(e){this.$refs[e].validate(e=>{if(!e)return!1;this.bugForm.spaceId=this.spaceId,this.bugForm.iterationId=this.iterationId,this.edit?Sa.updateBug(this.bugForm).then(e=>{e.data?(this.$message.success("修改缺陷成功"),this.closeBug()):this.$message.error("修改缺陷失败")}):Sa.createBug(this.bugForm).then(e=>{e.data?(this.$message.success("创建缺陷成功"),this.closeBug()):this.$message.error("创建缺陷失败")})})}},created(){this.spaceId=this.$store.state.spaceId,this.isEdit=this.edit,this.getstatusList()}},Ba=qa,Va=Object(y["a"])(Ba,La,Na,!1,null,null,null),Ua=Va.exports,Ga={props:{space:{default:"",type:String}},components:{bugDetail:Ua},watch:{space:{handler(e){this.spaceId=e,this.getBugList(),console.log("bug里i iiiii")}}},data(){return{spaceId:"",tableData:[],queryForm:{name:"",status:""},statusList:[],bugForm:{},bugId:"",showBugDialog:!1,bugTitle:"创建缺陷",abilityList:["用户体验","功能增强","性能","可靠性","安全","运维"],currentPage:1,currentSize:10,total:0,isEdit:!1,bugRule:{bugName:[{required:!0,message:"请输入缺陷名称",trigger:"blur"},{min:10,message:"缺陷名称最少10个字符",trigger:"blur"}],level:[{required:!0,message:"请选择缺陷优先级",trigger:"change"}]}}},methods:{exchangeStatusName(e){let t="-";return this.statusList.forEach(a=>{a.value==e&&(t=a.statusName)}),t},queryBugs(){this.getBugList()},viewBug(e){this.showBugDialog=!0,this.bugId=e.bugId,this.isEdit=!0,this.bugTitle="缺陷详情"},createBug(){this.showBugDialog=!0,this.isEdit=!1,this.bugId="",this.bugTitle="创建详情"},handlePageChange(e){this.currentPage=e,this.getBugList()},handleSizeChange(e){this.currentSize=e,this.getBugList()},closeBug(){this.showBugDialog=!1,this.bugForm={},this.getBugList(),this.$refs.bugForm.resetFields()},submitBug(e){this.$refs[e].validate(e=>{if(!e)return!1;console.log("edit",this.isEdit),this.isEdit?Sa.updateBug(this.bugForm).then(e=>{e.data?(this.$message.success("修改缺陷成功"),this.getBugList(),this.closeBug()):this.$message.error("修改缺陷失败")}):Sa.createBug(this.bugForm).then(e=>{e.data?(this.$message.success("创建缺陷成功"),this.getBugList(),this.closeBug()):this.$message.error("创建缺陷失败")})})},getBugList(){this.spaceId||(this.spaceId=""),Sa.getBugList(this.currentPage,this.currentSize,this.queryForm.name,this.queryForm.status,this.spaceId,"").then(e=>{console.log(e),this.tableData=e.data.data,this.total=e.data.total})},getstatusList(){Sa.getBugStatuses().then(e=>{this.statusList=e.data})}},created(){this.spaceId=this.$store.state.spaceId,this.getBugList(),this.getstatusList()}},ja=Ga,Ma=(a("18f6"),Object(y["a"])(ja,Ta,Pa,!1,null,"7452f2dc",null)),Ja=Ma.exports,Ha=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("el-container",{staticStyle:{width:"100%"}},[t("el-aside",{style:{width:e.detailWidth+"px"},attrs:{id:"resize"}},[t("div",{staticClass:"top-op"},[t("el-row",[t("el-col",{attrs:{span:20}},[t("div",{staticClass:"create-line",on:{click:e.showIterationDialog}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 创建 ")])]),t("el-col",{attrs:{span:4}},[t("div",{staticClass:"op-div"},[t("i",{staticClass:"el-icon-search"})])])],1)],1),t("el-scrollbar",e._l(e.iterationList,(function(a,s){return t("div",{key:s,staticClass:"iteration-div",on:{click:function(t){return e.clickIteration(a)}}},[t("div",{staticClass:"title"},[t("text-view",{attrs:{text:a.name,len:30}})],1),t("div",{staticClass:"period"},[e._v(" 周期: "+e._s(e._f("dayFormat")(a.startTime))+" ~ "+e._s(e._f("dayFormat")(a.endTime))+" ")]),t("div",{staticClass:"split-line"}),t("div",{staticClass:"status"},[e._v(" 状态: "),t("el-tag",{attrs:{size:"mini",type:e.matchStatus(a.status).type}},[e._v(" "+e._s(e.matchStatus(a.status).name)+" ")])],1),t("div",{staticClass:"op-div"},[t("el-dropdown",{attrs:{size:"mini",placement:"right-start"},on:{command:function(t){return e.selectCommand(t,a)}}},[t("span",[t("i",{staticClass:"el-icon-s-tools"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"edit"}},[e._v("编辑")])],1)],1)],1)])})),0)],1),t("div",{staticClass:"split-div"},[t("div",{staticClass:"dragWidth",attrs:{id:"set_menu_width"},on:{click:e.dragControllerDiv}}),t("i",{class:{"el-icon-arrow-left":!e.isCollapse,"el-icon-arrow-right":e.isCollapse,"left-icon":!0},on:{click:e.hideMenu}})]),t("el-main",[null==e.iterationInfo?t("el-empty",{attrs:{description:"请在左侧选择迭代"}}):t("div",{staticClass:"main-content"},[t("div",{staticClass:"content-title"},[e._v(" "+e._s(e.iterationInfo.name)+" ")]),t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"概览",name:"review"}},[t("div",{staticClass:"review-div"},[t("div",{staticClass:"ui-container"},[t("div",{staticClass:"ui-item"},[t("div",{staticClass:"title"},[e._v("需求个数")]),t("span",[e._v(e._s(e.statistic.demandCount))])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"title"},[e._v("缺陷个数")]),t("span",[e._v(e._s(e.statistic.bugCount))])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"title"},[e._v("任务个数")]),t("span",[e._v(e._s(e.statistic.workCount))])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"title"},[e._v("总工时")]),t("span",[e._v(e._s(e.statistic.workload))])])]),t("div",{staticClass:"step-line"},[t("div",[e._v("里程碑")]),t("el-steps",{attrs:{active:0,"align-center":""}},[t("el-step",{attrs:{title:"需求评审"}},[t("div",{attrs:{slot:"description"},slot:"description"},[e._v("08-08")])]),t("el-step",{attrs:{title:"技术评审"}},[t("div",{attrs:{slot:"description"},slot:"description"},[e._v("08-08")])]),t("el-step",{attrs:{title:"开发研发"}},[t("div",{attrs:{slot:"description"},slot:"description"},[e._v("08-08")])]),t("el-step",{attrs:{title:"提测"}},[t("div",{attrs:{slot:"description"},slot:"description"},[e._v("08-08")])]),t("el-step",{attrs:{title:"发布"}},[t("div",{attrs:{slot:"description"},slot:"description"},[e._v("08-08")])])],1)],1),t("div",{staticClass:"bottom-line"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"desc-box"},[t("el-descriptions",{attrs:{size:"medium",title:"迭代信息",column:1}},[t("el-descriptions-item",[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-s-opportunity"}),e._v(" 迭代ID ")]),e._v(" "+e._s(e.iterationInfo.iterationId)+" ")]),t("el-descriptions-item",[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-turn-off"}),e._v(" 状态 ")]),t("el-tag",{attrs:{size:"mini",type:e.matchStatus(e.iterationInfo.status).type}},[e._v(" "+e._s(e.matchStatus(e.iterationInfo.status).name)+" ")])],1),t("el-descriptions-item",[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-date"}),e._v(" 迭代周期 ")]),e._v(" "+e._s(e._f("dayFormat")(e.iterationInfo.startTime))+" ~ "+e._s(e._f("dayFormat")(e.iterationInfo.endTime))+" ")]),t("el-descriptions-item",[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-receiving"}),e._v(" 描述 ")]),e._v(" "+e._s(e.iterationInfo.description)+" ")]),t("el-descriptions-item",[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-s-custom"}),e._v(" 成员 ")])])],1)],1)]),t("el-col",{attrs:{span:16}},[t("div",{staticClass:"iteration-comment"},[t("div",{staticClass:"comment-title"},[e._v("迭代动态")]),t("div",{staticClass:"comments-div"},[t("div",[t("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:20},placeholder:"请输入您对需求的讨论"},model:{value:e.commentMsg,callback:function(t){e.commentMsg=t},expression:"commentMsg"}})],1),t("div",{staticClass:"commit-btn"},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addComment}},[e._v("添加评论")])],1)]),t("el-scrollbar",[t("div",{staticClass:"comment-list"},e._l(e.comments,(function(a,s){return t("div",{key:s,staticClass:"history"},[t("div",{staticClass:"user-div"},[t("span",[t("i",{staticClass:"el-icon-s-custom"})]),e._v(" "+e._s(a.userName)+" "+e._s(e._f("dateFormat")(a.createTime))+" ")]),t("div",{staticClass:"history-content"},[e._v(" "+e._s(a.comment)+" ")])])})),0)])],1)])],1)],1)])]),t("el-tab-pane",{attrs:{label:"需求",name:"demand"}},[t("iterationDemand",{attrs:{iteration:e.iterationInfo.iterationId}})],1),t("el-tab-pane",{attrs:{label:"缺陷",name:"bug"}},[t("iterationBug",{attrs:{iteration:e.iterationInfo.iterationId}})],1),t("el-tab-pane",{attrs:{label:"看板",name:"card"}},[t("div",{staticClass:"card-div"},[t("div",{staticClass:"card-title"},[e._v(" 展示类型： "),t("el-dropdown",{attrs:{placement:"bottom-end"},on:{command:e.cardCommand}},[t("span",{staticClass:"down-text"},[e._v(" "+e._s(e.showCardtype)),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"demand"}},[e._v("需求")]),t("el-dropdown-item",{attrs:{command:"bug"}},[e._v("缺陷")])],1)],1)],1),t("div",{staticClass:"col-list"},e._l(e.cardData,(function(a,s){return t("div",{key:s,staticClass:"card-col"},[t("div",{staticClass:"card-col-title"},[e._v(" "+e._s(a.name)+" ("+e._s(a.data.length)+") ")]),t("div",e._l(a.data,(function(a,s){return t("div",{key:s,staticClass:"card-item"},[t("div",{staticClass:"card-type"},[e._v("s")]),e._v(" "+e._s(a.name)+" "),t("div",{staticClass:"tag-div"},[e._l(a.selectTag,(function(a,s){return t("div",{key:s,staticClass:"tag-inline",style:{"background-color":a.statusColor,"border-color":a.statusColor}},[e._v(" "+e._s(a.statusName)+" ")])})),t("el-popover",{attrs:{placement:"right",width:"200",trigger:"click"},model:{value:a.showPop,callback:function(t){e.$set(a,"showPop",t)},expression:"it.showPop"}},[e._l(e.tagList,(function(s,i){return t("div",{key:i,staticClass:"tag-info",on:{click:function(t){return e.clickTag(s,a)}}},[t("div",{staticClass:"tag-line cycle",style:{"background-color":s.statusColor}}),t("div",{staticClass:"tag-line"},[e._v(e._s(s.statusName))])])})),t("div",{staticClass:"plus-div",attrs:{slot:"reference"},slot:"reference"},[e._v("+")])],2)],2)])})),0)])})),0)])])],1)],1)],1)],1),t("el-dialog",{attrs:{title:"创建迭代",visible:e.showIteration,width:"40%","before-close":e.closeIteration},on:{"update:visible":function(t){e.showIteration=t}}},[t("el-form",{ref:"iterationForm",attrs:{model:e.iterationForm,rules:e.iterationRule,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"迭代名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"请输入迭代名称"},model:{value:e.iterationForm.name,callback:function(t){e.$set(e.iterationForm,"name",t)},expression:"iterationForm.name"}})],1),t("el-form-item",{attrs:{label:"迭代周期",prop:"selectedDate",rules:[{required:!0,message:"迭代执行时间点不能为空",trigger:"select"}]}},[t("el-date-picker",{attrs:{type:"daterange","value-format":"timestamp","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.iterationForm.selectedDate,callback:function(t){e.$set(e.iterationForm,"selectedDate",t)},expression:"iterationForm.selectedDate"}})],1),t("el-form-item",{attrs:{label:"迭代描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"请输入迭代描述"},model:{value:e.iterationForm.description,callback:function(t){e.$set(e.iterationForm,"description",t)},expression:"iterationForm.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeIteration}},[e._v("取 消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitIteration("iterationForm")}}},[e._v("确 定")])],1)],1)],1)},Ka=[],Wa=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"},model:{value:e.queryForm,callback:function(t){e.queryForm=t},expression:"queryForm"}},[t("el-form-item",{attrs:{label:"需求名称"}},[t("el-input",{attrs:{placeholder:"输入需求名称查询",clearable:""},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择需求状态"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.statusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.statusName,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.queryDemands}},[e._v("查询")])],1)],1),t("div",{staticClass:"demand-div"},[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"mini"},on:{click:e.createDemand}},[e._v("新建需求")])],1)],1),t("div",{staticClass:"table-list"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"600"}},[t("el-table-column",{attrs:{prop:"demandName",label:"需求名称"}}),t("el-table-column",{attrs:{prop:"proposer",label:"提出人",width:"180"}}),t("el-table-column",{attrs:{prop:"status",label:"需求状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.exchangeStatusName(t.row.status))+" ")]}}])}),t("el-table-column",{attrs:{prop:"expectTime",label:"期待结束时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-date"}),e._v(" "+e._s(e._f("dayFormat")(a.row.expectTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"tag",label:"需求标签"}}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.viewDemand(a.row)}}},[e._v("查看")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":10,layout:"sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1),t("el-dialog",{attrs:{title:e.demandTitle,visible:e.showDemandDialog,width:"80%"},on:{"update:visible":function(t){e.showDemandDialog=t}}},[t("div",{staticStyle:{height:"100%"}},[t("el-form",{ref:"demandForm",attrs:{model:e.demandForm,size:"mini","label-width":"120px",rules:e.demandRule}},[t("el-form-item",{attrs:{label:"需求标题",prop:"demandName"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入需求标题"},model:{value:e.demandForm.demandName,callback:function(t){e.$set(e.demandForm,"demandName",t)},expression:"demandForm.demandName"}})],1),t("el-form-item",{attrs:{label:"需求描述",prop:"demandContent"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:12,maxRows:30},placeholder:"请输入需求的详细描述"},model:{value:e.demandForm.demandContent,callback:function(t){e.$set(e.demandForm,"demandContent",t)},expression:"demandForm.demandContent"}})],1),t("el-form-item",{attrs:{label:"附件"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/",multiple:"",limit:3,"file-list":e.demandForm.fileList}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("上传附件")])],1)],1),t("el-form-item",{attrs:{label:"需求价值",prop:"customerValue"}},[t("el-select",{attrs:{placeholder:"请选择需求价值"},model:{value:e.demandForm.customerValue,callback:function(t){e.$set(e.demandForm,"customerValue",t)},expression:"demandForm.customerValue"}},e._l(e.abilityList,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"需求优先级",prop:"level"}},[t("el-select",{attrs:{placeholder:"请选择需求优先级"},model:{value:e.demandForm.level,callback:function(t){e.$set(e.demandForm,"level",t)},expression:"demandForm.level"}},[t("el-option",{attrs:{label:"P1",value:1}}),t("el-option",{attrs:{label:"P2",value:2}}),t("el-option",{attrs:{label:"P3",value:3}})],1)],1),t("el-form-item",{attrs:{label:"提出人"}},[t("el-input",{attrs:{placeholder:"提出人"},model:{value:e.demandForm.proposer,callback:function(t){e.$set(e.demandForm,"proposer",t)},expression:"demandForm.proposer"}})],1),t("el-form-item",{attrs:{label:"接受人"}},[t("el-input",{attrs:{placeholder:"接受人"},model:{value:e.demandForm.acceptor,callback:function(t){e.$set(e.demandForm,"acceptor",t)},expression:"demandForm.acceptor"}})],1),t("el-form-item",{attrs:{label:"期待完成时间",prop:"expectTime"}},[t("el-date-picker",{attrs:{align:"right",type:"date","value-format":"timestamp",placeholder:"选择日期"},model:{value:e.demandForm.expectTime,callback:function(t){e.$set(e.demandForm,"expectTime",t)},expression:"demandForm.expectTime"}})],1),t("el-form-item",{attrs:{label:"工作量(人/日)",prop:"workload"}},[t("el-input",{attrs:{placeholder:"请输入工作量"},model:{value:e.demandForm.workload,callback:function(t){e.$set(e.demandForm,"workload",t)},expression:"demandForm.workload"}})],1),t("el-form-item",{attrs:{label:"标签"}},[t("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择标签"},model:{value:e.demandForm.tag,callback:function(t){e.$set(e.demandForm,"tag",t)},expression:"demandForm.tag"}},e._l(e.tagList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.text,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeDemand}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitDemand("demandForm")}}},[e._v("确 定")])],1)],1)]),t("el-dialog",{attrs:{title:e.demandTitle,visible:e.showDemandDetail,width:"90%"},on:{"update:visible":function(t){e.showDemandDetail=t}}},[t("detail",{attrs:{demand:e.demandDetail.demandId}})],1)],1)},Qa=[],Ya={getUserDemands(e,t){return new Promise((a,s)=>{let i=`/v1/devops/user/demands?page=${e}&size=${t}`;g.get(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getIterationDemandList(e){return new Promise((t,a)=>{let s=`/v1/devops/iterations/${e}/demands`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getDemandList(e,t,a,s,i,r){return new Promise((l,o)=>{let n=`/v1/devops/demands?page=${e}&size=${t}&name=${a}&status=${s}&spaceId=${i}&iterationId=${r}`;g.get(n).then(e=>{l(e)}).catch(e=>{o(e)})})},getDemandDetail(e){return new Promise((t,a)=>{let s="/v1/devops/demands/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getDemandTags(){return new Promise((e,t)=>{let a="/v1/devops/demand/tags";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getDemandStatuses(){return new Promise((e,t)=>{let a="/v1/devops/demand/statuses";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createDemand(e){return new Promise((t,a)=>{let s="/v1/devops/demands";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateDemand(e){return new Promise((t,a)=>{let s="/v1/devops/demand";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})}},Xa=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title-line"},[t("div",{staticClass:"btn-list"},[e.isEdit?e._e():t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(t){e.isEdit=!e.isEdit}}},[e._v("编辑")]),e.isEdit?t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-circle-close"},on:{click:function(t){e.isEdit=!e.isEdit}}},[e._v("取消")]):e._e(),e.isEdit?t("el-button",{attrs:{size:"mini",icon:"el-icon-s-promotion",type:"primary"},on:{click:e.submitInfo}},[e._v("提交")]):e._e()],1)]),t("el-row",[t("el-col",{attrs:{span:14}},[t("el-form",{attrs:{model:e.demandForm,size:"mini","label-width":"80px"}},[t("el-form-item",{attrs:{label:"需求ID"}},[t("span",[e._v(e._s(e.demandForm.demandId)+" "),t("el-tooltip",{attrs:{effect:"dark",content:"复制需求ID",placement:"right-start"}},[t("i",{staticClass:"copy-icon el-icon-document-copy",attrs:{"data-clipboard-text":e.demandForm.demandId}})])],1)]),t("el-form-item",{attrs:{label:"需求标题"}},[t("span",[e._v(e._s(e.demandForm.demandName))])]),t("el-form-item",{attrs:{label:"客户价值"}},[t("span",[e._v(e._s(e.demandForm.customerValue))])]),t("el-form-item",{attrs:{label:"需求描述"}},[t("el-input",{attrs:{type:"textarea",disabled:!e.isEdit,autosize:{minRows:8,maxRows:20},placeholder:"请输入需求的详细描述"},model:{value:e.demandForm.demandContent,callback:function(t){e.$set(e.demandForm,"demandContent",t)},expression:"demandForm.demandContent"}})],1),t("el-form-item",{attrs:{label:"附件"}},[e._v(" xxxx.doc ")])],1),t("div",{staticClass:"comments-div"},[t("div",[t("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:20},placeholder:"请输入您对需求的讨论"},model:{value:e.commentMsg,callback:function(t){e.commentMsg=t},expression:"commentMsg"}})],1),t("div",{staticClass:"commit-btn"},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.addComment}},[e._v("添加评论")])],1)]),t("div",{staticClass:"comment-list"},e._l(e.comments,(function(a,s){return t("div",{key:s,staticClass:"history"},[t("div",{staticClass:"user-div"},[t("span",[t("i",{staticClass:"el-icon-s-custom"})]),e._v(" "+e._s(a.userName)+" "+e._s(e._f("dateFormat")(a.createTime))+" ")]),t("div",{staticClass:"history-content"},[e._v(" "+e._s(a.comment)+" ")])])})),0)],1),t("el-col",{attrs:{span:8}},[t("el-form",{attrs:{model:e.demandForm,"label-width":"120px",size:"mini"}},[t("el-form-item",{attrs:{label:"提出人"}},[t("span",[e._v(e._s(e.demandForm.proposerName))])]),t("el-form-item",{attrs:{label:"接受人"}},[t("userSearch",{attrs:{user:e.demandForm.acceptorName},on:{chooseUser:e.selectUser}})],1),t("el-form-item",{attrs:{label:"截止时间",disabled:""}},[t("el-date-picker",{attrs:{disabled:"",align:"right",type:"date",placeholder:"选择日期"},model:{value:e.completeDate,callback:function(t){e.completeDate=t},expression:"completeDate"}})],1),t("el-form-item",{attrs:{label:"工作量",disabled:""}},[t("el-input",{attrs:{disabled:"",placeholder:"请输入工作量(人/日)"},model:{value:e.demandForm.workload,callback:function(t){e.$set(e.demandForm,"workload",t)},expression:"demandForm.workload"}})],1),t("el-form-item",{attrs:{label:"标签"}},[t("el-select",{attrs:{filterable:"",disabled:!e.isEdit,"allow-create":"","default-first-option":"",placeholder:"请选择标签"},model:{value:e.demandForm.tag,callback:function(t){e.$set(e.demandForm,"tag",t)},expression:"demandForm.tag"}},e._l(e.tagList,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"需求状态"}},[t("el-select",{attrs:{disabled:!e.isEdit,placeholder:"请选择状态"},on:{change:e.statusChange},model:{value:e.demandForm.status,callback:function(t){e.$set(e.demandForm,"status",t)},expression:"demandForm.status"}},e._l(e.statusOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.statusName,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"搁置天数"}},[e._v(" 3 ")])],1)],1)],1)],1)},Za=[],es=a("b311"),ts=a.n(es),as={getComments(e){return new Promise((t,a)=>{let s=`/v1/devops/${e}/comments`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createComment(e){return new Promise((t,a)=>{let s="/v1/devops/comments";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateDemand(e){return new Promise((t,a)=>{let s="/v1/devops/comments";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteComment(e){return new Promise((t,a)=>{let s=`/v1/devops/${e}/comment`;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},ss={props:{demand:{type:String}},components:{userSearch:Aa},watch:{demand:{handler(e){this.demandId=e,this.init()}}},data(){return{demandForm:{},demandId:"",tagList:["个人需求","数据分析","客户定制"],abilityList:["用户体验","功能增强","性能","可靠性","安全","运维"],commentMsg:"",refuseReason:"",isRefuse:!1,completeDate:null,isEdit:!1,statusOptions:[],comments:[]}},methods:{selectUser(e){this.demandForm.acceptor=e.userId},submitInfo(){Ya.updateDemand(this.demandForm).then(e=>{e.data?(this.$message.success("更新成功"),this.isEdit=!1):this.$message.error("更新失败")})},initCopy(){let e=this,t=new ts.a(".copy-icon");t.on("success",(function(){e.$message.success("复制成功")})),t.on("error",(function(){e.$message.success("复制失败")}))},getDemandDetail(){this.demandId&&Ya.getDemandDetail(this.demandId).then(e=>{this.demandForm=e.data,this.completeDate=new Date(this.demandForm.expectTime)})},getstatusList(){Ya.getDemandStatuses().then(e=>{this.statusOptions=e.data})},statusChange(){console.log(this.demandForm.status,this.demandId),Ya.updateDemandStatus({status:this.demandForm.status,demandId:this.demandId}).then(e=>{console.log("返回结果",e),this.$message.success("修改状态成功")})},getCommentsList(){as.getComments(this.demandId).then(e=>{console.log("list comment ",e),this.comments=e.data})},addComment(){let e={comment:this.commentMsg,relativeId:this.demandId,userId:"admin",userName:"admin"};as.createComment(e).then(e=>{e.data?(this.$message.success("添加评论成功"),this.getCommentsList(),this.commentMsg=""):this.$message.error("添加评论失败")})},init(){this.getDemandDetail(),this.getCommentsList(),this.getstatusList()}},created(){this.demandId=this.demand,this.init()},mounted(){this.initCopy()}},is=ss,rs=(a("eed3"),Object(y["a"])(is,Xa,Za,!1,null,"62c6930b",null)),ls=rs.exports,os={name:"iteration-demand",props:{iteration:{default:"",type:String}},components:{detail:ls},watch:{iteration(e){this.iterationId=e,this.getDemandList()}},data(){return{spaceId:"",iterationId:"",tableData:[],queryForm:{name:"",status:""},statusList:[],demandForm:{},demandId:"",showDemandDialog:!1,showDemandDetail:!1,demandTitle:"创建需求",tagList:[{text:"个人需求",value:"个人需求"},{text:"数据分析",value:"数据分析"},{text:"客户定制",value:"客户定制"}],abilityList:["用户体验","功能增强","性能","可靠性","安全","运维"],currentPage:1,currentSize:10,total:0,demandDetail:{},demandRule:{demandName:[{required:!0,message:"请输入需求名称",trigger:"blur"},{min:10,message:"需求名称最少10个字符",trigger:"blur"}],demandContent:[{required:!0,message:"请输入需求描述",trigger:"blur"},{min:20,message:"需求名称最少20个字符",trigger:"blur"}],customerValue:[{required:!0,message:"请选择客户价值",trigger:"change"}],level:[{required:!0,message:"请选择需求优先级",trigger:"change"}],workload:[{required:!0,message:"请输入工作量",trigger:"blur"}],expectTime:[{required:!0,message:"请选择期待完成日期",trigger:"change"}]}}},methods:{exchangeStatusName(e){let t="-";return this.statusList.forEach(a=>{a.value==e&&(t=a.statusName)}),t},queryDemands(){this.getDemandList()},viewDemand(e){this.showDemandDetail=!0,this.demandDetail=e},createDemand(){this.showDemandDialog=!0},handlePageChange(e){this.currentPage=e,this.getDemandList()},handleSizeChange(e){this.currentSize=e,this.getDemandList()},closeDemand(){this.showDemandDialog=!1,this.demandForm={},this.$refs.demandForm.resetFields()},submitDemand(e){this.$refs[e].validate(e=>{if(!e)return!1;this.demandForm.spaceId=this.spaceId,this.demandForm.iterationId=this.iterationId,Ya.createDemand(this.demandForm).then(e=>{e.data?(this.$message.success("创建需求成功"),this.getDemandList(),this.closeDemand()):this.$message.error("创建需求失败")})})},getDemandList(){console.log("开始请求需求",this.iterationId),this.spaceId&&this.iterationId&&Ya.getDemandList(this.currentPage,this.currentSize,this.queryForm.name,this.queryForm.status,this.spaceId,this.iterationId).then(e=>{console.log(e),this.tableData=e.data.data,this.total=e.data.total})},getstatusList(){Ya.getDemandStatuses().then(e=>{this.statusList=e.data})}},created(){this.spaceId=this.$store.state.spaceId,this.iterationId=this.iteration,this.getDemandList(),this.getstatusList()}},ns=os,cs=(a("38f1"),Object(y["a"])(ns,Wa,Qa,!1,null,"cf61186a",null)),ds=cs.exports,us=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"},model:{value:e.queryForm,callback:function(t){e.queryForm=t},expression:"queryForm"}},[t("el-form-item",{attrs:{label:"缺陷名称"}},[t("el-input",{attrs:{placeholder:"输入缺陷名称查询",clearable:""},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择缺陷状态"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.statusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.statusName,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.queryBugs}},[e._v("查询")])],1)],1),t("div",{staticClass:"bug-div"},[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"mini"},on:{click:e.createBug}},[e._v("新建缺陷")])],1)],1),t("div",{staticClass:"table-list"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"600"}},[t("el-table-column",{attrs:{prop:"bugName",label:"缺陷名称",width:"600"}}),t("el-table-column",{attrs:{prop:"acceptor",label:"负责人",width:"180"}}),t("el-table-column",{attrs:{prop:"status",label:"缺陷状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.exchangeStatusName(t.row.status))+" ")]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"提出时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"tag",label:"缺陷标签"}}),t("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.viewBug(a.row)}}},[e._v("查看")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":10,layout:"sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1),t("el-dialog",{attrs:{title:e.bugTitle,visible:e.showBugDialog,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.showBugDialog=t}}},[t("bugDetail",{attrs:{edit:e.isEdit,iteration:e.iterationId,bug:e.bugId},on:{cancel:e.closeBug}})],1)],1)},ps=[],ms={name:"iteration-bug",props:{iteration:{default:"",type:String}},components:{bugDetail:Ua},watch:{iteration:{handler(e){this.iterationId=e,this.getBugList()}}},data(){return{spaceId:"",iterationId:"",tableData:[],queryForm:{name:"",status:""},statusList:[],bugForm:{},bugId:"",showBugDialog:!1,bugTitle:"创建缺陷",abilityList:["用户体验","功能增强","性能","可靠性","安全","运维"],currentPage:1,currentSize:10,total:0,isEdit:!1,bugRule:{bugName:[{required:!0,message:"请输入缺陷名称",trigger:"blur"},{min:10,message:"缺陷名称最少10个字符",trigger:"blur"}],level:[{required:!0,message:"请选择缺陷优先级",trigger:"change"}]}}},methods:{exchangeStatusName(e){let t="-";return this.statusList.forEach(a=>{a.value==e&&(t=a.statusName)}),t},queryBugs(){this.getBugList()},viewBug(e){this.showBugDialog=!0,this.bugId=e.bugId,this.isEdit=!0},createBug(){this.showBugDialog=!0,this.isEdit=!1,this.bugId=""},handlePageChange(e){this.currentPage=e,this.getBugList()},handleSizeChange(e){this.currentSize=e,this.getBugList()},closeBug(){this.showBugDialog=!1,this.bugForm={},this.getBugList(),this.$refs.bugForm.resetFields()},getBugList(){this.spaceId&&this.iterationId&&Sa.getBugList(this.currentPage,this.currentSize,this.queryForm.name,this.queryForm.status,this.spaceId,this.iterationId).then(e=>{console.log(e),this.tableData=e.data.data,this.total=e.data.total})},getstatusList(){Sa.getBugStatuses().then(e=>{this.statusList=e.data})}},created(){this.spaceId=this.$store.state.spaceId,this.iterationId=this.iteration,console.log("获取到iteration ",this.iteration),this.getBugList(),this.getstatusList()}},hs=ms,gs=(a("ce5c"),Object(y["a"])(hs,us,ps,!1,null,"cf60262c",null)),vs=gs.exports,fs={getIterationList(){return new Promise((e,t)=>{let a="/v1/devops/iterations";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getIterationStatistic(e){return new Promise((t,a)=>{let s=`/v1/devops/iterations/${e}/statistic`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getIterationDetail(e){return new Promise((t,a)=>{let s="/v1/devops/iterations/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createIteration(e){return new Promise((t,a)=>{let s="/v1/devops/iterations";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateIteration(e,t){return new Promise((a,s)=>{let i="/v1/devops/iterations/"+e;g.put(i,t).then(e=>{a(e)}).catch(e=>{s(e)})})}},bs={props:{id:String},components:{iterationDemand:ds,iterationBug:vs,TextView:A},data(){return{showCardtype:"需求",cardData:{},commentMsg:"",comments:[],statistic:{},iterationInfo:null,iterationRule:{name:[{required:!0,message:"请输入迭代名称",trigger:"blur"},{min:4,message:"迭代名称最少10个字符",trigger:"blur"}],description:[{max:256,message:"迭代名称最少10个字符",trigger:"blur"}]},iterationList:[],iterationForm:{},showIteration:!1,selectedDate:[],spaceId:"",showIndex:"",selectSpacce:"",showPop:!1,detailWidth:250,isCollapse:!1,activeName:"review",tagList:[],steps:[{date:"07/31",subDate:"08/05",description:"需求评审",completed:!0},{date:"08/02",subDate:"08/05",description:"技术评审",completed:!0},{date:"08/06",description:"计划确认",completed:!1},{date:"08/09",description:"提测",completed:!1},{date:"08/17",description:"验收",completed:!1},{date:"08/19",description:"发布评审",completed:!1},{date:"08/20",description:"结项",completed:!1}]}},methods:{cardCommand(e){this.getDemandTags(),this.cardData={noStart:{name:"未开始",data:[]},process:{name:"处理中",data:[]},complete:{name:"已完成",data:[]}},"demand"==e&&(this.showCardtype="需求",this.getDemandCard()),"bug"==e&&(this.showCardtype="缺陷",this.getBugCard())},getCommentsList(){as.getComments(this.iterationInfo.iterationId).then(e=>{this.comments=e.data})},addComment(){let e={comment:this.commentMsg,relativeId:this.iterationInfo.iterationId,userId:"admin",userName:"admin"};as.createComment(e).then(e=>{e.data?(this.$message.success("添加评论成功"),this.getCommentsList(),this.commentMsg=""):this.$message.error("添加评论失败")})},clickIteration(e){fs.getIterationDetail(e.iterationId).then(e=>{this.iterationInfo=e.data,this.getCommentsList()}),fs.getIterationStatistic(e.iterationId).then(e=>{this.statistic=e.data})},selectCommand(e,t){console.log(e,t),"edit"==e&&(this.iterationForm=JSON.parse(JSON.stringify(t)),this.iterationForm.selectedDate=[t.startTime,t.endTime],this.showIteration=!0,this.isEditIteration=!0)},matchStatus(e){if(!e)return{};switch(e){case 1:return{name:"未开始",type:"info"};case 2:return{name:"进行中",type:"primary"};case 3:return{name:"已关闭",type:"warning"};case 4:return{name:"已完成",type:"success"}}return{}},getIterationList(){fs.getIterationList().then(e=>{this.iterationList=e.data})},submitIteration(e){this.$refs[e].validate(e=>{if(console.log(this.iterationForm),!e)return!1;this.iterationForm.startTime=this.iterationForm.selectedDate[0],this.iterationForm.endTime=this.iterationForm.selectedDate[1],this.isEditIteration?fs.updateIteration(this.iterationForm.iterationId,this.iterationForm).then(e=>{e.data?(this.$message.success("修改迭代成功"),this.closeIteration(),this.getIterationList()):this.$message.error("修改迭代失败")}):fs.createIteration(this.iterationForm).then(e=>{e.data?(this.$message.success("创建迭代成功"),this.closeIteration(),this.getIterationList()):this.$message.error("创建迭代失败")})})},showIterationDialog(){this.showIteration=!0},closeIteration(){this.isEditIteration=!1,this.iterationForm={},this.selectedDate=[],this.showIteration=!1},clickTag(e,t){t.selectTag.push(e),t.showPop=!1},handleClick(e){console.log("tab",e),"card"==e.name&&this.cardCommand("demand")},selectMenu(e){this.showIndex=e},hideMenu(){this.isCollapse=!this.isCollapse,this.detailWidth=this.isCollapse?0:250},dragControllerDiv(){let e=this,t=document.getElementById("set_menu_width");t.onmousedown=function(a){let s=a.clientX;return t.left=t.offsetLeft,document.onmousemove=function(t){let a=t.clientX,i=a-s;s=a;let r=e.detailWidth+i;r<=100?e.detailWidth=100:e.detailWidth+=i},document.onmouseup=function(){t.style.background="",document.onmousemove=null,document.onmouseup=null},!1}},getDemandTags(){Ya.getDemandTags().then(e=>{this.tagList=e.data})},getBugCard(){Sa.getIterationBugs(this.iterationInfo.iterationId).then(e=>{console.log(e.data),e.data.forEach(e=>{let t={name:e.bugName,id:e.bugId,showPop:!1,selectTag:[]};1==e.status&&this.cardData.noStart.data.push(t),e.status>1&&e.status<=4&&this.cardData.process.data.push(t),e.status>4&&this.cardData.complete.data.push(t)})})},getDemandCard(){Ya.getIterationDemandList(this.iterationInfo.iterationId).then(e=>{console.log(e.data),e.data.forEach(e=>{let t={name:e.demandName,id:e.demandId,showPop:!1,selectTag:[]};1==e.status&&this.cardData.noStart.data.push(t),e.status>1&&e.status<=4&&this.cardData.process.data.push(t),e.status>4&&this.cardData.complete.data.push(t)})})}},created(){this.getDemandTags(),this.getIterationList()}},ys=bs,ws=(a("e9e8"),Object(y["a"])(ys,Ha,Ka,!1,null,"7ba0fee7",null)),ks=ws.exports,Cs=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"},model:{value:e.queryForm,callback:function(t){e.queryForm=t},expression:"queryForm"}},[t("el-form-item",{attrs:{label:"需求名称"}},[t("el-input",{attrs:{placeholder:"输入需求名称查询",clearable:""},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择需求状态"},model:{value:e.queryForm.status,callback:function(t){e.$set(e.queryForm,"status",t)},expression:"queryForm.status"}},e._l(e.statusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.statusName,value:e.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.queryDemands}},[e._v("查询")])],1)],1),t("div",{staticClass:"demand-div"},[t("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"mini"},on:{click:e.createDemand}},[e._v("新建需求")])],1)],1),t("div",{staticClass:"table-list"},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"500"}},[t("el-table-column",{attrs:{prop:"demandName",label:"需求名称"}}),t("el-table-column",{attrs:{prop:"proposer",label:"提出人",width:"180"}}),t("el-table-column",{attrs:{prop:"status",label:"需求状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.exchangeStatusName(t.row.status))+" ")]}}])}),t("el-table-column",{attrs:{prop:"expectTime",label:"期待结束时间"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-date"}),e._v(" "+e._s(e._f("dayFormat")(a.row.expectTime))+" ")]}}])}),t("el-table-column",{attrs:{prop:"tag",label:"需求标签"}}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.viewDemand(a.row)}}},[e._v("查看")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":10,layout:"sizes, prev, pager, next",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handlePageChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1),t("el-dialog",{attrs:{title:e.demandTitle,visible:e.showDemandDialog,width:"80%"},on:{"update:visible":function(t){e.showDemandDialog=t}}},[t("div",{staticStyle:{height:"100%"}},[t("el-form",{ref:"demandForm",attrs:{model:e.demandForm,size:"mini","label-width":"120px",rules:e.demandRule}},[t("el-form-item",{attrs:{label:"需求标题",prop:"demandName"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"请输入需求标题"},model:{value:e.demandForm.demandName,callback:function(t){e.$set(e.demandForm,"demandName",t)},expression:"demandForm.demandName"}})],1),t("el-form-item",{attrs:{label:"需求描述",prop:"demandContent"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:12,maxRows:30},placeholder:"请输入需求的详细描述"},model:{value:e.demandForm.demandContent,callback:function(t){e.$set(e.demandForm,"demandContent",t)},expression:"demandForm.demandContent"}})],1),t("el-form-item",{attrs:{label:"附件"}},[t("el-upload",{staticClass:"upload-demo",attrs:{action:"https://jsonplaceholder.typicode.com/posts/",multiple:"",limit:3,"file-list":e.demandForm.fileList}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("上传附件")])],1)],1),t("el-form-item",{attrs:{label:"需求价值",prop:"customerValue"}},[t("el-select",{attrs:{placeholder:"请选择需求价值"},model:{value:e.demandForm.customerValue,callback:function(t){e.$set(e.demandForm,"customerValue",t)},expression:"demandForm.customerValue"}},e._l(e.abilityList,(function(e,a){return t("el-option",{key:a,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"需求优先级",prop:"level"}},[t("el-select",{attrs:{placeholder:"请选择需求优先级"},model:{value:e.demandForm.level,callback:function(t){e.$set(e.demandForm,"level",t)},expression:"demandForm.level"}},[t("el-option",{attrs:{label:"P1",value:1}}),t("el-option",{attrs:{label:"P2",value:2}}),t("el-option",{attrs:{label:"P3",value:3}})],1)],1),t("el-form-item",{attrs:{label:"接受人"}},[t("userSearch",{on:{chooseUser:e.selectUser}})],1),t("el-form-item",{attrs:{label:"期待完成时间",prop:"expectTime"}},[t("el-date-picker",{attrs:{align:"right",type:"date","value-format":"timestamp",placeholder:"选择日期"},model:{value:e.demandForm.expectTime,callback:function(t){e.$set(e.demandForm,"expectTime",t)},expression:"demandForm.expectTime"}})],1),t("el-form-item",{attrs:{label:"工作量(人/日)",prop:"workload"}},[t("el-input",{attrs:{placeholder:"请输入工作量"},model:{value:e.demandForm.workload,callback:function(t){e.$set(e.demandForm,"workload",t)},expression:"demandForm.workload"}})],1),t("el-form-item",{attrs:{label:"标签"}},[t("el-select",{attrs:{filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择标签"},model:{value:e.demandForm.tag,callback:function(t){e.$set(e.demandForm,"tag",t)},expression:"demandForm.tag"}},e._l(e.tagList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.text,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeDemand}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitDemand("demandForm")}}},[e._v("确 定")])],1)],1)]),t("el-dialog",{attrs:{title:"需求详情",visible:e.showDemandDetail,width:"90%"},on:{"update:visible":function(t){e.showDemandDetail=t}}},[t("detail",{attrs:{demand:e.demandDetail.demandId}})],1)],1)},_s=[],Fs={props:{space:{default:"",type:String}},components:{detail:ls,userSearch:Aa},watch:{space(e){this.spaceId=e,this.getDemandList()}},data(){return{spaceId:"",tableData:[],queryForm:{name:"",status:""},statusList:[],demandForm:{},demandId:"",showDemandDialog:!1,showDemandDetail:!1,demandTitle:"创建需求",tagList:[{text:"个人需求",value:"个人需求"},{text:"数据分析",value:"数据分析"},{text:"客户定制",value:"客户定制"}],abilityList:["用户体验","功能增强","性能","可靠性","安全","运维"],currentPage:1,currentSize:10,total:0,demandDetail:{},demandRule:{demandName:[{required:!0,message:"请输入需求名称",trigger:"blur"},{min:10,message:"需求名称最少10个字符",trigger:"blur"}],demandContent:[{required:!0,message:"请输入需求描述",trigger:"blur"},{min:20,message:"需求名称最少20个字符",trigger:"blur"}],customerValue:[{required:!0,message:"请选择客户价值",trigger:"change"}],level:[{required:!0,message:"请选择需求优先级",trigger:"change"}],workload:[{required:!0,message:"请输入工作量",trigger:"blur"}],expectTime:[{required:!0,message:"请选择期待完成日期",trigger:"change"}]}}},methods:{selectUser(e){this.demandForm.acceptor=e.userId},exchangeStatusName(e){let t="-";return this.statusList.forEach(a=>{a.value==e&&(t=a.statusName)}),t},queryDemands(){this.getDemandList()},viewDemand(e){this.showDemandDetail=!0,this.demandDetail=e},createDemand(){this.showDemandDialog=!0},handlePageChange(e){this.currentPage=e,this.getDemandList()},handleSizeChange(e){this.currentSize=e,this.getDemandList()},closeDemand(){this.showDemandDialog=!1,this.demandForm={},this.$refs.demandForm.resetFields()},submitDemand(e){this.$refs[e].validate(e=>{if(!e)return!1;Ya.createDemand(this.demandForm).then(e=>{e.data?(this.$message.success("创建需求成功"),this.getDemandList(),this.closeDemand()):this.$message.error("创建需求失败")})})},getDemandList(){this.spaceId||(this.spaceId=""),Ya.getDemandList(this.currentPage,this.currentSize,this.queryForm.name,this.queryForm.status,this.spaceId,"").then(e=>{console.log(e),this.tableData=e.data.data,this.total=e.data.total})},getstatusList(){Ya.getDemandStatuses().then(e=>{this.statusList=e.data})}},created(){this.spaceId=this.$store.state.spaceId,this.getDemandList(),this.getstatusList()}},xs=Fs,Is=(a("dcf8"),Object(y["a"])(xs,Cs,_s,!1,null,"16813f98",null)),Ds=Is.exports,Ts=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary"},on:{click:e.showSpace}},[e._v("新增空间")]),t("el-table",{attrs:{data:e.tableData,size:"mini"}},[t("el-table-column",{attrs:{prop:"spaceName",label:"空间名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("textview",{attrs:{len:20,text:e.row.spaceName}})]}}])}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-edit"},on:{click:function(t){return e.startEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-sort"},on:{click:function(t){return e.switchSpace(a.row)}}},[e._v("切换空间")])]}}])})],1),t("el-dialog",{attrs:{title:e.spaceTitle,visible:e.showSpaceDialog,width:"40%","append-to-body":!0,"before-close":e.handleClose},on:{"update:visible":function(t){e.showSpaceDialog=t}}},[t("el-form",{ref:"spaceForm",attrs:{model:e.spaceForm,rules:e.SpaceRules,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"空间名称",prop:"spaceName"}},[t("el-input",{attrs:{placeholder:"请输入空间名称"},model:{value:e.spaceForm.spaceName,callback:function(t){e.$set(e.spaceForm,"spaceName",t)},expression:"spaceForm.spaceName"}})],1),t("el-form-item",{attrs:{label:"空间描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:10},placeholder:"请输入空间名称"},model:{value:e.spaceForm.description,callback:function(t){e.$set(e.spaceForm,"description",t)},expression:"spaceForm.description"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.handleClose}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitForm("spaceForm")}}},[e._v("确 定")])],1)],1)],1)},Ps=[],Ss={getSpaceList(){return new Promise((e,t)=>{let a="/v1/devops/spaces";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getSpaceDetail(e){return new Promise((t,a)=>{let s="/v1/devops/spaces/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createSpace(e){return new Promise((t,a)=>{let s="/v1/devops/spaces";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateSpace(e,t){return new Promise((a,s)=>{let i="/v1/devops/spaces/"+e;g.put(i,t).then(e=>{a(e)}).catch(e=>{s(e)})})}},Ls={components:{textview:A},data(){return{tableData:[{}],showSpaceDialog:!1,spaceForm:{},spaceTitle:"",edit:!1,SpaceRules:{spaceName:[{required:!0,message:"请输入空间名称",trigger:"blur"},{min:2,message:"缺陷名称最少2个字符",trigger:"blur"}],description:[{required:!0,message:"请输入空间描述",trigger:"change"}]}}},methods:{switchSpace(e){this.$emit("switchSpace",e)},showSpace(){this.spaceTitle="创建空间",this.showSpaceDialog=!0,this.edit=!1},startEdit(e){this.spaceTitle="编辑空间",this.showSpaceDialog=!0,this.edit=!0,this.spaceForm=e},handleClose(){this.showSpaceDialog=!1,this.spaceForm={}},submitForm(e){this.$refs[e].validate(e=>{if(!e)return!1;this.edit?Ss.updateSpace(this.spaceForm.spaceId,this.spaceForm).then(e=>{e.data?(this.$message.success("修改空间成功"),this.handleClose(),this.getSpaceList()):this.$message.error("修改空间失败")}):Ss.createSpace(this.spaceForm).then(e=>{e.data?(this.$message.success("创建空间成功"),this.handleClose(),this.getSpaceList()):this.$message.error("创建空间失败")})})},getSpaceList(){Ss.getSpaceList().then(e=>{this.tableData=e.data})}},created(){this.getSpaceList()}},Ns=Ls,$s=(a("894b"),Object(y["a"])(Ns,Ts,Ps,!1,null,"fb80b7c8",null)),Es=$s.exports,zs={components:{bug:Ja,demand:Ds,iteration:ks,spaceList:Es,textview:A},data(){return{showIndex:1,selectSpacce:"",showPop:!1,detailWidth:200,isCollapse:!1,spaceName:"",spaceId:"",asideHeight:""}},computed:{simpleSpaceName(){return this.spaceName?this.spaceName.substring(0,1):""}},methods:{selecteSpace(e){console.log("spacexxx",e),this.spaceName=e.spaceName,this.spaceId=e.spaceId,this.showPop=!1},selectMenu(e){this.showIndex=e},hideMenu(){this.isCollapse=!this.isCollapse,this.detailWidth=this.isCollapse?70:200},getSpaceList(){Ss.getSpaceList().then(e=>{this.spaceName=e.data[0].spaceName,this.spaceId=e.data[0].spaceId,this.$store.commit("UPDATE_SPACE",this.spaceId)})},calculateAsideHeight(){const e=document.documentElement.scrollHeight;this.asideHeight=Math.max(e,window.innerHeight)}},created(){this.getSpaceList(),this.calculateAsideHeight()},mounted(){window.addEventListener("scroll",this.calculateAsideHeight),window.addEventListener("resize",this.calculateAsideHeight)},beforeDestroy(){window.removeEventListener("scroll",this.calculateAsideHeight),window.removeEventListener("resize",this.calculateAsideHeight)}},Rs=zs,Os=(a("f9f0"),a("7c91"),Object(y["a"])(Rs,Ia,Da,!1,null,"6d77e9fe",null)),As=Os.exports,qs=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"header-container"},[t("img",{staticClass:"image-logo",attrs:{src:e.imageUrl,alt:"windy"}}),t("el-autocomplete",{staticClass:"custom-input",attrs:{size:"mini",clearable:"","fetch-suggestions":e.querySearchAsync,placeholder:"请输入关联的需求、缺陷、任务名称"},on:{select:e.selectData},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[1==a.relationType?t("div",{staticClass:"query-type demand"},[e._v(" 需求 ")]):2==a.relationType?t("div",{staticClass:"query-type bug"},[e._v(" 缺陷 ")]):t("div",{staticClass:"query-type work"},[e._v("任务")]),t("span",[e._v(e._s(a.value))])]}}]),model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}}),t("div",{staticClass:"ui-container"},[t("el-tooltip",{attrs:{effect:"dark",content:"未完成缺陷数",placement:"right-start"}},[t("div",{staticClass:"ui-item",on:{click:function(t){return e.showTab("bug")}}},[t("div",{staticClass:"ui-value"},[e._v(e._s(e.bugTotal))]),t("div",{staticClass:"ui-label"},[e._v("缺陷数")])])]),t("el-tooltip",{attrs:{effect:"dark",content:"未完成需求数",placement:"right-start"}},[t("div",{staticClass:"ui-item",on:{click:function(t){return e.showTab("demand")}}},[t("div",{staticClass:"ui-value"},[e._v(e._s(e.demandTotal))]),t("div",{staticClass:"ui-label"},[e._v("需求数")])])]),t("el-tooltip",{attrs:{effect:"dark",content:"未完成任务数",placement:"right-start"}},[t("div",{staticClass:"ui-item",on:{click:function(t){return e.showTab("work")}}},[t("div",{staticClass:"ui-value"},[e._v(e._s(e.taskTotal))]),t("div",{staticClass:"ui-label"},[e._v("工作项")])])])],1)],1),t("div",{staticClass:"content"},[t("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"缺陷",name:"bug"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-aim"}),e._v(" 缺陷")]),t("div",{staticClass:"content-detail"},e._l(e.bugData,(function(a,s){return t("div",{key:s,staticClass:"bug-div"},[t("el-row",{staticClass:"bug-row",attrs:{gutter:30}},[t("el-col",{attrs:{span:1}},[t("el-tag",{attrs:{type:1==a.status?"info":"primary",size:"small"}},[e._v(e._s(e.exchnageBugStatus(a.status).statusName))])],1),t("el-col",{attrs:{span:23}},[t("div",{staticClass:"bug-description title",on:{click:function(t){return e.showBugDetail(a)}}},[t("textview",{attrs:{text:a.bugName,len:100}})],1)])],1),t("div",{staticClass:"bug-bottom"},[1==a.level?t("span",{staticClass:"bug-level p1"},[e._v("P"+e._s(a.level))]):(a.level=2)?t("span",{staticClass:"bug-level p2"},[e._v("P"+e._s(a.level))]):t("span",{staticClass:"bug-level p3"},[e._v("P"+e._s(a.level))]),t("span",[e._v("缺陷ID: "+e._s(a.bugId)+" "),t("i",{staticClass:"el-icon-document-copy copy-icon",attrs:{"data-clipboard-text":a.bugId}})])]),t("div",{staticClass:"time-div"},[e._v(" 创建时间: "+e._s(e._f("dayFormat")(a.createTime))+" ")])],1)})),0),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.bugPage,"page-sizes":[10,20,50],"page-size":e.bugSize,layout:"sizes, prev, pager, next",total:e.bugTotal},on:{"size-change":function(t){return e.handleSizeChange(t,"bug")},"current-change":function(t){return e.handleCurrentChange(t,"bug")},"update:currentPage":function(t){e.bugPage=t},"update:current-page":function(t){e.bugPage=t}}})],1)]),t("el-tab-pane",{attrs:{label:"需求",name:"demand"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-s-shop"}),e._v(" 需求")]),t("div",{staticClass:"content-detail"},e._l(e.demandData,(function(a,s){return t("div",{key:s,staticClass:"bug-div"},[t("div",[t("div",{staticClass:"title",on:{click:function(t){return e.showDemand(a)}}},[t("textview",{attrs:{text:a.demandName,len:100}})],1),t("div",{staticClass:"demand-desc"},[t("textview",{attrs:{len:200,showpop:!1,text:a.demandContent}})],1)]),t("div",{staticClass:"bug-bottom"},[1==a.level?t("span",{staticClass:"bug-level p1"},[e._v("P"+e._s(a.level))]):(a.level=2)?t("span",{staticClass:"bug-level p2"},[e._v("P"+e._s(a.level))]):t("span",{staticClass:"bug-level p3"},[e._v("P"+e._s(a.level))]),t("span",[t("i",{staticClass:"el-icon-user-solid"}),e._v(" 古月澜")]),t("span",[t("span",[e._v("需求ID:")]),e._v(" "+e._s(a.demandId)+" "),t("i",{staticClass:"el-icon-document-copy copy-icon",attrs:{"data-clipboard-text":a.demandId}})])]),t("div",{staticClass:"time-div"},[e._v(" 截止时间: "+e._s(e._f("dayFormat")(a.expectTime))+" ")])])})),0),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.demandPage,"page-sizes":[10,20,50],"page-size":e.demandSize,layout:"sizes, prev, pager, next",total:e.demandTotal},on:{"size-change":function(t){return e.handleSizeChange(t,"demand")},"current-change":function(t){return e.handleCurrentChange(t,"demand")},"update:currentPage":function(t){e.demandPage=t},"update:current-page":function(t){e.demandPage=t}}})],1)]),t("el-tab-pane",{attrs:{label:"任务列表",name:"work"}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("i",{staticClass:"el-icon-s-claim"}),e._v(" 工作项")]),t("div",{staticClass:"work-add"},[t("el-button",{staticStyle:{"z-index":"1000"},attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.showTaskView}},[e._v("新增工作项")])],1),t("div",{staticClass:"content-detail"},e._l(e.taskData,(function(a,s){return t("div",{key:s,staticClass:"bug-div"},[t("div",[t("div",{staticClass:"title"},[t("div",{on:{click:function(t){return e.showEditWork(a)}}},[t("textview",{attrs:{text:a.taskName,len:100}})],1)]),t("div",{staticClass:"demand-desc"},[t("textview",{attrs:{showpop:!1,len:200,text:a.description}})],1)]),t("div",{staticClass:"bug-bottom"},[t("span",[t("i",{staticClass:"el-icon-camera-solid bug-icon"}),e._v(" ["+e._s(a.taskId)+"] "),t("i",{staticClass:"el-icon-document-copy"})]),t("span",[t("i",{staticClass:"el-icon-user-solid"}),e._v(" 工时: "+e._s(a.workload)+" 天")]),t("span",[t("i",{staticClass:"el-icon-time"}),e._v(" 结束点: "+e._s(e._f("dayFormat")(a.completeTime)))])]),t("div",{staticClass:"time-div"},[e._v(" 开始时间: "+e._s(e._f("dateFormat")(a.createTime))+" "),t("div",{staticClass:"delete-icon",on:{click:function(t){return e.deleteWork(a)}}},[t("i",{staticClass:"el-icon-delete-solid"}),e._v(" 删除 ")])])])})),0),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{"current-page":e.taskPage,"page-sizes":[10,20,50],"page-size":e.taskSize,layout:"sizes, prev, pager, next",total:e.taskTotal},on:{"size-change":function(t){return e.handleSizeChange(t,"work")},"current-change":function(t){return e.handleCurrentChange(t,"work")},"update:currentPage":function(t){e.taskPage=t},"update:current-page":function(t){e.taskPage=t}}})],1)])],1)],1),t("el-dialog",{attrs:{title:"需求详情",visible:e.showDemandDetail,width:"90%"},on:{"update:visible":function(t){e.showDemandDetail=t},close:e.closeDemand}},[t("detail",{attrs:{demand:e.demandId}})],1),t("el-dialog",{attrs:{title:"缺陷详情",visible:e.showBugDialog,width:"90%"},on:{"update:visible":function(t){e.showBugDialog=t}}},[t("bugDetail",{attrs:{bug:e.bugId,edit:!0},on:{cancel:e.closeBug}})],1),t("el-dialog",{attrs:{title:e.workTitle,visible:e.showTaskDialog},on:{"update:visible":function(t){e.showTaskDialog=t},close:e.closeTask}},[t("div",[t("el-form",{ref:"taskForm",attrs:{model:e.taskForm,"label-width":"120px",rules:e.taskRule,size:"mini"}},[t("el-form-item",{attrs:{label:"任务名称"}},[t("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.taskForm.taskName,callback:function(t){e.$set(e.taskForm,"taskName",t)},expression:"taskForm.taskName"}})],1),e.isEditTask?t("el-form-item",{attrs:{label:"任务状态"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.taskForm.status,callback:function(t){e.$set(e.taskForm,"status",t)},expression:"taskForm.status"}},e._l(e.taskStatus,(function(e){return t("el-option",{key:e.value,attrs:{label:e.statusName,value:e.value}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"任务描述"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:20},placeholder:"请输入任务名称"},model:{value:e.taskForm.description,callback:function(t){e.$set(e.taskForm,"description",t)},expression:"taskForm.description"}})],1),t("el-form-item",{attrs:{label:"关联ID"}},[t("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入关联的需求、缺陷、任务名称"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[1==a.relationType?t("div",{staticClass:"query-type demand"},[e._v(" 需求 ")]):2==a.relationType?t("div",{staticClass:"query-type bug"},[e._v(" 缺陷 ")]):t("div",{staticClass:"query-type work"},[e._v("任务")]),t("span",[e._v(e._s(a.value))])]}}]),model:{value:e.selectItem.name,callback:function(t){e.$set(e.selectItem,"name",t)},expression:"selectItem.name"}})],1),t("el-form-item",{attrs:{label:"完成时间",prop:"expectTime"}},[t("el-date-picker",{attrs:{align:"right",type:"date","value-format":"timestamp",placeholder:"选择日期"},model:{value:e.taskForm.completeTime,callback:function(t){e.$set(e.taskForm,"completeTime",t)},expression:"taskForm.completeTime"}})],1)],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.closeTask}},[e._v("取消")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitTask("taskForm")}}},[e._v("确认")])],1)])],1)},Bs=[],Vs=a("7f01"),Us=a.n(Vs),Gs={getTaskPaage(e,t){return new Promise((a,s)=>{let i=`/v1/devops/work/tasks?page=${e}&size=${t}`;g.get(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getTaskDetail(e){return new Promise((t,a)=>{let s="/v1/devops/work/tasks/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteTask(e){return new Promise((t,a)=>{let s="/v1/devops/work/tasks/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getTaskStatuses(){return new Promise((e,t)=>{let a="/v1/devops/work/task/statuses";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createTask(e){return new Promise((t,a)=>{let s="/v1/devops/work/tasks";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateTask(e){return new Promise((t,a)=>{let s="/v1/devops/work/task";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})}},js={codeChangeList(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/changes`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},relationList(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/relations?name="+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},saveCodeChange(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/change";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteCodeChange(e,t){return new Promise((a,s)=>{let i=`/v1/devops/pipeline/${e}/change/${t}`;g.delete(i).then(e=>{a(e)}).catch(e=>{s(e)})})}},Ms={components:{textview:A,detail:ls,bugDetail:Ua},data(){return{imageUrl:Us.a,searchText:"",activeName:"bug",total:30,currentPage:1,demandTotal:0,demandPage:1,demandSize:10,demandData:[],bugTotal:0,bugPage:1,bugSize:10,bugData:[],showDemandDetail:!1,showBugDialog:!1,demandId:"",bugId:"",bugStatus:[],demandStatus:[],showTaskDialog:!1,taskRules:[],taskForm:{},relatedType:1,taskTotal:0,taskPage:1,taskSize:10,taskData:[],isEditTask:!1,taskRule:{},taskStatus:[],workTitle:"",selectItem:{},allData:[],queryName:""}},methods:{deleteWork(e){Gs.deleteTask(e.taskId).then(e=>{e.data?(this.$message.success("删除成功"),this.getTasks()):this.$message.error("删除失败")})},showTab(e){this.activeName=e},querySearchAsync(e,t){var a=e?this.allData.filter(this.createFilter(e)):this.allData;t(a)},createFilter(e){return t=>0===t.value.toLowerCase().indexOf(e.toLowerCase())||0===t.relationId.toLowerCase().indexOf(e.toLowerCase())},getAllData(e){js.relationList("").then(t=>{this.allData=[],t.data.forEach(e=>{e.value=e.name,this.allData.push(e)}),e&&e()})},selectData(e){console.log("selectData",e),1==e.relationType&&(this.demandId=e.relationId,this.showDemandDetail=!0),2==e.relationType&&(this.showBugDialog=!0,this.bugId=e.relationId),3==e.relationType&&Gs.getTaskDetail(e.relationId).then(e=>{this.showEditWork(e.data)})},handleSelect(e){this.selectItem=e},showEditWork(e){this.getAllData(()=>{this.allData.forEach(t=>{t.relationId==e.relatedId&&(this.selectItem=t)})}),this.workTitle="编辑任务",this.showTaskDialog=!0,this.isEditTask=!0,this.taskForm=JSON.parse(JSON.stringify(e))},submitTask(e){this.$refs[e].validate(e=>{if(!e)return!1;this.taskForm.relatedId=this.selectItem.relationId,this.taskForm.relatedType=this.selectItem.relationType,this.isEditTask?Gs.updateTask(this.taskForm).then(e=>{e.data?(this.$message.success("修改任务成功"),this.getTasks(),this.closeTask()):this.$message.error("修改任务失败")}):Gs.createTask(this.taskForm).then(e=>{e.data?(this.$message.success("添加任务成功"),this.getTasks(),this.closeTask()):this.$message.error("添加任务失败")})})},closeTask(){this.selectItem={},this.taskForm={},this.showTaskDialog=!1,this.getTasks()},showTaskView(){this.workTitle="创建任务",this.showTaskDialog=!0,this.isEditTask=!1,this.getAllData()},closeBug(){this.showBugDialog=!1,this.getBugs()},closeDemand(){this.getDemands()},showBugDetail(e){this.showBugDialog=!0,this.bugId=e.bugId},exchnageBugStatus(e){let t={};return this.bugStatus.forEach(a=>{a.value==e&&(t=a)}),t},demandStatusName(e){let t="-";return this.demandStatus.forEach(a=>{a.value==e&&(t=a.statusName)}),t},showDemand(e){this.demandId=e.demandId,this.showDemandDetail=!0},handleClick(e){console.log(e)},handleSizeChange(e,t){"demand"==t&&(this.demandSize=e,this.getDemands()),"bug"==t&&(this.bugSize=e,this.getBugs())},handleCurrentChange(e,t){"demand"==t&&(this.demandPage=e,this.getDemands()),"bug"==t&&(this.bugPage=e,this.getBugs())},getDemands(){Ya.getUserDemands(this.demandPage,this.demandSize).then(e=>{this.demandTotal=e.data.total,this.demandData=e.data.data})},getBugs(){Sa.getUserbugs(this.bugPage,this.bugSize).then(e=>{this.bugTotal=e.data.total,this.bugData=e.data.data})},getTasks(){Gs.getTaskPaage(this.taskPage,this.taskSize).then(e=>{this.taskTotal=e.data.total,this.taskData=e.data.data})},getStatusList(){Ya.getDemandStatuses().then(e=>{this.demandStatus=e.data,this.getDemands()}),Sa.getBugStatuses().then(e=>{this.bugStatus=e.data,this.getBugs()}),Gs.getTaskStatuses().then(e=>{this.taskStatus=e.data,this.getTasks()})},initCopy(){let e=this,t=new ts.a(".copy-icon");t.on("success",(function(){e.$message.success("复制成功")})),t.on("error",(function(){e.$message.error("复制失败")}))}},created(){this.getStatusList(),this.getAllData()},mounted(){this.initCopy()}},Js=Ms,Hs=(a("fd4e"),a("ebe0"),Object(y["a"])(Js,qs,Bs,!1,null,"68402b78",null)),Ks=Hs.exports,Ws=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title"},[t("el-page-header",{attrs:{content:e.recordName},on:{back:e.goBack}})],1),t("el-row",[t("el-col",{attrs:{span:6}},[t("div",{staticClass:"show-config"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.showRecordConfig}},[e._v("查看配置")])],1),t("div",{staticClass:"search"},[t("span",{staticClass:"filter-txt"},[e._v("状态过滤:")]),t("el-radio-group",{staticClass:"status-box",on:{change:e.chooseStatus},model:{value:e.filterStatus,callback:function(t){e.filterStatus=t},expression:"filterStatus"}},[t("el-radio",{attrs:{label:1}},[e._v("全部")]),t("el-radio",{attrs:{label:2}},[e._v("失败")]),t("el-radio",{attrs:{label:3}},[e._v("成功")])],1),t("el-input",{attrs:{size:"mini",placeholder:"输入用例名进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-tree",{ref:"tree",attrs:{"node-key":"featureId","default-expanded-keys":e.errorList,data:e.recordData,"filter-node-method":e.filterNode,props:{children:"children",label:"featureName"}},on:{"node-click":e.treeNodeClick},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("span",{},[t("span",{staticClass:"custom-tree-node",style:{color:s.status}},[e._v(e._s(a.label))])])}}])})],1),t("el-col",{attrs:{span:18}},[t("div",{staticClass:"percent-box"},[t("h3",[e._v("任务执行统计")]),t("div",{staticClass:"ui-container"},[t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-result"},[t("el-progress",{attrs:{type:"circle",percentage:e.executePercent}})],1),t("div",{staticClass:"ui-label"},[e._v("执行进度")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value"},[e._v(e._s(e.totalCount))]),t("div",{staticClass:"ui-label"},[e._v("用例总数")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-success"},[e._v(e._s(e.successCount))]),t("div",{staticClass:"ui-label"},[e._v("成功数")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-error"},[e._v(e._s(e.errorCount))]),t("div",{staticClass:"ui-label"},[e._v("失败数")])]),t("div",{staticClass:"ui-item"},[t("div",{staticClass:"ui-value ui-result"},[e._v(e._s(e.resultPercent)+"%")]),t("div",{staticClass:"ui-label"},[e._v("成功率")])])])]),e.isShowEmpty?t("el-empty",{attrs:{description:"请在左侧点击详细用例查看详情"}}):t("div",{staticClass:"drawer-content"},[t("div",{staticClass:"record-title"},[e._v(" 【"+e._s(e.chooseFeature.featureName)+"】执行历史记录 ")]),t("div",{staticClass:"execute-detail"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{name:"preset"}},[t("el-badge",{staticClass:"tab-label",attrs:{slot:"label","is-dot":"",hidden:!e.presetError},slot:"label"},[e._v("预置")]),t("PanelList",{attrs:{list:e.presetList}})],1),t("el-tab-pane",{attrs:{name:"execute"}},[t("el-badge",{staticClass:"tab-label",attrs:{slot:"label","is-dot":"",hidden:!e.executeError},slot:"label"},[e._v("执行")]),t("PanelList",{attrs:{list:e.executeList}})],1),t("el-tab-pane",{attrs:{name:"clean"}},[t("el-badge",{staticClass:"tab-label",attrs:{slot:"label","is-dot":"",hidden:!e.cleanError},slot:"label"},[e._v("清理")]),t("PanelList",{attrs:{list:e.cleanList}})],1)],1)],1)])],1)],1),t("el-dialog",{attrs:{visible:e.dialogVisible,title:"任务执行配置",width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("json-viewer",{attrs:{value:e.jsonData,"expand-depth":5,copyable:"",boxed:"",sort:""}})],1)],1)},Qs=[],Ys={components:{PanelList:le,JsonViewer:ae.a},data(){return{recordData:[],recordId:"",recordName:"",filterText:"",activeName:"preset",resultList:[],presetList:[],executeList:[],cleanList:[],jsonData:[],dialogVisible:!1,chooseFeature:{},isShowEmpty:!0,errorList:[],presetError:!1,executeError:!1,cleanError:!1,filterStatus:1,totalCount:0,successCount:0,errorCount:0,displayAll:!1,recordStatus:0}},watch:{filterText(e){this.displayAll=!0,this.$refs.tree.filter(e)}},computed:{resultPercent(){var e=this.successCount/this.totalCount;return Math.round(100*e)},executePercent(){if(0==this.totalCount)return 0;var e=(this.successCount+this.errorCount)/this.totalCount;return Math.round(100*e)}},methods:{chooseStatus(){this.displayAll=1!=this.filterStatus,this.$refs.tree.filter()},goBack(){this.$router.go(-1)},treeNodeClick(e){this.resultList=[],this.activeName="preset",this.chooseFeature=e,this.isShowEmpty=!1,I.getExecuteRecords(e.historyId).then(e=>{this.resultList=e.data,this.filterRecord()})},filterRecord(){this.presetList=[],this.executeList=[],this.cleanList=[],this.resultList.forEach(e=>{1==e.testStage&&(this.presetList.push(e),1!=e.status&&(this.presetError=!0)),2==e.testStage&&(this.executeList.push(e),1!=e.status&&(this.executeError=!0)),3==e.testStage&&(this.cleanList.push(e),1!=e.status&&(this.cleanError=!0))})},filterNode(e,t){return!!(3!=this.filterStatus||t.executeStatus&&1==t.executeStatus)&&(!!(2!=this.filterStatus||t.executeStatus&&2==t.executeStatus)&&(!e||-1!==t.featureName.indexOf(e)))},getTaskHistories(){ka.getTaskHistoryTree(this.recordId).then(e=>{let t=e.data;this.errorCount=0,this.successCount=0,this.displayTreeNode(t),this.recordData=t,this.errorCount+this.successCount==this.totalCount&&clearInterval(this.queryInterval)})},startInterval(){this.queryInterval=setInterval(()=>{this.getTaskHistories()},2e3)},displayTreeNode(e){e.forEach(e=>{e.executeStatus&&(e.status="#67C23A",1!=e.executeStatus?(e.status="#F56C6C",this.errorCount++,this.errorList.push(e.featureId)):this.successCount++),e.children&&e.children.length>0&&this.displayTreeNode(e.children)})},showRecordConfig(){this.dialogVisible=!0,ka.getTaskRecordDetail(this.recordId).then(e=>{this.jsonData=JSON.parse(e.data.taskConfig)})},getRecordDetail(){ka.getTaskRecordDetail(this.recordId).then(e=>{this.recordName="任务名称: "+e.data.taskName,this.recordStatus=e.data.status,this.getCaseFeatures(e.data.testCaseId),4==e.data.status&&this.startInterval()})},getCaseFeatures(e){x.getCaseFeatures(e).then(e=>{4!=this.recordStatus?this.totalCount=this.errorCount+this.successCount:e.data.forEach(e=>{1==e.featureType&&this.totalCount++})})}},created(){this.recordId=this.$route.query.recordId,this.getRecordDetail(),this.getTaskHistories()}},Xs=Ys,Zs=(a("38d3"),Object(y["a"])(Xs,Ws,Qs,!1,null,"3fbb7dd8",null)),ei=Zs.exports,ti=function(){var e=this,t=e._self._c;return t("div",{staticClass:"all"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"服务名称"}},[t("el-input",{attrs:{placeholder:"请输入服务名称",clearable:""},on:{input:e.startQuery},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.startCreate}},[e._v("新增服务")])],1)],1)],1),t("div",{staticClass:"content"},[t("el-table",{attrs:{data:e.serviceData,size:"mini"}},[t("el-table-column",{attrs:{prop:"serviceName",label:"服务名称"}}),t("el-table-column",{attrs:{prop:"description",label:"服务描述"}}),t("el-table-column",{attrs:{prop:"gitUrl",label:"git地址"}}),t("el-table-column",{attrs:{prop:"priority",label:"优先级"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-rate",{attrs:{disabled:""},model:{value:a.row.priority,callback:function(t){e.$set(a.row,"priority",t)},expression:"scope.row.priority"}})]}}])}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.startEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(t){return e.startDelete(a.row)}}},[e._v("删除")])]}}])})],1),t("div",[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.showServiceDialog,width:"70%"},on:{"update:visible":function(t){e.showServiceDialog=t},close:e.closeDialog}},[e.notConfigGit?t("el-alert",{attrs:{type:"warning",center:"","show-icon":"",closable:!1}},[t("template",{slot:"title"},[e._v(" 创建服务需先配置环境信息 "),t("el-link",{attrs:{type:"primary"},on:{click:e.goEnv}},[e._v("前往配置>>")])],1)],2):e._e(),t("el-form",{ref:"serviceForm",attrs:{model:e.serviceForm,disabled:!e.isEdit&&e.notConfigGit,rules:e.rules,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"服务名称",prop:"serviceName"}},[t("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.serviceForm.serviceName,callback:function(t){e.$set(e.serviceForm,"serviceName",t)},expression:"serviceForm.serviceName"}})],1),t("el-form-item",{attrs:{label:"服务描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入服务描述"},model:{value:e.serviceForm.description,callback:function(t){e.$set(e.serviceForm,"description",t)},expression:"serviceForm.description"}})],1),t("el-form-item",{attrs:{label:"服务git地址",prop:"gitUrl"}},[t("el-input",{attrs:{placeholder:"请输入服务git地址"},model:{value:e.serviceForm.gitUrl,callback:function(t){e.$set(e.serviceForm,"gitUrl",t)},expression:"serviceForm.gitUrl"}})],1),t("el-form-item",{attrs:{label:"优先级",prop:"gitUrl"}},[t("el-rate",{model:{value:e.serviceForm.priority,callback:function(t){e.$set(e.serviceForm,"priority",t)},expression:"serviceForm.priority"}})],1),t("el-form-item",{attrs:{label:"成员列表"}},[e._l(e.members,(function(a,s){return t("el-tag",{key:s,staticClass:"tag-item",attrs:{type:"primary",closable:""},on:{close:function(t){return e.deleteMember(a.userId)}}},[e._v(e._s(a.userName))])})),t("div",{staticClass:"add-member"},[t("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"},model:{value:e.showPop,callback:function(t){e.showPop=t},expression:"showPop"}},[t("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入用户名称"},on:{select:e.handleSelect},model:{value:e.selectedUser,callback:function(t){e.selectedUser=t},expression:"selectedUser"}}),t("el-button",{attrs:{slot:"reference",type:"text",size:"mini",icon:"el-icon-plus"},slot:"reference"},[e._v("新增")])],1)],1)],2),t("h3",[e._v("Kubernetes配置")]),t("el-tabs",{staticClass:"k8s-config",attrs:{type:"border-card"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"基础配置",name:"first"}},[t("el-form-item",{attrs:{label:"环境变量"}},e._l(e.envList,(function(a,s){return t("el-row",{key:s,staticClass:"param-line"},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"环境变量名称"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"env.name"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"环境变量值"},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"env.value"}})],1),t("el-col",{attrs:{span:4}},[t("el-switch",{attrs:{"active-text":"系统变量"},model:{value:a.isRelated,callback:function(t){e.$set(a,"isRelated",t)},expression:"env.isRelated"}})],1),t("el-col",{staticClass:"op-box",attrs:{span:4}},[t("i",{staticClass:"el-icon-remove op-icon del",on:{click:function(t){return e.delEnv(s)}}}),s==e.envList.length-1?t("i",{staticClass:"el-icon-circle-plus op-icon add",on:{click:e.addEnv}}):e._e()])],1)})),1),t("el-form-item",{attrs:{label:"文件挂载"}},e._l(e.volumeList,(function(a,s){return t("el-row",{key:s,staticClass:"param-line"},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"主机路径"},model:{value:a.hostVolume,callback:function(t){e.$set(a,"hostVolume",t)},expression:"volume.hostVolume"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"容器路径"},model:{value:a.volume,callback:function(t){e.$set(a,"volume",t)},expression:"volume.volume"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"名称"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"volume.name"}})],1),t("el-col",{staticClass:"op-box",attrs:{span:4}},[t("i",{staticClass:"el-icon-remove op-icon del",on:{click:function(t){return e.delVolume(s)}}}),t("i",{staticClass:"el-icon-circle-plus op-icon add",on:{click:e.addVolume}})])],1)})),1),t("el-form-item",{attrs:{label:"端口映射"}},e._l(e.portList,(function(a,s){return t("el-row",{key:s,staticClass:"param-line"},[t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"容器端口"},model:{value:a.port,callback:function(t){e.$set(a,"port",t)},expression:"port.port"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"宿主机端口"},model:{value:a.hostPort,callback:function(t){e.$set(a,"hostPort",t)},expression:"port.hostPort"}})],1),t("el-col",{attrs:{span:2}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"协议类型"},model:{value:a.protocol,callback:function(t){e.$set(a,"protocol",t)},expression:"port.protocol"}},[t("el-option",{attrs:{label:"TCP",value:"TCP"}}),t("el-option",{attrs:{label:"UDP",value:"UDP"}})],1)],1),t("el-col",{staticClass:"op-box",attrs:{span:4}},[t("i",{staticClass:"el-icon-remove op-icon del",on:{click:function(t){return e.delPort(s)}}}),t("i",{staticClass:"el-icon-circle-plus op-icon add",on:{click:e.addPort}})])],1)})),1)],1),t("el-tab-pane",{attrs:{label:"高级配置",name:"second"}},[t("el-form-item",{attrs:{label:"更新策略"}},[t("el-select",{attrs:{placeholder:"选择更新策略"},model:{value:e.strategy,callback:function(t){e.strategy=t},expression:"strategy"}},[t("el-option",{attrs:{label:"暂停更新",value:"Recreate"}})],1)],1),t("el-form-item",{attrs:{label:"节点调度"}},[t("el-radio-group",{model:{value:e.selectWay,callback:function(t){e.selectWay=t},expression:"selectWay"}},[t("el-radio",{attrs:{label:"name"}},[e._v("根据【节点名称】选择节点")]),t("el-radio",{attrs:{label:"label",disabled:""}},[e._v("根据【标签选择器】选择节点")]),t("el-radio",{attrs:{label:"rule"}},[e._v("根据【节点亲和性】选择节点")])],1),t("div",[e._v(" 请选择标签: "),t("el-link",{attrs:{type:"primary"},on:{click:e.chooseNode}},[t("i",{staticClass:"el-icon-thumb"},[e._v("选择标签")])]),e.selectNode?t("span",{staticClass:"chosed-tag"},[e._v("已选择标签："),t("el-tag",{attrs:{size:"mini",closable:""},on:{close:function(t){e.selectNode=null}}},[e._v(e._s(e.selectNode))])],1):e._e()],1)],1)],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit("serviceForm")}}},[e._v("确认")]),t("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("取消")])],1)],1)],1),t("el-dialog",{attrs:{title:"选择节点",visible:e.showChooseNode},on:{"update:visible":function(t){e.showChooseNode=t}}},[t("el-select",{attrs:{placeholder:"请选择环境",size:"mini"},on:{change:e.chooseEnv},model:{value:e.selectEnv,callback:function(t){e.selectEnv=t},expression:"selectEnv"}},e._l(e.deployEnvList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-table",{attrs:{data:e.nodeList},on:{"row-click":e.clickNode}},[t("el-table-column",{attrs:{label:"节点名",prop:"nodeName"}}),t("el-table-column",{attrs:{label:"节点IP",prop:"nodeIp"}})],1)],1)],1)},ai=[],si={getEnvs(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/environments?page=${e}&size=${t}&name=${a}`;g.get(r).then(e=>{s(e)}).catch(e=>{i(e)})})},getAllEnvs(){return new Promise((e,t)=>{let a="/v1/devops/environments/all";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},createEnv(e){return new Promise((t,a)=>{let s="/v1/devops/environments";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},checkEnv(e,t){return new Promise((a,s)=>{let i="/v1/devops/environment/check?checkType="+e;g.post(i,t).then(e=>{a(e)}).catch(e=>{s(e)})})},updateEnv(e){return new Promise((t,a)=>{let s="/v1/devops/environment";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteEnv(e){return new Promise((t,a)=>{let s="/v1/devops/environments/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getService(e){return new Promise((t,a)=>{let s="/v1/devops/environments/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getNodeList(e){return new Promise((t,a)=>{let s=`/v1/devops/environment/${e}/nodes`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},ii={updateGitConfig(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/system/config/git";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateMavenConfig(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/system/config/maven";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateRepository(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/system/config/repository";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},requestGitConfig(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/git";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},requestMavenConfig(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/maven";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getDefaultPipeline(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/pipe";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getImageRepository(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/repository";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},getMonitor(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/monitor";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})}},ri={data(){return{activeName:"first",serviceData:[],currentPage:1,totalSize:0,queryName:"",dialogTitle:"创建服务",showServiceDialog:!1,serviceForm:{},isEdit:!1,rules:{serviceName:[{required:!0,message:"请输入服务名称",trigger:"blur"}],description:[{required:!0,message:"请输入服务描述",trigger:"blur"}],gitUrl:[{required:!0,message:"请输入服务的git地址",trigger:"blur"}]},notConfigGit:!1,envList:[{}],volumeList:[{}],portList:[{}],showChooseNode:!1,nodeList:[],deployEnvList:[],selectEnv:"",selectWay:"",selectNode:"",strategy:"",members:[],selectedUser:null,showPop:!1}},methods:{deleteMember(e){F.removeMember(this.serviceForm.serviceId,e).then(e=>{e.data&&this.getserviceMember(this.serviceForm.serviceId)})},querySearchAsync(e,t){v.queryUserByName(e).then(e=>{let a=[];e.data.forEach(e=>{e.value=e.userName,a.push(e)}),t(a)})},handleSelect(e){F.addServiceMembers({serviceId:this.serviceForm.serviceId,userId:e.userId}).then(e=>{e.data&&(this.showPop=!this.showPop,this.getserviceMember(this.serviceForm.serviceId))})},clickNode(e){this.selectNode=e.nodeName,this.showChooseNode=!1,this.nodeList=[],this.selectEnv=""},chooseEnv(e){si.getNodeList(e).then(e=>{this.nodeList=e.data})},chooseNode(){this.showChooseNode=!0,this.deployEnvList=[],si.getAllEnvs().then(e=>{console.log(e),e.data.forEach(e=>{this.deployEnvList.push({label:e.envName,value:e.envId})})})},getNodeList(){},delPort(e){0!=e&&this.portList.splice(e,1)},delEnv(e){0!=e&&this.envList.splice(e,1)},delVolume(e){0!=e&&this.volumeList.splice(e,1)},addPort(){this.portList.push({protocol:"TCP"})},addEnv(){this.envList.push({})},addVolume(){this.volumeList.push({})},getserviceMember(e){F.getServiceMembers(e).then(e=>{this.members=e.data})},startEdit(e){this.getserviceMember(e.serviceId),this.dialogTitle="修改服务",this.isEdit=!0,this.showPop=!1,this.showServiceDialog=!0,this.serviceForm=JSON.parse(JSON.stringify(e));let t=e.containerParams;t&&(t.envParams&&t.envParams.length>0&&(this.envList=t.envParams),t.ports&&t.ports.length>0&&(this.portList=t.ports),t.volumes&&t.volumes.length>0&&(this.volumeList=t.volumes),this.selectWay=t.nodeStrategy.type,this.selectNode=t.nodeStrategy.value,this.strategy=t.strategy.type)},startDelete(e){this.$confirm(`确认删除服务【${e.serviceName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{F.deleteService(e.serviceId).then(e=>{if(1==e.data)return this.$message.success("删除服务成功"),this.closeDialog(),void this.getServices(1);this.$message.warning("删除服务失败")})})},startQuery(){this.getServices(1)},startCreate(){this.dialogTitle="添加服务",this.isEdit=!1,this.showServiceDialog=!0,this.serviceForm={}},closeDialog(){this.isEdit=!1,this.showServiceDialog=!1,this.serviceForm={}},pageChange(e){this.getServices(e)},getServices(e){let t=this.queryName;null!=t&&void 0!=t||(t=""),F.getServicesPage(e,10,t).then(t=>{this.totalSize=t.data.total,this.currentPage=e,this.serviceData=t.data.data})},submit(e){this.$refs[e].validate(e=>{if(!e)return!1;let t={envParams:this.envList,ports:this.portList,volumes:this.volumeList,nodeStrategy:{type:this.selectWay,value:this.selectNode},strategy:{type:this.strategy}};this.serviceForm.containerParams=t,this.isEdit?F.updateService(this.serviceForm).then(()=>{this.$message.success("修改成功！"),this.closeDialog(),this.getServices(1)}):F.createService(this.serviceForm).then(()=>{this.$message.success("添加成功！"),this.closeDialog(),this.getServices(1)})})},getGitEnv(){ii.requestGitConfig().then(e=>{this.notConfigGit=this.$utils.isEmpty(e.data.accessToken)})},goEnv(){this.$router.push({path:"/system"})}},created(){this.getGitEnv(),this.getServices(1)}},li=ri,oi=(a("dd00"),Object(y["a"])(li,ti,ai,!1,null,"5ebbf521",null)),ni=oi.exports,ci=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:5}},[t("div",{staticClass:"api-list"},[t("el-form",{attrs:{inline:"",size:"mini"}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"mini",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.serviceId,callback:function(t){e.serviceId=t},expression:"serviceId"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1)],1),t("div",{staticClass:"filter-text"},[t("div",{staticClass:"filter-op"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:16}},[t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-tickets"},on:{click:e.queryHistory}},[e._v("二方包构建记录")])],1),t("el-col",{attrs:{span:5}},[t("el-dropdown",{attrs:{szie:"mini"},on:{command:e.selectCommand}},[t("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(" 操作"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"api"}},[e._v("新增接口")]),t("el-dropdown-item",{attrs:{command:"dir"}},[e._v("新增目录")]),t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")]),t("el-dropdown-item",{attrs:{command:"generate"}},[e._v("生成二方包")]),t("el-dropdown-item",{attrs:{command:"import"}},[e._v("API导入")])],1)],1)],1)],1)],1),t("el-input",{attrs:{size:"mini",clearable:"",placeholder:"输入api名称过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}})],1),t("el-tree",{ref:"apiTree",attrs:{data:e.apiTreeData,"show-checkbox":"",draggable:"","node-key":"apiId","filter-node-method":e.filterNode,props:e.apiProps,"allow-drop":e.allowApiDrop,"default-expanded-keys":e.expendKeys},on:{"node-drop":e.handleApiDragEnd,"check-change":e.selectTreeNode,"node-click":e.treeNodeSelect},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("div",{staticClass:"tree-node"},[0==s.apiType?t("i",{staticClass:"el-icon-folder-opened folder-icon"}):e._e(),t("span",{staticClass:"api-name"},[e._v(e._s(a.label))]),t("div",{staticClass:"tree-op-list"},[t("el-dropdown",{on:{command:function(t){return e.selectItemCommand(t,s)}}},[t("span",[e._v(" ... ")]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[0==s.apiType?t("el-dropdown-item",{attrs:{command:"api"}},[e._v("新增接口")]):e._e(),0==s.apiType?t("el-dropdown-item",{attrs:{command:"dir"}},[e._v("新增目录")]):e._e(),t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}}])})],1)]),t("el-col",{attrs:{span:19}},[e.apiForm.apiId?t("div",{staticClass:"api-detail"},[t("el-tabs",{attrs:{"before-leave":e.beforeLeave},on:{"tab-click":e.selectTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"接口预览",name:"preview"}},[t("h4",{staticClass:"title-bar"},[e._v("接口属性")]),t("el-descriptions",{attrs:{column:2}},[t("el-descriptions-item",{attrs:{label:"接口名称"}},[e._v(e._s(e.apiForm.apiName))]),t("el-descriptions-item",{attrs:{label:"接口类型"}},[e._v(e._s(e.apiForm.type))]),t("el-descriptions-item",{attrs:{label:"接口定义"}},[t("el-tag",{attrs:{type:"success",size:"small"}},[e._v(e._s(e.apiForm.method))]),t("span",{staticClass:"uri-text"},[e._v(e._s(e.apiForm.resource))]),t("i",{staticClass:"el-icon-document-copy copy-icon",attrs:{title:"复制"},on:{click:function(t){return e.copyToClipboard(e.apiForm.resource)}}})],1),t("el-descriptions-item",{attrs:{label:"修改时间"}},[e._v(e._s(e._f("dateFormat")(e.apiForm.updateTime)))]),t("el-descriptions-item",{attrs:{label:"接口说明"}},[e._v(" "+e._s(e.apiForm.description)+" ")])],1),t("h4",{staticClass:"title-bar"},[e._v("请求参数")]),e.pathData.length>0?t("div",{staticClass:"display-param"},[t("h5",[e._v("Path路径参数")]),t("el-table",{attrs:{data:e.pathData,border:"",size:"mini"}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称",width:"150px"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型",width:"150px"}}),t("el-table-column",{attrs:{prop:"position",label:"参数位置",width:"150px"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}],null,!1,1370730974)}),t("el-table-column",{attrs:{prop:"description",label:"参数描述"}})],1)],1):e._e(),e.headerData.length>0?t("div",{staticClass:"display-param"},[t("h5",[e._v("Header")]),t("el-table",{attrs:{data:e.headerData,border:"",size:"mini"}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称",width:"200px"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型",width:"150px"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}],null,!1,1370730974)}),t("el-table-column",{attrs:{prop:"description",label:"参数描述"}})],1)],1):e._e(),e.bodyData.length>0?t("div",{staticClass:"display-param"},[t("h5",[e._v("请求body")]),t("el-table",{attrs:{data:e.bodyData,size:"mini",border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称",width:"200px"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型",width:"150px"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}],null,!1,1370730974)}),t("el-table-column",{attrs:{prop:"description",label:"参数描述"}})],1)],1):e._e(),t("h4",{staticClass:"title-bar"},[e._v("响应参数")]),t("div",{staticClass:"display-param"},[t("el-table",{attrs:{data:e.previewRes,border:"","row-key":"id",size:"mini","tree-props":{children:"children",hasChildren:"hasChildren"}}},[t("el-table-column",{attrs:{prop:"paramKey",label:"参数名称"}}),t("el-table-column",{attrs:{prop:"type",label:"参数类型"}}),t("el-table-column",{attrs:{prop:"required",label:"是否必填",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#909399"},model:{value:a.row.required,callback:function(t){e.$set(a.row,"required",t)},expression:"scope.row.required"}})]}}])}),t("el-table-column",{attrs:{prop:"type",label:"参数描述"}})],1)],1)],1),t("el-tab-pane",{attrs:{label:"接口配置",name:"edit"}},[t("el-form",{attrs:{size:"mini","label-width":"80px"},model:{value:e.apiForm,callback:function(t){e.apiForm=t},expression:"apiForm"}},[t("h4",{staticClass:"title-bar"},[e._v("接口属性")]),t("el-form-item",{attrs:{label:"接口名称"}},[t("el-input",{attrs:{placeholder:"请输入接口名称"},model:{value:e.apiForm.apiName,callback:function(t){e.$set(e.apiForm,"apiName",t)},expression:"apiForm.apiName"}})],1),t("el-form-item",{attrs:{label:"接口类型"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.apiForm.method=""}},model:{value:e.apiForm.type,callback:function(t){e.$set(e.apiForm,"type",t)},expression:"apiForm.type"}},[t("el-option",{attrs:{label:"HTTP",value:"http"}}),t("el-option",{attrs:{label:"DUBBO",value:"dubbo"}})],1)],1),t("el-form-item",{attrs:{label:"接口定义"}},[t("el-row",{attrs:{gutter:10}},["http"==e.apiForm.type?t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"请选择HTTP请求方法"},model:{value:e.apiForm.method,callback:function(t){e.$set(e.apiForm,"method",t)},expression:"apiForm.method"}},[t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1):e._e(),t("el-col",{attrs:{span:18}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"http"==e.apiForm.type?"请输入uri":"请输入dubbo的类名"},model:{value:e.apiForm.resource,callback:function(t){e.$set(e.apiForm,"resource",t)},expression:"apiForm.resource"}})],1),"dubbo"==e.apiForm.type?t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"请输入方法名"},model:{value:e.apiForm.method,callback:function(t){e.$set(e.apiForm,"method",t)},expression:"apiForm.method"}})],1):e._e()],1)],1),t("el-form-item",{attrs:{label:"接口说明"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入接口描述"},model:{value:e.apiForm.description,callback:function(t){e.$set(e.apiForm,"description",t)},expression:"apiForm.description"}})],1),t("h4",{staticClass:"title-bar"},[e._v("参数设置")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addParam}},[e._v("新增请求参数")]),t("el-tree",{staticClass:"tree-item",attrs:{data:e.paramData,props:e.defaultProps,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("div",{staticClass:"custom-node"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",disabled:s.hide,placeholder:"请输入参数名称"},model:{value:s.paramKey,callback:function(t){e.$set(s,"paramKey",t)},expression:"data.paramKey"}})],1),t("el-col",{attrs:{span:3}},[t("el-select",{staticStyle:{with:"100%"},attrs:{size:"mini",disabled:s.freezed,placeholder:"请选择参数位置"},model:{value:s.position,callback:function(t){e.$set(s,"position",t)},expression:"data.position"}},[t("el-option",{attrs:{label:"Path",value:"Path"}}),t("el-option",{attrs:{label:"Query",value:"Query"}}),t("el-option",{attrs:{label:"Header",value:"Header"}}),t("el-option",{attrs:{label:"Body",value:"Body"}})],1)],1),t("el-col",{attrs:{span:3}},[t("el-select",{staticClass:"select-type",attrs:{placeholder:"请选择参数类型",size:"mini"},on:{change:function(t){return e.paramTypeChange(t,s)}},model:{value:s.type,callback:function(t){e.$set(s,"type",t)},expression:"data.type"}},[t("el-option",{attrs:{label:"String",value:"String"}}),t("el-option",{attrs:{label:"Long",value:"Long"}}),"Body"==s.position?t("el-option",{attrs:{label:"Array",value:"Array"}}):e._e(),"Body"==s.position?t("el-option",{attrs:{label:"Object",value:"Object"}}):e._e(),t("el-option",{attrs:{label:"Boolean",value:"Boolean"}}),t("el-option",{attrs:{label:"Integer",value:"Integer"}}),t("el-option",{attrs:{label:"Float",value:"Float"}}),t("el-option",{attrs:{label:"Array",value:"Array"}})],1)],1),s.hide?e._e():t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{size:"mini",disabled:s.hide,placeholder:"选择参数是否必填"},model:{value:s.required,callback:function(t){e.$set(s,"required",t)},expression:"data.required"}},[t("el-option",{attrs:{label:"必填",value:!0}}),t("el-option",{attrs:{label:"非必填",value:!1}})],1)],1),s.hide||"Object"==s.type?e._e():t("el-col",{attrs:{span:3}},[t("el-input",{attrs:{size:"mini",disabled:s.hide,placeholder:"请输入参数默认值"},model:{value:s.defaultValue,callback:function(t){e.$set(s,"defaultValue",t)},expression:"data.defaultValue"}})],1),s.hide?e._e():t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",disabled:s.hide,placeholder:"请输入参数描述"},model:{value:s.description,callback:function(t){e.$set(s,"description",t)},expression:"data.description"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"op-icon"},[s.hide?e._e():t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.removeParam(a,s)}}}),"Object"==s.type?t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addSubParam(s)}}}):e._e()])]),"Object"==s.type?t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入Object类名,代码生成使用"},model:{value:s.objectName,callback:function(t){e.$set(s,"objectName",t)},expression:"data.objectName"}})],1):e._e()],1)],1)}}])}),t("h4",{staticClass:"title-bar"},[e._v("响应设置")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addResParam}},[e._v("新增响应参数")]),t("el-tree",{staticClass:"tree-item",attrs:{data:e.responseData,props:e.defaultProps,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function({node:a,data:s}){return t("div",{staticClass:"custom-node"},[t("el-row",{attrs:{gutter:10}},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数名称"},model:{value:s.paramKey,callback:function(t){e.$set(s,"paramKey",t)},expression:"data.paramKey"}})],1),t("el-col",{attrs:{span:3}},[t("el-select",{staticClass:"select-type",attrs:{placeholder:"请选择参数类型",size:"mini"},model:{value:s.type,callback:function(t){e.$set(s,"type",t)},expression:"data.type"}},[t("el-option",{attrs:{label:"String",value:"String"}}),t("el-option",{attrs:{label:"Long",value:"Long"}}),t("el-option",{attrs:{label:"Array",value:"Array"}}),t("el-option",{attrs:{label:"Object",value:"Object"}}),t("el-option",{attrs:{label:"Boolean",value:"Boolean"}}),t("el-option",{attrs:{label:"Integer",value:"Integer"}})],1)],1),t("el-col",{attrs:{span:3}},[t("el-select",{attrs:{size:"mini",placeholder:"选择参数是否必填"},model:{value:s.required,callback:function(t){e.$set(s,"required",t)},expression:"data.required"}},[t("el-option",{attrs:{label:"必填",value:!0}}),t("el-option",{attrs:{label:"非必填",value:!1}})],1)],1),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入参数描述"},model:{value:s.description,callback:function(t){e.$set(s,"description",t)},expression:"data.description"}})],1),t("el-col",{attrs:{span:2}},[t("div",{staticClass:"op-icon",on:{click:function(t){return e.addSubParam(s)}}},[t("i",{staticClass:"el-icon-remove-outline",on:{click:function(t){return e.removeParam(a,s)}}}),"Object"==s.type?t("i",{staticClass:"el-icon-circle-plus-outline",on:{click:function(t){return e.addSubParam(s)}}}):e._e()])]),"Object"==s.type?t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{size:"mini",placeholder:"请输入Object类名,代码生成使用"},model:{value:s.objectName,callback:function(t){e.$set(s,"objectName",t)},expression:"data.objectName"}})],1):e._e()],1)],1)}}])}),t("h4",{staticClass:"title-bar"},[e._v("代码生成配置")]),t("el-form-item",{attrs:{label:"文件类名","label-width":"120px"}},[t("div",[t("el-input",{attrs:{placeholder:"请输入类名"},model:{value:e.apiForm.className,callback:function(t){e.$set(e.apiForm,"className",t)},expression:"apiForm.className"}},[t("el-input",{attrs:{slot:"append",placeholder:"请输入接口方法名称"},slot:"append",model:{value:e.apiForm.classMethod,callback:function(t){e.$set(e.apiForm,"classMethod",t)},expression:"apiForm.classMethod"}})],1)],1)]),e.isHaveBody?t("el-form-item",{attrs:{label:"body请求体类名","label-width":"120px"}},[t("el-input",{attrs:{placeholder:"请输入body请求体类名"},model:{value:e.apiForm.bodyClass,callback:function(t){e.$set(e.apiForm,"bodyClass",t)},expression:"apiForm.bodyClass"}})],1):e._e(),e.responseData.length>0?t("el-form-item",{attrs:{label:"响应体类名","label-width":"120px"}},[t("el-input",{attrs:{placeholder:"请输入接口响应类名"},model:{value:e.apiForm.resultClass,callback:function(t){e.$set(e.apiForm,"resultClass",t)},expression:"apiForm.resultClass"}})],1):e._e()],1)],1)],1)],1):t("el-empty",{attrs:{description:"请在左侧选择接口"}})],1)],1)],1),"edit"==e.activeName?t("div",{staticClass:"save-btn"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-upload",size:"small"},on:{click:e.saveApi}},[e._v("保存配置")])],1):e._e(),t("el-dialog",{attrs:{title:"创建目录",visible:e.showCreateApi,width:"50%","before-close":e.cancelCreate},on:{"update:visible":function(t){e.showCreateApi=t}}},[t("el-form",{ref:"dataForm",attrs:{model:e.dataForm,"label-width":"80px",size:"mini",rules:e.apiRule}},[t("el-form-item",{attrs:{label:"名称",prop:"apiName"}},[t("el-input",{model:{value:e.dataForm.apiName,callback:function(t){e.$set(e.dataForm,"apiName",t)},expression:"dataForm.apiName"}})],1),e.createDir?e._e():t("el-form-item",{attrs:{label:"接口类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.dataForm.type,callback:function(t){e.$set(e.dataForm,"type",t)},expression:"dataForm.type"}},[t("el-option",{attrs:{label:"Rest Http",value:"http"}}),t("el-option",{attrs:{label:"Dubbo",value:"dubbo"}})],1)],1),e.createDir?e._e():t("el-form-item",{attrs:{label:"接口定义",prop:"resource"}},[t("el-row",{attrs:{gutter:10}},["http"==e.dataForm.type?t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"选择请求方法"},model:{value:e.dataForm.method,callback:function(t){e.$set(e.dataForm,"method",t)},expression:"dataForm.method"}},[t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1):e._e(),t("el-col",{attrs:{span:18}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"http"==e.dataForm.type?"请输入uri":"请输入dubbo的类名"},model:{value:e.dataForm.resource,callback:function(t){e.$set(e.dataForm,"resource",t)},expression:"dataForm.resource"}})],1),"dubbo"==e.dataForm.type?t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"请输入方法名"},model:{value:e.dataForm.method,callback:function(t){e.$set(e.dataForm,"method",t)},expression:"dataForm.method"}})],1):e._e()],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelCreate}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitApi("dataForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"构建Maven二方包",visible:e.showGenerateApi,width:"60%"},on:{"update:visible":function(t){e.showGenerateApi=t},open:e.getBuildParam}},[t("el-form",{ref:"generateForm",attrs:{model:e.generateForm,"label-width":"80px",size:"mini",rules:e.generateRule}},[t("el-form-item",{attrs:{label:"包路径",prop:"packageName"}},[t("el-input",{attrs:{placeholder:"请输入二方包路径，例如:com.zj.windy"},model:{value:e.generateForm.packageName,callback:function(t){e.$set(e.generateForm,"packageName",t)},expression:"generateForm.packageName"}})],1),t("el-form-item",{attrs:{label:"GroupId",prop:"groupId"}},[t("el-input",{attrs:{placeholder:"请输入GroupId"},model:{value:e.generateForm.groupId,callback:function(t){e.$set(e.generateForm,"groupId",t)},expression:"generateForm.groupId"}})],1),t("el-form-item",{attrs:{label:"ArtifactId",prop:"artifactId"}},[t("el-input",{attrs:{placeholder:"请输入ArtifactId"},model:{value:e.generateForm.artifactId,callback:function(t){e.$set(e.generateForm,"artifactId",t)},expression:"generateForm.artifactId"}})],1),t("el-form-item",{attrs:{label:"Version",prop:"version"}},[t("el-input",{attrs:{placeholder:"请输入二方包版本号"},model:{value:e.generateForm.version,callback:function(t){e.$set(e.generateForm,"version",t)},expression:"generateForm.version"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelGenerate}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitGenerate("generateForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"二方包构建记录",visible:e.isShowLog,width:"70%","before-close":e.closeLog},on:{"update:visible":function(t){e.isShowLog=t},open:e.openLog}},[t("el-form",{attrs:{size:"mini"},model:{value:e.logForm,callback:function(t){e.logForm=t},expression:"logForm"}},[t("el-form-item",{attrs:{label:"版本"}},[t("el-select",{attrs:{placeholder:"请选择历史构建版本"},on:{change:e.selectVersion},model:{value:e.logRecordId,callback:function(t){e.logRecordId=t},expression:"logRecordId"}},e._l(e.logVersions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"节点状态"}},[t("el-tag",{attrs:{type:e._f("statusFormat")(e.logForm.status)}},[e._v(e._s(e._f("statusName")(e.logForm.status)))])],1),t("el-form-item",{attrs:{label:"执行时间"}},[e._v(e._s(e._f("dateFormat")(e.logForm.time)))])],1),t("el-divider",[t("i",{staticClass:"el-icon-receiving"})]),t("h4",[e._v("运行日志")]),t("div",{staticClass:"log-list"},[t("ul",e._l(e.logForm.messageList,(function(a,s){return t("li",{key:s},[t("span",[e._v(e._s(a))])])})),0)])],1),t("el-dialog",{attrs:{title:"三方API导入",visible:e.showImportDialog},on:{"update:visible":function(t){e.showImportDialog=t}}},[t("el-form",{attrs:{size:"mini",rules:e.importRule},model:{value:e.importForm,callback:function(t){e.importForm=t},expression:"importForm"}},[t("el-form-item",{attrs:{label:"导入类型",prop:"type"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.importForm.type,callback:function(t){e.$set(e.importForm,"type",t)},expression:"importForm.type"}},[t("el-option",{attrs:{label:"Yapi-JSON文件",value:"Yapi"}}),t("el-option",{attrs:{label:"Postman文件",value:"Postman"}})],1)],1),t("el-form-item",{attrs:{label:"文件上传"}},[t("el-upload",{attrs:{drag:"",action:"#","auto-upload":!0,"http-request":e.httpRequest}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 目前只支持Yapi导出的json文件、Postman文件导入 ")])])],1)],1)],1)],1)},di=[],ui={data(){return{logInterval:null,logRecordId:"",logVersions:[],isShowLog:!1,logForm:{},generateForm:{},showGenerateApi:!1,activeName:"preview",filterText:"",apiForm:{},paramData:[],responseData:[],apiTreeData:[],defaultProps:{children:"children",label:"paramKey"},apiProps:{children:"children",label:"apiName"},pathData:[],headerData:[],bodyData:[],previewRes:[],uuid:1,serviceList:[],serviceId:"",currentApi:"",showCreateApi:!1,dataForm:{type:"http"},apiRule:{apiName:[{required:!0,message:"请输入名称",trigger:"blur"}],type:[{required:!0,message:"请选择接口类型",trigger:"blur"}],resource:[{required:!0,message:"请输入api",trigger:"blur"},{validator:this.validApi,message:"请填写方法",trigger:"blur"}]},generateRule:{packageName:[{required:!0,message:"请输入包路径",trigger:"blur"}],groupId:[{required:!0,message:"请输入groupId",trigger:"blur"}],artifactId:[{required:!0,message:"请输入artifactId",trigger:"blur"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"}]},createDir:!1,selectNodes:[],isLeaving:!1,updateApi:!1,showImportDialog:!1,importForm:{},importRule:{type:[{required:!0,message:"请选择导入文件类型",trigger:"blur"}]},loading:null,expendKeys:[]}},watch:{filterText(e){this.$refs.apiTree.filter(e)},apiForm:{handler(e,t){t&&t.apiName&&(this.updateApi=!0)},deep:!0,immediate:!0},paramData:{handler(e,t){t&&t.length>0&&(this.updateApi=!0)},deep:!0,immediate:!0}},methods:{copyToClipboard(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.$message.success("复制成功")},httpRequest(e){const t=new FormData;t.append("file",e.file),t.append("type",this.importForm.type),t.append("serviceId",this.serviceId),this.showLoading(),F.importApi(t).then(e=>{this.closeLoading(),e.data.apiList?(this.$message.success("导入api成功"),this.showImportDialog=!1,this.selectService()):(this.$message.error("导入api失败"),this.showImportDialog=!1)})},showLoading(){this.loading=this.$loading({lock:!0,text:"文件导入中...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"})},closeLoading(){this.loading.close()},allowApiDrop(e,t,a){let s=t.data;return"inner"!=a||0==s.apiType},handleApiDragEnd(e,t){let a=JSON.parse(JSON.stringify(e.data));a.parentId=t.data.apiId,0!=t.data.apiType&&(a.parentId=null),a.requestParams=JSON.parse(a.requestParams),a.responseParams=JSON.parse(a.responseParams),F.updateApi(a)},beforeLeave(e,t){return!("edit"==t&&!this.isLeaving&&this.updateApi)||(this.$confirm("当前页面存在数据变更，离开后数据可能丢失，确认离开?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.isLeaving=!0,this.activeName=e,this.selectTab(),this.updateApi=!1}).catch(()=>{}),!1)},selectTreeNode(e,t){if(t)this.selectNodes.push(e.apiId);else{let t=this.selectNodes.indexOf(e.apiId);-1!=t&&this.selectNodes.splice(t,1)}},validApi(e,t,a){""==this.dataForm.method||null==this.dataForm.method?a(new Error):a()},selectItemCommand(e,t){"dir"!=e?"api"!=e?"delete"==e&&F.deleteApi(t.apiId).then(e=>{e.data?(this.$message.success("删除成功"),this.selectService()):this.$message.error("删除失败")}):this.addApi(t):this.addFolder(t)},treeNodeSelect(e){0!=e.apiType&&(this.apiForm=JSON.parse(JSON.stringify(e)),console.log("show item",this.apiForm),this.paramData=JSON.parse(e.requestParams),this.paramData||(this.paramData=[]),this.paramData.forEach(e=>{(e.objectName=e.children&&e.children[0]&&"Object"==e.children[0].objectName)&&(e.children[0].hide=!0,e.children[0].freezed=!0)}),console.log("show paramData",this.paramData),this.responseData=JSON.parse(e.responseParams),this.responseData||(this.responseData=[]),this.currentApi=e.apiId,this.updateApi=!1,this.selectTab())},addFolder(e){this.createDir=!0,this.showCreateApi=!0,this.dataForm.parentId=e.apiId,this.dataForm.apiType=0},addApi(e){this.createDir=!1,this.showCreateApi=!0,this.dataForm.parentId=e.apiId,this.dataForm.apiType=1},cancelGenerate(){this.generateForm={},this.showGenerateApi=!1},getBuildParam(){F.getGenerate(this.serviceId).then(e=>{e.data&&(this.generateForm=e.data)})},submitGenerate(e){this.$refs[e].validate(e=>{if(!e)return!1;this.generateForm.serviceId=this.serviceId,F.buildGenerate(this.generateForm).then(e=>{e.data?(this.$message.success("开始构建"),this.showGenerateApi=!1,this.isShowLog=!0,this.queryHistory()):this.$message.error("触发构建任务失败")})})},submitApi(e){this.$refs[e].validate(e=>{if(!e)return!1;this.dataForm.serviceId=this.serviceId,F.createApi(this.dataForm).then(e=>{e.data?(this.$message.success("添加成功"),this.selectService(),this.cancelCreate()):this.$message.error("添加失败")})})},selectCommand(e){"generate"!=e?"import"!=e?"delete"!=e?(this.createDir="dir"==e,this.showCreateApi=!0,this.dataForm.apiType=this.createDir?0:1):F.batchDeleteApi(this.selectNodes).then(e=>{e.data?(this.$message.success("删除成功"),this.selectService()):this.$message.error("删除失败")}):this.showImportDialog=!0:this.showGenerateApi=!0},cancelCreate(){this.showCreateApi=!1,this.dataForm={type:"http"}},saveApi(){let e=this.apiForm;e.serviceId=this.serviceId,this.recursionName(this.paramData),this.recursionName(this.responseData),e.requestParams=this.paramData,e.responseParams=this.responseData,""==this.currentApi?F.createApi(e).then(t=>{t.data?(this.$message.success("添加接口成功"),this.updateApi=!1,this.expendKeys=[e.apiId],this.selectService()):this.$message.error("添加接口失败")}):F.updateApi(e).then(t=>{t.data&&(this.$message.success({showClose:!0,message:"修改接口成功"}),this.expendKeys=[e.apiId],this.selectService(),this.updateApi=!1)})},recursionName(e){e.forEach(e=>{this.$utils.isEmpty(e.objectName)&&(e.objectName=e.type),e.children&&e.children.length>0&&this.recursionName(e.children)})},selectTab(){this.isLeaving=!1,"preview"==this.activeName&&(this.pathData=[],this.headerData=[],this.bodyData=[],this.traverseTree(this.paramData),console.log("this.paramData",this.paramData),this.paramData.forEach(e=>{"Path"!=e.position&&"Query"!=e.position||this.pathData.push(e),"Header"==e.position&&this.headerData.push(e),"Body"==e.position&&this.bodyData.push(e)}),this.previewRes=JSON.parse(JSON.stringify(this.responseData)),this.traverseTree(this.previewRes))},traverseTree(e){for(const t of e)t.id=this.$utils.randomString();for(const t of e)t.children&&t.children.length>0&&this.traverseTree(t.children)},filterNode(e,t){return!e||-1!==t.apiName.indexOf(e)},removeParam(e,t){const a=e.parent,s=a.data.children||a.data,i=s.findIndex(e=>e.id===t.id);s.splice(i,1)},paramTypeChange(e,t){"Array"==e&&(t.children=[{type:"String",paramKey:" ",position:t.position,require:!0,hide:!0,freezed:!0,children:[]}])},addParam(){this.paramData.push({id:this.$utils.randomString(),paramKey:"",children:[]}),this.uuid++},addSubParam(e){if(e.children)return e.children.push({id:this.uuid,paramKey:"",children:[],position:e.position,freezed:!0}),void this.uuid++;e.children=[{id:this.uuid,paramKey:"",children:[],position:e.position,freezed:!0}],this.uuid++},addResParam(){this.responseData.push({id:this.uuid,paramKey:"",children:[]}),this.uuid++},selectService(){F.getApiList(this.serviceId).then(e=>{this.apiTreeData=this.buildTree(e.data),setTimeout(()=>{this.$refs.apiTree.filter(this.filterText)},100)})},buildTree(e,t=null){let a=[];for(let s of e)if(s.parentId===t){let t=this.buildTree(e,s.apiId);t.length>0&&(s.children=t),s.children||(s.children=[]),a.push(s)}return a},openLog(){this.logInterval=setInterval(()=>{this.queryHistory()},2e3)},queryHistory(){F.getGenerateLog(this.serviceId).then(e=>{let t=[];e.data.forEach(e=>{let a=JSON.parse(e.executeParams);a.time=e.updateTime,a.status=e.status,a.label=a.version,a.value=e.recordId,a.messageList=JSON.parse(e.result),t.push(a)}),this.logVersions=t,this.isShowLog=!0,!this.logRecordId&&this.logVersions.length>0&&(this.logRecordId=this.logVersions[0].value),this.selectVersion(this.logRecordId)})},selectVersion(e){this.logForm={},this.logVersions.forEach(t=>{t.value==e&&(this.logForm=t)})},closeLog(){this.isShowLog=!1,this.logVersions=[],this.logForm={},this.logRecordId=null,this.logInterval&&clearInterval(this.logInterval)},getServices(){this.serviceList=[],F.getServices().then(e=>{this.serviceList=e.data,this.serviceId=this.serviceList[0].serviceId,this.selectService()})}},computed:{isHaveBody:function(){let e=!1;return this.paramData.forEach(t=>{"Body"==t.position&&(e=!0)}),e}},created(){this.getServices()}},pi=ui,mi=(a("f4a6"),a("2b2d"),Object(y["a"])(pi,ci,di,!1,null,"6162b46c",null)),hi=mi.exports,gi=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("div",{staticClass:"title"},[t("div",[t("el-form",{attrs:{inline:!0,size:"mini"}},[t("el-form-item",{attrs:{label:"环境名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入环境名称"},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.createEnv}},[e._v("新增环境")])],1)],1)],1)]),t("div",[t("el-row",{attrs:{gutter:40}},e._l(e.envData,(function(a,s){return t("el-col",{key:s,attrs:{span:6}},[t("el-card",{staticClass:"env-card",attrs:{shadow:"always","body-style":{padding:"15px"}}},[t("div",[t("span",{staticClass:"env-name"},[e._v(e._s(a.envName)+" ")]),t("img",{staticClass:"env-img",attrs:{src:a.img,width:"40",height:"40"}})]),t("div",[t("div",{staticClass:"status-icon"},[t("el-tag",{attrs:{type:e._f("statusFormat")(a.envStatus),size:"medium"}},[e._v(e._s(e._f("deployFormat")(a.envStatus)))])],1),t("div",{staticClass:"op-line"},[t("el-button",{attrs:{icon:"el-icon-edit-outline",type:"text"},on:{click:function(t){return e.handleEdit(a)}}},[e._v("编辑")]),t("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")])],1)])])],1)})),1),t("div",{staticClass:"page-index"},[t("el-pagination",{attrs:{"page-size":10,"current-page":e.currentPage,layout:"prev, pager, next",total:e.totalSize},on:{"current-change":e.pageChange}})],1)],1),t("el-dialog",{attrs:{title:e.titleName,visible:e.showEnvDialog,width:"60%"},on:{"update:visible":function(t){e.showEnvDialog=t}}},[t("el-form",{attrs:{model:e.envForm,"label-width":"80px",size:"mini"}},[t("el-form-item",{attrs:{label:"环境名称",prop:"envName"}},[t("el-input",{attrs:{placeholder:"请输入环境名称"},model:{value:e.envForm.envName,callback:function(t){e.$set(e.envForm,"envName",t)},expression:"envForm.envName"}})],1),t("el-form-item",{attrs:{label:"部署类型",prop:"envType"}},[t("el-radio-group",{on:{change:e.selectType},model:{value:e.envForm.envType,callback:function(t){e.$set(e.envForm,"envType",t)},expression:"envForm.envType"}},[t("el-radio",{attrs:{label:1}},[e._v("SSH部署")]),t("el-radio",{attrs:{label:2}},[e._v("K8S部署")])],1)],1),t("el-form-item",[t("el-form",{attrs:{"label-width":"120px",size:"mini"}},e._l(e.paramsList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.name}},[t("el-input",{attrs:{placeholder:a.desc},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)})),1)],1),t("el-form-item",{attrs:{label:"环境状态",prop:"envStatus"}},[t("el-row",[t("el-col",{attrs:{span:3}},[t("el-switch",{attrs:{disabled:e.limited},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}})],1),t("el-col",{attrs:{span:6}},[t("el-button",{staticClass:"check",attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.checkStatus}},[e._v("检测")])],1)],1)],1),t("el-alert",{attrs:{title:"检测提示",description:"只有通过检测之后环境才可使用，点击检测按钮即可",type:"info",closable:!1,"show-icon":""}})],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancellDialog}},[e._v(" 取消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submit}},[e._v(" 确定")])],1)],1)],1)},vi=[],fi=a("6c62"),bi=a.n(fi),yi=a("2039"),wi=a.n(yi),ki={data(){return{currentPage:1,totalSize:0,envData:[],queryName:"",showEnvDialog:!1,envForm:{},titleName:"创建环境",limited:!0,isEdit:!1,checked:!1,sshParams:[{key:"sshIp",value:"",name:"访问IP",desc:"请输入访问ssh的IP"},{key:"sshPort",value:"22",name:"访问端口",desc:"请输入访问ssh的端口"},{key:"user",value:"",name:"ssh用户",desc:"请输入访问ssh所使用的用户"},{key:"password",value:"",name:"ssh密码",desc:"请输入访问ssh所使用的密码"},{key:"remotePath",value:"",name:"远端路径",desc:"请输入ssh远端服务的运行路径"}],k8sParams:[{key:"apiService",value:"",name:"Api服务",desc:"请输入访问k8s的ApiService地址"},{key:"token",value:"",name:"访问token",desc:"请输入访问k8s的地址"},{key:"repository",value:"",name:"镜像仓库",desc:"请输入访问k8s镜像仓库的地址,填写后覆盖默认仓库地址"},{key:"namespace",value:"",name:"命名空间",desc:"请输入部署的Namespace"},{key:"secretName",value:"",name:"Secret名称",desc:"请输入拉取镜像的Secret名称"}],paramsList:[]}},methods:{pageChange(e){this.currentPage=e,this.getEnvs()},handleDelete(e){this.$confirm(`确认删除环境【${e.envName}】?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{si.deleteEnv(e.envId).then(e=>{e.data?(this.$message.success("删除环境成功"),this.getEnvs()):this.$message.error("删除环境失败")})})},handleEdit(e){this.showEnvDialog=!0,this.isEdit=!0,this.titleName="修改环境",this.paramsList=this.translate(e),this.limited=2==e.envStatus,this.envForm=JSON.parse(JSON.stringify(e)),this.checked=1==e.envStatus},translate(e){let t=[],a=JSON.parse(e.envParams);return 1==e.envType&&(this.setValue(this.sshParams,a),t=this.sshParams),2==e.envType&&(this.setValue(this.k8sParams,a),t=this.k8sParams),t},setValue(e,t){e.forEach(e=>{let a=t[e.key];a&&(e.value=a)})},submit(){let e=this.envForm,t={};this.paramsList.forEach(e=>{t[e.key]=e.value}),e.envParams=JSON.stringify(t),e.envStatus=2,this.checked&&(e.envStatus=1),this.isEdit?si.updateEnv(e).then(e=>{e.data?(this.$message.success("修改环境成功"),this.cancellDialog(),this.getEnvs()):this.$message.error("修改环境失败")}):si.createEnv(e).then(e=>{e.data?(this.$message.success("添加环境成功"),this.cancellDialog(),this.getEnvs()):this.$message.error("添加环境失败")})},cancellDialog(){this.showEnvDialog=!1,this.envForm={}},selectType(e){this.paramsList=[],1==e&&(this.paramsList=JSON.parse(JSON.stringify(this.sshParams))),2==e&&(this.paramsList=JSON.parse(JSON.stringify(this.k8sParams)))},getEnvs(){this.envData=[],si.getEnvs(this.currentPage,10,this.queryName).then(e=>{e.data.data&&(e.data.data.forEach(e=>{e.configList=this.translate(e),1==e.envType&&(e.img=wi.a),2==e.envType&&(e.img=bi.a),this.envData.push(e)}),this.totalSize=e.data.total)})},checkStatus(){let e={};this.paramsList.forEach(t=>{e[t.key]=t.value}),si.checkEnv(this.envForm.envType,e).then(e=>{e.data?(this.$message.success("环境校验成功"),this.limited=!1,this.checked=!0):(this.checked=!1,this.limited=!0,this.$message.error("环境校验失败"))})},startQuery(){this.getEnvs()},createEnv(){this.showEnvDialog=!0,this.envForm={envType:1},this.selectType(1),this.limited=!0,this.isEdit=!1,this.titleName="创建环境"}},created(){this.getEnvs()}},Ci=ki,_i=(a("9fa8"),Object(y["a"])(Ci,gi,vi,!1,null,"37af8ada",null)),Fi=_i.exports,xi=function(){var e=this,t=e._self._c;return t("div",[t("el-alert",{staticClass:"tips-info",attrs:{title:"消息提示",type:"info",closable:!1,description:"系统配置作用于全局，请谨慎操作","show-icon":""}}),t("div",{staticClass:"content"},[t("el-tabs",{attrs:{"tab-position":"left"},on:{"tab-click":e.clickTab},model:{value:e.configType,callback:function(t){e.configType=t},expression:"configType"}},[t("el-tab-pane",{attrs:{label:"Git配置",name:"git"}},[t("el-form",{attrs:{model:e.systemForm,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"类型",prop:"gitType"}},[t("el-radio-group",{on:{change:e.changeGit},model:{value:e.systemForm.gitType,callback:function(t){e.$set(e.systemForm,"gitType",t)},expression:"systemForm.gitType"}},[t("el-radio",{attrs:{label:"Gitea"}},[e._v("Gitea")]),t("el-radio",{attrs:{label:"Gitlab"}},[e._v("Gitlab")])],1)],1),t("el-form-item",{attrs:{label:"地址",prop:"gitDomain"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入git访问地址"},model:{value:e.systemForm.gitDomain,callback:function(t){e.$set(e.systemForm,"gitDomain",t)},expression:"systemForm.gitDomain"}})],1),"Gitlab"!=e.systemForm.gitType?t("el-form-item",{attrs:{label:"拥有者",prop:"owner"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入git拥有者"},model:{value:e.systemForm.owner,callback:function(t){e.$set(e.systemForm,"owner",t)},expression:"systemForm.owner"}})],1):e._e(),t("el-form-item",{attrs:{label:"访问token",prop:"accessToken"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入git访问token"},model:{value:e.systemForm.accessToken,callback:function(t){e.$set(e.systemForm,"accessToken",t)},expression:"systemForm.accessToken"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitGit}},[e._v("提交")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"镜像仓库配置",name:"repo"}},[t("el-form",{attrs:{model:e.repoForm,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"仓库地址",prop:"repositoryUrl"}},[t("el-input",{attrs:{type:"text",placeholder:"请输入镜像仓库地址"},model:{value:e.repoForm.repositoryUrl,callback:function(t){e.$set(e.repoForm,"repositoryUrl",t)},expression:"repoForm.repositoryUrl"}})],1),t("el-form-item",{attrs:{label:"用户",prop:"userName"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的用户"},model:{value:e.repoForm.userName,callback:function(t){e.$set(e.repoForm,"userName",t)},expression:"repoForm.userName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的密码"},model:{value:e.repoForm.password,callback:function(t){e.$set(e.repoForm,"password",t)},expression:"repoForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitImage}},[e._v("提交")])],1)],1)],1),t("el-tab-pane",{attrs:{label:"Maven配置",name:"maven"}},[t("el-form",{attrs:{model:e.mavenForm,size:"mini","label-width":"120px"}},[t("h5",[e._v("Maven仓库")]),t("el-form-item",{attrs:{label:"推送远程仓库",prop:"mavenUrl"}},[t("el-input",{attrs:{type:"text",placeholder:"仓库地址"},model:{value:e.mavenForm.mavenUrl,callback:function(t){e.$set(e.mavenForm,"mavenUrl",t)},expression:"mavenForm.mavenUrl"}})],1),t("el-form-item",{attrs:{label:"用户",prop:"userName"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的用户"},model:{value:e.mavenForm.userName,callback:function(t){e.$set(e.mavenForm,"userName",t)},expression:"mavenForm.userName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"text",placeholder:"访问镜像仓库的密码"},model:{value:e.mavenForm.password,callback:function(t){e.$set(e.mavenForm,"password",t)},expression:"mavenForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submitMaven}},[e._v("提交")])],1)],1)],1)],1)],1)],1)},Ii=[],Di={data(){return{systemForm:{},repoForm:{},mavenForm:{},configType:"git"}},methods:{changeGit(e){"Gitlab"==e&&(this.systemForm.owner="oauth2"),"Gitlab"!=e&&"oauth2"==this.systemForm.owner&&(this.systemForm.owner="")},getGitConfig(){ii.requestGitConfig().then(e=>{this.systemForm=e.data})},getRepoConfig(){ii.getImageRepository().then(e=>{this.repoForm=e.data})},getMavenConfig(){ii.requestMavenConfig().then(e=>{this.mavenForm=e.data})},submitMaven(){ii.updateMavenConfig(this.mavenForm).then(e=>{e.data?this.$message.success("修改Maven配置成功"):this.$message.error("修改Maven配置失败")})},submitGit(){ii.updateGitConfig(this.systemForm).then(e=>{e.data?this.$message.success("修改Git配置成功"):this.$message.error("修改Git配置失败")})},submitImage(){ii.updateRepository(this.repoForm).then(e=>{e.data?this.$message.success("修改镜像仓库成功"):this.$message.error("修改镜像仓库失败")})},clickTab(){"git"==this.configType&&this.getGitConfig(),"repo"==this.configType&&this.getRepoConfig(),"maven"==this.configType&&this.getMavenConfig()}},created(){this.getGitConfig()}},Ti=Di,Pi=(a("1aee"),Object(y["a"])(Ti,xi,Ii,!1,null,"3ab6fbdb",null)),Si=Pi.exports,Li=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content"},[t("el-alert",{staticClass:"tips-info",attrs:{title:"消息提示",type:"info",description:"以下是对master与client的监控，相比较下master更需要关注内存使用情况，client更关心cpu与线程数","show-icon":""}}),t("div",[t("div",[t("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"mini"},on:{click:e.refresh}},[e._v(" 刷新状态")])],1),t("el-divider",{attrs:{"content-position":"left"}},[e._v("Master节点")]),t("div",[t("el-table",{attrs:{data:e.masterData}},[t("el-table-column",{attrs:{label:"Master IP"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-monitor"}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.ip))])]}}])}),t("el-table-column",{attrs:{label:"cpu",prop:"cpu"}}),t("el-table-column",{attrs:{label:"内存",prop:"heap"}}),t("el-table-column",{attrs:{label:"线程数",prop:"threads"}}),t("el-table-column",{attrs:{label:"任务数",prop:"size"}}),t("el-table-column",{attrs:{label:"垃圾收集"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"right",width:"600",trigger:"click"}},[t("el-table",{attrs:{data:a.row.histories}},[t("el-table-column",{attrs:{width:"300",property:"collector",label:"收集器"}}),t("el-table-column",{attrs:{width:"150",property:"collectCount",label:"收集次数"}}),t("el-table-column",{attrs:{width:"150",property:"collectTime",label:"收集耗时"}})],1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"primary"},slot:"reference"},[e._v("查看垃圾回收")])],1)]}}])})],1)],1)],1),t("div",{staticClass:"client"},[t("el-divider",{attrs:{"content-position":"left"}},[e._v("Client节点")]),t("el-table",{attrs:{data:e.clientData}},[t("el-table-column",{attrs:{label:"Client IP"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-monitor"}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(a.row.ip))])]}}])}),t("el-table-column",{attrs:{label:"cpu",prop:"cpu"}}),t("el-table-column",{attrs:{label:"内存",prop:"heap"}}),t("el-table-column",{attrs:{label:"线程数",prop:"threads"}}),t("el-table-column",{attrs:{label:"任务数",prop:"size"}}),t("el-table-column",{attrs:{label:"垃圾收集"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"right",width:"600",trigger:"click"}},[t("el-table",{attrs:{data:a.row.histories}},[t("el-table-column",{attrs:{width:"300",property:"collector",label:"收集器"}}),t("el-table-column",{attrs:{width:"150",property:"collectCount",label:"收集次数"}}),t("el-table-column",{attrs:{width:"150",property:"collectTime",label:"收集耗时"}})],1),t("el-button",{attrs:{slot:"reference",size:"mini",type:"primary"},slot:"reference"},[e._v("查看垃圾回收")])],1)]}}])})],1)],1)],1)},Ni=[],$i={data(){return{clientData:[],masterData:[]}},methods:{refresh(){this.getMonitor()},getMonitor(){this.clientData=[],this.masterData=[],ii.getMonitor().then(e=>{e.data.clients.forEach(e=>{let t=e.physics;t.size=e.waitQuerySize,this.clientData.push(t)}),e.data.masters.forEach(e=>{let t=e.physics;t.size=e.taskCount,this.masterData.push(t)})})}},created(){this.getMonitor()}},Ei=$i,zi=(a("b4e1"),Object(y["a"])(Ei,Li,Ni,!1,null,"7f3459fe",null)),Ri=zi.exports,Oi=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title-line"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,size:"mini"}},[t("el-form-item",{attrs:{label:"服务列表"}},[t("el-select",{attrs:{size:"small","reserve-keyword":"",placeholder:"请输入搜索的服务名"},on:{change:e.selectService},model:{value:e.serviceId,callback:function(t){e.serviceId=t},expression:"serviceId"}},e._l(e.pipelines,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("div",{staticClass:"content"},[t("el-row",[t("el-col",{attrs:{span:4}},[t("div",{staticClass:"left-content"},[t("div",{staticClass:"op-line"},[t("el-dropdown",{attrs:{placement:"bottom-end"},on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-edit"}),e._v("管理"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"new"}},[t("i",{staticClass:"el-icon-circle-plus"}),e._v("新增")])],1)],1)],1),t("div",{staticClass:"pipeline-list"},[t("el-collapse",{model:{value:e.activePipelines,callback:function(t){e.activePipelines=t},expression:"activePipelines"}},[t("el-collapse-item",{attrs:{name:"1"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-promotion title-icon"}),e._v(" 发布流水线 ")]),e._l(e.publishList,(function(a,s){return t("div",{key:s,staticClass:"pipeline-item",class:{"selected-line":a.selected}},[t("span",{on:{click:function(t){return e.selectPipeline(a)}}},[e._v(e._s(a.pipelineName))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:function(t){return e.operateLine(t,a)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}))],2),t("el-collapse-item",{attrs:{name:"2"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-cpu title-icon"}),e._v(" 定时流水线 ")]),e._l(e.buildList,(function(a,s){return t("div",{key:s,staticClass:"pipeline-item",class:{"selected-line":a.selected}},[t("span",{on:{click:function(t){return e.selectPipeline(a)}}},[e._v(e._s(a.pipelineName))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:function(t){return e.operateLine(t,a)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}))],2),t("el-collapse-item",{attrs:{name:"3"}},[t("template",{slot:"title"},[t("i",{staticClass:"el-icon-s-custom title-icon"}),e._v(" 自定义流水线 ")]),e._l(e.customList,(function(a,s){return t("div",{key:s,staticClass:"pipeline-item",class:{"selected-line":a.selected}},[t("span",{on:{click:function(t){return e.selectPipeline(a)}}},[e._v(e._s(a.pipelineName))]),t("div",{staticStyle:{float:"right"}},[t("el-dropdown",{on:{command:function(t){return e.operateLine(t,a)}}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"delete"}},[e._v("删除")])],1)],1)],1)])}))],2)],1)],1)])]),e.currentPipeline.pipelineConfig&&e.currentPipeline.pipelineConfig.length<=0?t("el-empty",{attrs:{description:"请在左侧点击流水线查看详情"}},[t("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(t){return e.handleCommand("new")}}},[e._v("创建流水线?")])],1):t("el-col",{attrs:{span:20}},[t("div",{staticClass:"pipe-op-div"},[e.isRunning?t("el-button",{attrs:{type:"primary",icon:"el-icon-video-pause",size:"mini"},on:{click:e.pausePipeline}},[e._v("停止")]):t("el-button",{directives:[{name:"clickOnce",rawName:"v-clickOnce"}],attrs:{type:"primary",icon:"el-icon-video-play",size:"mini",disabled:1!=e.currentPipeline.executeType},on:{click:e.startPipeline}},[e._v("运行")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:e.startEdit}},[e._v("编辑")]),1!=e.currentPipeline.pipelineType?t("el-button",{attrs:{type:"primary",icon:"el-icon-setting",size:"mini"},on:{click:function(t){e.showGitConfig=!e.showGitConfig}}},[e._v("Git配置")]):e._e(),t("el-button",{attrs:{type:"info",icon:"el-icon-view",size:"mini"},on:{click:e.startView}},[e._v("查看")]),1!=e.currentPipeline.pipelineType?t("el-button",{attrs:{type:"primary",icon:"el-icon-upload",size:"mini"},on:{click:e.publish}},[e._v("推送发布")]):e._e()],1),t("div",{staticClass:"pipeline-detail"},[t("el-descriptions",{attrs:{title:"流水线历史",column:3,size:"medium"}},[t("el-descriptions-item",{attrs:{label:"git分支"}},[e._v(" "+e._s(e.history.branch))]),t("el-descriptions-item",{attrs:{label:"运行时间"}},[e._v(" "+e._s(e._f("dateFormat")(e.history.createTime))+" ")]),t("el-descriptions-item",{attrs:{label:"执行结果"}},[t("el-tag",{attrs:{type:e._f("statusFormat")(e.history.pipelineStatus)}},[e._v(e._s(e._f("statusName")(e.history.pipelineStatus)))])],1),t("el-descriptions-item",{attrs:{label:"执行方式"}},[t("el-tag",{attrs:{type:"primary"}},[e._v(e._s(e.executeWay(e.currentPipeline.executeType)))])],1)],1)],1),t("div",{staticClass:"pipeline-content"},[e.currentPipeline.pipelineConfig&&e.currentPipeline.pipelineConfig.length>0?t("vue-pipeline",{key:e.uuid,ref:"pipeline",attrs:{x:50,y:55,data:e.currentPipeline.pipelineConfig,showArrow:!0,ystep:70,xstep:120,lineStyle:"default"},on:{select:e.showNodeLog}}):e._e()],1),1==e.currentPipeline.pipelineType?t("div",[t("h4",{staticClass:"republis-info"},[e._v("待发布分支")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.publishData}},[t("el-table-column",{attrs:{prop:"branch",label:"分支"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("publisFormat")(t.row.status))+" ")]}}],null,!1,747692322)}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}],null,!1,3816663554)}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.removePublish(a.row)}}},[e._v("移除发布")])]}}],null,!1,2377153871)})],1)],1):e._e()])],1)],1),t("el-dialog",{attrs:{title:"Git配置",visible:e.showGitConfig,"destroy-on-close":!0,"before-close":e.closeGitDialog,width:"70%"},on:{"update:visible":function(t){e.showGitConfig=t}}},[t("bind",{attrs:{pipeline:e.currentPipeline.pipelineId,service:e.serviceId}})],1),t("el-dialog",{attrs:{title:"节点日志",visible:e.isShowNodeLog,"destroy-on-close":!0,width:"70%"},on:{"update:visible":function(t){e.isShowNodeLog=t},close:e.closeNodeLog}},[t("span",[e._v("节点运行状态: "),t("el-tag",{attrs:{type:e._f("statusFormat")(e.logForm.status)}},[e._v(e._s(e._f("statusName")(e.logForm.status)))])],1),t("el-divider",[t("i",{staticClass:"el-icon-receiving"})]),t("ul",e._l(e.logForm.messageList,(function(a,s){return t("li",{key:s},[t("span",[e._v(e._s(a))])])})),0),e.recordList&&e.recordList.length>0?t("div",[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.openTaskDetail}},[e._v("查看任务详情")]),t("el-table",{attrs:{data:e.recordList,size:"mini",height:"400px"}},[t("el-table-column",{attrs:{prop:"featureName",label:"用例名称"}}),t("el-table-column",{attrs:{prop:"executeStatus",label:"用例状态",filters:[{text:"成功",value:1},{text:"失败",value:2},{text:"超时",value:3},{text:"运行中",value:4}],"filter-method":e.filterStatus},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:e._f("statusFormat")(a.row.executeStatus)}},[e._v(e._s(e._f("statusName")(a.row.executeStatus)))])]}}],null,!1,2110693804)}),t("el-table-column",{attrs:{prop:"createTime",label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}],null,!1,3816663554)})],1)],1):e._e()],1),t("el-dialog",{attrs:{title:e.titleName,visible:e.pipelineDialog,width:"80%","destroy-on-close":!0,"before-close":e.cancelCreatePipeline},on:{"update:visible":function(t){e.pipelineDialog=t}}},[t("PipelineConfig",{attrs:{operate:e.piplienOperate,pipeline:e.pipelineId,service:e.serviceId},on:{complete:e.completeNotify}})],1),t("el-dialog",{attrs:{title:"卡点审批",visible:e.showApproval,width:"30%","before-close":e.approvalClose},on:{"update:visible":function(t){e.showApproval=t}}},[t("span",[e._v("审批是否通过?")]),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:e.cancelApproval}},[e._v("不通过")]),t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.confirmApproval}},[e._v("通过")])],1)])],1)},Ai=[],qi=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("div",{staticClass:"git"},[t("el-link",{attrs:{type:"primary",underline:!1}},[e._v(e._s(e.gitUrl))])],1)]),t("div",[t("div",[t("el-select",{attrs:{filterable:"",size:"small","reserve-keyword":"",placeholder:"请输入绑定的分支"},model:{value:e.selectedBranch,callback:function(t){e.selectedBranch=t},expression:"selectedBranch"}},e._l(e.branches,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-button",{staticClass:"search-btn",attrs:{type:"primary",size:"small",icon:"el-icon-paperclip"},on:{click:e.createBind}},[e._v("关联分支")])],1),t("div",[t("div",{staticClass:"bind-title"},[e._v("已绑定分支：")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[t("el-table-column",{attrs:{prop:"gitBranch",label:"分支名",width:"180"}}),t("el-table-column",{attrs:{prop:"createTime",label:"绑定时间",width:"180"}}),t("el-table-column",{attrs:{prop:"isChoose",label:"是否绑定"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.isChoose?t("i",{staticClass:"el-icon-circle-check choose-item"}):e._e()]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{icon:"el-icon-connection",type:"text",size:"small"},on:{click:function(t){return e.bindBranch(a.row)}}},[e._v(e._s(a.row.isChoose?"解绑":"绑定"))]),t("el-button",{staticClass:"delete-icon",attrs:{icon:"el-icon-delete",type:"text",size:"small"},on:{click:function(t){return e.deleteBind(a.row)}}},[e._v("删除")])]}}])})],1)],1)])])},Bi=[],Vi={gitbindList(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/git/binds`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createGitbind(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/git/bind";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},bindBranch(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/git/bind";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deleteCodeChange(e,t){return new Promise((a,s)=>{let i=`/v1/devops/pipeline/${e}/git/bind/${t}`;g.delete(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getService(e){return new Promise((t,a)=>{let s=`/v1/devops/service/${e}/detail`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getServiceBranch(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/branches`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Ui={props:{pipeline:String,service:String},data(){return{selectedBranch:"",branches:[],loading:!1,tableData:[],pipelineId:"",serviceId:"",gitUrl:""}},methods:{deleteBind(e){Vi.deleteCodeChange(this.pipelineId,e.bindId).then(e=>{1==e.data?(this.$message.success("删除成功"),this.getBindBranches()):this.$message.error("删除失败")})},bindBranch(e){e.isChoose=!e.isChoose,Vi.bindBranch(e).then(()=>{let t=e.isChoose?"绑定":"解绑";this.$message({message:t+"成功",type:"success"}),this.getBindBranches()})},createBind(){if(!this.selectedBranch||""==this.selectedBranch)return void this.$message({message:"请先选择分支",type:"warning"});let e={gitBranch:this.selectedBranch,gitUrl:this.gitUrl,isChoose:!1,pipelineId:this.pipelineId};Vi.createGitbind(e).then(()=>{this.$message({message:"关联成功",type:"success"}),this.getBindBranches()})},getBindBranches(){Vi.gitbindList(this.pipelineId).then(e=>{this.tableData=e.data})},getService(){Vi.getService(this.serviceId).then(e=>{this.gitUrl=e.data.gitUrl})},getServiceBranch(){this.branches=[],Vi.getServiceBranch(this.serviceId).then(e=>{e.data.forEach(e=>{this.branches.push({label:e,value:e})})})}},created(){this.serviceId=this.service,this.pipelineId=this.pipeline,this.getBindBranches(),this.getService(),this.getServiceBranch()}},Gi=Ui,ji=(a("cd78"),Object(y["a"])(Gi,qi,Bi,!1,null,"06292448",null)),Mi=ji.exports,Ji=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"pipelineForm",attrs:{model:e.pipelineForm,"label-width":"120px",rules:e.pipelineRule,size:"mini",disabled:this.isView}},[t("el-form-item",{attrs:{label:"流水线名称",prop:"pipelineName"}},[t("el-input",{model:{value:e.pipelineForm.pipelineName,callback:function(t){e.$set(e.pipelineForm,"pipelineName",t)},expression:"pipelineForm.pipelineName"}})],1),t("el-form-item",{attrs:{label:"流水线类型",prop:"pipelineType"}},[t("el-radio-group",{model:{value:e.pipelineForm.pipelineType,callback:function(t){e.$set(e.pipelineForm,"pipelineType",t)},expression:"pipelineForm.pipelineType"}},[t("el-radio",{attrs:{label:1}},[e._v("发布流水线")]),t("el-radio",{attrs:{label:2}},[e._v("定时流水线")]),t("el-radio",{attrs:{label:3}},[e._v("个人流水线")])],1)],1),e.isSchdule?t("el-form-item",{attrs:{label:"每日定时",rules:[{required:!0,message:"定时执行时间点不能为空",trigger:"select"}],prop:"scheduleTime"}},[t("el-time-picker",{attrs:{"picker-options":{start:"00:00",step:"01:00",end:"24:00"},"value-format":"H",placeholder:"选择每日执行的时间点"},model:{value:e.pipelineForm.scheduleTime,callback:function(t){e.$set(e.pipelineForm,"scheduleTime",t)},expression:"pipelineForm.scheduleTime"}})],1):e._e(),t("el-form-item",{attrs:{label:"执行方式",prop:"executeType"}},[t("el-radio-group",{model:{value:e.pipelineForm.executeType,callback:function(t){e.$set(e.pipelineForm,"executeType",t)},expression:"pipelineForm.executeType"}},[t("el-radio",{attrs:{disabled:e.isSchdule,label:1}},[e._v("手动执行")]),t("el-radio",{attrs:{disabled:e.isSchdule||e.isPublish,label:2}},[e._v("Push")]),t("el-radio",{attrs:{disabled:!e.isSchdule||e.isPublish,label:3}},[e._v("定时执行")])],1)],1),this.isView?e._e():t("el-button",{attrs:{type:"primary",size:"mini",disabled:e.startMove,icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.dialogVisible=!e.dialogVisible,e.operateType=1}}},[e._v("添加节点")]),this.isView||e.startMove?e._e():t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(t){e.startMove=!e.startMove}}},[e._v("操作节点")]),!this.isView&&e.startMove?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-circle-close"},on:{click:function(t){e.startMove=!e.startMove}}},[e._v("取消操作")]):e._e(),!this.isView&&e.startMove?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-d-arrow-left"},on:{click:e.leftMove}},[e._v("前移")]):e._e(),!this.isView&&e.startMove?t("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-d-arrow-right"},on:{click:e.rightMove}},[e._v("后移")]):e._e(),!this.isView&&e.startMove?t("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:e.removeNode}},[e._v("删除")]):e._e(),t("div",[e.editPipelines&&e.editPipelines.length>0?t("vue-pipeline",{key:e.uuid,ref:"pipeline",attrs:{x:50,y:55,data:e.editPipelines,showArrow:!0,ystep:70,xstep:120,lineStyle:"default"},on:{select:e.choosePipeItem}}):e._e()],1),t("el-form-item",[e.isView?e._e():t("div",{staticClass:"dialog-footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.cancelCreatePipeline}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitPipeline("pipelineForm")}}},[e._v("确 定")])],1)])],1),t("el-dialog",{attrs:{title:"配置节点","append-to-body":!0,visible:e.dialogVisible,"destroy-on-close":!0,width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.closeConfigNode}},[t("el-form",{ref:"nodeForm",attrs:{model:e.nodeForm,rules:e.nodeRule,size:"mini",disabled:e.isView}},[t("el-form-item",{attrs:{label:"节点名称","label-width":e.formLabelWidth,prop:"name"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.nodeForm.name,callback:function(t){e.$set(e.nodeForm,"name",t)},expression:"nodeForm.name"}})],1),t("el-form-item",{attrs:{label:"节点提示","label-width":e.formLabelWidth,prop:"hint"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.nodeForm.hint,callback:function(t){e.$set(e.nodeForm,"hint",t)},expression:"nodeForm.hint"}})],1),t("el-form-item",{attrs:{label:"节点类型","label-width":e.formLabelWidth,prop:"configId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectStep},model:{value:e.nodeForm.configId,callback:function(t){e.$set(e.nodeForm,"configId",t)},expression:"nodeForm.configId"}},e._l(e.stepOptions,(function(e){return t("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})})),1)],1)],1),t("el-row",[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"step-title"},[e._v("执行步骤")]),t("div",{staticClass:"item-list"},[t("ul",[t("draggable",{attrs:{list:e.itemList}},e._l(e.itemList,(function(a,s){return t("li",{key:s,on:{click:function(t){return e.chooseStep(a)}}},[t("div",{staticClass:"item"},[e._v(" "+e._s(a.actionName)+" ")])])})),0)],1)])]),t("el-col",{attrs:{span:16}},[t("div",[t("div",{staticClass:"step-title"},[e._v("配置步骤")]),t("el-form",{attrs:{size:"mini",disabled:e.isView,"label-width":e.formLabelWidth},model:{value:e.configForm,callback:function(t){e.configForm=t},expression:"configForm"}},[e.paramConfigs.length>0?t("el-divider",{attrs:{"content-position":"left"}},[e._v("触发参数配置")]):e._e(),e._l(e.paramConfigs,(function(a,s){return t("el-form-item",{key:100+s,attrs:{"label-width":e.formLabelWidth}},[t("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(a.description))]),"select"==a.type?t("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.selectChange(t,a)}},model:{value:e.configForm[a.compareKey],callback:function(t){e.$set(e.configForm,a.compareKey,t)},expression:"configForm[item.compareKey]"}},e._l(a.list,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1):t("el-input",{on:{input:function(t){return e.datachange(a.compareKey)}},model:{value:e.configForm[a.compareKey],callback:function(t){e.$set(e.configForm,a.compareKey,t)},expression:"configForm[item.compareKey]"}})],1)})),e.calculateShow?t("el-divider",{attrs:{"content-position":"left"}},[e._v("节点配置")]):e._e(),e._l(e.stepConfigs,(function(a,s){return t("div",{key:s},[a.showCompare?t("el-form-item",{attrs:{"label-width":e.formLabelWidth}},[t("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(a.description))]),t("el-input",{on:{input:function(t){return e.datachange(a.compareKey)}},model:{value:e.configForm[a.compareKey],callback:function(t){e.$set(e.configForm,a.compareKey,t)},expression:"configForm[item.compareKey]"}})],1):e._e()],1)}))],2)],1)])],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[e.isView?e._e():t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.submitConfig("nodeForm")}}},[e._v("确认")])],1)],1)],1)},Hi=[];const Ki=120,Wi=50;var Qi={updateNode(e,t,a){let s=JSON.parse(JSON.stringify(e)),i=[],r=0;for(var l=0;l<s.length;)if(s[l].group==t.group){if(s[l].root){r=l,l++;continue}i.push(s[l]),s.splice(l,1)}else l++;let o=1;a.forEach(e=>{let a=r+o,i={group:t.group,hint:e.hint,id:a,name:e.name,next:[],root:!1,nodeId:e.nodeId,status:"success",originData:{actionId:e.originData.actionId,compareInfo:e.originData.compareResults,paramList:e.originData.paramList}};s.splice(a,0,i),o++});let n=i.length-a.length,c=[];t.next.forEach(e=>{e.index=e.index-n,c.push(e)});let d={};return a.forEach(e=>{d[e.actionId]=e.compareResults}),s.forEach(e=>{if(e.originData){let t=d[e.originData.actionId];t&&(e.originData.compareInfo=t)}}),s},addNode(e,t,a){let s=JSON.parse(JSON.stringify(e)),i=s[s.length-1],r=i.x,l=i.y;t.x=i.x,t.y=i.y,t.group=i.group,i.group=i.group+1,s.splice(s.length-1,1);let o=s.length+1;if(a&&(o+=a.length),t.next=[{index:o,weight:0}],s.push(t),console.log("last result",s),!a)return i.x+=Ki,s.push(i),s;let n=[];s.forEach(e=>{let t=!1;e.next.forEach(e=>{e.index==s.length-1&&(t=!0)}),t&&n.push(e)});let c=t.group,d=1;return a.forEach(e=>{let a={id:c+d,name:e.name,hint:e.name,status:"success",group:c,originData:e.originData,next:[]};a.x=r,a.y=l+Wi,s.push(a),t.list.push(a),n.forEach(e=>{e.next.push({index:s.length-1,weight:0})})}),i.x+=Ki,s.push(i),this.resetId(s),console.log("sub result",s),s},removeNode(e,t){if(!t.root)return this.removeSingleNode(e,t);let a=this.transformTreeNode(e);console.log("array",JSON.parse(JSON.stringify(a)));let s=a.findIndex(e=>e.id==t.id),i=a[s];for(let o=s+1;o<a.length;o++)a[o].next.forEach(e=>{e.index=e.index-i.nodes.length-1});let r=[];for(let o=0;o<a[s-1].id;o++)r.push(e[o]);let l=null;for(let o=s-1;o<a.length;o++){if(o==s)continue;let e=a[o];if(o==s-1){let t=a[s+1];e.next=[],e.next.push({index:t.id-i.nodes.length-1,width:0}),t.nodes.forEach(t=>{e.next.push({index:t.id-i.nodes.length-1,width:0})})}e.root&&(l=r.length,e.group=l),e.id=r.length,r.push(e),e.nodes&&e.nodes.length>0&&e.nodes.forEach(e=>{e.id=r.length,e.group=l,r.push(e)})}return console.log("delete result",r),r},removeSingleNode(e,t){let a=this.transformTreeNode(e),s=t.group,i=[];i.push({index:a[s].id,width:0});let r=1;a[s].nodes.forEach(e=>{e.id!=t.id&&i.push({index:a[s].id+r,width:0})}),e[a[s-1].id].next=i,e.forEach(e=>{(e.id>t.id||e.group==t.group)&&e.root&&e.next&&e.next.forEach(e=>{e.index=e.index-1})});let l=e.findIndex(e=>e.id==t.id);return e.splice(l,1),console.log("remove single result",e),this.resetId(e),e},moveLeft(e,t){if(t=this.getRootOfNode(e,t),t.id<=2)return void console.log("已到根结点无法前移");this.changeGroup(e,t,!0);let a=this.transformTreeNode(e),s=a.findIndex(e=>e.id==t.id),i=a[s-1],r=a[s-2],l=JSON.parse(JSON.stringify(a[s])),o=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(r));l.id=o.id;let c=[],d=l.id+l.nodes.length+1;for(let h=0;h<=o.nodes.length;h++)c.push({index:d+h,width:0});o.id=l.id+l.nodes.length+1;let u=l.next,p=n.id+n.nodes.length+1,m=[];for(let h=0;h<=l.nodes.length;h++)m.push({index:p+h,width:0});l.next=c,e[l.id]=l;for(let h=0;h<l.nodes.length;h++)e[l.id+h+1]=l.nodes[h];o.next=u,e[o.id]=o;for(let h=0;h<o.nodes.length;h++)e[o.id+h+1]=o.nodes[h];e[n.id].next=m,this.resetId(e),console.log("exchange after",JSON.parse(JSON.stringify(e)))},moveRight(e,t){t=this.getRootOfNode(e,t),this.changeGroup(e,t,!1);let a=this.transformTreeNode(e),s=a.findIndex(e=>e.id==t.id);if(s>=a.length-2)return void console.log("已到根结点无法后移");let i=a[s],r=a[s-1],l=a[s+1],o=[];l.id=i.id;for(let p=0;p<=l.nodes.length;p++)o.push({index:l.id+p,width:0});let n=[],c=l.id+l.nodes.length+1;for(let p=0;p<=i.nodes.length;p++)n.push({index:c+p,width:0});let d=l.next;e[r.id].next=o,l.next=n,l.group=l.id,e[l.id]=l;for(let p=0;p<l.nodes.length;p++)l.nodes[p].group=l.id,e[l.id+p+1]=l.nodes[p];i.id=l.id+l.nodes.length+1,i.next=d,i.group=i.id,e[i.id]=i;for(let p=0;p<i.nodes.length;p++)i.nodes[p].group=i.id,e[i.id+p+1]=i.nodes[p];e[e.length-1].group=e[e.length-1].id;let u=0;e.forEach(e=>{e.id=u,u++})},exchangeData(e,t){let a={};t.forEach(e=>{a[e.group]||(a[e.group]=[]),a[e.group].push(e)});let s={pipelineId:e.pipelineId,pipelineName:e.pipelineName,pipelineType:e.pipelineType,executeType:e.executeType,stageList:[]},i=null;return Object.values(a).forEach(e=>{let t={},a=[];e.forEach(e=>{if(e.root)t.stageName=e.name,t.type=e.group,t.stageId=e.stageId,t.configId=e.configId,i=e.stageId;else{console.log("sub item",e);let t=e.originData.compareResults;t||(t=e.originData.compareInfo);let s={actionId:e.originData.actionId,compareInfo:t,paramList:e.originData.paramList};a.push({nodeName:e.name,configDetail:JSON.stringify(s),type:e.group,nodeId:e.nodeId,stageId:i})}}),t.nodes=a,s.stageList.push(t)}),console.log("转换结果",s),s},displayData(e){let t=[],a={next:[]},s=0,i=0;return e.forEach(e=>{let r={id:s,name:e.stageName,hint:e.stageName,status:"success",group:i,root:!0,stageId:e.stageId,configId:e.configId,list:e.nodes,next:[]};t.push(r),a.next.push({index:s,weight:0}),s++,e.nodes&&e.nodes.forEach(e=>{t.push({id:s,name:e.nodeName,hint:e.nodeName,status:"success",group:i,nodeId:e.nodeId,originData:JSON.parse(e.configDetail),next:[]}),a.next.push({index:s,weight:0}),s++}),a=r,i++}),t[0].status="start",t[t.length-1].status="end",console.log("filnal",t),t},getRootOfNode(e,t){if(t.root)return t;let a=t;return e.forEach(e=>{e.group==t.group&&e.root&&(a=e)}),a},changeGroup(e,t,a){let s=t.group;if(e.forEach(e=>{s==e.group&&(e.group="temp")}),a){let t=s-1;e.forEach(e=>{t==e.group&&(e.group=t+1),"temp"==e.group&&(e.group=s-1)})}else{let t=s+1;e.forEach(e=>{t==e.group&&(e.group=t-1),"temp"==e.group&&(e.group=s+1)})}},transformTreeNode(e){let t=[],a={},s=[];return e.forEach(e=>{e.root?(a.nodes=JSON.parse(JSON.stringify(s)),a=e,t.push(e),s=[]):s.push(e)}),t[t.length-1].nodes=[],t},resetId(e){let t=0;e.forEach(e=>{e.id=t,t++})}},Yi={createNode(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/nodes";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateNode(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/node";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getNode(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/node/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getNodeActions(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/executors`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getNodePage(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/pipeline/nodes?page=${e}&size=${t}&name=${a}`;g.get(r).then(e=>{s(e)}).catch(e=>{i(e)})})},getAllNodes(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/nodes/all";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},deleteNode(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/node/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Xi={pipelineList(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/list`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},queryPipeline(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/detail/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},savePipeline(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updatePipeline(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/pipeline/${e}/${t}`;g.put(r,a).then(e=>{s(e)}).catch(e=>{i(e)})})},deletePipeline(e,t){return new Promise((a,s)=>{let i=`/v1/devops/pipeline/${e}/${t}`;g.delete(i).then(e=>{a(e)}).catch(e=>{s(e)})})},defaultConfig(){return new Promise((e,t)=>{let a="/v1/devops/pipeline/system/config/pipe";g.get(a).then(t=>{e(t)}).catch(e=>{t(e)})})},startPipeline(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/"+e;g.post(s).then(e=>{t(e)}).catch(e=>{a(e)})})},pausePipeline(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/pause`;g.put(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},Zi={components:{draggable:We.a},props:{operate:{type:Number,default:1},pipeline:{type:String,default:""},service:{type:String},enableView:{type:Boolean,default:!1}},watch:{pipeline:{handler(e){this.pipelineId=e},deep:!0,immediate:!0},service:{handler(e){this.serviceId=e},deep:!0,immediate:!0},operate:{handler(e){1==e&&(this.isView=!1,this.isEditPipeline=!0,this.getPipeline()),2==e&&(this.isView=!0,this.isEditPipeline=!1,this.getPipeline()),3==e&&(this.isView=!1,this.pipelineForm={},this.pipelineId="",this.serviceId="",this.getDefaultPipe(),this.isEditPipeline=!1)},deep:!0,immediate:!0}},computed:{calculateShow(){if(!this.stepConfigs||0==this.stepConfigs.length)return!1;let e=!1;return this.stepConfigs.forEach(t=>{t.showCompare&&(e=!0)}),e},isSchdule(){return 2==this.pipelineForm.pipelineType},isPublish(){return 1==this.pipelineForm.pipelineType}},data(){return{isEditPipeline:!1,pipelineForm:{},isView:!1,dialogVisible:!1,operateType:1,startMove:!1,editPipelines:[],formLabelWidth:"120px",nodeForm:{},stepOptions:[],itemList:[],configForm:{},paramConfigs:[],stepConfigs:[],labelWidth:"150px",rootList:[],uuid:"",serviceId:"",pipelineId:"",chosedConfigItem:[],pipelineRule:{pipelineName:[{required:!0,message:"请输入流水线名称",trigger:"blur"}],pipelineType:[{required:!0,message:"请选择流水线类型",trigger:"change"}],executeType:[{required:!0,message:"请选择执行方式",trigger:"change"}]},nodeRule:{name:[{required:!0,message:"请输入节点名称",trigger:"blur"}],configId:[{required:!0,message:"请选择节点类型",trigger:"select"}]}}},methods:{leftMove(){this.nodeForm.name?(Qi.moveLeft(this.editPipelines,this.nodeForm),this.uuid++,this.nodeForm={}):this.$message.warning("请先点击选择一个移动的节点")},rightMove(){this.nodeForm.name?(Qi.moveRight(this.editPipelines,this.nodeForm),this.nodeForm={},this.uuid++):this.$message.warning("请先点击选择一个移动的节点")},removeNode(){let e=Qi.removeNode(this.editPipelines,this.nodeForm);this.editPipelines=e,this.uuid++},selectChange(e,t){this.chosedConfigItem.paramList.forEach(a=>{a.name==t.compareKey&&(a.value=e)}),this.$forceUpdate()},datachange(e){this.chosedConfigItem.compareResults.forEach(t=>{t.compareKey==e&&(t.value=this.configForm[e])}),this.chosedConfigItem.paramList.forEach(t=>{t.name==e&&(t.value=this.configForm[e])}),this.$forceUpdate()},selectStep(e){this.itemList=[],Yi.getNodeActions(e).then(e=>{let t={};this.nodeForm.list&&this.nodeForm.list.forEach(e=>{if(e.configDetail){let a=JSON.parse(e.configDetail);t[a.actionId]=a}}),e.data.forEach(e=>{let a=t[e.actionId];void 0!=a&&null!=a&&(e.compareResults=a.compareInfo,e.paramList.forEach(e=>{let t=a.paramList[e.name];t&&(e.value=t)}),this.nodeForm.list.forEach(t=>{let a=JSON.parse(t.configDetail);e.actionId==a.actionId&&(e.nodeId=t.nodeId)})),this.itemList.push(e)})}),this.paramConfigs=[],this.stepConfigs=[]},cancelCreatePipeline(){this.rootList=[],this.pipelineDialog=!1,this.isView=!1,this.pipelineForm={},this.editPipelines=[],this.configForm={},this.$emit("complete")},closeConfigNode(){this.nodeForm={},this.configForm={},this.itemList=[]},submitConfig(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=JSON.parse(JSON.stringify(this.editPipelines)),a=[];if(this.itemList.forEach(e=>{let t={};e.paramList.forEach(e=>{t[e.name]=e.value});let s={actionId:e.actionId,compareResults:e.compareResults,paramList:t};e.originData=s,a.push({name:e.actionName,hint:e.actionName,status:"success",nodeId:e.nodeId,originData:JSON.parse(JSON.stringify(s)),next:[]})}),1==this.operateType){let e=JSON.parse(JSON.stringify(t)),s=e.length,i={name:this.nodeForm.name,hint:this.nodeForm.hint,status:"success",configId:this.nodeForm.configId,list:[],id:s,group:s,root:!0};this.editPipelines=Qi.addNode(t,i,a),this.uuid++}else this.editPipelines=Qi.updateNode(t,this.nodeForm,a);this.resetNode()})},submitPipeline(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=Qi.exchangeData(this.pipelineForm,this.editPipelines);if(2==t.pipelineType){let e=`0 0 ${this.pipelineForm.scheduleTime} * * ?`;t.pipelineConfig=JSON.stringify({schedule:e})}this.isEditPipeline&&Xi.updatePipeline(this.serviceId,this.pipelineId,t).then(()=>{this.$message({message:"修改流水线成功",type:"success"}),this.cancelCreatePipeline()}),this.isEditPipeline||(t.serviceId=this.serviceId,Xi.savePipeline(t).then(()=>{this.$message({message:"创建流水线成功",type:"success"}),this.cancelCreatePipeline()}))})},choosePipeItem(e){let t=e;this.nodeForm=t,e.disable||this.startMove||(this.editPipelines.forEach(a=>{a.group==e.group&&a.root&&(this.nodeForm=a,t=a)}),this.dialogVisible=!0,this.operateType=2,this.itemList=t.list,this.selectStep(t.configId))},chooseStep(e){this.stepConfigs=JSON.parse(JSON.stringify(e.compareResults)),this.stepConfigs.forEach(e=>{this.configForm[e.compareKey]=e.value}),this.paramConfigs=[],e.paramList.forEach(e=>{this.configForm[e.name]=e.value,this.paramConfigs.push({compareKey:e.name,description:e.description,value:e.value,type:e.type})}),"TEST"==e.executeType&&this.getFeatureTasks(),"DEPLOY"==e.executeType&&this.getAllEnvs(),this.chosedConfigItem=e,this.$forceUpdate()},getFeatureTasks(){ka.getAllTaskList(this.serviceId).then(e=>{let t=[];e.data.forEach(e=>{t.push({label:e.taskName,value:e.taskId})}),this.paramConfigs.forEach(e=>{"taskId"==e.compareKey&&(e.list=t)}),this.$forceUpdate()})},getAllEnvs(){si.getAllEnvs().then(e=>{let t=[];e.data.forEach(e=>{t.push({label:e.envName,value:e.envId})}),this.paramConfigs.forEach(e=>{"envId"==e.compareKey&&(e.list=t)}),this.$forceUpdate()})},resetNode(){this.dialogVisible=!1,this.configForm={},this.itemList=[],this.nodeForm={}},getConfigNodes(){Yi.getAllNodes().then(e=>{this.stepOptions=e.data})},getDefaultPipe(){Xi.defaultConfig().then(e=>{let t=JSON.parse(e.data.configDetail);t.forEach(e=>{e.id&&e.rootId==e.id&&this.rootList.push(e)}),this.editPipelines=JSON.parse(JSON.stringify(t))})},getPipeline(){this.pipelineForm={},Xi.queryPipeline(this.pipelineId).then(e=>{this.editPipelines=Qi.displayData(e.data.stageList),this.pipelineForm=e.data;let t=JSON.parse(e.data.pipelineConfig);if(t){let e=t.schedule.split(" ")[2],a=new Date(2023,7,20,e);this.$set(this.pipelineForm,"scheduleTime",a)}this.uuid++})}},created(){this.getConfigNodes(),this.serviceId=this.service,this.pipelineId=this.pipeline}},er=Zi,tr=(a("066e"),Object(y["a"])(er,Ji,Hi,!1,null,"066f1ba8",null)),ar=tr.exports,sr={getPublishes(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/publishes`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},createPublish(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/publish";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updatePublish(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/publish";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},deletePublish(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/publish/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},ir={latestPipelineHistory(e,t){return new Promise((a,s)=>{let i=`/v1/devops/pipeline/${e}/${t}/latest/history`;g.get(i).then(e=>{a(e)}).catch(e=>{s(e)})})},getPipelienStatus(e){return new Promise((t,a)=>{let s=`/v1/devops/pipeline/${e}/status`;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},approval(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/pipeline/node/approval?historyId=${e}&nodeId=${t}&type=${a}`;g.put(r).then(e=>{s(e)}).catch(e=>{i(e)})})}},rr={createAction(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/actions";g.post(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},updateAction(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/action";g.put(s,e).then(e=>{t(e)}).catch(e=>{a(e)})})},getAction(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/action/"+e;g.get(s).then(e=>{t(e)}).catch(e=>{a(e)})})},getActionPage(e,t,a){return new Promise((s,i)=>{let r=`/v1/devops/pipeline/actions?page=${e}&size=${t}&name=${a}`;g.get(r).then(e=>{s(e)}).catch(e=>{i(e)})})},deleteAction(e){return new Promise((t,a)=>{let s="/v1/devops/pipeline/action/"+e;g.delete(s).then(e=>{t(e)}).catch(e=>{a(e)})})}},lr={components:{bind:Mi,PipelineConfig:ar},data(){return{nodes:[],startIndex:1,formLabelWidth:"80px",loading:!1,activePipelines:["1","2","3"],pipelines:[],currentPipeline:{pipelineConfig:[]},pipelineId:"",history:{},publishList:[],buildList:[],customList:[],isRunning:!1,pipelineDialog:!1,piplienOperate:0,prenodeId:[],serviceId:"",titleName:"新增流水线",showGitConfig:!1,uuid:1,isShowNodeLog:!1,logForm:{},publishData:[],approvalNode:{},showApproval:!1,bindGit:!1,recordList:[],taskRecordId:""}},methods:{closeNodeLog(){this.recordList=[],this.taskRecordId=""},filterStatus(e,t){return t.executeStatus===e},executeWay(e){let t="-";switch(e){case 1:t="手动执行";break;case 2:t="代码提交";break;case 3:t="定时执行";break}return t},approvalClose(){this.approvalNode={},this.showApproval=!1},cancelApproval(){this.approvalPipeline(2)},confirmApproval(){this.approvalPipeline(1)},approvalPipeline(e){ir.approval(this.history.historyId,this.approvalNode.nodeId,e).then(e=>{e.data?this.$message.success("审批通过"):this.$message.error("审批失败，请重试"),this.approvalClose()})},getServicePublishes(){this.publishData=[],sr.getPublishes(this.serviceId).then(e=>{this.publishData=e.data})},publish(){let e={pipelineId:this.currentPipeline.pipelineId,serviceId:this.serviceId};sr.createPublish(e).then(e=>{e.data?this.$message.success("推送发布成功，请去发布流水线查看"):this.$message.error("推送发布失败")})},removePublish(e){sr.deletePublish(e.publishId).then(e=>{e.data?(this.$message.success("删除成功"),this.getServicePublishes()):this.$message.error("删除失败")})},completeNotify(){this.pipelineDialog=!1,this.getPipelineList(),1==this.piplienOperate&&Xi.queryPipeline(this.currentPipeline.pipelineId).then(e=>{let t=Qi.displayData(e.data.stageList);this.currentPipeline.pipelineConfig=t,this.currentPipeline.pipelineName=e.data.pipelineName,this.currentPipeline.pipelineType=e.data.pipelineType,this.currentPipeline.pipelineId=e.data.pipelineId,this.uuid++})},exchangeStatusMessage(e){let t="无";if(void 0==e||null==e)return t;switch(e){case 4:t="运行中";break;case 1:t="运行成功";break;case 2:t="运行失败";break;case 3:t="运行超时";break;default:t="运行失败";break}return t},exchangeExecuteStatus(e){let t="info";if(void 0==e||null==e)return t;switch(e){case 4:t="primary";break;case 1:t="success";break;case 2:t="danger";break;case 3:t="warning";break;default:t="danger";break}return t},operateLine(e,t){"delete"==e&&this.deletePipeline(t)},selectService(){this.getPipelineList(),this.currentPipeline={pipelineConfig:[]}},showNodeLog(e){e.originData&&e.originData.actionId&&rr.getAction(e.originData.actionId).then(t=>{if("APPROVAL"==t.data.executeType&&this.isRunning){if(!this.history.historyId)return;return this.approvalNode=e,void(this.showApproval=!0)}if(!this.history||!this.history.historyId)return this.logForm.status=1,this.logForm.messageList=["未执行"],void(this.isShowNodeLog=!0);console.log("ddd",t);let a=t.data.executeType;ir.getPipelienStatus(this.history.historyId).then(t=>{t.data.nodeStatusList.forEach(t=>{t.nodeId==e.nodeId&&(this.logForm.nodeId=e.nodeId,this.logForm.status=t.status,this.logForm.messageList=t.message,this.isShowNodeLog=!0,"TEST"==a&&this.getTaskHistories(t.recordId))})})})},getTaskHistories(e){ka.getTaskRecordByTriggerId(e).then(e=>{this.taskRecordId=e.data.recordId,ka.getTaskHistories(this.taskRecordId).then(e=>{this.recordList=e.data})})},openTaskDetail(){let e=window.location.href.split("//"),t=e[1].split("/")[0];console.log(`${e[0]}//${t}/record/detail?recordId=${this.taskRecordId}`),window.open(`${e[0]}//${t}/record/detail?recordId=${this.taskRecordId}`,"_blank")},getPrenode(e,t){let a={};return e.forEach(e=>{e.next&&e.next.length>0&&e.next.forEach(s=>{s.index==t&&(a=e)})}),a},preNodeAddline(e,t,a,s){e.forEach(e=>{e.id==t&&a.forEach(t=>{e.next.push({index:t,weight:0,groupId:s})})})},remoteMethod(){F.getServices().then(e=>{this.pipelines=[],e.data.forEach(e=>{this.pipelines.push({label:e.serviceName,value:e.serviceId})})})},pausePipeline(){this.isRunning&&Xi.pausePipeline(this.history.historyId).then(e=>{this.isRunning=!1,e.data?this.$message.success("停止流水线成功"):this.$message.error("停止流水线失败")})},startPipeline(){if(!this.currentPipeline.pipelineConfig.length)return void this.$message.warning("请先选择流水线");let e=1==this.currentPipeline.pipelineType&&this.publishData.length<1;if(e)this.$message.warning("待发布列表为空，请先推送分支到发布流水线");else if(e||this.bindGit)Xi.startPipeline(this.currentPipeline.pipelineId).then(e=>{""!=e.data&&null!=e.data?(this.$message.success("开始运行流水线"),this.getLatestHistory(this.currentPipeline.pipelineId),this.isRunning=!0,this.currentPipeline.pipelineConfig.forEach(e=>{e.status="success"}),this.uuid++):this.$message.error("运行流水线失败")});else{let e=this.$message.warning({dangerouslyUseHTMLString:!0,message:'当前流水线未绑定分支，请先绑定 <span style="cursor: pointer;color:#409EFF" @click="showGitConfig = !showGitConfig">去绑定>></span>'}),t=this;e.$el.querySelector("span").onclick=()=>{t.showGitConfig=!t.showGitConfig}}},exchangeStatus(e){switch(e){case 1:return"success";case 2:return"failure";case 3:return"unstable";case 4:return"running";case 5:return"unstable";case 6:return"paused"}},startEdit(){this.currentPipeline.pipelineConfig.length?(this.piplienOperate=1,this.pipelineDialog=!0):this.$message.warning("请先选择流水线")},startView(){this.currentPipeline.pipelineConfig.length?(this.piplienOperate=2,this.titleName="查看流水线",this.pipelineDialog=!0):this.$message.warning("请先选择流水线")},selectPipeline(e){this.publishList.forEach(e=>{e.selected=!1}),this.buildList.forEach(e=>{e.selected=!1}),this.customList.forEach(e=>{e.selected=!1}),e.selected=!0,Xi.queryPipeline(e.pipelineId).then(t=>{let a=Qi.displayData(t.data.stageList);this.currentPipeline.pipelineConfig=a,this.currentPipeline.pipelineName=t.data.pipelineName,this.currentPipeline.pipelineType=t.data.pipelineType,this.currentPipeline.executeType=t.data.executeType,this.currentPipeline.pipelineId=e.pipelineId,this.pipelineId=e.pipelineId,this.uuid++,this.checkBindBranch(),1==this.currentPipeline.pipelineType&&this.getServicePublishes()}),ir.latestPipelineHistory(this.serviceId,e.pipelineId).then(e=>{e.data?(this.history=e.data,ir.getPipelienStatus(this.history.historyId).then(e=>{let t={};e.data.nodeStatusList.forEach(e=>{t[e.nodeId]=this.exchangeStatus(e.status)}),this.currentPipeline.pipelineConfig.forEach(e=>{let a=t[e.nodeId];e.status=a||"success"}),this.uuid++})):this.history={}})},getLatestHistory(e){ir.latestPipelineHistory(this.serviceId,e).then(e=>{e.data?this.history=e.data:this.history={}})},handleCommand(e){"new"==e&&(this.piplienOperate=3,this.titleName="创建流水线",this.pipelineDialog=!0)},deletePipeline(e){this.$confirm(`确认删除流水线【${e.pipelineName}】？`).then(()=>{Xi.deletePipeline(this.serviceId,e.pipelineId).then(()=>{this.getPipelineList()})})},getPipelineList(){Xi.pipelineList(this.serviceId).then(e=>{this.publishList=[],this.buildList=[],this.customList=[],e.data.forEach(e=>{e.selected=!1,e.pipelineConfig=JSON.parse(e.pipelineConfig),1==e.pipelineType&&this.publishList.push(e),2==e.pipelineType&&this.buildList.push(e),3==e.pipelineType&&this.customList.push(e)})})},getConfigNodes(){Yi.getAllNodes().then(e=>{this.stepOptions=e.data})},getDefaultService(){F.getServices().then(e=>{this.pipelines=[],e.data.forEach(e=>{this.pipelines.push({label:e.serviceName,value:e.serviceId})}),this.serviceId=this.pipelines[0].value,this.getPipelineList()})},loopQueryStatus(){setInterval(()=>{this.history.historyId&&ir.getPipelienStatus(this.history.historyId).then(e=>{let t={};if(e.data.nodeStatusList.forEach(e=>{t[e.nodeId]=this.exchangeStatus(e.status),e.nodeId==this.logForm.nodeId&&(this.logForm={nodeId:this.logForm.nodeId,status:e.status,messageList:e.message})}),this.currentPipeline.pipelineConfig.forEach(e=>{let a=t[e.nodeId];a&&(e.status=a)}),4!=e.data.pipelineStatus)return this.isRunning=!1,void this.getLatestHistory(this.currentPipeline.pipelineId);this.isRunning=!0})},3e3)},cancelCreatePipeline(){this.pipelineDialog=!1},closeGitDialog(){this.checkBindBranch(),this.showGitConfig=!1},checkBindBranch(){this.bindGit=!1,Vi.gitbindList(this.currentPipeline.pipelineId).then(e=>{e.data.forEach(e=>{e.isChoose&&(this.bindGit=!0)})})}},created(){this.getConfigNodes(),this.getDefaultService(),this.loopQueryStatus()}},or=lr,nr=(a("18f1"),Object(y["a"])(or,Oi,Ai,!1,null,"a69d81bc",null)),cr=nr.exports,dr=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{staticClass:"content",model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[t("el-tab-pane",{attrs:{label:"节点列表",name:"node"}},[t("div",{staticClass:"query-div"},[t("el-form",{attrs:{inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"节点名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入节点名称"},model:{value:e.queryNodeName,callback:function(t){e.queryNodeName=t},expression:"queryNodeName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQueryNode}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.createNode}},[e._v("新增节点")])],1)],1)],1),t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.nodeList,stripe:""}},[t("el-table-column",{attrs:{prop:"nodeName",label:"节点名称"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},on:{click:function(t){return e.editNode(a.row)}},slot:"reference"},[e._v("编辑")]),t("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},on:{click:function(t){return e.removeNode(a.row)}},slot:"reference"},[e._v("删除")])]}}])})],1),t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.currentNodePage,total:e.nodeTotalSize},on:{"current-change":e.changeNodePage}})],1)]),t("el-tab-pane",{attrs:{label:"执行点",name:"execute"}},[t("div",{staticClass:"query-div"},[t("el-form",{attrs:{inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{attrs:{label:"执行点名称"}},[t("el-input",{attrs:{clearable:"",placeholder:"请输入执行点名称"},model:{value:e.queryName,callback:function(t){e.queryName=t},expression:"queryName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.startQuery}},[e._v("查询")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.createTemplet}},[e._v("新增执行点")])],1)],1)],1),t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.actionList,stripe:""}},[t("el-table-column",{attrs:{prop:"actionName",label:"执行点名称"}}),t("el-table-column",{attrs:{prop:"description",label:"描述"}}),t("el-table-column",{attrs:{prop:"updateTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.updateTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{slot:"reference",type:"primary",size:"mini"},on:{click:function(t){return e.editAction(a.row)}},slot:"reference"},[e._v("编辑")]),"HTTP"==a.row.executeType?t("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},on:{click:function(t){return e.removeAction(a.row)}},slot:"reference"},[e._v("删除")]):e._e()]}}])})],1),t("el-pagination",{attrs:{layout:"prev, pager, next","current-page":e.currentPage,total:e.totalSize},on:{"current-change":e.changePage}})],1)])],1),t("el-dialog",{attrs:{title:e.nodeTitle,visible:e.showCreateNode,width:"80%","before-close":e.closeNodeDialog},on:{"update:visible":function(t){e.showCreateNode=t}}},[t("el-form",{ref:"nodeForm",attrs:{model:e.nodeForm,rules:e.nodeRule,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"节点名称",prop:"nodeName"}},[t("el-input",{attrs:{placeholder:"请输入节点名称"},model:{value:e.nodeForm.nodeName,callback:function(t){e.$set(e.nodeForm,"nodeName",t)},expression:"nodeForm.nodeName"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入执行点描述"},model:{value:e.nodeForm.description,callback:function(t){e.$set(e.nodeForm,"description",t)},expression:"nodeForm.description"}})],1),t("el-form-item",{attrs:{label:"关联执行点",prop:"executors"}},[t("el-select",{attrs:{multiple:"",clearable:"",placeholder:"请选择"},model:{value:e.nodeForm.executors,callback:function(t){e.$set(e.nodeForm,"executors",t)},expression:"nodeForm.executors"}},e._l(e.executeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeNodeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addNode("nodeForm")}}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:e.title,visible:e.showCreateExecuter,"before-close":e.closeDialog,width:"80%"},on:{"update:visible":function(t){e.showCreateExecuter=t}}},[t("el-form",{ref:"actionForm",attrs:{model:e.actionForm,rules:e.actionRule,size:"small","label-width":"150px"}},[t("el-form-item",{attrs:{label:"执行点名称",prop:"actionName"}},[t("el-input",{attrs:{placeholder:"请输入执行点名称"},model:{value:e.actionForm.actionName,callback:function(t){e.$set(e.actionForm,"actionName",t)},expression:"actionForm.actionName"}})],1),t("el-form-item",{attrs:{label:"描述",prop:"description"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入执行点描述"},model:{value:e.actionForm.description,callback:function(t){e.$set(e.actionForm,"description",t)},expression:"actionForm.description"}})],1),t("el-form-item",{attrs:{label:"执行类型",prop:"executeType"}},[t("el-radio-group",{on:{change:e.chooseExecuteType},model:{value:e.executeType,callback:function(t){e.executeType=t},expression:"executeType"}},[t("el-radio",{attrs:{label:"HTTP",disabled:e.isEditAction}},[e._v("默认")]),t("el-radio",{attrs:{label:"BUILD",disabled:""}},[e._v("构建")]),t("el-radio",{attrs:{label:"WAIT",disabled:""}},[e._v("等待")]),t("el-radio",{attrs:{label:"DEPLOY",disabled:""}},[e._v("部署")]),t("el-radio",{attrs:{label:"TEST",disabled:""}},[e._v("用例测试")]),t("el-radio",{attrs:{label:"APPROVAL",disabled:""}},[e._v("人工卡点")]),t("el-radio",{attrs:{label:"MERGE",disabled:""}},[e._v("合并master")])],1)],1),"HTTP"==e.executeType?t("HttpAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"APPROVAL"==e.executeType?t("ApprovalAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"BUILD"==e.executeType?t("BuildAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"DEPLOY"==e.executeType?t("DeployAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"TEST"==e.executeType?t("FeatureAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"WAIT"==e.executeType?t("WaitAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e(),"MERGE"==e.executeType?t("MergeAct",{attrs:{form:e.actionForm},on:{notifyParam:e.notifyParam}}):e._e()],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addAction("actionForm")}}},[e._v("确 定")])],1)],1)],1)},ur=[],pr=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),t("el-form-item",{attrs:{label:"动作触发地址"}},[t("el-input",{attrs:{placeholder:"请输入执行点名称"},on:{input:e.notifyParam},model:{value:e.dataForm.actionUrl,callback:function(t){e.$set(e.dataForm,"actionUrl",t)},expression:"dataForm.actionUrl"}})],1),t("el-form-item",{attrs:{label:"参数列表"}},[e._l(e.paramList,(function(a,s){return t("el-row",{key:s,staticClass:"config-line"},[t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"输入参数名"},on:{input:e.notifyParam},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"item.name"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:6}},[t("el-input",{attrs:{placeholder:"输入参数描述"},on:{input:e.notifyParam},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:5}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)],1)})),t("div",{staticClass:"add-btn",on:{click:e.addNewItem}},[e._v("新增参数")])],2),t("el-divider",{attrs:{"content-position":"left"}},[e._v("状态查询配置")]),t("el-form-item",{attrs:{label:"状态查询地址"}},[t("el-input",{attrs:{placeholder:"请输入状态查询地址"},on:{input:e.notifyParam},model:{value:e.dataForm.queryUrl,callback:function(t){e.$set(e.dataForm,"queryUrl",t)},expression:"dataForm.queryUrl"}})],1),t("el-form-item",{attrs:{label:"结果条件列表"}},[e._l(e.compareList,(function(a,s){return t("el-row",{key:s,staticClass:"config-line"},[t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"比较Key"},on:{input:e.notifyParam},model:{value:a.compareKey,callback:function(t){e.$set(a,"compareKey",t)},expression:"item.compareKey"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"描述"},on:{input:e.notifyParam},model:{value:a.description,callback:function(t){e.$set(a,"description",t)},expression:"item.description"}})],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"选择数据类型"},on:{change:e.notifyParam},model:{value:a.valueType,callback:function(t){e.$set(a,"valueType",t)},expression:"item.valueType"}},e._l(e.typeList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"选择运算服符"},on:{change:e.notifyParam},model:{value:a.operator,callback:function(t){e.$set(a,"operator",t)},expression:"item.operator"}},e._l(e.operators,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{staticClass:"separate-line",attrs:{span:1}},[e._v("-")]),t("el-col",{attrs:{span:4}},[t("el-input",{attrs:{placeholder:"设置期望值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)],1)})),t("div",{staticClass:"add-btn",on:{click:e.addNewCondition}},[e._v("新增条件")])],2)],1)},mr=[],hr={props:{form:Object},watch:{form:{handler(e){this.dataForm=e,e.paramList&&e.paramList.length>0&&(this.paramList=e.paramList),e.compareResults&&e.compareResults.length>0&&(this.compareList=e.compareResults),this.notifyParam()},deep:!0,immediate:!0}},data(){return{dataForm:{},paramList:[{}],compareList:[{showCompare:!0}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList,actionUrl:this.dataForm.actionUrl,queryUrl:this.dataForm.queryUrl})},addNewItem(){this.paramList.push({})},addNewCondition(){this.compareList.push({showCompare:!0})}},created(){this.dataForm=this.form,this.notifyParam()}},gr=hr,vr=(a("9159"),Object(y["a"])(gr,pr,mr,!1,null,"452d4042",null)),fr=vr.exports,br=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("秒")])])],1)}))],2)},yr=[],wr={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"maxWait",description:"审批最大等待时长(秒)",value:604800}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:[]})},presetValue(e,t,a){let s={};e.forEach(e=>{s[e[a]]=e.value}),t.forEach(e=>{let t=s[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},kr=wr,Cr=(a("8617"),Object(y["a"])(kr,br,yr,!1,null,"948e7356",null)),_r=Cr.exports,Fr=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("默认在根目录下")])])],1)}))],2)},xr=[],Ir={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),e.compareResults&&e.compareResults.length>0&&this.presetValue(e.compareResults,this.compareList,"compareKey"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"pomPath",description:"构建pom相对路径",value:"pom.xml"}],compareList:[{compareKey:"status",description:"构建状态",valueType:"Integer",operator:"=",value:"1",showCompare:!1}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList,actionUrl:this.dataForm.actionUrl,queryUrl:this.dataForm.queryUrl})},presetValue(e,t,a){let s={};e.forEach(e=>{s[e[a]]=e.value}),t.forEach(e=>{let t=s[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},Dr=Ir,Tr=(a("b49e1"),Object(y["a"])(Dr,Fr,xr,!1,null,"fcb24c76",null)),Pr=Tr.exports,Sr=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"在流水线选择部署的环境",disabled:""},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)}))],2)},Lr=[],Nr={props:{form:Object},watch:{form:{handler(e){this.dataForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),e.compareResults&&e.compareResults.length>0&&this.presetValue(e.compareResults,this.compareList,"compareKey"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{dataForm:{},paramList:[{name:"envId",description:"环境Id",value:"",type:"select"}],compareList:[{compareKey:"status",description:"部署状态",value:"",valueType:"Integer",operator:"=",showCompare:!1}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}],deployModes:[{label:"Jar部署",value:"JAR"},{label:"镜像部署",value:"MIRROR"}]}},methods:{presetValue(e,t,a){let s={};e.forEach(e=>{s[e[a]]=e.value}),t.forEach(e=>{let t=s[e[a]];t&&(e.value=t)})},notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList,actionUrl:this.dataForm.actionUrl,queryUrl:this.dataForm.queryUrl})}},created(){this.dataForm=this.form,this.notifyParam()}},$r=Nr,Er=(a("b45d"),Object(y["a"])($r,Sr,Lr,!1,null,"12231a5b",null)),zr=Er.exports,Rr=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"编辑流水线时选择",disabled:""},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)})),t("el-divider",{attrs:{"content-position":"left"}},[e._v("状态查询配置")]),e._l(e.compareList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-input-number",{attrs:{min:50,max:100,label:"请输入默认值"},on:{change:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1)}))],2)},Or=[],Ar={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),e.compareResults&&e.compareResults.length>0&&this.presetValue(e.compareResults,this.compareList,"compareKey"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"taskId",description:"选择任务",value:"",type:"select"}],compareList:[{compareKey:"percent",description:"执行成功率",operator:">=",valueType:"Integer",value:"90",showCompare:!0}],operators:[{label:"equals",value:"equal"},{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="}],typeList:[{label:"数字类型",value:"Integer"},{label:"字符串类型",value:"String"}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:this.compareList})},presetValue(e,t,a){let s={};e.forEach(e=>{s[e[a]]=e.value}),t.forEach(e=>{let t=s[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},qr=Ar,Br=(a("6705"),Object(y["a"])(qr,Rr,Or,!1,null,"70ffc2d0",null)),Vr=Br.exports,Ur=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-input",{attrs:{placeholder:"输入默认值"},on:{input:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("span",{attrs:{slot:"suffix"},slot:"suffix"},[e._v("秒")])])],1)}))],2)},Gr=[],jr={props:{form:Object},watch:{form:{handler(e){this.actionForm=e,e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{actionForm:{},paramList:[{name:"waitTime",description:"节点等待时长",value:10}]}},methods:{notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:[]})},presetValue(e,t,a){let s={};e.forEach(e=>{s[e[a]]=e.value}),t.forEach(e=>{let t=s[e[a]];t&&(e.value=t)})}},created(){this.dataForm=this.form,this.notifyParam()}},Mr=jr,Jr=(a("220e"),Object(y["a"])(Mr,Ur,Gr,!1,null,"094fb5f3",null)),Hr=Jr.exports,Kr=function(){var e=this,t=e._self._c;return t("div",[t("el-divider",{attrs:{"content-position":"left"}},[e._v("动作触发配置")]),e._l(e.paramList,(function(a,s){return t("el-form-item",{key:s,attrs:{label:a.description}},[t("el-radio-group",{on:{change:e.notifyParam},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}},[t("el-radio",{attrs:{label:"1"}},[e._v("是")]),t("el-radio",{attrs:{label:"false"}},[e._v("否")])],1)],1)}))],2)},Wr=[],Qr={props:{form:Object},watch:{form:{handler(e){e.paramList&&e.paramList.length>0&&this.presetValue(e.paramList,this.paramList,"name"),this.notifyParam()},deep:!0,immediate:!0}},data(){return{paramList:[{name:"deleteBranch",description:"是否删除分支",value:2}]}},methods:{presetValue(e,t,a){let s={};e.forEach(e=>{s[e[a]]=e.value}),t.forEach(e=>{let t=s[e[a]];t&&(e.value=t)})},notifyParam(){this.$emit("notifyParam",{paramList:this.paramList,compareList:[]})}},created(){this.notifyParam()}},Yr=Qr,Xr=(a("97ca"),Object(y["a"])(Yr,Kr,Wr,!1,null,"054f31f1",null)),Zr=Xr.exports,el={components:{HttpAct:fr,ApprovalAct:_r,BuildAct:Pr,DeployAct:zr,FeatureAct:Vr,WaitAct:Hr,MergeAct:Zr},data(){return{queryName:"",actionList:[],showCreateExecuter:!1,actionForm:{},currentPage:1,totalSize:0,title:"创建执行点",isEditAction:!1,activeTab:"node",nodeList:[],showCreateNode:!1,nodeTitle:"创建节点",executeList:[],nodeForm:{},selectActions:[],currentNodePage:1,nodeTotalSize:0,queryNodeName:"",isEditNode:!1,executeType:"HTTP",configList:[],compareList:[],nodeRule:{nodeName:[{required:!0,message:"请输入节点名称",trigger:"blur"}],executors:[{required:!0,message:"请选择执行点",trigger:"change"}]},actionRule:{actionName:[{required:!0,message:"请输入执行点名称",trigger:"blur"}],executeType:[{required:!0,message:"请选择执行类型",trigger:"blur"}]}}},methods:{chooseExecuteType(){this.configList=[],this.compareList=[]},addNewCondition(){this.compareList.push({})},startQueryNode(){this.getNodes()},editNode(e){this.isEditNode=!0,this.nodeTitle="编辑节点",this.showCreateNode=!0,this.nodeForm=e,this.nodeForm.executors=[],this.getAllActions(),Yi.getNodeActions(e.nodeId).then(e=>{e.data.forEach(e=>{this.nodeForm.executors.push(e.actionId)})})},notifyParam(e){this.configList=e.paramList,this.compareList=e.compareList},closeNodeDialog(){this.isEditNode=!1,this.showCreateNode=!1,this.nodeForm={executors:[]},this.selectActions=[]},removeNode(e){this.$confirm(`确认删除节点【${e.nodeName}】？`).then(()=>{Yi.deleteNode(e.nodeId).then(e=>{e.data?(this.$message.success("删除节点成功"),this.getNodes()):this.$message.error("删除节点失败")})})},changeNodePage(){this.getNodes()},createNode(){this.nodeTitle="创建节点",this.showCreateNode=!0,this.nodeForm={executors:[]},this.getAllActions()},addNode(e){this.$refs[e].validate(e=>{if(!e)return!1;this.isEditNode?Yi.updateNode(this.nodeForm).then(e=>{e.data?(this.$message.success("修改节点成功"),this.getNodes(),this.closeNodeDialog()):this.$message.error("修改节点失败")}):Yi.createNode(this.nodeForm).then(e=>{e.data?(this.$message.success("添加节点成功"),this.getNodes(),this.closeNodeDialog()):this.$message.error("添加节点失败")})})},getNodes(){Yi.getNodePage(this.currentNodePage,10,this.queryNodeName).then(e=>{this.nodeTotalSize=e.total,this.nodeList=e.data})},startQuery(){this.currentPage=1,this.getActions()},changePage(){this.getActions()},createTemplet(){this.showCreateExecuter=!0,this.title="创建执行点",this.actionForm.executeType="HTTP"},editAction(e){this.isEditAction=!0,this.title="编辑执行点",this.showCreateExecuter=!0,this.actionForm=e,this.executeType=e.executeType},removeAction(e){this.$confirm(`确认删除执行点【${e.actionName}】？`).then(()=>{rr.deleteAction(e.actionId).then(e=>{e.data?(this.$message.success("删除执行点成功"),this.getActions()):this.$message.error("删除执行点失败")})})},closeDialog(){this.showCreateExecuter=!1,this.configList=[],this.compareList=[],this.actionForm={},this.isEditAction=!1,this.executeType="HTTP"},addAction(e){this.$refs[e].validate(e=>{if(!e)return!1;let t=this.actionForm;t.paramList=[],this.configList.forEach(e=>{"TEST"==this.executeType&&(e.type="select"),e.description&&e.name&&t.paramList.push(e)}),t.compareResults=[],this.compareList.forEach(e=>{e.value&&e.compareKey&&t.compareResults.push(e)}),t.executeType=this.executeType,this.isEditAction?rr.updateAction(t).then(e=>{e.data?(this.$message.success("修改执行点成功"),this.closeDialog(),this.getActions()):this.$message.error("修改执行点失败")}):rr.createAction(t).then(e=>{e.data?(this.$message.success("创建执行点成功"),this.closeDialog(),this.getActions()):this.$message.error("创建执行点失败")})})},addNewItem(){this.configList.push({})},getActions(){rr.getActionPage(this.currentPage,10,this.queryName).then(e=>{this.totalSize=e.total,this.actionList=e.data})},getAllActions(){rr.getActionPage(1,100,"").then(e=>{this.executeList=[],e.data.forEach(e=>{this.executeList.push({label:e.actionName,value:e.actionId})})})}},created(){this.getActions(),this.getNodes()}},tl=el,al=(a("5606"),Object(y["a"])(tl,dr,ur,!1,null,"152ea596",null)),sl=al.exports,il=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"title-line"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,size:"mini"}},[t("el-form-item",{attrs:{label:"服务列表"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-select",{attrs:{size:"small",placeholder:"选择服务"},on:{change:e.selectService},model:{value:e.service,callback:function(t){e.service=t},expression:"service"}},e._l(e.serviceList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.serviceName,value:e.serviceId}})})),1)],1)],1)],1),t("div",{staticClass:"change-content"},[t("div",{staticClass:"change-title"},[t("div",{staticClass:"change-desc"},[e._v("代码变更列表")]),t("div",{staticClass:"add-btn"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-plus-outline"},on:{click:e.addChangeCode}},[e._v("添加变更")])],1)]),t("div",{staticClass:"change-list"},[t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.changeList,stripe:""}},[t("el-table-column",{attrs:{prop:"changeName",label:"变更"}}),t("el-table-column",{attrs:{prop:"changeBranch",label:"分支"}}),t("el-table-column",{attrs:{prop:"changeDesc",label:"描述"}}),t("el-table-column",{attrs:{prop:"relationId",label:"需求/缺陷Id"}}),t("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("dateFormat")(t.row.createTime))+" ")]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},on:{click:function(t){return e.removeChange(a.row)}},slot:"reference"},[e._v("删除")])]}}])})],1)],1)])]),t("el-dialog",{attrs:{title:"创建变更",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"changeForm",attrs:{model:e.changeForm,rules:e.rule,size:"mini","label-width":"120px"}},[t("el-form-item",{attrs:{label:"变更描述",prop:"changeName"}},[t("el-input",{attrs:{placeholder:"请输入变更详细说明",autocomplete:"off"},model:{value:e.changeForm.changeName,callback:function(t){e.$set(e.changeForm,"changeName",t)},expression:"changeForm.changeName"}})],1),t("el-form-item",{attrs:{label:"详细说明",prop:"changeDesc"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入详细说明",autosize:{minRows:2,maxRows:4}},model:{value:e.changeForm.changeDesc,callback:function(t){e.$set(e.changeForm,"changeDesc",t)},expression:"changeForm.changeDesc"}})],1),t("el-form-item",{attrs:{label:"选择分支",prop:"branchType"}},[t("el-radio-group",{on:{change:e.selectBranchType},model:{value:e.changeForm.branchType,callback:function(t){e.$set(e.changeForm,"branchType",t)},expression:"changeForm.branchType"}},[t("el-radio",{attrs:{label:"default"}},[e._v("默认")]),t("el-radio",{attrs:{label:"custom"}},[e._v("自定义")])],1)],1),t("el-form-item",{attrs:{label:"变更分支",prop:"changeBranch"}},[t("el-input",{attrs:{disabled:e.editBranch,placeholder:"请输入分支名",autocomplete:"off"},model:{value:e.changeForm.changeBranch,callback:function(t){e.$set(e.changeForm,"changeBranch",t)},expression:"changeForm.changeBranch"}})],1),t("el-form-item",{attrs:{label:"关联需求/bug",prop:"relationId"}},[t("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearchAsync,placeholder:"请输入关联的需求、缺陷、任务名称"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function({item:a}){return[1==a.relationType?t("div",{staticClass:"query-type demand"},[e._v(" 需求 ")]):2==a.relationType?t("div",{staticClass:"query-type bug"},[e._v(" 缺陷 ")]):t("div",{staticClass:"query-type work"},[e._v("任务")]),t("span",[e._v(e._s(a.value))])]}}]),model:{value:e.changeForm.relationId,callback:function(t){e.$set(e.changeForm,"relationId",t)},expression:"changeForm.relationId"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"mini"},on:{click:e.closeDialog}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.confirmChange("changeForm")}}},[e._v("确 定")])],1)],1)],1)},rl=[],ll={data(){return{service:"",serviceList:[],changeList:[],changeForm:{branchType:"custom"},selectItem:null,dialogFormVisible:!1,loading:!1,editBranch:!1,rule:{changeName:[{required:!0,message:"请输入变更描述",trigger:"blur"}],changeBranch:[{required:!0,message:"请输入分支名称",trigger:"blur"}]}}},methods:{querySearchAsync(e,t){js.relationList(e).then(e=>{console.log("res",e);let a=[];e.data.forEach(e=>{e.value=e.name,a.push(e)}),t(a)})},handleSelect(e){this.selectItem=e},getServices(){this.serviceList=[],F.getServices().then(e=>{this.serviceList=e.data,this.service=this.serviceList[0].serviceId,this.getCodeChangeList()})},addChangeCode(){this.dialogFormVisible=!0},selectService(){this.getCodeChangeList()},selectBranchType(e){if("default"==e){let e="develop_";var t=new Date,a=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear();e+=i+s+a+"_"+this.$utils.randomString(6),this.editBranch=!0,this.changeForm.changeBranch=e}else this.changeForm.changeBranch="",this.editBranch=!1},removeChange(e){this.$confirm("确认删除？").then(()=>{js.deleteCodeChange(this.service,e.changeId).then(()=>{this.$message({message:"删除变更成功",type:"success"}),this.getCodeChangeList()})})},closeDialog(){this.dialogFormVisible=!1,this.changeForm={}},confirmChange(e){this.$refs[e].validate(e=>{if(!e)return!1;this.changeForm.relationId=this.selectItem.relatedId,this.changeForm.serviceId=this.service,js.saveCodeChange(this.changeForm).then(()=>{this.$message({message:"创建变更成功",type:"success"}),this.changeForm={branchType:"custom"},this.dialogFormVisible=!1,this.getCodeChangeList()})})},getCodeChangeList(){js.codeChangeList(this.service).then(e=>{this.changeList=e.data})}},created(){this.getServices()}},ol=ll,nl=(a("5f65"),Object(y["a"])(ol,il,rl,!1,null,"b4e11d18",null)),cl=nl.exports;s["default"].use(o["a"]);const dl=[{path:"/login",name:"Login",component:qt},{path:"/user",name:"User",component:Mt},{path:"",component:k,children:[{path:"rbac",name:"RBAC",component:ba},{path:"space",name:"Space",component:As},{path:"case",name:"TestCase",component:S},{path:"e2e",name:"TestE2E",component:U},{path:"workbench",name:"Workbench",component:Ks},{path:"feature",name:"Feature",component:wt},{path:"template",name:"Template",component:$t},{path:"task",name:"Task",component:xa},{path:"record/detail",name:"RecordDetail",component:ei},{path:"",name:"Service",component:ni},{path:"pipeline",name:"Pipeline",component:cr},{path:"code/change",name:"CodeChange",component:cl},{path:"pipe/action",name:"PipeAction",component:sl},{path:"env",name:"Environment",component:Fi},{path:"service/resource",name:"ServiceApi",component:hi},{path:"system",name:"System",component:Si},{path:"monitor",name:"Monitor",component:Ri}]}],ul=new o["a"]({mode:"history",base:"/",routes:dl});var pl=ul,ml={randomString(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=t.length,s="";for(let i=0;i<e;i++)s+=t.charAt(Math.floor(Math.random()*a));return s},isEmpty(e){return null==e||void 0==e||""==e}},hl=a("9a30");s["default"].filter("dateFormat",(function(e){if(!e)return"";var t=new Date(e),a=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear();let r=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return i+"-"+s+"-"+a+" "+r+":"+l+":"+o})),s["default"].filter("dayFormat",(function(e){if(!e)return"";var t=new Date(e),a=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),i=t.getFullYear();return i+"-"+s+"-"+a})),s["default"].filter("statusFormat",(function(e){if(!e)return"";switch(e){case 1:return"success";case 2:return"danger";case 3:return"info";case 4:return"primary";case 5:return"wrning";case 6:return"info"}return"info"})),s["default"].filter("publisFormat",(function(e){if(!e)return"-";switch(e){case 1:return"待发布";case 2:return"发布中"}return"-"})),s["default"].filter("deployType",(function(e){if(!e)return"-";switch(e){case 1:return"ssh部署";case 2:return"K8S部署";case 3:return"Docker部署"}return"-"})),s["default"].filter("deployFormat",(function(e){if(!e)return"-";switch(e){case 1:return"可用";case 2:return"不可用"}return"-"})),s["default"].filter("statusName",(function(e){if(!e)return"";switch(e){case 1:return"处理成功";case 2:return"处理失败";case 3:return"处理超时";case 4:return"运行中";case 5:return"跳过失败";case 6:return"停止运行"}return"info"}));var gl=a("e5d9"),vl=a("2f62");s["default"].use(vl["a"]);var fl=new vl["a"].Store({state:{caseContext:{},spaceId:"",iterationId:""},mutations:{UPDATE_CASE_CONTEXT(e,t){e.caseContext&&0!==Object.keys(e.caseContext).length||(e.caseContext={}),e.caseContext[t.key]=t.value},UPDATE_SPACE(e,t){e.spaceId=t},UPDATE_ITERATION(e,t){e.iterationId=t}},actions:{},modules:{}});s["default"].use(gl["a"]),s["default"].prototype.$utils=ml,s["default"].use(l.a),s["default"].use(hl["a"]),s["default"].config.productionTip=!1,s["default"].directive("clickOnce",{inserted(e){e.addEventListener("click",()=>{e.classList.add("is-disabled"),e.disabled=!0,setTimeout(()=>{e.disabled=!1,e.classList.remove("is-disabled")},2e3)})}}),new s["default"]({store:fl,router:pl,render:e=>e(i["default"])}).$mount("#app")},"5a9e":function(e,t,a){"use strict";a("c18b")},"5e2d":function(e,t,a){"use strict";a("c6d6")},"5f65":function(e,t,a){"use strict";a("f541")},6705:function(e,t,a){"use strict";a("bdbf")},6888:function(e,t,a){"use strict";a("f671")},"6c62":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFwAAABcCAMAAADUMSJqAAAAclBMVEX///8lZuQWYOP8/f8gZOQcYuTk6vsybOUuauUqaOQQXuORqu8/c+ZhiOm+zPVTf+jL1vfy9f0AWeOFoe2ds/CkuPHF0fbt8fyxwvNLeufU3fjg5vrZ4fn3+f7p7fsAW+NzleupvPJ7muxrj+oAVOIASuHJijtZAAAGsElEQVRo3uVZaZOrKhANCgqK+xK3RGPm/v+/eBVQETCJM3OrXtXjU+LSNt19Th/gcvlfjJvj3P6R6bsfuW6U3/+B6WsGIXZdjECW/LJpZ0zBZHoeGKaj84umm2cKXGmA9Nn8kuk4gMRVBoFB/HPLdhlYmmlmHgWl/TPTYeQZTTPzVhT+wHxFj00z8x6tvun1A1vYfTOmRx7nvb/mELofDQTz67my9gHEpigbk4uI/3nht5lrMu2SqG0jk3WM3Mz5EIwQHORvQk5zcA/CD2DbDik4DO/EWc7hTZAO7Rswpse1h3F3uXQvapOkL2Db1OhlWVvl5VJaLwsf1Z3ZdvgaMZPxCTEP9KbwvdLYC9C7iob55eK/rX5kqvrs/Wv+J09B39AfozdYxwBOpRjDN7Gb0KDzgQNfU1RaD/n8nD/Q1Hr1AUz0gi+9V+SXlVvbt5NwdFVOk/568auQE+IimfiCUmvJ1yqSaxJRTF4FfQs5ibp7sXqG6tLMyJULthq9ttL7gVaIdCvncPr/sAQl+Yd0nYziGfZCuM2EqsUYb/fQY75QzDkgeOvydsxiGTfb18J5fthj3SjfwopUaVBAKd0sEJUHYb0E+/6o05TFMkvTqFouOy6AzO9LKNEdKhTjgVRdGI7zxBo/EE46GZhYBxbCQzJ1ByHqkiCfqdB5yoWsBt1WUEbkxptj1jssdo0nA7oP6YEHUGhaIUSVxPtsCW0SiHR4bP7V8u+5PGAPnlL0ZE+NlYbPVDzQrn2Jg2MFG3RFUcSpRkLhzvioARoMwq/8S/jlsSJohHH8tQQm0FoXyHbGDcSyorKlHK8em0vXC2ytDHLXuzneobnXGoNUTreMJ5G1yBYx3MjY0jm+l/kiRBq/MqJaOm44RRhj5qszBQFSwU02u5RobQbJlOGrYQOcfNKFg+4BgpS5c3WhNYhU2hnkpEfMr+sQ4rXCXHoga1imXyydvQwWDNyeFodnp0ZVhpGtFROHAUvc4fotoVOsavZTi0u/paTpjX2wmb8J3AOZ6RC8TjHTMLjBKFfTDcMtE5gYhVTDCxDmxoKAW7ENWkJme7bIBIYGHRUKfwjDWqd6Toa1jqkm3GwW07WyBGDKohA11i0kgFlOEqK2VLqkykmNCLuuLfuLm4x7hDgHXMKFE1yPpUTDaLoAuNIgRNk3ew6nXsDRYXMnjMltn6RcwaR3UVe69DOzFi+wNp2XEpG/9DUW2DW9ducHaFKX3EWquk7GI60lPP9Dn5W0TXGrySwNJAFzD4f6DzeuBVboLsegn5ixUqnwDAAAMwVJ8c0Y80V36VqLILOe6J6DWX7fdGEvpLQsXAmAqP+qT296JPVXbyFZpArdJYUcBX5RNYrpWxcWobK0zsNGiZndhVUeICnoitYCisq7dnEx0ClKaC8uy352kj6nTyj7RlLfYLor3v73vMxubcfdioCF+B7Ojv0X7BNkIc6K97jj0203CmSkUaC9VHL8yPJ4rqVbuwzfFIK6W55XZ+30TI72qnCUSAeMfpDOdCfSgaQFC6PPXMx+ueGtrIpBGviy8GJFu2uvBAgmBLakgBZY+n3Pv9IKouKa1RbbX4TIBYlmR8wrSyEmuSvkydGGVoJ8MjOAd7PCbGGOuR2ZVzgsp9cZ8stCZACrVoqZwKasVq7UuFqPLkam5x/mOG9dMpXsjfeeTXzPfMSW64drzEUvhsa1lqi+FhMRIt6YRGMvEAH89dho21th5xsXz5gD5ErTRO6TXGVOGo3fTlzT+tWS4BiYIkOWVsWnsBjBXHYsnlHTq/C50/6mpAJZs2yA2q1KIrNbezIl2Jjxu2TFQ4AAgDxQb2QYQOMaWhEjoTHshK4LM9sp82wYsrx0Vipoa2OhQW3lmputo/x42/ABjAixcv3Rp3lnoc+PbOepcZ9jl8x11EY/YHFkvDCDpzYfG1hHWEqCLJYaTzKtUKfSL42BhAe61URhMzcllEBEozGvwrAqsogiCOY2a0KHd7g/pycVg2ZZ1040MPUEC/IszmTbAHxApsYxqGFkpEwNiWO6SXMGjq+2tZWkMt3kGHnNc2a2xgroXm53X/c0hKrDqmBVtJew2H2z1x3vksraGDWWM4vL/rvW2yOYahcEGjvZwWYmHNt414P6D44YRrg7NkCHW4LA2s1SlajmUQP3G0P0zLeiEuPzton7oXjt0GnrGHYfnw95Z417J86LfOucbcs/I+aDU0kFwbkDYetUwE8eHrf9iYCfPnuNIcQfjMlt+I2TUSerMVGGHhG3zr534p04H4zfPu3+b4y/2/KnF87ecHwAAAAASUVORK5CYII="},7149:function(e,t,a){},"72fa":function(e,t,a){},"79ea":function(e,t,a){},"7ae7":function(e,t,a){},"7c91":function(e,t,a){"use strict";a("de6c")},"7cc9":function(e,t,a){},"7d9e":function(e,t,a){},"7f01":function(e,t,a){e.exports=a.p+"img/logo.718c4601.svg"},8533:function(e,t){},8617:function(e,t,a){"use strict";a("e3f7")},8901:function(e,t,a){"use strict";a("d62b")},"894b":function(e,t,a){"use strict";a("400f")},"8bce":function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return i}));var s=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("router-view")},i=[]},"8bd4":function(e,t,a){"use strict";a("b94b")},"8c29":function(e,t,a){},"8c59":function(e,t,a){},9090:function(e,t,a){},9159:function(e,t,a){"use strict";a("1913")},"97ca":function(e,t,a){"use strict";a("d259")},"9fa8":function(e,t,a){"use strict";a("fb83")},a569:function(e,t,a){},a5c6:function(e,t,a){"use strict";a("d722")},a77f:function(e,t,a){"use strict";a("1b58")},aaa0:function(e,t,a){},afcb:function(e,t,a){},afd5:function(e,t,a){"use strict";a("d94c")},b3ef:function(e,t,a){e.exports=a.p+"media/background.ed17fcee.mp4"},b45d:function(e,t,a){"use strict";a("eb13")},b49e:function(e,t,a){"use strict";a("c533")},b49e1:function(e,t,a){"use strict";a("02f3")},b4e1:function(e,t,a){"use strict";a("7cc9")},b4eb:function(e,t,a){},b92d:function(e,t,a){"use strict";a("2a9b")},b94b:function(e,t,a){},bd78:function(e,t,a){"use strict";a("a569")},bdbf:function(e,t,a){},c181:function(e,t,a){"use strict";a("37bc")},c18b:function(e,t,a){},c420:function(e,t,a){},c533:function(e,t,a){},c6d6:function(e,t,a){},c942:function(e,t,a){"use strict";a("0934")},cbd4:function(e,t,a){"use strict";a("52d0")},cd78:function(e,t,a){"use strict";a("1d24")},ce5c:function(e,t,a){"use strict";a("25c3")},d259:function(e,t,a){},d5d1:function(e,t,a){"use strict";a("8c59")},d62b:function(e,t,a){},d6d7:function(e,t,a){},d722:function(e,t,a){},d7a9:function(e,t,a){},d7d14:function(e,t,a){"use strict";a("edb7")},d94c:function(e,t,a){},dcf8:function(e,t,a){"use strict";a("7d9e")},dd00:function(e,t,a){"use strict";a("7149")},de6c:function(e,t,a){},df7a:function(e,t,a){},e3f7:function(e,t,a){},e9e8:function(e,t,a){"use strict";a("72fa")},eb13:function(e,t,a){},ebe0:function(e,t,a){"use strict";a("d6d7")},edb7:function(e,t,a){},eed3:function(e,t,a){"use strict";a("38ce")},f4a6:function(e,t,a){"use strict";a("b4eb")},f541:function(e,t,a){},f55a:function(e,t,a){"use strict";a("c420")},f671:function(e,t,a){},f762:function(e,t,a){},f9f0:function(e,t,a){"use strict";a("afcb")},fb83:function(e,t,a){},fd4e:function(e,t,a){"use strict";a("7ae7")}});
//# sourceMappingURL=app.a112876f.js.map